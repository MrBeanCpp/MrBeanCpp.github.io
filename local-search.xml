<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>å¦‚ä½•è·å–æ–‡ä»¶ï¼ˆå¤¹ï¼‰å›¾æ ‡ without Cache</title>
    <link href="/2024/08/01/How-to-get-file-folder-icon/"/>
    <url>/2024/08/01/How-to-get-file-folder-icon/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦ï¼ˆè¿«çœŸï¼‰"><a href="#å‰æƒ…æè¦ï¼ˆè¿«çœŸï¼‰" class="headerlink" title="å‰æƒ…æè¦ï¼ˆè¿«çœŸï¼‰"></a>å‰æƒ…æè¦ï¼ˆè¿«çœŸï¼‰</h2><p>ä¹¦æ¥ä¸Šå›ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»äº†å¦‚ä½•è®¾ç½®æ–‡ä»¶å¤¹å›¾æ ‡ï¼Œæƒ³å¿…å¤§å®¶éƒ½æ„çŠ¹æœªå°½</p><p>é‚£ä¹ˆæ ¹æ®æœ‰<code>Set</code>å¿…æœ‰<code>Get</code>å®šç†ï¼Œæœ¬èŠ‚æˆ‘ä»¬æ¥è®²è®²å›¾æ ‡çš„è·å–ï¼ˆon <code>Windows</code>ï¼‰</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Qt</code>æ˜¯ä¸€ä¸ª<code>Convenient</code>çš„<code>C++</code>åº“</p><p>Soï¼Œé•¿è¯çŸ­è¯´ï¼Œä¸¤è¡Œä»£ç ç§’äº†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++">QFileIconProvider iconPro;<br>QIcon icon = iconPro.<span class="hljs-built_in">icon</span>(dirPath);<br></code></pre></td></tr></table></figure><p>å¥½çš„ï¼Œè¯·å¤§å®¶æœ‰åºé€€åœºğŸ‘‹</p><blockquote><p> æ–°åƒå¸­è§‚ä¼—è¿˜åœ¨æ‡µé€¼ï¼Œè€åƒå¸­è§‚ä¼—å·²ç»å¼€å§‹æ’æ’åäº†ï¼šéƒ½çŸ¥é“ç¬”è€…å‡ºæ‰‹å¿…æœ‰å¤§å‘</p></blockquote><h2 id="ç¼“å­˜ï¼ˆCacheï¼‰"><a href="#ç¼“å­˜ï¼ˆCacheï¼‰" class="headerlink" title="ç¼“å­˜ï¼ˆCacheï¼‰"></a>ç¼“å­˜ï¼ˆCacheï¼‰</h2><p>å¤§å®¶çœ‹çœ‹è¿™æ˜¯ä»€ä¹ˆâ˜ï¼Œè€æœ‹å‹äº†</p><p>ç¼“å­˜æ˜¯ä¸ªå¥½ä¸œè¥¿å•Šï¼Œç©ºé—´æ¢æ—¶é—´ï¼Œç°ä»£CPUéƒ½ä¸Šåˆ°ä¸‰çº§ç¼“å­˜äº†</p><blockquote><p>å¯æ˜¯æ²¡æœ‰ä»€ä¹ˆæ˜¯æ°¸æ’çš„ï¼Œæ˜¯éå¥½åã€çœŸå‡å¯¹é”™ï¼Œç”šè‡³æ˜¯è¿™å¥è¯æœ¬èº« â€”â€” MrBeanC</p></blockquote><p>å’Œæ–‡ä»¶ç³»ç»Ÿæ‰“äº¤é“ï¼Œæ—¶æ•ˆæ€§ç¡®å®ä¸å¤ªèƒ½ä¿è¯ï¼Œæ— è®ºæ˜¯<code>HDD</code>äº¦æˆ–æ˜¯<code>SSD</code>ï¼Œåœ¨<code>Memory</code>é¢å‰å°±æ˜¯å¼Ÿå¼Ÿ</p><p>é‚£ä¹ˆ<code>Qt</code>ç»™<code>QFileIconProvider</code>ä¸Šç¼“å­˜ä¹Ÿä¸éš¾ç†è§£äº†</p><h3 id="æ–‡ä»¶å¤¹å›¾æ ‡ç¼“å­˜"><a href="#æ–‡ä»¶å¤¹å›¾æ ‡ç¼“å­˜" class="headerlink" title="æ–‡ä»¶å¤¹å›¾æ ‡ç¼“å­˜"></a>æ–‡ä»¶å¤¹å›¾æ ‡ç¼“å­˜</h3><p>æ²¡é”™ï¼Œåœ¨ç¨‹åºç”Ÿå‘½å‘¨æœŸå†…ï¼Œä½¿ç”¨<code>QFileIconProvider::icon</code>è·å–æ–‡ä»¶å¤¹å›¾æ ‡ï¼Œä¼šåœ¨<strong>å…¨å±€</strong>èŒƒå›´å†…è¿›è¡Œç¼“å­˜</p><p>æ— è®ºåç»­æ–‡ä»¶å¤¹å›¾æ ‡æ˜¯å¦æ”¹å˜ï¼Œéƒ½åªä¼šè¿”å›ç¬¬ä¸€æ¬¡ç¼“å­˜çš„ç»“æœ</p><h3 id="åŸºæ“åˆ†å‰²çº¿"><a href="#åŸºæ“åˆ†å‰²çº¿" class="headerlink" title="åŸºæ“åˆ†å‰²çº¿"></a>åŸºæ“åˆ†å‰²çº¿</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œéƒ½æ˜¯åŸºæ“ï¼ˆåŸºæœ¬æ“ä½œï¼‰</p><p>ä½†æ˜¯æï¼Œå¯¹äºç¼“å­˜è¿™ä»¶äº‹ï¼Œ<code>QFileIconProvider</code>çš„<a href="https://doc.qt.io/qt-5/qfileiconprovider.html">æ–‡æ¡£</a>é‡Œåªå­—æœªæï¼Œç”šè‡³æŸ¥ä¸åˆ°<code>Cache</code>è¿™ä¸ªè¯</p><p>è€Œä¸”å“ˆï¼Œè¿™ä¸ªç±»ï¼Œä¹Ÿæ²¡æœ‰æä¾›ä»»ä½•æ–¹æ³•ï¼ˆmethodï¼‰æ¥æ¸…é™¤ç¼“å­˜æˆ–é€‰æ‹©ä¸ç¼“å­˜</p><p>No, Nothing</p><p>è¿™æˆ–è®¸å°±æ˜¯æ— å½¢çš„æ‰‹å§.ğŸ¤Œ</p><p>ğŸ˜ ğŸ˜¾ğŸ¤¬ğŸ’¬ğŸ—¯ï¸</p><h3 id="So-What"><a href="#So-What" class="headerlink" title="So What"></a>So What</h3><p>å¯èƒ½ï¼ˆä¸å¯èƒ½ï¼‰æœ‰äººè§‰å¾—è¿™æ²¡ä»€ä¹ˆ</p><p>ä¸‡ä¸€ï¼Œæˆ‘æ˜¯è¯´ä¸‡ä¸€å“ˆï¼Œæœ‰è¿™ä¹ˆä¸€æ¬¾è½¯ä»¶ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯ä¿®æ”¹æ–‡ä»¶å¤¹å›¾æ ‡</p><p>&#x2F;&#x2F; æºç çº§å¹¿å‘Šæ¤å…¥ï¼š<a href="https://github.com/MrBeanCpp/Dr-Folder">Dr.Folder</a></p><p>ä¿®æ”¹å®Œæˆåï¼Œè½¯ä»¶ä¼šé‡æ–°è·å–å¹¶å±•ç¤ºè¯¥å›¾æ ‡ï¼ˆæˆ–è€…æ˜¯ä¸é‡å¯çš„æƒ…å†µä¸‹åˆ·æ–°ï¼‰</p><p>ç„¶åå‡å¦‚è·å–çš„è¿˜æ˜¯æ—§å›¾æ ‡ï¼Œä½ è¯´è¿™ä¸å®ŒçŠŠå­äº†ğŸ˜‘</p><h3 id="è¿”ç’å½’çœŸ"><a href="#è¿”ç’å½’çœŸ" class="headerlink" title="è¿”ç’å½’çœŸ"></a>è¿”ç’å½’çœŸ</h3><p>é‚£æ²¡åŠæ³•äº†ï¼Œä½ ä»æˆ‘ä¹‰ï¼ˆçš„åä¹‰è¯ï¼‰</p><p>è¿˜æ˜¯çœ‹çœ‹è¿œæ–¹çš„<code>Windows API</code>å§ï¼Œå®¶äººä»¬</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QIcon <span class="hljs-title">getFileIcon</span><span class="hljs-params">(QString filePath)</span> </span>&#123;<br>    filePath = QDir::<span class="hljs-built_in">toNativeSeparators</span>(filePath); <span class="hljs-comment">// IMPORTANT: å¦åˆ™ä¼šæ‰¾ä¸åˆ°æ–‡ä»¶</span><br><br>    <span class="hljs-built_in">CoInitialize</span>(<span class="hljs-literal">NULL</span>); <span class="hljs-comment">// important for SHGetFileInfoï¼Œå¦åˆ™å¤±è´¥</span><br>    SHFILEINFO sfi;<br>    <span class="hljs-built_in">memset</span>(&amp;sfi, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(SHFILEINFO));<br><br>    QIcon icon;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">SHGetFileInfo</span>(filePath.<span class="hljs-built_in">toStdWString</span>().<span class="hljs-built_in">c_str</span>(), <span class="hljs-number">0</span>, &amp;sfi, <span class="hljs-built_in">sizeof</span>(SHFILEINFO), SHGFI_ICON)) &#123;<br>        icon = QtWin::<span class="hljs-built_in">fromHICON</span>(sfi.hIcon); <span class="hljs-comment">// è²Œä¼¼Qt6åˆ é™¤äº†è¿™ä¸ªæ¨¡å— å“­</span><br>        <span class="hljs-built_in">DestroyIcon</span>(sfi.hIcon);<br>    &#125;<br>    <span class="hljs-built_in">CoUninitialize</span>();<br><br>    <span class="hljs-keyword">return</span> icon;<br>&#125;<br></code></pre></td></tr></table></figure><p>Okayï¼Œå®Œç¾ï¼Œå…„å¼Ÿä»¬ï¼Œå¯ä»¥è·å–åˆ°åŸæ±åŸå‘³çš„å›¾æ ‡äº†</p><h3 id="å°ä¸‘"><a href="#å°ä¸‘" class="headerlink" title="å°ä¸‘"></a>å°ä¸‘</h3><p>å¥½çš„ï¼Œç¼“å­˜æ˜¯æ²¡ç¼“å­˜äº†ï¼Œä½†æ˜¯å¡ç‚¸äº†</p><p>è¿™æ³¢å•Šï¼Œè¿™æ³¢æ˜¯æ—¶é—´æ¢æ—¶æ•ˆ</p><h3 id="ç³»ç»Ÿçº§ç¼“å­˜ï¼ˆAttentionï¼‰"><a href="#ç³»ç»Ÿçº§ç¼“å­˜ï¼ˆAttentionï¼‰" class="headerlink" title="ç³»ç»Ÿçº§ç¼“å­˜ï¼ˆAttentionï¼‰"></a>ç³»ç»Ÿçº§ç¼“å­˜ï¼ˆAttentionï¼‰</h3><p>æ³¨æ„ï¼Œé™¤äº†<code>Qt</code>å†…éƒ¨çš„å›¾æ ‡ç¼“å­˜å¤–ï¼Œ<code>Windows</code>æ–‡ä»¶ç³»ç»Ÿä¹Ÿä¼šå¯¹è¿›è¡Œä¸€å®šçš„ç¼“å­˜</p><p>å‚è€ƒæˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« ï¼š<a href="https://blog.cls.ink/2024/07/27/Set-Folder-Icon-and-Refresh-Cache-Immediately/#%E5%9B%BE%E6%A0%87%E7%BC%93%E5%AD%98">æ›´æ”¹æ–‡ä»¶å¤¹å›¾æ ‡ &amp; ä½¿å…¶ç«‹å³ç”Ÿæ•ˆ - MrBeanC-Blog (cls.ink)</a></p><p>è¿™ä¹ˆè¯´å§ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…è¿ç»­è°ƒç”¨<code>SHGetFileInfo</code>ï¼Œå…¶é€Ÿåº¦ä¼šè¶Šæ¥è¶Šå¿«</p><p>ä½†æ˜¯ç¬¬ä¸€æ¬¡çš„è°ƒç”¨æ—¶é•¿å¯è¾¾æ•°ç§’ï¼ˆæœ€å¤šï¼‰æˆ–æ•°ç™¾æ¯«ç§’ï¼ˆå¸¸è§ï¼‰ï¼Œè¿™æ˜¯ä¸å¯æ¥å—çš„</p><h3 id="å§œè¿˜æ˜¯è€çš„è¾£"><a href="#å§œè¿˜æ˜¯è€çš„è¾£" class="headerlink" title="å§œè¿˜æ˜¯è€çš„è¾£"></a>å§œè¿˜æ˜¯è€çš„è¾£</h3><p>ä½†æ˜¯<code>QFileIconProvider</code>äººå®¶å°±ä¸å¡ï¼Œè¿™å¯å’Œä»€ä¹ˆå†…éƒ¨ç¼“å­˜æ— å…³å•Š</p><p>äººå®¶ç¬¬ä¸€æ¬¡è·å–å°±ä¸å¡çš„</p><p>è€Œä¸”æ¯”<code>SHGetFileInfo</code>å¿«äº†ä¸€ä¸ªæ•°é‡çº§ï¼ˆWTFï¼Ÿï¼‰</p><p>è¿™ä¸ç§‘å­¦å§ï¼Œç”¨äº†ä»€ä¹ˆé»‘ç§‘æŠ€</p><h2 id="QFileIconProvideræºç å‰–æ"><a href="#QFileIconProvideræºç å‰–æ" class="headerlink" title="QFileIconProvideræºç å‰–æ"></a><code>QFileIconProvider</code>æºç å‰–æ</h2><blockquote><p>éƒ½æŠŠè‡ªå·±çš„å¿ƒè‚ºè‚ å­ç¿»å‡ºæ¥ï¼Œæ™’ä¸€æ™’ï¼Œæ´—ä¸€æ´—ï¼Œæ‹¾æ‡æ‹¾æ‡ â€”â€” åº·ç†™</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QIcon <span class="hljs-title">QFileIconProviderPrivate::getIcon</span><span class="hljs-params">(<span class="hljs-type">const</span> QFileInfo &amp;fi)</span> <span class="hljs-type">const</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> QGuiApplicationPrivate::<span class="hljs-built_in">platformTheme</span>()-&gt;<span class="hljs-built_in">fileIcon</span>(fi, <span class="hljs-built_in">toThemeIconOptions</span>(options));<br>&#125;<br><span class="hljs-function">QIcon <span class="hljs-title">QFileIconProvider::icon</span><span class="hljs-params">(<span class="hljs-type">const</span> QFileInfo &amp;info)</span> <span class="hljs-type">const</span> </span>&#123;<br>...<br>    QIcon retIcon = d-&gt;<span class="hljs-built_in">getIcon</span>(info);<br>    <span class="hljs-keyword">if</span> (!retIcon.<span class="hljs-built_in">isNull</span>())<br>        <span class="hljs-keyword">return</span> retIcon;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ç°ç»†èŠ‚éšè—åœ¨äº†<code>platformTheme()-&gt;fileIcon()</code></p><p>è¿™ä¹Ÿæ˜¯<code>Qt</code>å®ç°è·¨å¹³å°çš„ç§˜è¯€ï¼šæ¯ä¸ªå¹³å°å†™ä¸€ä»½ä»£ç </p><p>è¿™é‡Œæˆ‘ä»¬æ¥é‡ç‚¹å…³æ³¨ä¸€ä¸‹<code>Windows</code>çš„å®ç°ï¼ˆ<code>qtbase/src/plugins/platforms/windows/qwindowstheme.cpp</code>ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QIcon <span class="hljs-title">QWindowsTheme::fileIcon</span><span class="hljs-params">(<span class="hljs-type">const</span> QFileInfo &amp;fileInfo, QPlatformTheme::IconOptions iconOptions)</span> <span class="hljs-type">const</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">QIcon</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">QWindowsFileIconEngine</span>(fileInfo, iconOptions));<br>&#125;<br></code></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œä¸ç¦æ„Ÿå¹ï¼šå¦™å“‰å¦™å“‰</p><p>åŸæ¥æˆ‘ä»¬é€šè¿‡<code>QFileIconProvider::icon</code>è·å–çš„å›¾æ ‡é‡Œå¹¶æ²¡æœ‰çœŸæ­£çš„å›¾åƒæ•°æ®ï¼Œè€Œæ˜¯å°è£…äº†ä¸€ä¸ª<code>Engine</code>ï¼ˆç”¨äºè·å–å›¾æ ‡çš„ä¸­ä»‹ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">QWindowsFileIconEngine</span> : <span class="hljs-keyword">public</span> QAbstractFileIconEngine<br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">QWindowsFileIconEngine</span><span class="hljs-params">(<span class="hljs-type">const</span> QFileInfo &amp;info, QPlatformTheme::IconOptions opts)</span> :</span><br><span class="hljs-function">        QAbstractFileIconEngine(info, opts) &#123;</span>&#125;<br><br>    <span class="hljs-function">QList&lt;QSize&gt; <span class="hljs-title">availableSizes</span><span class="hljs-params">(QIcon::Mode = QIcon::Normal, QIcon::State = QIcon::Off)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span><br><span class="hljs-function">    </span>&#123; <span class="hljs-keyword">return</span> QWindowsTheme::<span class="hljs-built_in">instance</span>()-&gt;<span class="hljs-built_in">availableFileIconSizes</span>(); &#125;<br><br><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-function">QString <span class="hljs-title">cacheKey</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function">QPixmap <span class="hljs-title">filePixmap</span><span class="hljs-params">(<span class="hljs-type">const</span> QSize &amp;size, QIcon::Mode mode, QIcon::State)</span> <span class="hljs-keyword">override</span></span>;<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ€ªä¸å¾—<code>.icon()</code>è·å–å›¾æ ‡é‚£ä¹ˆå¿«å‘¢ï¼Œæ•¢æƒ…æ˜¯æ²¡æœ‰çœŸæ•°æ®å•Š</p><p>å¥½çš„ï¼Œç›¯å¸§ä¸€ä¸‹æˆ‘ä»¬å°±èƒ½å‘ç°<code>filePixmap</code>è¿™ä¸ªå‡½æ•°æ‰æ˜¯çœŸæ­£çš„é‡ç‚¹</p><h3 id="QWindowsFileIconEngine-filePixmap"><a href="#QWindowsFileIconEngine-filePixmap" class="headerlink" title="QWindowsFileIconEngine::filePixmap"></a>QWindowsFileIconEngine::filePixmap</h3><h4 id="æ–‡ä»¶å¤¹ç¼“å­˜"><a href="#æ–‡ä»¶å¤¹ç¼“å­˜" class="headerlink" title="æ–‡ä»¶å¤¹ç¼“å­˜"></a>æ–‡ä»¶å¤¹ç¼“å­˜</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-type">bool</span> cacheableDirIcon = <span class="hljs-built_in">fileInfo</span>().<span class="hljs-built_in">isDir</span>() &amp;&amp; !<span class="hljs-built_in">fileInfo</span>().<span class="hljs-built_in">isRoot</span>();<br><span class="hljs-keyword">if</span> (cacheableDirIcon) &#123;<br>    <span class="hljs-function">QMutexLocker <span class="hljs-title">locker</span><span class="hljs-params">(&amp;mx)</span></span>;<br>    <span class="hljs-type">int</span> iIcon = (useDefaultFolderIcon &amp;&amp; defaultFolderIIcon &gt;= <span class="hljs-number">0</span>) ? defaultFolderIIcon<br>         : **dirIconEntryCache.<span class="hljs-built_in">object</span>(filePath);<br>    <span class="hljs-keyword">if</span> (iIcon) &#123;<br>        QPixmapCache::<span class="hljs-built_in">find</span>(<span class="hljs-built_in">dirIconPixmapCacheKey</span>(iIcon, iconSize, requestedImageListSize), &amp;pixmap);<br>        <span class="hljs-keyword">if</span> (pixmap.<span class="hljs-built_in">isNull</span>()) <span class="hljs-comment">// Let&#x27;s keep both caches in sync</span><br>            dirIconEntryCache.<span class="hljs-built_in">remove</span>(filePath);<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-keyword">return</span> pixmap;<br>    &#125;<br>&#125;<br>...<br>...<br><span class="hljs-keyword">if</span> (cacheableDirIcon) &#123;<br>    <span class="hljs-function">QMutexLocker <span class="hljs-title">locker</span><span class="hljs-params">(&amp;mx)</span></span>;<br>    QPixmapCache::<span class="hljs-built_in">insert</span>(key, pixmap);<br>    dirIconEntryCache.<span class="hljs-built_in">insert</span>(filePath, FakePointer&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-built_in">create</span>(info.iIcon));<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š</p><ul><li>åªå¯¹æ–‡ä»¶å¤¹ï¼ˆDirectoryï¼‰è¿›è¡Œäº†ç¼“å­˜ï¼ˆcacheableDirIconï¼‰ï¼Œæ²¡æœ‰ç¼“å­˜æ–‡ä»¶ï¼ˆfileï¼‰ï¼› &#x2F;&#x2F; Why?</li><li>ä½¿ç”¨äº†<code>QPixmapCache</code>è¿›è¡Œç¼“å­˜ï¼Œè€Œä¸”æ˜¯<code>::insert</code>é™æ€æ–¹æ³•</li></ul><p>é™æ€æ–¹æ³•è¯´æ˜æ˜¯å…¨å±€çŠ¶æ€</p><div class="note note-info">            <p>[<strong>ç°åœ¨å¯ä»¥å…¬å¼€çš„æƒ…æŠ¥</strong>]</p><p>ï¼ï¼å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨<code>QPixmapCache::clear()</code>æ¥æ¸…é™¤<code>QFileIconProvider</code>çš„ç¼“å­˜</p>          </div><p>ğŸ˜‘è¿˜å¾—æ˜¯æºç </p><h4 id="æ·±å…¥è™ç©´"><a href="#æ·±å…¥è™ç©´" class="headerlink" title="æ·±å…¥è™ç©´"></a>æ·±å…¥è™ç©´</h4><p>Okayï¼Œéƒ½åˆ°è¿™é‡Œäº†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹<code>Qt</code>åˆ°åº•ç”¨äº†ä»€ä¹ˆæ–¹æ³•æ¥è·å–å›¾æ ‡å§</p><p><code>filePixmap()</code>ä¸­è°ƒç”¨äº†ä»¥ä¸‹å‡½æ•°ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">bool</span> <span class="hljs-title">shGetFileInfoBackground</span><span class="hljs-params">(<span class="hljs-type">const</span> QString &amp;fileName, DWORD attributes,</span></span><br><span class="hljs-params"><span class="hljs-function">                                    SHFILEINFO *info, UINT flags,</span></span><br><span class="hljs-params"><span class="hljs-function">                                    qint64 timeOutMSecs = <span class="hljs-number">5000</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">static</span> QShGetFileInfoThread *getFileInfoThread = <span class="hljs-literal">nullptr</span>;<br>    <span class="hljs-keyword">if</span> (!getFileInfoThread) &#123;<br>        getFileInfoThread = <span class="hljs-keyword">new</span> QShGetFileInfoThread;<br>        getFileInfoThread-&gt;<span class="hljs-built_in">start</span>(); <span class="hljs-comment">//å¯åŠ¨çº¿ç¨‹ï¼Œè°ƒç”¨run()å‡½æ•°</span><br>    &#125;<br><br>    <span class="hljs-type">bool</span> result = <span class="hljs-literal">false</span>;<br>    <span class="hljs-function">QShGetFileInfoParams <span class="hljs-title">params</span><span class="hljs-params">(fileName, attributes, info, flags, &amp;result)</span></span>;<br>    <span class="hljs-keyword">if</span> (!getFileInfoThread-&gt;<span class="hljs-built_in">runWithParams</span>(&amp;params, timeOutMSecs)) &#123;<br>        <span class="hljs-comment">// Cancel and reset getFileInfoThread. It&#x27;ll</span><br>        <span class="hljs-comment">// be reinitialized the next time we get called.</span><br>        getFileInfoThread-&gt;<span class="hljs-built_in">cancel</span>();<br>        getFileInfoThread = <span class="hljs-literal">nullptr</span>;<br>        <span class="hljs-built_in">qWarning</span>().<span class="hljs-built_in">noquote</span>() &lt;&lt; <span class="hljs-string">&quot;SHGetFileInfo() timed out for &quot;</span> &lt;&lt; fileName;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆè¿™ä¸ªå‘½åéå¸¸æœ‰æ„æ€ï¼Œä¸ºä»€ä¹ˆæ˜¯<strong>Background</strong>å‘¢ï¼Œéš¾é“æ˜¯å¤šçº¿ç¨‹ï¼Ÿï¼ˆç¬¬ä¸€è¡Œä»£ç å°±ç»“æŸäº†æ¯”èµ›</p><p>å¥½å§ï¼Œå…³æ³¨ç‚¹éš¾é“ä¸åº”è¯¥æ˜¯<code>shGetFileInfoBackground</code>æŠŠ<code>SHGetFileInfo</code>APIå†™è„¸ä¸Šäº†å—</p><p>è¿™é‡Œæœ‰ä¸€ç‚¹æ¯”è¾ƒç–‘æƒ‘ï¼šä¸ºä»€ä¹ˆ<code>Qt</code>åœ¨è¿™é‡Œè¦ä½¿ç”¨å¤šçº¿ç¨‹å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œè¿™æ˜¯ä¸€ä¸ª<code>filePixmap()</code>æ˜¯ä¸€ä¸ªåŒæ­¥å‡½æ•°ï¼Œä¹Ÿæ²¡æ³•å¼‚æ­¥è¿”å›</p><p>å…¶æ¬¡ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨äº†<code>m_doneCondition.wait</code>è¿›è¡Œç­‰å¾…ï¼Œç­‰å¾…è¢«å­çº¿ç¨‹å”¤é†’æˆ–è¶…æ—¶ï¼ˆ5sï¼‰ï¼Œæ„å‘³ç€è¿˜æ˜¯ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥å­çº¿ç¨‹æœ‰ä»€ä¹ˆæ„ä¹‰</p><p>å…¶å®æœ€ä¸»è¦çš„æ„ä¹‰å°±æ˜¯è¿™ä¸ª<strong>è¶…æ—¶</strong>æœºåˆ¶ï¼Œç”±äºå‰é¢è¯´çš„<code>SHGetFileInfo</code>å¯èƒ½éå¸¸è€—æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½æ— é™æœŸç­‰å¾…ä¸‹å»ï¼ˆGUIä¼šå¡æ­»ï¼‰</p><p>æ‰€ä»¥åˆ©ç”¨<strong>å¤šçº¿ç¨‹ + æ¡ä»¶å˜é‡</strong>çš„æ–¹å¼å®ç°<strong>è¶…æ—¶æœºåˆ¶</strong></p><p>ä»…å•çº¿ç¨‹çš„è¯ï¼Œæ§åˆ¶æƒä¼šé™·å…¥APIè°ƒç”¨<code>SHGetFileInfo</code>ï¼Œæ— æ³•é€€å‡º</p><p>ä¸‹é¢é™„ä¸Š<code>QShGetFileInfoThread</code>çš„ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">QShGetFileInfoThread</span> : <span class="hljs-keyword">public</span> QThread &#123;<br>...<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>&#123;<br>        m_init = <span class="hljs-built_in">CoInitializeEx</span>(<span class="hljs-literal">nullptr</span>, COINIT_MULTITHREADED);<br><br>        <span class="hljs-function">QMutexLocker <span class="hljs-title">readyLocker</span><span class="hljs-params">(&amp;m_readyMutex)</span></span>;<br>        <span class="hljs-keyword">while</span> (!m_cancelled.<span class="hljs-built_in">loadRelaxed</span>()) &#123;<br>            <span class="hljs-keyword">if</span> (!m_params &amp;&amp; !m_cancelled.<span class="hljs-built_in">loadRelaxed</span>()<br>                &amp;&amp; !m_readyCondition.<span class="hljs-built_in">wait</span>(&amp;m_readyMutex, <span class="hljs-built_in">QDeadlineTimer</span>(<span class="hljs-number">1000ll</span>)))<br>                <span class="hljs-keyword">continue</span>;<br><br>            <span class="hljs-keyword">if</span> (m_params) &#123;<br>                <span class="hljs-type">const</span> QString fileName = m_params-&gt;fileName;<br>                SHFILEINFO info;<br>                <span class="hljs-type">const</span> <span class="hljs-type">bool</span> result = <span class="hljs-built_in">SHGetFileInfo</span>(<span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">const</span> <span class="hljs-type">wchar_t</span> *&gt;(fileName.<span class="hljs-built_in">utf16</span>()),<br>                                                  m_params-&gt;attributes, &amp;info, <span class="hljs-built_in">sizeof</span>(SHFILEINFO),<br>                                                  m_params-&gt;flags);<br>                m_doneMutex.<span class="hljs-built_in">lock</span>();<br>                <span class="hljs-keyword">if</span> (!m_cancelled.<span class="hljs-built_in">loadRelaxed</span>()) &#123;<br>                    *m_params-&gt;result = result;<br>                    <span class="hljs-built_in">memcpy</span>(m_params-&gt;info, &amp;info, <span class="hljs-built_in">sizeof</span>(SHFILEINFO));<br>                &#125;<br>                m_params = <span class="hljs-literal">nullptr</span>;<br><br>                m_doneCondition.<span class="hljs-built_in">wakeAll</span>();<br>                m_doneMutex.<span class="hljs-built_in">unlock</span>();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (m_init != S_FALSE)<br>            <span class="hljs-built_in">CoUninitialize</span>();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">runWithParams</span><span class="hljs-params">(QShGetFileInfoParams *params, qint64 timeOutMSecs)</span> </span>&#123;<br>        <span class="hljs-function">QMutexLocker <span class="hljs-title">doneLocker</span><span class="hljs-params">(&amp;m_doneMutex)</span></span>;<br><br>        m_readyMutex.<span class="hljs-built_in">lock</span>();<br>        m_params = params;<br>        m_readyCondition.<span class="hljs-built_in">wakeAll</span>();<br>        m_readyMutex.<span class="hljs-built_in">unlock</span>();<br><br>        <span class="hljs-keyword">return</span> m_doneCondition.<span class="hljs-built_in">wait</span>(&amp;m_doneMutex, <span class="hljs-built_in">QDeadlineTimer</span>(timeOutMSecs));<br>    &#125;<br>...<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="Why-QFileIconProvider-Fast"><a href="#Why-QFileIconProvider-Fast" class="headerlink" title="Why QFileIconProvider Fast"></a>Why QFileIconProvider Fast</h2><p>å¥½çš„ï¼Œæ¥ä¸‹æ¥è¿˜å‰©ä¸‹ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆç”¨<code>QFileIconProvider</code> æ¯”ç›´æ¥ç”¨<code>SHGetFileInfo</code>æ›´å¿«ï¼ˆåœ¨åŠ è½½å¤§é‡å›¾æ ‡çš„æ—¶å€™ï¼‰</p><p>é¦–å…ˆå°±æ˜¯å†…éƒ¨ç¼“å­˜æœºåˆ¶ï¼Œå…¶æ¬¡æ˜¯å»¶è¿Ÿè·å–æœºåˆ¶ï¼ˆå…ˆè¿”å›QIcon + Engineï¼Œåœ¨åˆé€‚çš„æ—¶å€™å†è°ƒç”¨<code>filePixmap</code>ï¼‰</p><p>è¿™æ ·å¯ä»¥ç»“åˆQtçš„ç»˜åˆ¶æœºåˆ¶è¿›è¡Œä¸€äº›å¥‡æ€ªçš„ä¼˜åŒ–ï¼ˆå¤šçº¿ç¨‹ã€å±€éƒ¨é‡ç»˜ä¹‹ç±»çš„ï¼‰</p><p>ä»¥ä¸Šï¼Œæˆ‘çŒœçš„</p><p>å¥½çš„ï¼ŒPeace</p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://github.com/MrBeanCpp/Dr-Folder">MrBeanCpp&#x2F;Dr-Folder: Select icons for your software folders automatically. (github.com)</a></p><p><a href="https://blog.cls.ink/2024/07/27/Set-Folder-Icon-and-Refresh-Cache-Immediately">æ›´æ”¹æ–‡ä»¶å¤¹å›¾æ ‡ &amp; ä½¿å…¶ç«‹å³ç”Ÿæ•ˆ - MrBeanC-Blog</a></p>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>Windows</tag>
      
      <tag>Icon</tag>
      
      <tag>QFileIconProvider</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ›´æ”¹æ–‡ä»¶å¤¹å›¾æ ‡ &amp; ä½¿å…¶ç«‹å³ç”Ÿæ•ˆ</title>
    <link href="/2024/07/27/Set-Folder-Icon-and-Refresh-Cache-Immediately/"/>
    <url>/2024/07/27/Set-Folder-Icon-and-Refresh-Cache-Immediately/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œäººç±»æ›´å€¾å‘äºçœ‹å›¾è€Œéæ–‡å­—</p><p>å›¾ç‰‡æ‰€åŒ…å«çš„ä¿¡æ¯é‡æ›´å¤§ï¼Œä¹Ÿæ›´å®¹æ˜“æ¥å—</p><p>ï¼ˆè¿™å°±æ˜¯å¤§å®¶ä¸å–œæ¬¢è¯»ä¹¦çš„åŸå› baï¼‰</p><p>è¨€å½’æ­£ä¼ ï¼Œï¼ˆè¿™å°±æ˜¯å¤§å®¶å–œæ¬¢<code>GUI</code>çš„åŸå› baï¼‰</p><p>å›¾åƒå›ºç„¶é‡è¦ï¼Œä½†æ–‡å­—ä¹Ÿä¸å¯æˆ–ç¼º</p><p>äºæ˜¯ä¹ï¼Œæœ¬ç€æˆ‘éƒ½è¦çš„å¿ƒæ€ï¼Œç°ä»£å›¾å½¢ç•Œé¢ä¸­çš„ æ–‡ä»¶ &amp; æ–‡ä»¶å¤¹ éƒ½è¢«è®¾è®¡ä¸ºï¼š<strong>å›¾æ ‡ + æ–‡å­—æè¿°</strong> çš„å½¢å¼</p><p><img src="https://www.folderico.com/images/screenshot-1.png" alt="from folderico.com"></p><h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>ç³»ç»ŸåŸç”Ÿçš„æ–‡ä»¶å¤¹å›¾æ ‡æ˜¯ä¸ªé»„è‰²çš„â€œæ–‡ä»¶å¤¹â€ï¼ˆç‰©ç†ï¼‰</p><p>å¦‚æœæ‰€æœ‰æ–‡ä»¶å¤¹çš„å›¾æ ‡é•¿å¾—éƒ½ä¸€æ ·ï¼Œé‚£ä¹ˆä¹Ÿå°±å¤±å»äº†ä¼ é€’ç‰¹å¼‚ä¿¡æ¯çš„èƒ½åŠ›</p><p>ç”±äºæ–‡å­—çš„è§£è¯»è¦æ›´åŠ å›°éš¾ï¼ˆåå¤©èƒ½åŠ›ï¼‰ï¼Œå› æ­¤åœ¨ä¼—å¤šåƒç¯‡ä¸€å¾‹çš„æ–‡ä»¶å¤¹ä¸­å¿«é€Ÿå®šä½ç›®æ ‡åˆ™æˆäº†ä¸€ä»¶çƒ¦äººäº‹</p><h3 id="äººäº‘"><a href="#äººäº‘" class="headerlink" title="äººäº‘"></a>äººäº‘</h3><p>è¿™æ—¶å€™ï¼Œæœ‰çš„åŒå­¦è¦è¯´äº†ï¼šè¦ä»€ä¹ˆ<code>GUI</code>ï¼Œæˆ‘éƒ½æ˜¯ç›´æ¥<code>CLI</code>çš„â€¦</p><p>æ‰“ä½æ‰“ä½ï¼Œä¸‹ä¸€ä½</p><p>åŒå­¦Bï¼šå¯¹äº<code>Windows</code>ï¼Œå¯ä»¥ç›´æ¥åœ¨<strong>èµ„æºç®¡ç†å™¨</strong>ä¸­ï¼ˆéœ€è¦ç„¦ç‚¹ï¼‰ç›´æ¥è¾“å…¥æƒ³è¦æ–‡ä»¶ï¼ˆå¤¹ï¼‰åç§°ï¼ˆæ”¯æŒè¾“å…¥æ³•ï¼‰å³å¯å®šä½</p><p>è¿™ä½åŒå­¦è¯´å¾—å¥½ï¼Œä¸è¿‡æœ‰äº†æ›´å·®å¼‚åŒ–çš„å›¾æ ‡ä¾¿æ›´èƒ½é”¦ä¸Šæ·»èŠ± (à¹‘Â¯Ï‰Â¯à¹‘)</p><h2 id="è®¾ç½®æ–‡ä»¶å¤¹å›¾æ ‡"><a href="#è®¾ç½®æ–‡ä»¶å¤¹å›¾æ ‡" class="headerlink" title="è®¾ç½®æ–‡ä»¶å¤¹å›¾æ ‡"></a>è®¾ç½®æ–‡ä»¶å¤¹å›¾æ ‡</h2><h3 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h3><p>å±æ€§-è‡ªå®šä¹‰-æ›´æ”¹å›¾æ ‡<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="[åœ¨ Windows 11 ä¸Šæ›´æ”¹æ–‡ä»¶å¤¹å›¾æ ‡çš„ 5 ç§æ–¹æ³•ï¼ˆå’Œ 3 ä¸ªæç¤ºï¼‰-äº‘ä¸œæ–¹ (yundongfang.com)](https://www.yundongfang.com/Yun147646.html)">[1]</span></a></sup></p><p>ç›¸ä¿¡å¤§å®¶æ—©å°±çŸ¥é“äº†ï¼Œè·³è¿‡è·³è¿‡ï¼ˆskipï¼‰</p><p><img src="https://www.yundongfang.com/wp-content/uploads/2022/04/004-49.png" alt="å±æ€§-è‡ªå®šä¹‰-æ›´æ”¹å›¾æ ‡"></p><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p>å’³å’³ï¼Œèº«ä¸º<strong>Programmer</strong>ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥è®¨è®ºä¸€ä¸‹æ›´æ·±å…¥â™‚â™€çš„å†…å®¹å§</p><p>ãã‚‚ãã‚‚ï¼Œè¯´åˆ°åº•ï¼Œ<code>Windows</code>è®¾ç½®æ–‡ä»¶å¤¹å›¾æ ‡çš„åŸç†ç©¶ç«Ÿæ˜¯ä»€ä¹ˆ</p><p>æœ¬è´¨ä¸Šå°±æ˜¯åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹å†…æ–°å»ºäº†ä¸€ä¸ª<code>desktop.ini</code>ï¼ˆä¹‹å‰çš„æ–‡ç« ä¹Ÿæåˆ°è¿‡ï¼š<a href="https://blog.cls.ink/2024/04/02/Windows-%E7%B3%BB%E7%BB%9F%E7%BA%A7%E4%B8%AA%E4%BA%BA%E6%96%87%E4%BB%B6%E5%A4%B9%E7%AE%80%E6%9E%90/#%E6%89%8B%E5%8A%A8%E6%96%B0%E5%BB%BA">Windows ç³»ç»Ÿçº§ä¸ªäººæ–‡ä»¶å¤¹ vs OneDriveç®€æ</a>ï¼‰</p><p>è¿™ä¸ªæ–‡ä»¶çš„å±æ€§æ¯”è¾ƒç‰¹æ®Šï¼š<code>SH</code>ï¼Œaka.<code>System + Hide</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[.ShellClassInfo]</span><br><span class="hljs-attr">IconResource</span>=xxx.ico,<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œé™¤äº†<code>.ico</code>æ–‡ä»¶ï¼Œè¿˜å¯ä»¥æ˜¯<code>exe</code>ï¼Œ<code>dll</code>ç­‰</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ¥åˆ›å»º<code>desktop.ini</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++">QString iniPath = folderPath + <span class="hljs-string">&quot;/desktop.ini&quot;</span>;<br><span class="hljs-function">QFile <span class="hljs-title">iniFile</span><span class="hljs-params">(iniPath)</span></span>;<br><span class="hljs-keyword">if</span> (iniFile.<span class="hljs-built_in">open</span>(QIODevice::WriteOnly | QIODevice::Text)) &#123;<br>    <span class="hljs-function">QTextStream <span class="hljs-title">out</span><span class="hljs-params">(&amp;iniFile)</span></span>;<br>    out &lt;&lt; <span class="hljs-string">&quot;[.ShellClassInfo]&quot;</span> &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span>;<br>    out &lt;&lt; <span class="hljs-string">&quot;IconResource=&quot;</span> &lt;&lt; iconPath &lt;&lt; <span class="hljs-string">&quot;,0&quot;</span> &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span>;<br>    iniFile.<span class="hljs-built_in">close</span>();<br><br>    <span class="hljs-comment">// Set desktop.ini file attributesï¼šéšè—å’Œç³»ç»Ÿæ–‡ä»¶</span><br>    <span class="hljs-built_in">SetFileAttributesW</span>(iniPath.<span class="hljs-built_in">toStdWString</span>().<span class="hljs-built_in">c_str</span>(), FILE_ATTRIBUTE_HIDDEN | FILE_ATTRIBUTE_SYSTEM);<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ä½ æ»¡æ€€æ¬£å–œåœ°ç›¯ç€æ–‡ä»¶å¤¹æ—¶ï¼Œâ€”â€” æ–‡ä»¶å¤¹ä¹Ÿåœ¨ç›¯ç€ä½ </p><blockquote><p>Nothing happened.</p></blockquote><p>äº‹æƒ…å¹¶æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œä¹Ÿè®¸è¿˜ç¼ºäº†ä»€ä¹ˆ</p><p>è¯·çœ‹<code>Windows</code>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://learn.microsoft.com/zh-cn/windows/win32/shell/how-to-customize-folders-with-desktop-ini">å¦‚ä½•ä½¿ç”¨ Desktop.ini è‡ªå®šä¹‰æ–‡ä»¶å¤¹</a></p><blockquote><p><strong>ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤é€šè¿‡ Desktop.ini è‡ªå®šä¹‰æ–‡ä»¶å¤¹çš„æ ·å¼ï¼š</strong></p><ol><li>ä½¿ç”¨ <a href="https://learn.microsoft.com/zh-cn/windows/desktop/api/Shlwapi/nf-shlwapi-pathmakesystemfoldera"><strong>PathMakeSystemFolder</strong></a> ä½¿æ–‡ä»¶å¤¹æˆä¸ºç³»ç»Ÿæ–‡ä»¶å¤¹ã€‚ è¿™å°†è®¾ç½®æ–‡ä»¶å¤¹ä¸Šçš„<strong>åªè¯»</strong>ä½ï¼Œä»¥æŒ‡ç¤ºåº”å¯ç”¨ä¸º <code>Desktop.ini</code> ä¿ç•™çš„ç‰¹æ®Šè¡Œä¸ºã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨ <strong>attrib +s</strong> <em>FolderName</em> å‘½ä»¤è¡Œå°†æ–‡ä»¶å¤¹è®¾ä¸ºç³»ç»Ÿæ–‡ä»¶å¤¹ã€‚</li><li>ä¸ºæ–‡ä»¶å¤¹åˆ›å»ºä¸€ä¸ª <code>Desktop.ini</code> æ–‡ä»¶ã€‚ åº”å°†å…¶æ ‡è®°ä¸º<em>éšè—</em>å’Œ<em>ç³»ç»Ÿ</em>ï¼Œä»¥ç¡®ä¿å¯¹æ™®é€šç”¨æˆ·éšè—ã€‚</li><li>ç¡®ä¿åˆ›å»ºçš„ <code>Desktop.ini</code> æ–‡ä»¶ä¸º Unicode æ ¼å¼ã€‚ è¿™æ˜¯å­˜å‚¨å¯æ˜¾ç¤ºç»™ç”¨æˆ·çš„æœ¬åœ°åŒ–å­—ç¬¦ä¸²æ‰€å¿…éœ€çš„ã€‚</li></ol></blockquote><p>å†çœ‹<code>FolderIco</code>çš„æ•™ç¨‹ï¼š<a href="https://www.folderico.com/what-if-custom-folder-icon-does-not-show.html">å¦‚æœè‡ªå®šä¹‰æ–‡ä»¶å¤¹å›¾æ ‡ä¸æ˜¾ç¤ºæ€ä¹ˆåŠï¼Ÿ â€” What If the Custom Folder Icon Does Not Show?</a></p><blockquote><p>To keep folder icon changed must be met following conditions:</p><ul><li>Folder must have <strong>â€œRead Onlyâ€</strong> or <strong>â€œSystemâ€</strong> attribute, only these attributes allows to show customized folder icon.</li><li>Folder must contain â€œdesktop.iniâ€ file (This file contain path to the customized icon).</li></ul></blockquote><p>ç»¼ä¸Šï¼Œæˆ‘ä»¬è¿˜ç¼ºå°‘ä¸€ä¸ªæ¡ä»¶ï¼š</p><ul><li>æ–‡ä»¶å¤¹å¿…é¡»æ‹¥æœ‰ <strong>åªè¯»ï¼ˆRï¼‰</strong>æˆ– <strong>ç³»ç»Ÿï¼ˆSï¼‰</strong>å±æ€§</li></ul><h4 id="Continue"><a href="#Continue" class="headerlink" title="Continue"></a>Continue</h4><p>æˆ‘ä»¬å¯ä»¥åœ¨<code>cmd</code>ä¸­é€šè¿‡<code>attrib +R Folder</code>å‘½ä»¤ä¸ºå…¶æ·»åŠ åªè¯»å±æ€§</p><p>æˆ–è€…</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">SetFileAttributesW</span>(folderPath.<span class="hljs-built_in">toStdWString</span>().<span class="hljs-built_in">c_str</span>(), FILE_ATTRIBUTE_READONLY);<br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// Make this a system folder, so that we look for desktop.ini when we navigate to this folder.</span><br><span class="hljs-built_in">PathMakeSystemFolder</span>(folderPath.<span class="hljs-built_in">toStdWString</span>().<span class="hljs-built_in">c_str</span>());<br></code></pre></td></tr></table></figure><p>å¤§å®¶çœ‹åˆ°è¿™é‡Œå¯èƒ½ä¸€å¤´é›¾æ°´ï¼Œåˆ«æ€¥</p><ul><li>é¦–å…ˆï¼Œè¿™å¯èƒ½å¾ˆåç›´è§‰ï¼Œä½†æ˜¯æ–‡ä»¶å¤¹ä¸Šçš„<strong>åªè¯»ï¼ˆRï¼‰</strong>å±æ€§ä¸æ–‡ä»¶ä¸åŒï¼Œå¹¶ä¸æ˜¯â€œåªè¯»â€çš„æœ¬æ„ã€‚â€This attribute is not honored on directories. â€œ â€“  <a href="https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-setfileattributesw#:~:text=FILE_ATTRIBUTE_READONLY">SetFileAttributesW - READONLY</a>. åœ¨æ–‡ä»¶å¤¹ä¸Šï¼Œè¯¥å±æ€§å’Œ<code>S</code>å±æ€§ä¸€æ ·ï¼Œæ›´å¤šçš„è¿™æ˜¯ä¸€ä¸ªæ ‡è®°ï¼ŒæŒ‡ç¤ºç³»ç»Ÿå»è¿›è¡Œä¸€äº›ç‰¹æ®Šæ“ä½œï¼Œä¾‹å¦‚ï¼šæŸ¥æ‰¾å¹¶åŠ è½½<code>desktop.ini</code></li><li><code>PathMakeSystemFolder</code>ï¼Œè¿™ä¸ªå‡½æ•°çœ‹èµ·æ¥æ˜¯ç»™æ–‡ä»¶å¤¹èµ‹äºˆ<code>System</code>å±æ€§ï¼Œä½†å®é™…ä¸Šä»–ä¼šè§†æƒ…å†µï¼Œç»™äºˆ<code>R</code>æˆ–<code>S</code>å±æ€§ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯<code>Read-Only</code>å±æ€§ã€‚ç”±äº<code>Windows</code>æ˜¯é—­æºç³»ç»Ÿï¼Œæ‰€ä»¥è¿™é‡Œç»™å‡ºä¸€ä¸ªä¸çŸ¥é“æ˜¯ä¸æ˜¯æºç çš„<a href="https://github.com/selfrender/Windows-Server-2003/blob/5c6fe3db626b63a384230a1aa6b92ac416b0765f/shell/shlwapi/path.c#L3408">æºç </a> ï¼ˆæˆ‘çœ‹åˆ°äº†ä¸¤ä»½ä¸åŒçš„å®ç°ï¼Œæ‰€ä»¥ä¸ç¡®å®šä»£ç æ˜¯å¦å¯é ï¼‰</li></ul><p>å¥½çš„ï¼Œä¸ç®¡æ€ä¹ˆæ ·ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»è¾¾æˆäº†ä¸ºæ–‡ä»¶å¤¹è‡ªå®šä¹‰å›¾æ ‡çš„æ‰€æœ‰æ¡ä»¶ã€‚</p><h2 id="æ­£ç‰‡å åº•"><a href="#æ­£ç‰‡å åº•" class="headerlink" title="æ­£ç‰‡å åº•"></a>æ­£ç‰‡å åº•</h2><p>ä»¥ä¸Šéƒ½æ˜¯æ´’æ´’æ°´ï¼Œç›¸ä¿¡å¤§å®¶å™¼é‡Œå•ªå•¦ã€å½é‡Œå‘±å•¦å°±æŸ¥å‡ºæ¥äº†</p><h3 id="å›¾æ ‡ç¼“å­˜"><a href="#å›¾æ ‡ç¼“å­˜" class="headerlink" title="å›¾æ ‡ç¼“å­˜"></a>å›¾æ ‡ç¼“å­˜</h3><p>ä¸»è¦é—®é¢˜åœ¨äºï¼šä¸ºä»€ä¹ˆä¸Šè¿°æ¡ä»¶éƒ½è¾¾æˆä¹‹åï¼Œæ–‡ä»¶å¤¹å›¾æ ‡è¿˜æ˜¯æ²¡æœ‰å˜åŒ–ï¼Œæˆ–è€…è¯´ï¼Œ<strong>å»¶è¿Ÿ</strong>æ›´æ–°</p><h3 id="ä¼ ç»ŸåŠŸå¤«ï¼ˆç„¡é§„ï¼‰"><a href="#ä¼ ç»ŸåŠŸå¤«ï¼ˆç„¡é§„ï¼‰" class="headerlink" title="ä¼ ç»ŸåŠŸå¤«ï¼ˆç„¡é§„ï¼‰"></a>ä¼ ç»ŸåŠŸå¤«ï¼ˆç„¡é§„ï¼‰</h3><p>å¯èƒ½æœ‰èªæ˜çš„åŒå­¦ä¼šè¯´äº†ï¼šè¿™é¢˜æˆ‘ä¼šï¼Œç”¨è¿™ä¸ªå‡½æ•°é€šçŸ¥ç³»ç»Ÿæ›´æ”¹å³å¯ï¼Œ<code>SHChangeNotify(SHCNE_ATTRIBUTES, ...ï¼‰</code></p><p>å¾ˆé—æ†¾ï¼Œèµ·ç å¯¹äº<code>Windows 11</code>çš„æ–‡ä»¶å¤¹æ¥è¯´ï¼Œè¯¥å‡½æ•°æ²¡æœ‰ä»»ä½•é¸Ÿç”¨</p><p>æ— è®ºæ˜¯ï¼š<code>SHCNE_ATTRIBUTES</code>ã€<code>SHCNE_UPDATEITEM</code> æˆ–æ˜¯ <code>SHCNE_ASSOCCHANGED</code>ï¼Œç”šè‡³æ˜¯<code>SHCNE_ALLEVENTS</code></p><p>Evenï¼š<code>SendMessageTimeout(HWND_BROADCAST, WM_SETTINGCHANGE, 0, (LPARAM)&quot;Environment&quot;, SMTO_ABORTIFHUNG, 5000, NULL)</code></p><p>éƒ½æ— æµäºäº‹â€¦</p><p>è¿˜æœ‰ä¸€äº›ç„¡é§„çš„æ–¹æ³•æˆ‘ä¹Ÿç½—åˆ—ä¸€ä¸‹ï¼š</p><ul><li><strong>ie4uinit.exe -show</strong></li><li><strong>nircmd.exe sysrefresh</strong> ï¼ˆç¬¬ä¸‰æ–¹ï¼‰</li></ul><p>å‚è§ï¼š<a href="https://stackoverflow.com/questions/68941080/update-folder-icon-with-desktop-ini-instantly-change-c">windows - Update folder icon with desktop.ini &amp; instantly change (C++) - Stack Overflow</a></p><blockquote><p>NO it doesnâ€™t work at all. 5 hour in computer during the night works as mirage â€”â€”  <a href="https://stackoverflow.com/questions/6464147/how-can-i-immediately-reload-a-folder-icon-when-desktop-ini-is-changed#:~:text=1-,NO,-it%20doesn%27t%20work">Piotr Sydow</a></p></blockquote><p>ä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•<strong>ç«‹å³</strong>åˆ·æ–°å›¾æ ‡ç¼“å­˜ï¼ˆé€šå¸¸åœ¨å‡ åˆ†é’Ÿååˆ·æ–°ï¼‰</p><h3 id="æš´åŠ›ç¾å­¦ï¼ˆä¿åº•ï¼‰"><a href="#æš´åŠ›ç¾å­¦ï¼ˆä¿åº•ï¼‰" class="headerlink" title="æš´åŠ›ç¾å­¦ï¼ˆä¿åº•ï¼‰"></a>æš´åŠ›ç¾å­¦ï¼ˆä¿åº•ï¼‰</h3><p>å½“ç„¶ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œé‡å¯èƒ½è§£å†³90%é—®é¢˜</p><p>æ˜¯çš„æ²¡é”™ï¼Œé‡å¯<strong>èµ„æºç®¡ç†å™¨ï¼ˆexplorer.exeï¼‰</strong>å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">taskkill /f /im explorer.exe<br>start explorer<br></code></pre></td></tr></table></figure><p>BUTï¼š</p><ol><li>é‡å¯å¹¶ä¸èƒ½ç®—ç«‹å³</li><li>ç”¨æˆ·ä½“éªŒï¼Œéå¸¸éå¸¸éå¸¸éå¸¸ï¼Œ<strong>BAD</strong>ï¼Œç´å¾—ã§ããªã„</li></ol><p>ä»äººæœºäº¤äº’å’Œäº§å“è®¾è®¡è§’åº¦æ¥è¯´ï¼Œéå¸¸å¤±è´¥ï¼Œæ— æ³•æ¥å—ï¼Œä»…æ­¤ä¸€é¡¹å°±ä¼šè®©ç”¨æˆ·æµå¤±</p><p>æ›´ä¸ç”¨è¯´å·²ç»æœ‰è½¯ä»¶èƒ½å¤Ÿåšåˆ°ä¸é‡å¯çš„æƒ…å†µä¸‹ç«‹å³åˆ·æ–° - <a href="https://www.folderico.com/">FolderIco</a></p><p>ta èƒ½åšåˆ°ï¼Œå°±è¯´æ˜ï¼šç†è®ºå­˜åœ¨ï¼Œå®è·µå¼€å§‹</p><h4 id="æ¯ç­"><a href="#æ¯ç­" class="headerlink" title="æ¯ç­"></a>æ¯ç­</h4><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•åœ¨æ°‘é—´å¹¿ä¸ºæµä¼ ï¼Œå®å±æš´åŠ›æ¥·æ¨¡ï¼š<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="[windowsæ¸…ç†å›¾æ ‡ç¼“å­˜å¹¶é‡æ–°åŠ è½½_windows å›¾æ ‡ç¼“å­˜åˆ·æ–°-CSDNåšå®¢](https://blog.csdn.net/luoyayun361/article/details/79228390)">[2]</span></a></sup></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">rem å…³é—­Windowså¤–å£³ç¨‹åºexplorer<br>taskkill /f /im explorer.exe<br>rem æ¸…ç†ç³»ç»Ÿå›¾æ ‡ç¼“å­˜æ•°æ®åº“<br>attrib -h -s -r <span class="hljs-string">&quot;%userprofile%\AppData\Local\IconCache.db&quot;</span><br>del /f <span class="hljs-string">&quot;%userprofile%\AppData\Local\IconCache.db&quot;</span><br>attrib /s /d -h -s -r <span class="hljs-string">&quot;%userprofile%\AppData\Local\Microsoft\Windows\Explorer\*&quot;</span><br>del /f <span class="hljs-string">&quot;%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_32.db&quot;</span><br>del /f <span class="hljs-string">&quot;%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_96.db&quot;</span><br>del /f <span class="hljs-string">&quot;%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_102.db&quot;</span><br>del /f <span class="hljs-string">&quot;%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_256.db&quot;</span><br>del /f <span class="hljs-string">&quot;%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_1024.db&quot;</span><br>del /f <span class="hljs-string">&quot;%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_idx.db&quot;</span><br>del /f <span class="hljs-string">&quot;%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_sr.db&quot;</span><br>rem æ¸…ç† ç³»ç»Ÿæ‰˜ç›˜è®°å¿†çš„å›¾æ ‡<br><span class="hljs-built_in">echo</span> y|reg delete <span class="hljs-string">&quot;HKEY_CLASSES_ROOT\Local Settings\Software\Microsoft\Windows\CurrentVersion\TrayNotify&quot;</span> /v IconStreams<br><span class="hljs-built_in">echo</span> y|reg delete <span class="hljs-string">&quot;HKEY_CLASSES_ROOT\Local Settings\Software\Microsoft\Windows\CurrentVersion\TrayNotify&quot;</span> /v PastIconsStream<br>rem é‡å¯Windowså¤–å£³ç¨‹åºexplorer<br>start explorer<br></code></pre></td></tr></table></figure><div class="note note-warning">            <p>ç›´æ¥åˆ æ‰æ‰€æœ‰ç¼“å­˜æ–‡ä»¶å’Œæ³¨å†Œè¡¨é¡¹ï¼ˆé€¼<code>Windows</code>é‡å»ºï¼‰ï¼Œå¹¶é‡å¯èµ„æºç®¡ç†å™¨</p>          </div><p>å“¦ï¼Œæˆ‘çš„è€å¤©çˆ·å•Š</p><p>æ€é¸¡ç„‰ç”¨ç‰›åˆ€ï¼Œå¤ªä¸ä¼˜é›…äº†å§ï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²å¹¶ä¸å»ºè®®ä½¿ç”¨ -_-||</p><h3 id="ä¼˜é›…è€Œç²¾å‡†"><a href="#ä¼˜é›…è€Œç²¾å‡†" class="headerlink" title="ä¼˜é›…è€Œç²¾å‡†"></a>ä¼˜é›…è€Œç²¾å‡†</h3><p><strong>FolderIco</strong>å·²ç»å‘æˆ‘ä»¬è¯æ˜äº†ï¼Œå­˜åœ¨ä¸€ç§æ–¹æ¡ˆï¼Œæ—¢ä¸éœ€è¦åˆ é™¤æ–‡ä»¶ï¼Œä¹Ÿä¸éœ€è¦é‡å¯èµ„æºç®¡ç†å™¨ï¼Œå°±èƒ½åˆ·æ–°å›¾æ ‡ç¼“å­˜çš„æ–¹æ¡ˆ</p><p>è™½ç„¶é—®é¢˜åœ¨äºè¿™æ˜¯é—­æºè½¯ä»¶ï¼Œçœ‹ä¸åˆ°æºç å‘œå‘œ</p><p>&#x2F;&#x2F; éš¾é“è¦åç¼–è¯‘å˜›ï¼Œaaa</p><p>ä¸ï¼Œä¸å¯èƒ½ï¼</p><p>è¦ä¸å‘ä¸ªé‚®ä»¶å¥½äº†ï¼Œå•Šï¼Œåœ¨é‚£ä¹‹å‰ï¼Œä¸€å®šæœ‰åŠæ³•ï¼Œo(â•¥ï¹â•¥)o</p><h4 id="SHGetSetFolderCustomSettings"><a href="#SHGetSetFolderCustomSettings" class="headerlink" title="SHGetSetFolderCustomSettings"></a>SHGetSetFolderCustomSettings</h4><p>ç»è¿‡äº†ä¸ƒä¸ƒå…«åä¸€å¤©çš„æœç´¢ï¼Œåœ¨è§è¯†åˆ°äº†<code>GPT-4o</code>å’Œ<code>Claude 3.5</code>å¯¹äº<code>Windows API</code>çš„æ— åŠ›ä¹‹å</p><p>æˆ‘ç»ˆäºæ‰¾åˆ°äº†ï¼Œé‚£æœ¬çœŸç»ï¼š<a href="https://learn.microsoft.com/zh-cn/windows/win32/api/shlobj_core/nf-shlobj_core-shgetsetfoldercustomsettings"><code>SHGetSetFolderCustomSettings</code></a></p><p>è¿˜å¾—æ˜¯ï¼š<a href="https://stackoverflow.com/questions/45921769/how-to-refresh-the-folder-icon-instantly-in-windows#:~:text=2-,I%20did%20some%20further,-tests%20where%20I">Stackoverflow</a></p><p>èŠ‚é€‰è¯„è®ºï¼š</p><blockquote><p>I did some further tests where I found that the supposed â€œcatch allâ€ <code>SHCNE_ASSOCCHANGED</code> is unreliable aswell. But <a href="https://stackoverflow.com/a/19440996/7571258">SHGetSetFolderCustomSettings()</a> always updates the icon immediately (despite being a deprecated API since Win XP SP3)!</p></blockquote><blockquote><p>I also used <code>SHChangeNotify()</code> and itâ€™s not reliable in Win10. Sometimes it works, sometimes not. It doesnâ€™t change it immediately but takes 1 minutes or so.</p></blockquote><blockquote><p>Yesterday I played around with <code>SHCNE_UPDATEITEM</code> but couldnâ€™t get consistent results. Sometimes it would update the folder icon, sometimes not. I also tried to add <code>SHCNF_FLUSH</code> and <code>SHCNE_UPDATEDIR</code> but the result was still unreliable.</p></blockquote><p><code>SHGetSetFolderCustomSettings</code>æ˜¯ä¸“é—¨ç”¨äºè¯»å–å’Œå†™å…¥<code>desktop.ini</code>çš„å‡½æ•°</p><p>ï¼ˆä¸è¿‡ä¸ºä»€ä¹ˆ<code>GPT</code>ä¸å‘Šè¯‰æˆ‘ï¼Œaaaaaï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setFolderIcon</span><span class="hljs-params">(<span class="hljs-type">const</span> QString &amp;folderPath, <span class="hljs-type">const</span> QString &amp;iconPath, <span class="hljs-type">int</span> iconIndex = <span class="hljs-number">0</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    SHFOLDERCUSTOMSETTINGS fcs = &#123;<span class="hljs-number">0</span>&#125;; <span class="hljs-comment">// åˆå§‹åŒ–æ‰€æœ‰æˆå‘˜ä¸º0</span><br>    fcs.dwSize = <span class="hljs-built_in">sizeof</span>(SHFOLDERCUSTOMSETTINGS);<br>    fcs.dwMask = FCSM_ICONFILE;<br>    <span class="hljs-keyword">auto</span> iconWStr = iconPath.<span class="hljs-built_in">toStdWString</span>(); <span class="hljs-comment">// IMPORTANT: ä¸èƒ½å†™ä¸º iconPath.toStdWString().c_str()ï¼Œå› ä¸ºè¿”å›çš„æ˜¯ä¸´æ—¶å¯¹è±¡ï¼Œå¯¼è‡´æŒ‡é’ˆæ— æ•ˆ</span><br>    fcs.pszIconFile = <span class="hljs-built_in">LPWSTR</span>(iconWStr.<span class="hljs-built_in">c_str</span>());<br>    fcs.cchIconFile = <span class="hljs-number">0</span>;<br>    fcs.iIconIndex = iconIndex;<br><br>    <span class="hljs-comment">// è¿™é‡Œè¿”å›ä¸´æ—¶å¯¹è±¡æŒ‡é’ˆæ²¡äº‹ï¼Œå› ä¸ºè¯­å¥æ²¡ç»“æŸä¸ä¼šè¢«é‡Šæ”¾</span><br>    HRESULT hr = <span class="hljs-built_in">SHGetSetFolderCustomSettings</span>(&amp;fcs, folderPath.<span class="hljs-built_in">toStdWString</span>().<span class="hljs-built_in">c_str</span>(), FCS_FORCEWRITE);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">FAILED</span>(hr)) &#123;<br>        <span class="hljs-built_in">qWarning</span>() &lt;&lt; <span class="hljs-string">&quot;Failed to set folder icon&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¸¸æˆç»“æŸï¼Œæ ¹æœ¬ä¸éœ€è¦è‡ªè¡Œæ–°å»º<code>desktop.ini</code>å·´æ‹‰çš„ï¼Œç›´æ¥åŒ…åŠ</p><h4 id="è¯­æ³•å°ç»†èŠ‚"><a href="#è¯­æ³•å°ç»†èŠ‚" class="headerlink" title="è¯­æ³•å°ç»†èŠ‚"></a>è¯­æ³•å°ç»†èŠ‚</h4><p>è¿™é‡Œæœ‰ä¸ªç»†èŠ‚å‘äº†æˆ‘ä¸€ä¸‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">auto</span> iconWStr = iconPath.<span class="hljs-built_in">toStdWString</span>();<br>fcs.pszIconFile = <span class="hljs-built_in">LPWSTR</span>(iconWStr.<span class="hljs-built_in">c_str</span>());<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¸èƒ½ç¼©å†™ä¸ºï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">fcs.pszIconFile = <span class="hljs-built_in">LPWSTR</span>(iconPath.<span class="hljs-built_in">toStdWString</span>().<span class="hljs-built_in">c_str</span>());<br></code></pre></td></tr></table></figure><p>å¦åˆ™ï¼Œæœ€ç»ˆå†™å…¥<code>desktop.ini</code>ä¸­çš„è·¯å¾„ä¼šå˜å¾—å¾ˆå¥‡æ€ª</p><p>å› ä¸º<code>.toStdWString()</code>è¿”å›çš„æ˜¯ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œé‚£ä¹ˆ<code>.toStdWString().c_str()</code>ä¹Ÿå°±æ˜¯ä¸€ä¸ªä¸´æ—¶å¯¹è±¡çš„æŒ‡é’ˆ</p><p>éšæ—¶ä¼šè¢«é”€æ¯ï¼ˆè¯­å¥ç»“æŸåï¼‰</p><p>æ‰€ä»¥æœ€ç»ˆå°±ä¼šé€ æˆé‡æŒ‡é’ˆé—®é¢˜ï¼Œå˜æˆéšæœºå­—ç¬¦ä¸²ï¼Œbombï¼ˆå¿«ç”¨<code>Rust</code>ï¼‰</p><p>é‚£ä¹ˆåˆæœ‰å°ç›†å‹è¦é—®äº†ï¼Œä¸ºä»€ä¹ˆè¿™å¥æ²¡äº‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">SHGetSetFolderCustomSettings</span>(&amp;fcs, folderPath.<span class="hljs-built_in">toStdWString</span>().<span class="hljs-built_in">c_str</span>(), FCS_FORCEWRITE);<br></code></pre></td></tr></table></figure><p>å› ä¸ºä¸´æ—¶å¯¹è±¡åœ¨è¯­å¥ç»“æŸåé”€æ¯ï¼Œæ‰€ä»¥åœ¨<code>SHGetSetFolderCustomSettings</code>æ‰§è¡Œè¿‡ç¨‹ä¸­éƒ½ä¸‡äº‹å¤§å‰</p><h4 id="Why-SHGetSetFolderCustomSettings"><a href="#Why-SHGetSetFolderCustomSettings" class="headerlink" title="Why SHGetSetFolderCustomSettings"></a>Why SHGetSetFolderCustomSettings</h4><p>å¥½çš„ï¼Œé‚£ä¹ˆï¼Œå‡­ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆ<code>SHGetSetFolderCustomSettings</code>å¯ä»¥åšåˆ°ç«‹å³åˆ·æ–°ï¼Œä»–è°ƒç”¨äº†ä»€ä¹ˆ<code>API</code>ï¼Œåšäº†ä»€ä¹ˆæ“ä½œå‘¢ï¼Ÿ</p><p>ä»€ä¹ˆï¼Œä½ è¯´ä½ ä¸æƒ³çŸ¥é“ï¼Œè¯¶ï¼Œåˆ«èµ°å•Š</p><p>å’³å’³ï¼Œç•™ä¸‹æ¥çš„éƒ½æ˜¯å¥½é¥±é¥±</p><p>å¥½å§ï¼Œç­”æ¡ˆæ˜¯ï¼šå¾ˆé—æ†¾ï¼Œ<code>Windows</code>æ˜¯é—­æºæ“ä½œç³»ç»Ÿï¼Œhhhhhhhhhh</p><p>o(â•¥ï¹â•¥)o</p><p>çœŸæ»´ç±³æœ‰åŠæ³•äº†å—ï¼Œä¸è¡Œï¼Œæˆ‘å»<code>GitHub</code>ä¸Šæœä¸€æœ</p><p>ä½ åˆ«è¯´ï¼Œè¿˜çœŸæœ‰ï¼š<a href="https://github.com/tongzx/nt5src/blob/master/Source/XPSP1/NT/shell/shell32/fldsets.c#L492">nt5src&#x2F;Source&#x2F;XPSP1&#x2F;NT&#x2F;shell&#x2F;shell32&#x2F;fldsets.c at master Â· tongzx&#x2F;nt5src (github.com)</a></p><p>å¬è¯´æ˜¯<code>XP</code>ä»£ç æ³„éœ²</p><p>ä¸è¿‡å‘¢ï¼Œä¸çŸ¥é“æ˜¯ç‰ˆæœ¬å¤ªè€ï¼Œè¿˜æ˜¯å¯ä¿¡åº¦å¤ªä½</p><p>æˆ‘åœ¨ä»£ç é‡Œå¹¶æ²¡æœ‰çœ‹åˆ°ä»€ä¹ˆç‰¹æ®Šæ“ä½œ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++">...<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">SUCCEEDED</span>(hret) &amp;&amp; (dwReadWrite &amp; FCS_FORCEWRITE))<br>&#123;<br>    <span class="hljs-comment">// Make desktop.ini hidden</span><br>    <span class="hljs-built_in">SetFileAttributes</span>(szIniFile, FILE_ATTRIBUTE_HIDDEN | FILE_ATTRIBUTE_SYSTEM);<br>    <span class="hljs-comment">// Make this a system folder, so that we look for desktop.ini when we navigate to this folder.</span><br>    <span class="hljs-built_in">PathMakeSystemFolder</span>(pszPath);<br>&#125;<br>....<br></code></pre></td></tr></table></figure><p>éƒ½æ˜¯æˆ‘ä»¬çš„åŸºæ“</p><p>æ‰€ä»¥åˆ°åº•ä¸ºå•¥å•Šï¼Œaaaaaa</p><p><code>Windows</code>åå¤§æœªè§£ä¹‹è°œï¼Œçœ‹æ¥åªèƒ½å…¥èŒå¾®è½¯äº†</p><h3 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h3><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://cloud.tencent.com/developer/ask/sof/107609033">ç”¨desktop.iniæ›´æ–°æ–‡ä»¶å¤¹å›¾æ ‡&amp;ç«‹å³æ›´æ”¹(C++)-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></p><p><a href="https://stackoverflow.com/questions/33309382/changing-desktop-ini-doesnt-update-folder-icon-automatically-in-windows">batch file - Changing desktop.ini doesnâ€™t update folder icon automatically in Windows - Stack Overflow</a></p><p><a href="https://stackoverflow.com/questions/68941080/update-folder-icon-with-desktop-ini-instantly-change-c">windows - Update folder icon with desktop.ini &amp; instantly change (C++) - Stack Overflow</a></p><p><a href="https://superuser.com/questions/499078/refresh-icon-cache-without-rebooting/499083">windows - Refresh Icon Cache Without Rebooting - Super User</a></p><p><a href="https://stackoverflow.com/questions/45921769/how-to-refresh-the-folder-icon-instantly-in-windows">c++ - How to refresh the folder icon instantly in Windows - Stack Overflow</a></p><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/shell/how-to-customize-folders-with-desktop-ini">å¦‚ä½•ä½¿ç”¨ Desktop.ini è‡ªå®šä¹‰æ–‡ä»¶å¤¹ - Win32 apps | Microsoft Learn</a></p><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/shlwapi/nf-shlwapi-pathmakesystemfolderw">pathMakeSystemFolderW å‡½æ•° (shlwapi.h) - Win32 apps | Microsoft Learn</a></p><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/shlobj_core/nf-shlobj_core-shchangenotify">SHChangeNotify å‡½æ•° (shlobj_core.h) - Win32 apps | Microsoft Learn</a></p><p><a href="https://www.folderico.com/what-if-custom-folder-icon-does-not-show.html">What If the Custom Folder Icon Does Not Show?</a></p><p><a href="https://github.com/tongzx/nt5src/tree/master">tongzx&#x2F;nt5src: Source code of Windows XP (NT5). Leaks are not from me. I just extracted the archive and cabinet files. (github.com)</a></p><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/shlobj_core/nf-shlobj_core-shgetsetfoldercustomsettings">SHGetSetFolderCustomSettings å‡½æ•° (shlobj_core.h) - Win32 apps | Microsoft Learn</a></p><p><a href="https://blog.csdn.net/bankpan/article/details/17759633">å¦‚ä½•æ”¹å˜æ–‡ä»¶å¤¹çš„å›¾æ ‡ï¼ˆæœªå®Œæˆã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ï¼‰-CSDNåšå®¢</a></p><p><a href="https://stackoverflow.com/questions/6464147/how-can-i-immediately-reload-a-folder-icon-when-desktop-ini-is-changed">windows - How can I immediately reload a folder icon when desktop.ini is changed - Stack Overflow</a></p><p><a href="https://github.com/selfrender/Windows-Server-2003/blob/5c6fe3db626b63a384230a1aa6b92ac416b0765f/shell/shlwapi/path.c#L3408">Windows-Server-2003&#x2F;shell&#x2F;shlwapi&#x2F;path.c at 5c6fe3db626b63a384230a1aa6b92ac416b0765f Â· selfrender&#x2F;Windows-Server-2003 (github.com)</a></p><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.yundongfang.com/Yun147646.html">åœ¨ Windows 11 ä¸Šæ›´æ”¹æ–‡ä»¶å¤¹å›¾æ ‡çš„ 5 ç§æ–¹æ³•ï¼ˆå’Œ 3 ä¸ªæç¤ºï¼‰-äº‘ä¸œæ–¹ (yundongfang.com)</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://blog.csdn.net/luoyayun361/article/details/79228390">windowsæ¸…ç†å›¾æ ‡ç¼“å­˜å¹¶é‡æ–°åŠ è½½_windows å›¾æ ‡ç¼“å­˜åˆ·æ–°-CSDNåšå®¢</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>Qt</tag>
      
      <tag>Windows</tag>
      
      <tag>Win11</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VMwareè™šæ‹Ÿæœºåœ¨åå°è¿è¡Œæ—¶æ€§èƒ½ä¸‹é™</title>
    <link href="/2024/07/16/VMware-Background-Performance-Down/"/>
    <url>/2024/07/16/VMware-Background-Performance-Down/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒWorld needs <code>Windows</code>. But <code>Linux</code> even matters. (Especially for developers)</p><p>é±¼å’Œç†ŠæŒèƒ½å¦å…¼å¾—ï¼Œä¹Ÿè®¸å¯ä»¥å°ç«æ…¢ç…</p><p>æœ‰çš„åŒå­¦è¦è¯´äº†ï¼šWSLï¼</p><p><code>WSLï¼ˆWindows Subsystem for Linuxï¼‰</code>ï¼Œä¸€å¬åå­—å°±æ„Ÿè§‰æ€§èƒ½çˆ†è¡¨</p><p>ä½†æ˜¯å¦‚æœéœ€è¦<strong>å›¾å½¢ç•Œé¢</strong>çš„è¯ï¼ŒWSLè²Œä¼¼ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿</p><p>æ­¤æ—¶å°±éœ€è¦ç»å…¸è™šæ‹Ÿæœºå‡ºåœºäº†ï¼Œlike <code>VMware</code></p><h2 id="ä¸»è¯‰ï¼ˆæ€§èƒ½ä¸‹é™ï¼‰"><a href="#ä¸»è¯‰ï¼ˆæ€§èƒ½ä¸‹é™ï¼‰" class="headerlink" title="ä¸»è¯‰ï¼ˆæ€§èƒ½ä¸‹é™ï¼‰"></a>ä¸»è¯‰ï¼ˆæ€§èƒ½ä¸‹é™ï¼‰</h2><p>ä¸€ä¸ªç»å…¸çš„æ–¹æ¡ˆæ˜¯ï¼šVSCodeï¼ˆRemote SSHï¼‰+ VMWareï¼ˆUbuntuï¼‰</p><p>æˆ‘ä»æ²¡æœ‰å‘ç°å…¶<strong>æ€§èƒ½ä¸ä½³</strong>ï¼Œç›´åˆ°æˆ‘å¼€å§‹æ€€å¿µ<code>RustRover (Jetbrains)</code>ï¼Œä½†è¢«<code>Jetbrains Gateway</code>çš„è¿œç¨‹å¼€å‘ä½“éªŒå‡»æºƒåï¼Œæˆ‘åœ¨è™šæ‹Ÿæœºé‡Œå®‰è£…äº†<code>Jetbrains for Linux</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs rust">cargo clean<br>cargo build<br></code></pre></td></tr></table></figure><p>çœ‹ç€ç¼©çŸ­äº†5å€çš„ç¼–è¯‘æ—¶é•¿ï¼Œæˆ‘é™·å…¥äº†æ²‰æ€</p><p>éƒ½æ˜¯<code>Terminal</code>ï¼Œéƒ½æ˜¯<code>fish</code>ï¼Œéš¾ä¸æˆ<code>Jetbrains</code>æœ‰é­”æ³•ï¼Œè¿˜æ˜¯<code>Remote SSH</code>æœ‰å¤§å‘</p><p>&#x2F;&#x2F; ç»æµ‹è¯•ï¼šåŸç”Ÿç»ˆç«¯å’Œ<code>Jetbrains</code>ç»ˆç«¯æ€§èƒ½ä¸€è‡´ å•Šå“ˆå“ˆï¼ˆå°¬ï¼‰</p><p>æˆ‘ä¸ç»è„ŠèƒŒå‘å‡‰ï¼Œæ²¡æœ‰äº†<code>VSCode Remote SSH</code>ï¼Œæˆ‘å¾ˆéš¾æƒ³è±¡å‡ºä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆè¿›è¡Œè¿œç¨‹å¼€å‘</p><p>ä¸ºæ­¤ï¼Œæˆ‘è¯·åˆ°äº†è‘—å<code>Linux</code>ä¸“å®¶ - ä¾¯åŒå­¦ï¼Œä¸ºå¤§å®¶è¿›è¡Œ<code>WSL + Remote SSH</code>çš„æµ‹è¯•</p><p>Resultï¼š<code>WSL</code>åŸç”Ÿç»ˆç«¯ä¸<code>Remote SSH</code>ç»ˆç«¯æ€§èƒ½å¹¶æ— äºŒå¼‚</p><p>çœ‹æ¥<code>VSCode</code>ä¸èƒŒè¿™ä¸ªé”…ï¼Œå‘¼å‘¼å‘¼</p><h2 id="å…ˆåšä¸ªæ£€æŸ¥å§"><a href="#å…ˆåšä¸ªæ£€æŸ¥å§" class="headerlink" title="å…ˆåšä¸ªæ£€æŸ¥å§"></a>å…ˆåšä¸ªæ£€æŸ¥å§</h2><p>ç›¯â€”â€”ï¼ˆæœ›é—»é—®åˆ‡ï¼‰</p><p>å¥½çš„ï¼Œè¯·é—®ï¼Œ<code>Jetbrains</code>ç»ˆç«¯å’Œ<code>VSCode Remote SSH</code>ç»ˆç«¯æœ‰ä»€ä¹ˆä¸åŒ</p><p>å³ç­”ï¼šåè€…æ˜¯Windowsç‰©ç†æœºåº”ç”¨ï¼Œæ­¤æ—¶ï¼Œè™šæ‹Ÿæœºè¿è¡Œäºåå°</p><p>è¿™ç‚¹å…¶å®éå¸¸é‡è¦ï¼Œåå°è¿›ç¨‹çš„ä¼˜å…ˆçº§æ˜¾ç„¶æ˜¯ä½äºå‰å°çš„ï¼Œï¼ˆè¢«è°ƒåº¦åˆ°å°æ ¸ä¸Šä¹‹ç±»çš„ï¼ŒCPUç‰‡å‡å°‘ä¹‹ç±»çš„ï¼‰</p><h2 id="åˆ‡ç‰‡ï¼ˆTestï¼‰"><a href="#åˆ‡ç‰‡ï¼ˆTestï¼‰" class="headerlink" title="åˆ‡ç‰‡ï¼ˆTestï¼‰"></a>åˆ‡ç‰‡ï¼ˆTestï¼‰</h2><p>Okayï¼Œæˆ‘ä»¬åœ¨Remote SSHç»ˆç«¯ä¸­è¾“å…¥<code>cargo build</code>ï¼Œç„¶åå›åˆ°è™šæ‹Ÿæœºï¼Œä½¿å…¶æ—¶åˆ»ä¿æŒåœ¨å‰å°</p><p>Resultï¼šç¼–è¯‘æ—¶é•¿å¤§å¤§ç¼©çŸ­ï¼Œä¸åŸç”Ÿç»ˆç«¯æ— å¼‚</p><h2 id="ç ´æ¡ˆ"><a href="#ç ´æ¡ˆ" class="headerlink" title="ç ´æ¡ˆ"></a>ç ´æ¡ˆ</h2><p>æ­£å¦‚æˆ‘ä»¬æ‰€çŒœæƒ³çš„ï¼Œåœ¨åå°æ—¶ï¼Œè¿›ç¨‹ä¼˜å…ˆçº§ä¸‹é™ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼ˆ5å€ï¼‰</p><h2 id="è¯æ–¹"><a href="#è¯æ–¹" class="headerlink" title="è¯æ–¹"></a>è¯æ–¹</h2><p>èƒ½å¦è®¾ç½®è™šæ‹Ÿæœºçš„è¿›ç¨‹ä¼˜å…ˆçº§å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼ˆè–›å®šè°”çš„ï¼‰</p><p><img src="/img/image-20240716162912923.png" alt="ä¼˜å…ˆçº§"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå³ä¾§å¯ä»¥è®¾ç½®ä¸¤ç§æƒ…å†µä¸‹çš„ä¼˜å…ˆçº§ï¼š</p><ul><li>æŠ“å–çš„è¾“å…¥å†…å®¹</li><li>å–æ¶ˆæŠ“å–çš„è¾“å…¥å†…å®¹</li></ul><p>å¥½çš„ï¼Œä½œä¸ºä¸€ä¸ªthe localï¼Œæˆ‘åªèƒ½å‘Šè¯‰ä½ ï¼Œæˆ‘æ¯ä¸ªå­—éƒ½çœ‹å¾—æ‡‚ï¼ŒButâ€¦</p><p>å¥½å§ï¼Œæˆ‘ä»¬è¿˜æ˜¯çœ‹çœ‹å®˜æ–¹æ–‡æ¡£å§ï¼š</p><p><img src="/img/image-20240716163106655.png" alt="å®˜æ–¹æ–‡æ¡£"></p><p>è¿™ä¸ªå°±å¥½ç†è§£å¤šäº†</p><p>I Guessï¼š</p><ul><li>å·²æŠ“å–è¾“å…¥æ—¶ï¼šå‰å°ï¼Œè·å–ç„¦ç‚¹æ—¶</li><li>æœªæŠ“å–è¾“å…¥æ—¶ï¼šåå°ï¼Œæ— ç„¦ç‚¹æ—¶</li></ul><p>å‰è€…é»˜è®¤æ˜¯<strong>æ­£å¸¸</strong>ï¼Œè®¾ç½®ä¸º<strong>é«˜</strong>åï¼Œå‰å°ä½¿ç”¨è™šæ‹Ÿæœºçš„æ€§èƒ½ä¼šæå‡</p><p>Butï¼Œåè€…å±…ç„¶æ— æ³•è®¾ç½®ä¸º<strong>é«˜</strong>ï¼</p><p>åªæœ‰ï¼Œ<strong>æ­£å¸¸</strong>å’Œ<strong>ä½</strong>ä¸¤ä¸ªé€‰é¡¹ï¼Œå¯„</p><p>&#x2F;&#x2F; å¯èƒ½æ˜¯ä¸ºäº†ä¸æŠ¢å ç‰©ç†æœºï¼Œä½†æ˜¯å±…ç„¶ä¸ç»™ä¸ªé€‰é¡¹</p><p>æœ‰åŠæ³•å—ï¼Ÿä¹Ÿè®¸å¯ä»¥å¼ºåˆ¶è®¾ç½®è¿›ç¨‹ä¼˜å…ˆçº§ï¼ˆWindows APIï¼‰</p><p>å‚è§ï¼š<a href="https://www.bilibili.com/read/cv21154645/">è¿˜åœ¨ä¸ºå¤§å°æ ¸è°ƒåº¦å›°æ‰°ï¼Ÿæ•™ä½ å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼ - å“”å“©å“”å“© (bilibili.com)</a></p><p>ã‚ã®ï¼Œæˆ‘è¿˜æ˜¯ç”¨<code>Linux Jetbrains</code>å§ï¼Œï¼ˆå­©å­ä»¬ï¼Œæˆ‘å›æ¥äº†ï¼‰</p><h3 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h3><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://www.bilibili.com/read/cv21154645/">è¿˜åœ¨ä¸ºå¤§å°æ ¸è°ƒåº¦å›°æ‰°ï¼Ÿæ•™ä½ å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼ - å“”å“©å“”å“© (bilibili.com)</a></p>]]></content>
    
    
    <categories>
      
      <category>è™šæ‹Ÿæœº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>VMware</tag>
      
      <tag>è™šæ‹Ÿæœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>QSettings æ— æ³•æ­£ç¡®å¤„ç†åŒ…å«æ–œæ çš„key</title>
    <link href="/2024/06/22/QSettings-%E6%97%A0%E6%B3%95%E6%AD%A3%E7%A1%AE%E5%A4%84%E7%90%86%E5%8C%85%E5%90%AB%E6%96%9C%E6%9D%A0%E7%9A%84key/"/>
    <url>/2024/06/22/QSettings-%E6%97%A0%E6%B3%95%E6%AD%A3%E7%A1%AE%E5%A4%84%E7%90%86%E5%8C%85%E5%90%AB%E6%96%9C%E6%9D%A0%E7%9A%84key/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>umï¼Œè¿™æ¬¡é•¿è¯çŸ­è¯´å¥½å§</p><p>åœ¨<code>Qt</code>ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç”¨<code>QSettings</code>æ¥è¯»å†™é…ç½®æ–‡ä»¶ï¼Œæ³¨å†Œè¡¨ç­‰</p><h2 id="â€˜-â€˜ï¼šäºŒä¹‰æ€§"><a href="#â€˜-â€˜ï¼šäºŒä¹‰æ€§" class="headerlink" title="â€˜\â€˜ï¼šäºŒä¹‰æ€§"></a>â€˜\â€˜ï¼šäºŒä¹‰æ€§</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å½“keyä¸­åŒ…å«åæ–œæ ï¼ˆ<code>&#39;\&#39;</code>ï¼‰ or æ–œæ ï¼ˆ <code>&#39;/&#39;</code>ï¼‰çš„æ—¶å€™ï¼Œå°±å¯„äº†</p><blockquote><p>æ–‡æ¡£ï¼šä¸è¦åœ¨èŠ‚åæˆ–é”®åä¸­ä½¿ç”¨æ–œæ ï¼ˆâ€œ&#x2F;â€å’Œâ€œ\â€ï¼‰ï¼›åæ–œæ å­—ç¬¦ç”¨äºåˆ†éš”å­é”®ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚åœ¨ Windows ä¸Šï¼Œâ€œ\â€è¢« QSettings è½¬æ¢ä¸ºâ€œ&#x2F;â€ï¼Œè¿™ä½¿å¾—å®ƒä»¬ç›¸åŒ</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">settings.<span class="hljs-built_in">setValue</span>(<span class="hljs-string">&quot;mainwindow/size&quot;</span>, win-&gt;<span class="hljs-built_in">size</span>());<br></code></pre></td></tr></table></figure><p>æ–œæ è¢«ç”¨äºåˆ†å‰²å­é”®ï¼Œæ‰€ä»¥å½“<code>key</code>æœ¬èº«å«æœ‰æ–œæ æ—¶ï¼ˆå¦‚ï¼š<code>&quot;C:\App\test.exe&quot;</code> in <code>MuiCache</code>ï¼‰ï¼Œ<code>QSettings</code>æ— æ³•å¤„ç†</p><ul><li>å¯èƒ½è¢«è®¤ä¸ºæ˜¯åˆ†å‰²ç¬¦</li><li>æˆ–è€…è¢«è½¬æ¢ä¸º<code>&quot;C:/App/test.exe&quot;</code>ï¼ˆæˆ‘é‡åˆ°äº†ï¼‰ï¼ˆæ‰¾äº†å¥½ä¹…bug å“­ï¼‰</li></ul><p><em>ï¼ˆè¿™å…¶ä¸­çš„é€»è¾‘è¿˜æ²¡æœ‰éå¸¸ææ¸…æ¥šï¼šä¸ºä»€ä¹ˆè·¯å¾„ä¸ä¼šè¢«è®¤ä¸ºæ˜¯åˆ†å‰²ç¬¦ è€Œæ˜¯äº§ç”Ÿäº†ä¸€ä¸ª<code>&quot;C:/App/test.exe&quot;</code>è¿™æ ·çš„<code>key</code>ï¼‰</em></p><blockquote><p><strong>æ–‡æ¡£ï¼š</strong></p><p>è¯·æ³¨æ„ï¼Œå¦‚å‰æ‰€è¿°ï¼Œ<code>QSettings</code> ä½¿ç”¨åæ–œæ å­—ç¬¦æ¥åˆ†éš”å­é¡¹ã€‚å› æ­¤ï¼Œæ‚¨æ— æ³•è¯»å–æˆ–å†™å…¥åŒ…å«æ–œæ æˆ–åæ–œæ çš„ <code>Windows</code> æ³¨å†Œè¡¨é¡¹ï¼›</p><p>å¦‚æœéœ€è¦ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨æœ¬æœº <code>Windows API</code></p></blockquote><p>æ–‡æ¡£ä¸­è¯´åˆ†å‰²ä½¿ç”¨åæ–œæ ï¼ˆ<code>&#39;\&#39;</code>ï¼‰ï¼Œä½†æ˜¯ä»£ç ä¾‹å­ä¸­ç”¨çš„æ˜¯æ–œæ ï¼ˆ <code>&#39;/&#39;</code>ï¼‰ï¼Œæœ‰ç‚¹è¿·ç³Š</p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><ul><li>åˆ†å‰²å­é”®ä½¿ç”¨ï¼šæ–œæ ï¼ˆ <code>&#39;/&#39;</code>ï¼‰</li><li><code>key</code>ä¸­åŒ…å«<code>&#39;\&#39;</code> or <code>&#39;/&#39;</code>ï¼ˆå¦‚ è·¯å¾„ï¼‰ï¼Œå°±ä¸è¦ç”¨<code>QSettings</code>äº†ï¼Œæ”¹ç”¨<code>Windows API - RegOpenKeyEx</code></li><li>æ³¨æ„ï¼Œæˆ‘è¯´çš„æ˜¯<code>key</code>ï¼Œnot <code>value</code>ï¼Œå€¼ä¸­åŒ…å«æ–œæ æ²¡æœ‰é—®é¢˜</li></ul><h3 id="peace"><a href="#peace" class="headerlink" title="peace"></a>peace</h3><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://runebook.dev/zh/docs/qt/qsettings">Qt - QSettings (class) zh (runebook.dev)</a></p><p><a href="https://www.cnblogs.com/LyShark/p/17850186.html">C&#x2F;C++ å®ç°Windowsæ³¨å†Œè¡¨æ“ä½œ - lyshark - åšå®¢å›­ (cnblogs.com)</a></p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windowsçª—å£ ç›¸å¯¹ç½®é¡¶ æŠ€æœ¯ç®€æ</title>
    <link href="/2024/06/16/Windows%E7%AA%97%E5%8F%A3-%E7%9B%B8%E5%AF%B9%E7%BD%AE%E9%A1%B6-%E6%8A%80%E6%9C%AF%E7%AE%80%E6%9E%90/"/>
    <url>/2024/06/16/Windows%E7%AA%97%E5%8F%A3-%E7%9B%B8%E5%AF%B9%E7%BD%AE%E9%A1%B6-%E6%8A%80%E6%9C%AF%E7%AE%80%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Windows</code> &#x3D; <code>Window</code> * n</p><p>å¯è§<code>Windowï¼ˆçª—å£ï¼‰</code>è¿™ä¸€æ¦‚å¿µåœ¨<code>Windows</code>æ“ä½œç³»ç»Ÿä¸­çš„æ ¸å¿ƒåœ°ä½</p><p>æ¯ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªçª—å£ï¼Œè€Œçª—å£é—´åˆå¯æ„æˆçˆ¶å­å…³ç³»</p><p>å¦‚ä½•ç®¡ç†<strong>å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰</strong>ä¸­è¿™äº›çº·ç¹å¤æ‚çš„çª—å£æˆäº†<code>Windows</code>ç»•ä¸å¼€çš„éš¾é¢˜</p><p>ç®¡ä¸­çª¥è±¹ï¼Œå¯è§ä¸€æ–‘</p><p>æœ¬æ–‡å°†è®¨è®ºä¸€ä¸ªä¸çª—å£å±‚çº§ï¼ˆZ-orderï¼‰ç›¸å…³çš„ç»å…¸é—®é¢˜ï¼š<strong>ç½®é¡¶</strong></p><h2 id="ç½®é¡¶"><a href="#ç½®é¡¶" class="headerlink" title="ç½®é¡¶"></a>ç½®é¡¶</h2><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œ<strong>ç½®é¡¶</strong>é€šå¸¸æ„å‘³ç€å°†çª—å£Zåºæå‡åˆ°æœ€é«˜</p><h3 id="ä¾‹å¦‚ï¼š"><a href="#ä¾‹å¦‚ï¼š" class="headerlink" title="ä¾‹å¦‚ï¼š"></a>ä¾‹å¦‚ï¼š</h3><p>miniæ¨¡å¼ç½‘æ˜“äº‘ï¼š</p><p><img src="/img/image-20240616143613946.png" alt="miniæ¨¡å¼çš„ç½‘æ˜“äº‘"></p><p>æœç‹—è¾“å…¥æ³•ï¼š</p><p><img src="/img/image-20240616143935658.png" alt="æœç‹—è¾“å…¥æ³•"></p><p><code>Windows</code>ä»»åŠ¡æ ï¼š</p><p><img src="/img/image-20240616144205063.png" alt="ä»»åŠ¡æ "></p><p>ä»–ä»¬é€šå¸¸ä¸ä¼šè½»æ˜“è¢«å…¶ä»–çª—å£è¦†ç›–ï¼Œé™¤éå¯¹æ–¹ä¹Ÿæ˜¯åŒæ ·ç½®é¡¶çš„çª—å£ï¼ˆæ­¤æ—¶åæ¥å±…ä¸Šï¼‰</p><h3 id="Z-order"><a href="#Z-order" class="headerlink" title="Z-order"></a>Z-order</h3><p>å…¶å®ï¼Œç½®é¡¶å¹¶ä¸ä»…ä»…æ˜¯å°†Zåºæå‡é‚£ä¹ˆç®€å•</p><p>ä»<code>Windows API</code>çš„è§†è§’æ¥çœ‹ï¼ŒZåºå¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><code>non-topmost</code>ï¼šéæœ€é¡¶å±‚çª—å£ï¼ˆæ™®é€šçª—å£ï¼‰</li><li><code>topmost</code>ï¼šæœ€é¡¶å±‚çª—å£ï¼Œ<em>The topmost window receives the highest rank and is the first window in the Z order.</em></li></ul><p>è¿™ä¸¤ç±»å±‚çº§å­˜åœ¨é˜¶çº§çš„éš”é˜‚ï¼Œå°±ç®—æ˜¯æ™®é€šçª—å£ä¸­çš„<code>TOP</code>ï¼Œä¹Ÿæ°¸è¿œåœ¨<code>TOPMOST</code>ä¹‹ä¸‹</p><p>å½“ä¸€ä¸ªçª—å£è·å¾—ç„¦ç‚¹ï¼Œæˆä¸ºæ´»åŠ¨çª—å£ï¼Œä¾‹å¦‚ç”¨<strong>é¼ æ ‡ç‚¹å‡»</strong>ï¼Œé‚£ä¹ˆè¯¥çª—å£ä¼šè¢«è®¾ç½®ä¸º<code>TOP</code>ï¼ˆæ™®é€šçª—å£ä¸­çš„æœ€é«˜å±‚ï¼‰</p><p>å½“ä½ å†æ¬¡ç‚¹å‡»å¦ä¸€ä¸ªçª—å£ï¼ŒåŸå…ˆçš„çª—å£å°±ä¼šè¢«è¦†ç›–</p><p>è€Œæˆ‘ä»¬å¹³æ—¶è¯´çš„<code>ç½®é¡¶</code>ï¼ŒæŒ‡çš„å°±æ˜¯<code>TOPMOST</code>ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿åœ¨æ‰€æœ‰æ™®é€šçª—å£ä¹‹ä¸Šï¼Œä¸è¢«è¦†ç›–</p><h3 id="SetWindowPos-å‡½æ•°"><a href="#SetWindowPos-å‡½æ•°" class="headerlink" title="SetWindowPos  å‡½æ•°"></a>SetWindowPos  å‡½æ•°</h3><p>ä¸ºäº†æ”¹å˜çª—å£Zåºï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°<a href="https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-setwindowpos"><code>SetWindowPos</code>å‡½æ•°</a></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">BOOL <span class="hljs-title">SetWindowPos</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">  [in]           HWND hWnd,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in, optional] HWND hWndInsertAfter,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in]           <span class="hljs-type">int</span>  X,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in]           <span class="hljs-type">int</span>  Y,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in]           <span class="hljs-type">int</span>  cx,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in]           <span class="hljs-type">int</span>  cy,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in]           UINT uFlags</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></table></figure><p>è¯¥å‡½æ•°å¯ä»¥ä¿®æ”¹çª—å£çš„ä½ç½®ã€å¤§å°å’ŒZåº</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">SetWindowPos</span>(hwnd, HWND_TOPMOST, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, SWP_NOMOVE | SWP_NOSIZE);<br></code></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬åªæƒ³æ”¹å˜Zåºï¼Œæ‰€ä»¥éœ€è¦åœ¨æœ€åä¸€ä¸ª<code>flags</code>å‚æ•°å†™ä¸Š<code>SWP_NOMOVE | SWP_NOSIZE</code>ï¼Œè¡¨ç¤ºå¿½ç•¥<code>X Y cx cy</code>å››ä¸ªå‚æ•°</p><p>ç¬¬äºŒä¸ªå‚æ•°<code>hWndInsertAfter</code>æ˜¯æˆ‘ä»¬è¦å…³æ³¨çš„é‡ç‚¹ï¼Œå–å€¼å¦‚ä¸‹ï¼š</p><ul><li><strong>HWND_BOTTOM</strong>ï¼šå°†çª—å£æ”¾ç½®åœ¨ Z åºçš„åº•éƒ¨</li><li><strong>HWND_NOTOPMOST</strong>ï¼šå°†çª—å£æ”¾ç½®åœ¨æ‰€æœ‰éæœ€é¡¶å±‚çª—å£ä¸Šæ–¹ï¼ˆå³æ‰€æœ‰æœ€é¡¶å±‚çª—å£åé¢ï¼‰ï¼Œå¦‚æœçª—å£å·²ç»æ˜¯éæœ€é¡¶å±‚çª—å£ï¼Œåˆ™æ­¤æ ‡å¿—æ— æ•ˆ</li><li><strong>HWND_TOP</strong>ï¼šå°†çª—å£æ”¾ç½®åœ¨ Z åºçš„é¡¶éƒ¨ ï¼ˆæŒ‡æ™®é€šçª—å£ï¼‰</li><li><strong>HWND_TOPMOST</strong>ï¼šå°†çª—å£æ”¾ç½®åœ¨æ‰€æœ‰éæœ€é¡¶å±‚çª—å£ä¹‹ä¸Šï¼ˆé«˜äºTOPï¼‰</li></ul><p><strong>æ³¨æ„ï¼š</strong></p><ul><li><p><code>HWND_NOTOPMOST</code>æ¯”è¾ƒç‰¹æ®Šï¼Œä»–çš„ä½œç”¨è²Œä¼¼æ˜¯æŠŠ<code>TOPMOST</code>çª—å£æ‹‰ä¸‹ç¥å›ï¼Œä»è´µæ—æ‰“ä¸ºå¹³æ°‘ï¼Œä¸è¿‡ç˜¦æ­»çš„éª†é©¼æ¯”é©¬å¤§ï¼Œä»ç„¶æ˜¯åœ¨æ™®é€šçª—å£çš„TOPå±‚çº§ï¼ˆä½†æ˜¯å¯ä»¥è¢«è¦†ç›–ï¼‰</p></li><li><p>ç”±äº<code>TOPMOST</code>é«˜äººä¸€ç­‰ï¼Œæ‰€ä»¥æœ‰ä¸”åªæœ‰<code>HWND_NOTOPMOST</code>èƒ½å–æ¶ˆä»–ä»¬çš„ç‰¹æƒå±‚çº§ï¼Œ<code>HWND_TOP</code>å’Œ<code>HWND_BOTTOM</code>å¯¹<code>TOPMOST</code>çª—å£éƒ½ä¸èµ·ä½œç”¨</p></li><li><p>è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ï¼š<code>SetWindowPos</code>ä¿®æ”¹Zåºä¸ä¼šå¯¹<strong>æœ€å°åŒ–</strong>çš„çª—å£ç”Ÿæ•ˆï¼Œå³ä¾¿åŠ ä¸Š<code>SWP_SHOWWINDOW</code>ä¹Ÿæ— æ•ˆ</p></li></ul><h3 id="ç½®é¡¶-vs-ç„¦ç‚¹"><a href="#ç½®é¡¶-vs-ç„¦ç‚¹" class="headerlink" title="ç½®é¡¶ vs ç„¦ç‚¹"></a>ç½®é¡¶ vs ç„¦ç‚¹</h3><p>åˆšåˆšè¯´åˆ°ï¼Œçª—å£è¢«ç‚¹å‡»ï¼Œè·å¾—ç„¦ç‚¹ä¹‹åï¼Œä¼šè¢«è®¾ç½®ä¸º<code>TOP</code>ï¼Œç½®é¡¶äºæ™®é€šçª—å£ä¹‹ä¸Š</p><p>ä½†æ˜¯åè¿‡æ¥ï¼Œç½®é¡¶å¹¶ä¸æ„å‘³ç€è·å–ç„¦ç‚¹ï¼Œå³ä¾¿æ˜¯<code>TOPMOST</code></p><p>åŒæ—¶ï¼Œå¦‚æœä¸€ä¸ªçª—å£æ²¡æœ‰ç„¦ç‚¹ï¼ˆéæ´»åŠ¨çª—å£ï¼‰ï¼Œå°±æ— æ³•è¢«è®¾ç½®ä¸º<code>HWND_TOP</code>æˆ–<code>HWND_BOTTOM</code></p><p>å®˜æ–¹æ–‡æ¡£ä¸­å†™é“:</p><blockquote><p>è‹¥è¦ä½¿ç”¨ <strong>SetWindowPos</strong> å°†çª—å£ç½®äºé¡¶éƒ¨ï¼Œæ‹¥æœ‰è¯¥çª—å£çš„è¿›ç¨‹å¿…é¡»å…·æœ‰ <a href="https://learn.microsoft.com/zh-cn/windows/desktop/api/winuser/nf-winuser-setforegroundwindow">SetForegroundWindow</a> æƒé™</p></blockquote><p>é‚£ä¹ˆï¼Œ<code>SetForegroundWindow</code>æƒé™åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š</p><p><img src="/img/image-20240616154207040.png" alt="SetForegroundWindowæ³¨è§£"></p><p>æ˜¯ä¸æ˜¯çœ¼èŠ±ç¼­ä¹±ï¼Œæ€»ä¹‹å‘¢ï¼Œ<code>Windows</code>ä¸¥æ ¼é™åˆ¶äº†å°†çª—å£ç½®é¡¶æˆ–è®¾ä¸ºå‰å°çª—å£ï¼ˆè·å–ç„¦ç‚¹ï¼‰çš„æƒåˆ©</p><p>è¿™æ˜¯ä¸ºäº†é˜²æ­¢æ‰“æ‰°ç”¨æˆ·çš„æ­£å¸¸å·¥ä½œ</p><p>ç»è¿‡å®éªŒï¼Œç»“è®ºå¤§è‡´å¦‚ä¸‹ï¼š</p><ul><li>å½“è°ƒç”¨è¿›ç¨‹æ˜¯å‰å°è¿›ç¨‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>SetForegroundWindow</code>å°†å…¶ä»–çª—å£è®¾ç½®ä¸ºå‰å°çª—å£ï¼Œå³ä¾¿å‰å°é”æ²¡æœ‰è¿‡æœŸï¼ˆ200sï¼‰</li><li>å¦‚æœè°ƒç”¨çº¿ç¨‹ä¸æ˜¯å‰å°è¿›ç¨‹ï¼Œå¤§æ¦‚ç‡å¤±è´¥</li><li>å½“è°ƒç”¨çº¿ç¨‹æ˜¯å‰å°è¿›ç¨‹ï¼Œä¸€èˆ¬ä¹Ÿä¸èƒ½ä½¿ç”¨<code>SetWindowPos</code>å°†çª—å£Aè®¾ç½®ä¸º<code>TOP</code>ï¼Œé™¤éçª—å£Aæ˜¯æ´»åŠ¨çª—å£ï¼Œç±»ä¼¼äº<code>BringWindowToTop</code>å‡½æ•°</li><li><code>TOPMOST</code>æ¯”è¾ƒç‰¹æ®Šï¼Œä¸€èˆ¬ä¸éœ€è¦ç‰¹æ®Šæ¡ä»¶å°±å¯ä»¥è®¾ç½®ï¼ˆä¸æ„§æ˜¯è´µæ—ï¼‰</li></ul><p>æ³¨æ„ï¼šæ–‡æ¡£ä¸­å†™é“ï¼Œå³ä½¿è¿›ç¨‹æ»¡è¶³è¿™äº›æ¡ä»¶ï¼Œä¹Ÿæœ‰å¯èƒ½æ‹’ç»è®¾ç½®å‰å°çª—å£çš„æƒåˆ© \å“­</p><h4 id="ä¸´æ—¶ç½®é¡¶"><a href="#ä¸´æ—¶ç½®é¡¶" class="headerlink" title="ä¸´æ—¶ç½®é¡¶"></a>ä¸´æ—¶ç½®é¡¶</h4><p>å¦‚æœæˆ‘ä»¬æƒ³è¦å°†ä¸€ä¸ªçª—å£ä¸´æ—¶ç½®é¡¶ï¼Œæå‡åˆ°ç”¨æˆ·é¢å‰ï¼Œä¸€èˆ¬æƒ…å†µä¸‹<code>SetForegroundWindow</code>å’Œ<code>HWND_TOP</code>éƒ½ä¸å¥½ä½¿</p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸€ç‚¹<code>trick</code>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">SetWindowPos</span>(hwnd, HWND_TOPMOST, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, SWP_NOMOVE | SWP_NOSIZE);<br><span class="hljs-built_in">SetWindowPos</span>(hwnd, HWND_NOTOPMOST, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, SWP_NOMOVE | SWP_NOSIZE);<br></code></pre></td></tr></table></figure><p>å°†çª—å£è®¾ç½®ä¸º<code>HWND_TOPMOST</code>å†<code>HWND_NOTOPMOST</code>ï¼Œå®Œç¾å®ç°äº†<code>TOP</code>çš„æ•ˆæœï¼Œhhhhï¼Œç½®é¡¶ä¹‹åä¹Ÿèƒ½è¢«å…¶ä»–çª—å£è¦†ç›–</p><p>è¿™é‡Œéœ€è¦<strong>æ³¨æ„</strong>ä¸€ç‚¹ï¼Œçª—å£çš„Zåºåªæœ‰åœ¨ç„¦ç‚¹çª—å£æ”¹å˜æ—¶æ‰ä¼šå˜åŒ–</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼šå¦‚æœç„¦ç‚¹åœ¨Açª—å£ä¸Šï¼Œç„¶åå¯¹Bçª—å£é‡‡ç”¨<code>trick</code>ï¼ˆç½®é¡¶å¹¶å–æ¶ˆï¼‰ï¼Œæ­¤æ—¶Bå¹¶æ²¡æœ‰è·å–ç„¦ç‚¹ï¼Œæ‰€ä»¥æ— è®ºå¦‚ä½•ç‚¹å‡»Açª—å£ï¼ŒBè¿˜æ˜¯åœ¨Aä¹‹ä¸Šï¼Œå› ä¸ºç„¦ç‚¹æ²¡æœ‰å˜åŒ–ï¼ŒZåºä¹Ÿä¸ä¼šå˜åŒ–</p><p>ä¸è¿‡åªè¦ä½ ç‚¹å‡»å¦å¤–ä¸€ä¸ªçª—å£ï¼Œæ”¹å˜ç„¦ç‚¹ï¼Œå†ç‚¹å‡»Aï¼ŒBå°±ä¼šæ­£å¸¸è¢«Aè¦†ç›–</p><h4 id="æ£€æµ‹TOPMOSTçŠ¶æ€"><a href="#æ£€æµ‹TOPMOSTçŠ¶æ€" class="headerlink" title="æ£€æµ‹TOPMOSTçŠ¶æ€"></a>æ£€æµ‹TOPMOSTçŠ¶æ€</h4><p>å¯ä»¥é€šè¿‡æ£€æµ‹çª—å£çš„æ‹“å±•æ ·å¼ä¸­æ˜¯å¦åŒ…å«<code>WS_EX_TOPMOST</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isTopMost</span><span class="hljs-params">(HWND hwnd)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (hwnd == <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    LONG_PTR style = <span class="hljs-built_in">GetWindowLongPtrW</span>(hwnd, GWL_EXSTYLE);<br>    <span class="hljs-keyword">return</span> style &amp; WS_EX_TOPMOST;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è®¾ç½®å‰å°çª—å£ï¼ˆç½®é¡¶-ç„¦ç‚¹ï¼‰"><a href="#è®¾ç½®å‰å°çª—å£ï¼ˆç½®é¡¶-ç„¦ç‚¹ï¼‰" class="headerlink" title="è®¾ç½®å‰å°çª—å£ï¼ˆç½®é¡¶ + ç„¦ç‚¹ï¼‰"></a>è®¾ç½®å‰å°çª—å£ï¼ˆç½®é¡¶ + ç„¦ç‚¹ï¼‰</h4><p>åˆšåˆšè¯´åˆ°ï¼Œä½¿ç”¨<code>SetForegroundWindow</code>è®¾ç½®å‰å°çª—å£æœ‰å¾ˆå¤šé™åˆ¶ï¼Œé‚£ä¹ˆå¦‚ä½•ç»•è¿‡è¿™ä¸ªé™åˆ¶ï¼Œå¼ºè¡Œå°†æŸçª—å£ï¼ˆä¾‹å¦‚è‡ªèº«ï¼‰è®¾ä¸ºå‰å°çª—å£ï¼Œç„¶åå“ç”¨æˆ·ä¸€è·³å‘¢?</p><h5 id="æœ€ç®€å•çš„åŠæ³•è«è¿‡äºï¼šå…ˆæœ€å°åŒ–å†æ˜¾ç¤º"><a href="#æœ€ç®€å•çš„åŠæ³•è«è¿‡äºï¼šå…ˆæœ€å°åŒ–å†æ˜¾ç¤º" class="headerlink" title="æœ€ç®€å•çš„åŠæ³•è«è¿‡äºï¼šå…ˆæœ€å°åŒ–å†æ˜¾ç¤º"></a>æœ€ç®€å•çš„åŠæ³•è«è¿‡äºï¼šå…ˆæœ€å°åŒ–å†æ˜¾ç¤º</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">miniAndShow</span><span class="hljs-params">(HWND hwnd)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">ShowWindow</span>(hwnd, SW_MINIMIZE); <span class="hljs-comment">//ç»„åˆæ“ä½œä¸è¦å¼‚æ­¥(ShowWindowAsync) è¦ç­‰å‰ä¸€æ­¥å®Œæˆ</span><br>    <span class="hljs-built_in">ShowWindow</span>(hwnd, SW_NORMAL);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ç§æ–¹æ³•çš„è§†è§‰ä½“éªŒä¸æ˜¯å¾ˆå¥½ï¼ˆä¼šçªç„¶æ¶ˆå¤±å†å‡ºç°ï¼‰ï¼Œä¸è¿‡å¯ä»¥ä½œä¸ºä¿åº•ï¼ˆè‚¯å®šèƒ½æˆï¼‰</p><h5 id="SwitchToThisWindow"><a href="#SwitchToThisWindow" class="headerlink" title="SwitchToThisWindow"></a>SwitchToThisWindow</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">SwitchToThisWindow</span>(hwnd, <span class="hljs-literal">false</span>); <span class="hljs-comment">//å°†è‡ªå·±çš„focusè½¬ç§»å¾ˆeasy è·å–å¾ˆå›°éš¾//ä¸èƒ½ç”¨äºè·å–focus //è¯¥å‡½æ•°ä¼šé€ æˆä»»åŠ¡æ é—ªçƒä¸å¤ªå¥½</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æœ‰æ—¶å€™èƒ½æˆ æœ‰æ—¶å€™ä¸èƒ½ å¾ˆç„å­¦åªèƒ½è¯´</p><p>å¦‚æœè‡ªèº«æ‹¥æœ‰ç„¦ç‚¹æ˜¯å¯ä»¥easyè½¬ç§»å‡ºå»çš„</p><h5 id="SetForegroundWindow-AttachThreadInput"><a href="#SetForegroundWindow-AttachThreadInput" class="headerlink" title="SetForegroundWindow + AttachThreadInput"></a>SetForegroundWindow + AttachThreadInput</h5><p>é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•å‘¢ï¼Œé‚£å¿…ç„¶æ˜¯æœ‰çš„ï¼Œè®©æˆ‘ä»¬å†æ¬¡æŠŠç›®å…‰å‘<code>SetForegroundWindow</code>çœ‹é½</p><p>è™½ç„¶åœ¨å½“å‰è¿›ç¨‹ä¸æ˜¯å‰å°è¿›ç¨‹æ—¶ï¼Œæ— æ³•ä½¿ç”¨<code>SetForegroundWindow</code></p><p>ä½†æ˜¯é€šè¿‡ä½¿ç”¨ <code>AttachThreadInput</code> å‡½æ•°ï¼Œçº¿ç¨‹å¯ä»¥ä¸å¦ä¸€ä¸ªçº¿ç¨‹å…±äº«å…¶è¾“å…¥çŠ¶æ€ (ä¾‹å¦‚é”®ç›˜çŠ¶æ€ï¼Œå½“å‰ç„¦ç‚¹çª—å£)</p><p>ä¾‹å¦‚å°†è‡ªèº«çº¿ç¨‹é™„åŠ åœ¨å‰å°çº¿ç¨‹ä¸Šï¼Œå‡è£…è‡ªå·±ä¹Ÿè·å–äº†ç„¦ç‚¹ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>SetForegroundWindow</code>è¾£ï¼Œå˜¿å˜¿</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">getInputFocus</span><span class="hljs-params">(HWND hwnd)</span></span><br><span class="hljs-function"></span>&#123;<br>    HWND foreHwnd = <span class="hljs-built_in">GetForegroundWindow</span>(); <span class="hljs-comment">//è·å–å‰å°çª—å£</span><br>    DWORD foreTID = <span class="hljs-built_in">GetWindowThreadProcessId</span>(foreHwnd, <span class="hljs-literal">NULL</span>); <span class="hljs-comment">//è·å–çº¿ç¨‹ID</span><br>    DWORD threadId = <span class="hljs-built_in">GetWindowThreadProcessId</span>(hwnd, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">if</span> (foreHwnd == hwnd)<br>        <span class="hljs-keyword">return</span>;<br>    <span class="hljs-type">bool</span> res = <span class="hljs-built_in">AttachThreadInput</span>(threadId, foreTID, TRUE); <span class="hljs-comment">//é™„åŠ </span><br>    <span class="hljs-keyword">if</span> (res == <span class="hljs-literal">false</span>) &#123; <span class="hljs-comment">//å¦‚æœé‡åˆ°ç³»ç»Ÿçª—å£è€Œå¤±è´¥ åªèƒ½æœ€å°åŒ–å†æ¿€æ´»è·å–ç„¦ç‚¹</span><br>        <span class="hljs-built_in">miniAndShow</span>(hwnd); <span class="hljs-comment">//ä¿åº•</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">//SetForegroundWindow(foreHwnd); //åˆ·æ–°ä»»åŠ¡æ å›¾æ ‡çŠ¶æ€ é˜²æ­¢ä¿æŒç„¦ç‚¹çŠ¶æ€ ä¸æ›´æ–° å¯¼è‡´ç‚¹å‡»å æœ€å°åŒ– è€Œéè·å–ç„¦ç‚¹</span><br>        <span class="hljs-built_in">SetForegroundWindow</span>(hwnd);<br>        <span class="hljs-built_in">SetFocus</span>(hwnd); <span class="hljs-comment">//å†—ä½™æ“ä½œ</span><br>        <span class="hljs-built_in">AttachThreadInput</span>(threadId, foreTID, FALSE); <span class="hljs-comment">//è§£é™¤é™„åŠ </span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¤§åŠŸå‘Šæˆ</p><blockquote><p> å˜›ï¼Œæˆ‘åªèƒ½è¯´ï¼Œ<code>Windows API</code>ä¹‹äº‹ï¼Œæ²¡æœ‰ç»å¯¹é€»è¾‘ï¼Œåªæœ‰è¯¶ã€å•Šã€è¿™ã€å˜¶ã€å˜›</p></blockquote><h2 id="ç›¸å¯¹ç½®é¡¶"><a href="#ç›¸å¯¹ç½®é¡¶" class="headerlink" title="ç›¸å¯¹ç½®é¡¶"></a>ç›¸å¯¹ç½®é¡¶</h2><p>å…¶å®è¯´äº†è¿™ä¹ˆå¤šï¼Œéƒ½æ˜¯å‰ç½®çŸ¥è¯†hhhï¼Œç°åœ¨æ‰æ˜¯æ­£ç‰‡å‘œ</p><p>è¯´å®Œäº†ç½®é¡¶ï¼ˆå…¨å±€ï¼‰ï¼Œæˆ‘ä»¬æ¥è¯´è¯´<strong>ç›¸å¯¹ç½®é¡¶</strong></p><p>æ‰€è°“<strong>ç›¸å¯¹ç½®é¡¶</strong>ï¼Œå°±æ˜¯ä»…å¯¹äºæŸä¸ªçª—å£ä¿æŒç½®é¡¶çŠ¶æ€ï¼Œè€Œèƒ½è¢«å…¶ä»–çª—å£æ­£å¸¸è¦†ç›–</p><p>ä¾‹å¦‚ï¼šçª—å£Aå§‹ç»ˆåœ¨çª—å£Bä¹‹ä¸Šï¼Œä½†æ˜¯çª—å£Aå’Œå…¶ä»–çª—å£çš„å±‚çº§å…³ç³»æ˜¯æ­£å¸¸çš„ï¼Œä¸å­˜åœ¨<code>TOPMOST</code>å…³ç³»</p><p>æœ‰ç‚¹åƒæ˜¯ï¼šçˆ¶çª—å£ä¸­çš„å¼¹çª—ï¼ˆå­çª—å£ï¼‰çš„é‚£ç§æ„Ÿè§‰ï¼Œæˆ–è€…æ˜¯å³é”®èœå•</p><p><em>&#x2F;&#x2F; ä»€ä¹ˆï¼Œä½ é—®æˆ‘ç›¸å¯¹ç½®é¡¶æœ‰ä»€ä¹ˆç”¨ï¼Œè¯•æƒ³ä¸€ä¸‹ä½ å¯¹ç€ä¸€å¼ å‚è€ƒå›¾åœ¨<code>blender</code>é‡Œå»ºæ¨¡ï¼Œæˆ–æ˜¯å‚è€ƒç”¨æˆ·éœ€æ±‚åœ¨<code>coding</code></em></p><p><img src="/img/image-20240616171554626.png" alt="å¯¹è¯æ¡†ç›¸å¯¹ç½®é¡¶"></p><p>å¯¹äºä»å±åŒä¸€ä¸ªè¿›ç¨‹çš„å­çª—å£æ¥è¯´ï¼Œè¿™å›ºç„¶å¾ˆå®¹æ˜“å®ç°</p><p>é‚£ä¹ˆå¯¹äºè·¨è¿›ç¨‹çš„çª—å£ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æœ‰äººè¦è¯´äº†ï¼šç”¨<code>SetParent</code>å‡½æ•°å°†ä¸¤ä¸ªçª—å£å»ºç«‹çˆ¶å­å…³ç³»ä¸å°±å¥½äº†</p><h3 id="SetParent"><a href="#SetParent" class="headerlink" title="SetParent"></a>SetParent</h3><p>æƒ³æ³•æ˜¯å¥½çš„ï¼Œä½†æ˜¯<code>SetParent</code>è·¨è¿›ç¨‹è®¾ç½®çˆ¶å­å…³ç³»è²Œä¼¼å¹¶ä¸ç®€å•ï¼Œç›´æ¥è°ƒç”¨æ²¡æœ‰ä»»ä½•æ•ˆæœ</p><p>å³ä¾¿æˆåŠŸäº†ä¹‹åï¼Œä¹Ÿä¼šå› ä¸ºæ¶ˆæ¯å¾ªç¯åŒæ­¥ç­‰é—®é¢˜å‡ºç°å„ç§bug</p><p>å‚è§ï¼š</p><p><a href="https://blog.csdn.net/qq_59075481/article/details/133581281">SetParent å‡½æ•°ä¿®æ”¹çˆ¶çª—å£çš„è¯¯åŒº-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/weixin_39636857/article/details/117270299">cè¯­è¨€è·¨è¿›ç¨‹å›è°ƒå‡½æ•°,ä½¿ç”¨ SetParent è·¨è¿›ç¨‹è®¾ç½®çˆ¶å­çª—å£æ—¶çš„ä¸€äº›é—®é¢˜ï¼ˆå°å¿ƒå¡æ­»ï¼‰â€¦-CSDNåšå®¢</a></p><p>æ‰€ä»¥æœ€ç»ˆå¹¶æ²¡æœ‰é‡‡ç”¨è¿™ç§æ–¹æ¡ˆ</p><h3 id="Dynamic-Z-order"><a href="#Dynamic-Z-order" class="headerlink" title="Dynamic Z-order"></a>Dynamic Z-order</h3><p>é‚£ä¹ˆæˆ‘ä»¬åªèƒ½åœ¨ä¿æŒçª—å£ç‹¬ç«‹æ€§çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°å»æ›´æ–°Zåºäº†</p><p>è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p><p><em>å‡å®šæƒ³è¦è®©è‡ªèº«çª—å£ï¼ˆmeï¼‰ç›¸å¯¹ç½®é¡¶äºç›®æ ‡çª—å£ï¼ˆtargetï¼‰ï¼Œè®¾å…¶ä»–çª—å£ä¸º others</em></p><h4 id="æ–¹æ¡ˆä¸€ï¼š"><a href="#æ–¹æ¡ˆä¸€ï¼š" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼š"></a>æ–¹æ¡ˆä¸€ï¼š</h4><ul><li>è‹¥å‰å°çª—å£æ˜¯<code>target</code>ï¼Œåˆ™è®©<code>me</code><strong>ä¸´æ—¶ç½®é¡¶</strong></li><li>è‹¥å‰å°çª—å£æ˜¯<code>others</code>æˆ–<code>me</code>ï¼Œæ— éœ€ä»»ä½•æ“ä½œï¼Œå› ä¸º<strong>ä¸´æ—¶ç½®é¡¶</strong>åä¼šæ¢å¤ä¸ºæ™®é€šå±‚çº§</li></ul><p>è¿™ç§æ–¹æ¡ˆå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚<code>target</code>æœ€å¤§åŒ–å’Œå–æ¶ˆæœ€å¤§åŒ–æ—¶ï¼Œä»¥åŠå…¶ä»–ä¸€äº›æ“ä½œæ—¶ï¼Œå¯èƒ½å¯¼è‡´Zåºå˜åŒ–ï¼Œå¯¼è‡´<code>me</code>è¢«<code>target</code>è¦†ç›–</p><p>pass</p><h4 id="æ–¹æ¡ˆäºŒï¼š"><a href="#æ–¹æ¡ˆäºŒï¼š" class="headerlink" title="æ–¹æ¡ˆäºŒï¼š"></a>æ–¹æ¡ˆäºŒï¼š</h4><ul><li>è‹¥å‰å°çª—å£æ˜¯<code>target</code>ï¼Œåˆ™è®©<code>me</code><strong>å…¨å±€ç½®é¡¶</strong>ï¼ˆ<code>TOPMOST</code>ï¼‰</li><li>è‹¥å‰å°çª—å£æ˜¯<code>others</code>ï¼Œåˆ™è®©<code>me</code><strong>å–æ¶ˆç½®é¡¶</strong>ï¼ˆ<code>NOTOPMOST</code>ï¼‰ï¼Œä½¿å…¶å¯ä»¥æ­£å¸¸è¢«<code>others</code>è¦†ç›–ï¼›<br>æ³¨æ„ï¼Œç”±äºæ£€æµ‹æ—¶æœºçš„é—®é¢˜ï¼Œå–æ¶ˆç½®é¡¶ä¹‹å<code>me</code>è¢«è®¾ç½®ä¸º<code>TOP</code>ï¼Œä»ç„¶åœ¨<code>others</code>ä¹‹ä¸Šï¼›<br>æ­¤æ—¶éœ€è¦è®¾ç½®<code>others</code>çš„å±‚çº§ä¸º<code>TOP</code>ï¼ˆ<code>others</code>æ˜¯æ´»åŠ¨çª—å£ï¼Œæ‰€ä»¥å¯ä»¥æˆåŠŸï¼‰</li><li>è‹¥å‰å°çª—å£æ˜¯<code>me</code>ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ</li></ul><p>å½“ç„¶ï¼Œæ›´è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦ç›‘è§†<code>target</code>çš„æœ€å°åŒ–ã€æ˜¾ç¤ºã€ç§»åŠ¨ã€é”€æ¯ç­‰äº‹ä»¶æ¥æ‰§è¡Œ<code>me</code>çš„ç›¸åº”æ“ä½œï¼Œä½¿å…¶æ›´åƒä¸€ä¸ªå­çª—å£</p><h3 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h3><p>å¥½çš„ï¼ŒZåºè°ƒæ•´çš„ç®—æ³•è§£å†³äº†ï¼Œé‚£ä¹ˆå¦‚ä½•æ£€æµ‹å„ç§çª—å£çš„çŠ¶æ€å‘¢ï¼Ÿä¾‹å¦‚ï¼Œå‰å°çª—å£çš„å˜åŒ–</p><p><code>Windows</code>æ˜¯åŸºäºæ¶ˆæ¯çš„æ“ä½œç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>Hook</code>æŠ€æœ¯ç›‘å¬æˆ–æ‹¦æˆªæ¶ˆæ¯ï¼ˆäº‹ä»¶ï¼‰</p><p>å¸¸ç”¨çš„æœ‰ï¼š<code>SetWindowsHookEx</code> å’Œ <code>SetWinEventHook</code> </p><p>åŒºåˆ«å¤§è‡´åœ¨äºï¼š</p><ul><li><code>SetWindowsHookEx</code>æ›´ä¸ºåº•å±‚ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼ˆä¾‹å¦‚æ‹¦æˆªæˆ–ä¿®æ”¹æ¶ˆæ¯ï¼‰ï¼Œä½†å¯èƒ½éœ€è¦dll<br>å‚è§æˆ‘çš„å¦ä¸€ç¯‡blogï¼š<a href="https://blog.cls.ink/2022/04/07/Windows-Hook-%E6%8A%80%E6%9C%AF%E6%B5%85%E6%9E%90/">Windows Hook æŠ€æœ¯æµ…æ - MrBeanC-Blog (cls.ink)</a></li><li><code>SetWinEventHook</code>æ›´é«˜çº§ï¼Œç›‘å¬çš„æ˜¯äº‹ä»¶ï¼ˆä¸æ˜¯æ¶ˆæ¯ï¼‰ï¼Œè€Œä¸”ä¸èƒ½ä¿®æ”¹ï¼Œä½†æ— éœ€dll</li></ul><p>æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬é‡‡ç”¨<code>SetWinEventHook</code></p><h4 id="SetWinEventHook"><a href="#SetWinEventHook" class="headerlink" title="SetWinEventHook"></a>SetWinEventHook</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">HWINEVENTHOOK <span class="hljs-title">SetWinEventHook</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">  [in] DWORD        eventMin,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in] DWORD        eventMax,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in] HMODULE      hmodWinEventProc,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in] WINEVENTPROC pfnWinEventProc,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in] DWORD        idProcess,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in] DWORD        idThread,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in] DWORD        dwFlags</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> CALLBACK <span class="hljs-title">WinEventProc</span><span class="hljs-params">(HWINEVENTHOOK hWinEventHook, DWORD event, HWND hwnd, LONG idObject, LONG idChild, DWORD dwEventThread, DWORD dwmsEventTime)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (idObject != OBJID_WINDOW) <span class="hljs-comment">//ç¡®ä¿å¯¹è±¡æ˜¯çª—å£</span><br>        <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-keyword">if</span> (event == EVENT_SYSTEM_FOREGROUND &amp;&amp; hwnd == xxx)<br>        ...<br>&#125;<br><br><span class="hljs-comment">// WINEVENT_OUTOFCONTEXTï¼šè¡¨ç¤ºå›è°ƒå‡½æ•°æ˜¯åœ¨è°ƒç”¨çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨çš„ï¼Œè€Œä¸æ˜¯åœ¨ç”Ÿæˆäº‹ä»¶çš„çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™ç§æ–¹å¼ä¸éœ€è¦DLLæ¨¡å—å¥æŸ„ï¼ˆhmodWinEventProc è®¾ç½®ä¸º NULLï¼‰</span><br>hHookFocus = <span class="hljs-built_in">SetWinEventHook</span>(EVENT_SYSTEM_FOREGROUND, EVENT_SYSTEM_FOREGROUND, <span class="hljs-literal">NULL</span>, WinEventProc, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, WINEVENT_OUTOFCONTEXT);<br><span class="hljs-comment">// STARTå°±æ˜¯æœ€å°åŒ–ï¼ŒENDå°±æ˜¯æ¢å¤</span><br><span class="hljs-comment">//hHookHideShow = SetWinEventHook(EVENT_SYSTEM_MINIMIZESTART, EVENT_SYSTEM_MINIMIZEEND, NULL, WinEventProc, 0, 0, WINEVENT_OUTOFCONTEXT);</span><br><span class="hljs-comment">//hHookDestory = SetWinEventHook(EVENT_OBJECT_DESTROY, EVENT_OBJECT_DESTROY, NULL, WinEventProc, 0, 0, WINEVENT_OUTOFCONTEXT);</span><br><span class="hljs-comment">//hHookLocation = SetWinEventHook(EVENT_OBJECT_LOCATIONCHANGE , EVENT_OBJECT_LOCATIONCHANGE , NULL, WinEventProc, 0, 0, WINEVENT_OUTOFCONTEXT);</span><br></code></pre></td></tr></table></figure><p>ç”¨æ³•éå¸¸ç®€å•ï¼Œä¸€è¡ŒSet + ä¸€ä¸ªå›è°ƒå‡½æ•°å³å¯</p><p>åŒæ—¶å¤šä¸ª<code>EventHook</code>å¯ä»¥æŒ‡å‘åŒä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆå†…éƒ¨åˆ¤æ–­eventå³å¯ï¼‰</p><p>å…·ä½“äº‹ä»¶æšä¸¾å¯ä»¥æŸ¥çœ‹<a href="https://learn.microsoft.com/zh-cn/windows/win32/winauto/event-constants">äº‹ä»¶å¸¸é‡ (Winuser.h) - Win32 apps | Microsoft Learn</a></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">UnhookWinEvent</span>(hHookFocus); <span class="hljs-comment">//ç”¨å®Œè®°å¾—å¸è½½é’©å­</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åªéœ€è¦å…³æ³¨ä»¥ä¸‹äº‹ä»¶å¹¶åšå‡ºç›¸åº”æ“ä½œå³å¯ï¼š</p><ul><li><code>EVENT_SYSTEM_FOREGROUND</code>ï¼šå‰å°çª—å£æ”¹å˜</li><li><code>EVENT_SYSTEM_MINIMIZESTART</code> &amp; <code>EVENT_SYSTEM_MINIMIZEEND</code>ï¼šæœ€å°åŒ–å’Œæ¢å¤</li><li><code>EVENT_OBJECT_DESTROY</code>ï¼šçª—å£å…³é—­ï¼ˆæ­¤æ—¶åº”å–æ¶ˆç›‘å¬ï¼‰</li><li><code>EVENT_OBJECT_LOCATIONCHANGE</code>ï¼šçª—å£ç§»åŠ¨</li></ul><p>å¯¹äºçª—å£ç§»åŠ¨çš„ç›‘å¬è¦æ³¨æ„ä¸€ç‚¹ï¼Œçª—å£æœ€å°åŒ–ä¹Ÿä¼šè§¦å‘ç§»åŠ¨ï¼Œåæ ‡ä¸ºï¼š<code>(-32000 -32000)</code>ï¼Œéœ€è¦é€šè¿‡<code>IsIconic</code>è¿‡æ»¤</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++">&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event == EVENT_OBJECT_LOCATIONCHANGE &amp;&amp; hwnd == targetWindow) &#123; <span class="hljs-comment">// çª—å£ä½ç½®æ”¹å˜</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">IsIconic</span>(hwnd)) &#123; <span class="hljs-comment">// æœ€å°åŒ–æ—¶ ä½ç½®ä¸º(-32000 -32000)ï¼Œéœ€è¦è¿‡æ»¤</span><br>        RECT currentRect;<br>        <span class="hljs-built_in">GetWindowRect</span>(hwnd, &amp;currentRect);<br>        <span class="hljs-keyword">auto</span> pos = <span class="hljs-built_in">QPoint</span>(currentRect.left, currentRect.top);<br>        ...<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¥½çš„ï¼Œå…¶ä»–çš„éƒ¨åˆ†æˆ‘ç›¸ä¿¡å¤§å®¶éƒ½ddddäº†ï¼Œãã£ã¨å¤§ä¸ˆå¤«ã­</p><p>æºç å®ç°å¯ä»¥å‚è€ƒï¼š<a href="https://github.com/MrBeanCpp/ImageViewer2.0">MrBeanCpp&#x2F;ImageViewer2.0: æ—¨åœ¨ä»¥æœ€ç®€æ´ã€è½»é‡çš„æ–¹å¼å‘ˆç°å›¾åƒ (github.com)</a></p><h3 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h3><h2 id="ç‰¹åˆ«é¸£è°¢"><a href="#ç‰¹åˆ«é¸£è°¢" class="headerlink" title="ç‰¹åˆ«é¸£è°¢"></a>ç‰¹åˆ«é¸£è°¢</h2><p>åˆ›æ„æ¥æºï¼š<a href="https://www.pureref.com/index.php">PureRef</a></p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-attachthreadinput">AttachThreadInput å‡½æ•° (winuser.h) - Win32 apps | Microsoft Learn</a></p><p><a href="https://www.cnblogs.com/ziwuge/archive/2012/01/06/2315342.html">SetForegroundWindowçš„æ­£ç¡®ç”¨æ³• - å­å - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-setparent">SetParent å‡½æ•° (winuser.h) - Win32 apps | Microsoft Learn</a></p><p><a href="https://blog.csdn.net/weixin_39636857/article/details/117270299">cè¯­è¨€è·¨è¿›ç¨‹å›è°ƒå‡½æ•°,ä½¿ç”¨ SetParent è·¨è¿›ç¨‹è®¾ç½®çˆ¶å­çª—å£æ—¶çš„ä¸€äº›é—®é¢˜ï¼ˆå°å¿ƒå¡æ­»ï¼‰â€¦-CSDNåšå®¢</a></p><p><a href="https://walterlv.blog.csdn.net/article/details/102775111">ä½¿ç”¨ SetParent è·¨è¿›ç¨‹è®¾ç½®çˆ¶å­çª—å£æ—¶çš„ä¸€äº›é—®é¢˜ï¼ˆå°å¿ƒå¡æ­»ï¼‰_vbä¸­setparentä½œç”¨æ­»æœº-CSDNåšå®¢</a></p><p><a href="http://www.cppblog.com/zaccheo/archive/2012/08/24/188156.aspx">SetWindowPos ä½¿ç”¨æ³¨æ„äº‹é¡¹ - å°æ­¥æ…¢è·‘ - C++åšå®¢ (cppblog.com)</a></p><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-setwindowpos">SetWindowPos å‡½æ•° (winuser.h) - Win32 apps | Microsoft Learn</a></p><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-setforegroundwindow">SetForegroundWindow å‡½æ•° (winuser.h) - Win32 apps | Microsoft Learn</a></p><p><a href="https://stackoverflow.com/questions/22025592/setwindowshookex-vs-setwinhookeventex">c# - SetWindowsHookEx ä¸ SetWinHookEventEx - å †æ ˆæº¢å‡º (stackoverflow.com)</a></p><p><a href="https://blog.csdn.net/stone5555/article/details/81953062">SetWinEventHookå’ŒSetWindowsHookExçš„å¼‚åŒ_delphi setwineventhook-CSDNåšå®¢</a></p>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>Windows</tag>
      
      <tag>Hook</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows ç³»ç»Ÿçº§ä¸ªäººæ–‡ä»¶å¤¹ vs OneDriveç®€æ</title>
    <link href="/2024/04/02/Windows-%E7%B3%BB%E7%BB%9F%E7%BA%A7%E4%B8%AA%E4%BA%BA%E6%96%87%E4%BB%B6%E5%A4%B9%E7%AE%80%E6%9E%90/"/>
    <url>/2024/04/02/Windows-%E7%B3%BB%E7%BB%9F%E7%BA%A7%E4%B8%AA%E4%BA%BA%E6%96%87%E4%BB%B6%E5%A4%B9%E7%AE%80%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Windows</code>çš„ç³»ç»Ÿçº§ä¸ªäººæ–‡ä»¶å¤¹åŒ…æ‹¬ï¼š<code>Documents</code>, <code>Music</code>, <code>Desktop</code>, <code>Pictures</code> ç­‰ç­‰</p><p>è¿™äº›æ–‡ä»¶å¤¹é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¯åœ¨<code>C:\Users\&#123;name&#125;\</code>ä¸‹</p><p>é‚£ä¹ˆç”±äºä¸€äº›å¦‡å­ºçš†çŸ¥çš„åŸå› ï¼ŒCç›˜ç©ºé—´æ˜¯æ°¸è¿œæ‰è¥Ÿè§è‚˜çš„</p><p>æœ‰æ²¡æœ‰åŠæ³•å°†è¿™äº›æ–‡ä»¶å¤¹ç§»åŠ¨åˆ°å…¶ä»–é©±åŠ¨å™¨ä¸Šå‘¢ï¼Ÿ</p><h2 id="Move"><a href="#Move" class="headerlink" title="Move"></a>Move</h2><p>ä¼Ÿå¤§çš„å·¨ç¡¬å·²ç»å¸®æˆ‘ä»¬æƒ³åˆ°äº†</p><p>æ‰“å¼€ä¸ªäººæ–‡ä»¶å¤¹ï¼ˆå¦‚ï¼šéŸ³ä¹ï¼‰çš„å±æ€§-ä½ç½®æ ‡ç­¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°<strong>ç§»åŠ¨</strong>æŒ‰é’®</p><blockquote><p> Tip: ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰å‘ç°ï¼Œè¿™ä¸ªâ€œä½ç½®â€æ ‡ç­¾åªæœ‰è¿™äº›ä¸ªäººæ–‡ä»¶å¤¹æ‰æœ‰ï¼Œæ™®é€šæ–‡ä»¶å¤¹æ˜¯æ²¡æœ‰çš„</p></blockquote><p><img src="/img/image-20240402234703570.png" alt="å±æ€§"></p><p>ä¾‹å¦‚é€‰æ‹©æ–°ä½ç½®ä¸ºï¼š<strong>E:\Music</strong>ï¼Œç§»åŠ¨ï¼Œå¤§åŠŸå‘Šæˆ</p><p>æœ‰çš„äººå¯èƒ½ä¼šè¯´äº†ï¼Œç›´æ¥<code>Ctrl+X</code>å‰ªåˆ‡ä¸è¡Œå—ï¼Ÿ</p><p>å¬èµ·æ¥æœ‰ç‚¹ç²—æš´ï¼Œå…¶å®ç»è¿‡æˆ‘çš„å®éªŒï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ“ä½œç³»ç»Ÿä»ç„¶èƒ½å¤Ÿè·Ÿè¸ªè¿™äº›æ–‡ä»¶å¤¹çš„ä½ç½®</p><blockquote><p> ï¼šç­‰ç­‰ï¼Œä»€ä¹ˆå«è·Ÿè¸ªï¼Œä¸ºä»€ä¹ˆè¦è·Ÿè¸ª</p></blockquote><h2 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h2><p>è¿™æ¬¡æˆ‘ä»¬æ‹¿<strong>æ–‡æ¡£</strong>ï¼ˆ<code>Documents</code>ï¼‰æ¥ä¸¾ä¾‹å§</p><p><code>QQ</code>éƒ½çŸ¥é“å§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>QQ</code>çš„æ¶ˆæ¯è®°å½•é»˜è®¤æ˜¯ä¿å­˜åœ¨â€œ<strong>æˆ‘çš„æ–‡æ¡£</strong>â€ä¸‹çš„</p><p><img src="/img/image-20240403000034283.png" alt="QQä¸ªäººæ–‡ä»¶å¤¹"></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œâ€œ<strong>æˆ‘çš„æ–‡æ¡£</strong>â€æ˜¯å¯ä»¥è¢«ç§»åŠ¨çš„ï¼ˆå¦‚å‰æ–‡æ‰€è¿°ï¼‰ï¼Œé‚£ä¹ˆ<code>QQ</code>å¦‚ä½•å‡†ç¡®æŸ¥æ‰¾â€œ<strong>æˆ‘çš„æ–‡æ¡£</strong>â€</p><p>æ€»ä¸èƒ½æ˜¯<code>User</code>ç›®å½•ï¼ˆ<code>C:\Users\&#123;name&#125;\</code>ï¼‰ + <code>Documents</code>å§</p><p><em>&#x2F;&#x2F; é‚£ä¹Ÿå¤ªæäº†ï¼Œä¸ä¼šæœ‰äººè¿™ä¹ˆå†™å§ï¼Œä¸ä¼šå§ä¸ä¼šå§</em></p><p>ç”¨åŠæœˆæ¿æƒ³éƒ½çŸ¥é“ï¼Œé‚£è‚¯å®šæ˜¯æœ‰ç³»ç»Ÿ<code>API</code>çš„ya</p><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/shlobj_core/nf-shlobj_core-shgetknownfolderpath"><code>SHGetKnownFolderPath</code></a>(æ›´ç°ä»£) or <a href="https://learn.microsoft.com/zh-cn/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha"><code>SHGetFolderPath</code></a>ï¼ˆå‰è€…çš„åŒ…è£…å™¨ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;shlobj.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;knownfolders.h&gt;</span> </span><br><br>PWSTR path = <span class="hljs-literal">nullptr</span>;<br>HRESULT hr = <span class="hljs-built_in">SHGetKnownFolderPath</span>(FOLDERID_Documents, <span class="hljs-number">0</span>, <span class="hljs-literal">nullptr</span>, &amp;path);<br><span class="hljs-keyword">if</span> (hr == S_OK) &#123;<br>    std::wcout &lt;&lt; path &lt;&lt; std::endl;<br>&#125; <span class="hljs-comment">// è‹¥æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼ˆè¢«åˆ é™¤ï¼‰ï¼Œåˆ™Fail</span><br><br><span class="hljs-built_in">CoTaskMemFree</span>(path);<span class="hljs-comment">// é‡Šæ”¾å†…å­˜, æ— è®ºæ˜¯å¦æˆåŠŸ</span><br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;shlobj.h&gt;</span></span><br><span class="hljs-comment">// #define CSIDL_MYDOCUMENTS  CSIDL_PERSONAL //  Personal was just a silly name for My Documents</span><br><br>TCHAR szPath[MAX_PATH]; <span class="hljs-comment">// æ–‡æ¡£é‡Œè¯´ç”¨ MAX_PATH (260)</span><br><span class="hljs-built_in">SHGetFolderPath</span>(<span class="hljs-literal">nullptr</span>, CSIDL_PERSONAL, <span class="hljs-literal">nullptr</span>, SHGFP_TYPE_CURRENT, szPath);<br><span class="hljs-comment">// szPath: &quot;E:\Documents&quot;</span><br></code></pre></td></tr></table></figure><p>åœ¨<code>Qt</code>ä¸­ï¼Œå¯ä»¥ç”¨<code>QStandardPaths</code>è·å–ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">QStandardPaths::<span class="hljs-built_in">writableLocation</span>(QStandardPaths::DocumentsLocation);<br></code></pre></td></tr></table></figure><p>è¯è¯´è¿™äº›<code>API</code>æ˜¯å¦‚ä½•çŸ¥é“â€œ<strong>æˆ‘çš„æ–‡æ¡£</strong>â€çš„å½“å‰ä½ç½®çš„ï¼Ÿ</p><p>å½“ç„¶æ˜¯è®°åœ¨æ³¨å†Œè¡¨å•Šï¼Œè§<a href="https://support.microsoft.com/zh-cn/topic/-%E6%88%91%E7%9A%84%E6%96%87%E6%A1%A3-%E6%96%87%E4%BB%B6%E5%A4%B9%E7%9A%84%E9%85%8D%E7%BD%AE-dfd9a90d-8f80-18d6-e7cc-f1566fc3b10b">å¾®è½¯æ–‡æ¡£</a></p><blockquote><p>â€œæˆ‘çš„æ–‡æ¡£â€æ–‡ä»¶å¤¹çš„è·¯å¾„å­˜å‚¨åœ¨ä»¥ä¸‹æ³¨å†Œè¡¨é¡¹ä¸­ï¼Œå…¶ä¸­çš„ &lt;å­˜å‚¨ä½ç½®çš„å®Œæ•´è·¯å¾„&gt; æ˜¯å­˜å‚¨ä½ç½®çš„è·¯å¾„ï¼š</p><p>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders</p><p>æ•°å€¼åç§°ï¼šPersonal<br>æ•°å€¼ç±»å‹ï¼šREG_SZ<br>æ•°å€¼æ•°æ®ï¼šå­˜å‚¨ä½ç½®çš„å®Œæ•´è·¯å¾„</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>Windows</code>ä¼šé€šè¿‡æ³¨å†Œè¡¨æ¥è·Ÿè¸ªä¸ªäººæ–‡ä»¶å¤¹çš„å½“å‰ä½ç½®</p><p>åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹æ³¨å†Œè¡¨ æ¥ åˆ¤æ–­ä¸ªäººæ–‡ä»¶å¤¹æ˜¯å¦ç§»åŠ¨æˆåŠŸ</p><p>å¦‚æœç§»åŠ¨åæ³¨å†Œè¡¨æ²¡æœ‰æ›´æ–° æˆ–è€… â€œä½ç½®â€æ ‡ç­¾æ¶ˆå¤±ï¼Œè¯´æ˜å¯„äº†</p><h3 id="å‘ï¼šç¼–ç "><a href="#å‘ï¼šç¼–ç " class="headerlink" title="å‘ï¼šç¼–ç "></a>å‘ï¼šç¼–ç </h3><p>è¿™é‡Œå…¶å®æœ‰ä¸€ä¸ªéå¸¸å¤§çš„å‘ï¼Œå’Œ<code>Windows API</code>äº¤äº’ç»å¸¸ä¼šæœ‰è¿™ç§é—®é¢˜</p><p>å°±æ˜¯å¦‚ä½•è¾“å‡º<code>TCHAR</code>æ•°ç»„ï¼Œå’Œ<code>PWSTR</code>æŒ‡é’ˆ</p><p>å¦‚æœç›´æ¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::cout &lt;&lt; szPath &lt;&lt; std::end; <span class="hljs-comment">// TCHAR // SHGetFolderPath</span><br>std::wcout &lt;&lt; path &lt;&lt; std::endl; <span class="hljs-comment">// PWSTR // SHGetKnownFolderPath</span><br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆä¼°è®¡ä¼šæ­»å¾—å¾ˆæƒ¨</p><p>çœ‹èµ·æ¥ç”¨<code>wcout</code>è¾“å‡º<code>PWSTR</code>éå¸¸æ­£ç¡®ï¼ˆWä»£è¡¨å®½å­—ç¬¦ï¼‰</p><p>äº‹å®ä¹Ÿç¡®å®å¦‚æ­¤ï¼Œä½†æ˜¯ç»“æœå´æ˜¯ï¼š</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">E:</span>\OneDrive\é™„ä»¶\éŸ³ä¹<br><span class="hljs-symbol">E:</span>\OneDrive\<br></code></pre></td></tr></table></figure><p>ï¼Ÿä¸ºä»€ä¹ˆ<code>PWSTR</code>çš„ç»“æœä¸æ­£ç¡®ï¼Œæ˜¯<code>SHGetKnownFolderPath</code>å‡ºbugäº†å—ï¼Œæ˜¯OneDriveé‡å®šå‘äº†å—</p><p>åœ¨é˜…è¯»äº†å¤§é‡æ–‡æ¡£å’ŒQtæºç åï¼ˆQt APIæ­£ç¡®è¾“å‡ºï¼Œä¸”å†…éƒ¨ä½¿ç”¨äº†<code>SHGetKnownFolderPath</code>ï¼‰</p><p>æˆ‘å‘ç°ï¼šå±…ç„¶æ˜¯æ‰“å°è¿‡ç¨‹å‡ºç°äº†é—®é¢˜ï¼ä¸­æ–‡æ²¡æœ‰æ­£å¸¸æ˜¾ç¤ºï¼ˆé€šè¿‡è°ƒè¯•æ¨¡å¼æ‰“æ–­ç‚¹å¯ä»¥çœ‹åˆ°å†…å­˜é‡Œæ˜¾ç¤ºæ˜¯æ­£å¸¸çš„ï¼‰</p><p>aaaaaï¼Œè¿™è°æƒ³å¾—åˆ°å•Šï¼Œç¼–ç ä¸æ­£ç¡®ä¸åº”è¯¥æ˜¯ä¹±ç å—ï¼Œæ€ä¹ˆä¼šç›´æ¥æ²¡äº†ï¼</p><p>å…¶å®è¯´å®è¯ï¼Œå¥½å¥½è¯»<a href="https://learn.microsoft.com/en-us/windows/win32/api/shlobj_core/nf-shlobj_core-shgetknownfolderpath#parameters">SHGetKnownFolderPathæ–‡æ¡£</a>çš„ç¨‹åºå‘˜åº”è¯¥ä¸€çœ¼å°±åˆè§ç«¯å€ªäº†</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">The returned <span class="hljs-type">path</span> does <span class="hljs-keyword">not</span> <span class="hljs-keyword">include</span> a <span class="hljs-keyword">trailing</span> backslash. <span class="hljs-keyword">For</span> example, &quot;C:\Users&quot; <span class="hljs-keyword">is</span> returned rather than &quot;C:\Users\&quot;.<br></code></pre></td></tr></table></figure><p>äººå®¶éƒ½è¯´äº†ï¼Œè¿”å›çš„è·¯å¾„ä¸ä¼šä»¥<code>&#39;\&#39;</code>ç»“å°¾çš„</p><p>ä½ çœ‹çœ‹<code>E:\OneDrive\</code>æ­£å¸¸å—ï¼Ÿï¼ç›¯â€”â€”â€”â€”</p><p><strong>ä¸ºäº†æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡ï¼Œéœ€è¦åŠ å…¥è¿™ä¸€è¡Œï¼š</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">setlocale</span>(LC_ALL, <span class="hljs-string">&quot;&quot;</span>); <span class="hljs-comment">// &quot;&quot; == ä½¿ç”¨å®¢æˆ·ç¯å¢ƒä¸­ç¼ºçœçš„locale (&quot;chs&quot;)</span><br><span class="hljs-comment">// setlocale(LC_ALL, &quot;chs&quot;);</span><br></code></pre></td></tr></table></figure><p>ç„¶åå°±æ­£å¸¸äº†</p><p>å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>locale</code>æ˜¯â€Câ€ï¼ˆå¬è¯´æ˜¯ä¸ºäº†å¯ç§»æ¤æ€§ï¼Œæ‰€ä»¥ä¸æ”¯æŒä¸­æ–‡ï¼‰</p><p>å¯é€šè¿‡ä»¥ä¸‹ä»£ç è·å–é»˜è®¤<code>locale</code>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">const</span> <span class="hljs-type">char</span>* currentLocale = <span class="hljs-built_in">setlocale</span>(LC_ALL, <span class="hljs-literal">nullptr</span>);<br>std::cout &lt;&lt; <span class="hljs-string">&quot;Current locale: &quot;</span> &lt;&lt; currentLocale &lt;&lt; std::endl; <span class="hljs-comment">// &quot;C&quot;</span><br></code></pre></td></tr></table></figure><p>ä½ ä»¥ä¸ºè¿™å°±å®Œäº†ï¼Ÿå¤ªå¹´è½»äº†å…„å¼Ÿ</p><h4 id="TCHARæ€ä¹ˆåŠå‘¢"><a href="#TCHARæ€ä¹ˆåŠå‘¢" class="headerlink" title="TCHARæ€ä¹ˆåŠå‘¢"></a><code>TCHAR</code>æ€ä¹ˆåŠå‘¢</h4><p>éš¾é“ä½ æƒ³è¯´ä½ çœ‹äº†çœ¼<code>TCAHR</code>çš„å®šä¹‰ï¼š<code>typedef char TCHAR</code>ï¼Œç„¶åå‘ç°å¾ˆåˆç†ï¼Œå¾ˆæ­£å¸¸</p><p>éšä¾¿ç”¨ä¸ª<code>cout</code>ã€ <code>printf</code>éƒ½èƒ½æ­£å¸¸è¾“å‡ºä¸­æ–‡</p><p>é‚£ä½ æœ‰æ²¡æœ‰æƒ³è¿‡<code>TCHAR</code>çš„<strong>T</strong>æ˜¯ä»€ä¹ˆæ„æ€ï¼Œ<code>_T</code>æœ‰ä»€ä¹ˆç”¨ï¼Œ<code>L</code>æœ‰ä»€ä¹ˆç”¨</p><p><code>T</code>å¯ä»¥ç†è§£ä¸º<code>TEXT</code>ï¼Œæ„ä¸ºæ–‡æœ¬ï¼Œä¹Ÿå°±æ˜¯ä¼šæ ¹æ®<code>UNICODE</code>å®å®šä¹‰è‡ªåŠ¨å¤„ç†å®½çª„å­—ç¬¦</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span>  UNICODE </span><br><span class="hljs-keyword">typedef</span> WCHAR TCHAR;<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">char</span> TCHAR;<br></code></pre></td></tr></table></figure><p><code>_T</code> ä¹Ÿæ˜¯å¦‚æ­¤</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _T(x)       __T(x)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _TEXT(x)    __T(x)</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __T(x)      L ## x <span class="hljs-comment">// if UNICODE</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __T(x)      x</span><br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆ<code>L</code>å‰ç¼€å‘¢ï¼Œå°±æ˜¯æŠŠå­—é¢é‡æ ‡è®°ä¸ºå®½å­—ç¬¦</p><p>ã ã‹ã‚‰ï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶è€ƒè™‘å®½çª„å­—ç¬¦ï¼ˆ<code>UNICODE</code>å®æ˜¯å¦å®šä¹‰ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;tchar.h&quot;</span></span><br><br>_tprintf(_T(<span class="hljs-string">&quot;%s\n&quot;</span>), szPath); <span class="hljs-comment">// TCHAR</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥ç”¨<code>_tprintf</code>å®æ¥è‡ªåŠ¨é€‰æ‹©<code>printf</code>å’Œ<code>wprintf</code>&#x2F;&#x2F; å®çœŸç¥å¥‡</p><p><em>&#x2F;&#x2F; é¡ºä¾¿è¯´ä¸€ä¸‹ï¼ŒWindows APIä¹Ÿå¸¸ä¼šæä¾›ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä»¥Aç»“å°¾ï¼ˆANSIï¼Œå•å­—èŠ‚å­—ç¬¦ï¼‰å’Œä»¥Wç»“å°¾ï¼ˆå®½å­—ç¬¦ï¼‰ï¼ŒåŒæ—¶è¿˜ä¼šæä¾›ä¸€ä¸ªå®ï¼ˆä¸å¸¦åç¼€ï¼‰æ¥è‡ªåŠ¨é€‰æ‹©</em></p><p>å•Šï¼Œæˆ‘ä¸å¾—ä¸åæ§½ä¸€ä¸‹ï¼ŒåŸç”ŸC++çš„ç¼–ç å¤ªç¦»è°±äº†ï¼Œä¸ä¼šçœŸæœ‰äººç”¨å¾—æ¥å§</p><p><strong>çœ‹çœ‹è¿œæ–¹çš„<code>Qt</code>å§ï¼Œå®¶äººä»¬ï¼Œ<code>QString</code>ç›´æ¥å°±æ˜¯<code>Unicode</code>ç¼–ç ï¼Œèˆ’æœ</strong></p><p>ä½ ä»¥ä¸ºè¿™å°±å®Œäº†ï¼Ÿä»æ—§å¹´è½»äº†å…„å¼Ÿ</p><p>å¦‚æœä½ ç”¨çš„æ˜¯<code>Windows Clion + MSVC</code>ï¼Œæ­¤æ—¶ä½ åªè¦ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">cout &lt;&lt; <span class="hljs-string">&quot;æµ‹è¯•&quot;</span> &lt;&lt; endl;<br><span class="hljs-comment">// å¨´å¬­ç˜¯</span><br></code></pre></td></tr></table></figure><p>å°±ä¼šå¾—åˆ°è¿™ä¸€å¨ï¼Œè¿˜æœ‰ä¸€ä¸ªWaringï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">warning C4819: è¯¥æ–‡ä»¶åŒ…å«ä¸èƒ½åœ¨å½“å‰ä»£ç é¡µ(<span class="hljs-number">936</span>)ä¸­è¡¨ç¤ºçš„å­—ç¬¦ã€‚è¯·å°†è¯¥æ–‡ä»¶ä¿å­˜ä¸º Unicode æ ¼å¼ä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±<br></code></pre></td></tr></table></figure><p>ä¹ä¸€çœ‹ï¼Œæ–‡ä»¶ç¼–ç æ˜æ˜å°±æ˜¯<code>UTF-8</code>å‘€ï¼Œæ€ä¹ˆä¸æ˜¯<code>Unicode</code>äº†</p><p>ä¸ä¼šæœ‰äººä¸çŸ¥é“<code>UTF-8</code>åˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬å§ï¼š<code>UTF-8</code> &amp; <code>UTF-8 with BOM</code></p><blockquote><p>BOMï¼ˆbyte order markï¼‰ï¼šç”¨äºæ ‡è®°å­—èŠ‚åºï¼Œå¾®è½¯åœ¨ UTF-8 ä¸­ä½¿ç”¨ BOM æ˜¯å› ä¸ºè¿™æ ·å¯ä»¥æŠŠ UTF-8 å’Œ ASCII ç­‰ç¼–ç æ˜ç¡®åŒºåˆ†å¼€</p><p>ä¸¤ä¸ªç‰ˆæœ¬çš„åŒºåˆ«å°±æ˜¯ï¼šæ–‡ä»¶å¼€å¤´æœ‰æ²¡æœ‰ U+FEFF</p></blockquote><p><code>MSVC</code>ç¼–è¯‘å™¨é»˜è®¤ç¼–ç æ˜¯<code>UTF-8 with BOM</code>ï¼Œå¦‚æœæ²¡æœ‰<code>BOM</code>ï¼Œ<code>MSVC</code>ç¼–è¯‘å™¨å°±ä¸ä¼šè®¤ä¸ºè¿™æ˜¯<code>Unicode</code>ç¼–ç ï¼Œå¯¼è‡´ç¼–è¯‘åæ‰“å°ä¹±ç </p><p><strong>Solutionï¼š</strong></p><ul><li>åœ¨IDEçš„æ–‡ä»¶ç¼–ç è®¾ç½®ä¸­æ”¹ä¸º<code>UTF-8 with BOM</code></li><li>æˆ–åœ¨<code>cmake</code>ä¸­å¼ºåˆ¶é‡‡ç”¨<code>UTF</code>-8ç¼–è¯‘ï¼š<code>add_compile_options(/utf-8)</code></li></ul><h4 id="è¿˜æœ‰ä¸ªå‘ï¼š"><a href="#è¿˜æœ‰ä¸ªå‘ï¼š" class="headerlink" title="è¿˜æœ‰ä¸ªå‘ï¼š"></a>è¿˜æœ‰ä¸ªå‘ï¼š</h4><p><code>Clion</code>æ­£å¸¸è¿è¡Œæ²¡é—®é¢˜ï¼Œä½†æ˜¯è°ƒè¯•æ¨¡å¼ è¿˜æ˜¯ä¼šä¹±ç ï¼Œå¯„</p><h2 id="OneDrive"><a href="#OneDrive" class="headerlink" title="OneDrive"></a>OneDrive</h2><p>äº‹æƒ…åˆ°è¿™é‡Œå°±ç»“æŸäº†å—ï¼Œå…¶å®æ‰åˆšåˆšå¼€å§‹</p><p>æˆ‘å‘ç°ï¼Œå½“ä¸ªäººæ–‡ä»¶å¤¹é‡ä¸ŠOneDriveï¼Œé—®é¢˜å°±å¤§å‘äº†</p><p>OneDriveæœ‰ä¸€ä¸ªå¤‡ä»½ä¸ªäººæ–‡ä»¶å¤¹çš„åŠŸèƒ½</p><p><img src="/img/image-20240403003339684.png" alt="OneDriveå¤‡ä»½"></p><p>å¦‚æœæˆ‘ä»¬æ‰“å¼€æŸæ–‡ä»¶å¤¹çš„å¤‡ä»½æŒ‰é’®</p><p>é‚£ä¹ˆè¯¥æ–‡ä»¶å¤¹å°±ä¼šè¢«<strong>ç§»åŠ¨</strong>åˆ°OneDriveæ–‡ä»¶å¤¹ä¸­</p><p>è¿™ä¸ªç§»åŠ¨åŒæ ·ä¼šè¢«æ³¨å†Œè¡¨è·Ÿè¸ªï¼Œå’Œæ‰‹åŠ¨å‰ªåˆ‡è¿›æ¥æ²¡æœ‰ä»€ä¹ˆä¸¤æ ·</p><p><em>&#x2F;&#x2F; æœ‰æ—¶å€™ä½ å¯èƒ½ä¼šå‘ç°ï¼ŒOneDriveè‡ªåŠ¨å¤‡ä»½å¯¼è‡´æ–‡ä»¶å¤¹ç§»åŠ¨åï¼Œç¼ºå°‘äº†â€œä½ç½®â€æ ‡ç­¾é¡µï¼Œåˆ«æ…Œï¼Œé‡å¯ä¸€ä¸‹èµ„æºç®¡ç†å™¨å°±å¥½äº†</em></p><h3 id="å¼‚å˜"><a href="#å¼‚å˜" class="headerlink" title="å¼‚å˜"></a>å¼‚å˜</h3><p>ä¸è¿‡ï¼Œä¸€æ—¦ä¸ªäººæ–‡ä»¶å¤¹è¿›å…¥äº†OneDriveï¼Œæ€§è´¨å°±å‘ç”Ÿäº†æ”¹å˜</p><p>æ­¤æ—¶å¦‚æœæˆ‘ä»¬ç§»åŠ¨è¿™ä¸ª ä¸ªäººæ–‡ä»¶å¤¹ï¼ˆå¦‚ï¼šéŸ³ä¹ï¼‰ï¼ˆé€šè¿‡â€œä½ç½®â€æ ‡ç­¾ï¼‰ï¼Œå°±ä¼šæŠ¥é”™</p><p><img src="/img/image-20240403004331783.png" alt="æ— æ³•ç§»åŠ¨"></p><p>å¦‚æœæ­¤æ—¶å¼ºè¡Œç”¨<code>Ctrl+X</code>å‰ªåˆ‡è¯¥æ–‡ä»¶å¤¹ï¼Œæ˜¯å¯ä»¥æˆåŠŸçš„</p><p>ä½†æ˜¯ï¼Œè¯¥æ–‡ä»¶å¤¹ï¼ˆå¦‚ï¼šéŸ³ä¹ï¼‰å°±ä¼š<strong>é€€åŒ–</strong>ä¸ºä¸€ä¸ªæ™®é€šæ–‡ä»¶å¤¹ï¼Œä¸”åç§°ä»â€Musicâ€å˜ä¸ºäº†â€œéŸ³ä¹â€</p><p><em>&#x2F;&#x2F; åŸæœ¬çš„â€œéŸ³ä¹æ–‡ä»¶å¤¹â€è™½ç„¶çœ‹èµ·æ¥å«â€éŸ³ä¹â€œï¼Œå…¶å®åœ°å€æ åç§°æ˜¯Musicï¼ˆä»€ä¹ˆä¸­è‹±æ··åˆä½“ï¼‰</em></p><p>æ­¤æ—¶ä½ ä¼šå‘ç°ï¼Œæ³¨å†Œè¡¨ä¸­çš„éŸ³ä¹æ–‡ä»¶å¤¹ä¾ç„¶æŒ‡å‘<code>OneDrive\Music</code></p><p>è¿‡äº†ä¸€ä¼šå„¿ï¼ˆç­‰èµ„æºç®¡ç†å™¨ååº”è¿‡æ¥ï¼‰ï¼Œå°±ä¼šåœ¨ä¸‹é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„â€œéŸ³ä¹â€æ–‡ä»¶å¤¹æ¥å–ä»£ä¹‹</p><p><em>&#x2F;&#x2F; å¯èƒ½ä¼šçœ‹åˆ°ä¸¤ä¸ªä¸€æ ·çš„â€œéŸ³ä¹â€æ–‡ä»¶å¤¹ï¼Œåˆ«æ‹…å¿ƒï¼Œé‡å¯ä¸€ä¸‹èµ„æºç®¡ç†å™¨</em></p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åŸæ¥çš„éŸ³ä¹æ–‡ä»¶å¤¹å°±åºŸäº†ï¼Œåªèƒ½æ‰‹åŠ¨å‰ªåˆ‡å†…å®¹äº†</p><h3 id="å¼‚å˜-2"><a href="#å¼‚å˜-2" class="headerlink" title="å¼‚å˜-2"></a>å¼‚å˜-2</h3><p>ç¬¬äºŒç§æƒ…å†µï¼Œå¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å°†OneDriveä¸‹çš„ä¸ªäººæ–‡ä»¶å¤¹ç§»åŠ¨èµ°ï¼Œè€Œæ˜¯é€šè¿‡åˆšåˆšOneDriveçš„å¤‡ä»½å¼€å…³ï¼ˆå…³é—­å¤‡ä»½ï¼‰</p><p>é‚£ä¹ˆï¼Œä»¤äººéœ‡æƒŠçš„äº‹æƒ…å‘ç”Ÿäº†ï¼ŒOneDriveä¸­çš„â€œéŸ³ä¹â€æ–‡ä»¶å¤¹æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼ˆç”šè‡³å›¾æ ‡è¿˜åœ¨ï¼‰</p><p>è€Œ<code>C:\Users\&#123;name&#125;\</code>ä¸‹ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„â€œéŸ³ä¹â€æ–‡ä»¶å¤¹ï¼ˆæ­£å®«ï¼‰ï¼Œä¸”å†…ç½®å¿«æ·æ–¹å¼æŒ‡å‘OneDriveä¸­çš„â€œéŸ³ä¹â€æ–‡ä»¶å¤¹</p><p>è¿™æ³¢æ“ä½œï¼Œé™ˆç‹¬ç§€ä½ åä¸‹</p><p>&#x2F;&#x2F; å› æ­¤ï¼Œä¸€æ—¦å°†ä¸ªäººæ–‡ä»¶å¤¹ç§»åŠ¨è‡³OneDriveï¼Œå°†å¾ˆéš¾æ­£å¸¸ç§»å‡ºå»</p><h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><p>å¦‚æœä½ åœ¨OneDriveæ–‡ä»¶å¤¹å†…éƒ¨ç§»åŠ¨ä¸ªäººæ–‡ä»¶å¤¹ï¼ˆå¦‚ï¼šéŸ³ä¹ï¼‰ï¼Œé‚£ä¹ˆæƒ…å†µå°†å¤§ä¸ç›¸åŒ</p><h4 id="æƒ…å†µ1ï¼šé€šè¿‡â€œä½ç½®â€æ ‡ç­¾é¡µå°†-OneDrive-Music-ç§»åŠ¨åˆ°-OneDrive-Other-Music"><a href="#æƒ…å†µ1ï¼šé€šè¿‡â€œä½ç½®â€æ ‡ç­¾é¡µå°†-OneDrive-Music-ç§»åŠ¨åˆ°-OneDrive-Other-Music" class="headerlink" title="æƒ…å†µ1ï¼šé€šè¿‡â€œä½ç½®â€æ ‡ç­¾é¡µå°† OneDrive\Music ç§»åŠ¨åˆ° OneDrive\Other\Music"></a>æƒ…å†µ1ï¼šé€šè¿‡â€œä½ç½®â€æ ‡ç­¾é¡µå°† OneDrive\Music ç§»åŠ¨åˆ° OneDrive\Other\Music</h4><p>é‚£ä¹ˆç¥å¥‡çš„äº‹æƒ…å°†ä¼šå‘ç”Ÿï¼Œ<code>OneDrive\Music</code> æ–‡ä»¶å¤¹ä¾ç„¶å­˜åœ¨ï¼Œä¸”å†…å®¹å®Œå¥½ï¼Œä½†æ˜¯ç¼ºå°‘äº†å›¾æ ‡</p><p>è€Œ<code>OneDrive\Other\Music</code> ç©ºæœ‰å›¾æ ‡ï¼ˆæ­£å®«æ ‡å¿—ï¼‰ï¼Œå´æ²¡æœ‰å†…å®¹</p><p>å•Šè¿™â€”â€”ï¼Œåˆ†è£‚äº†æ˜¯å§</p><h4 id="æƒ…å†µ2ï¼šç›´æ¥Ctrl-Xå‰ªåˆ‡"><a href="#æƒ…å†µ2ï¼šç›´æ¥Ctrl-Xå‰ªåˆ‡" class="headerlink" title="æƒ…å†µ2ï¼šç›´æ¥Ctrl+Xå‰ªåˆ‡"></a>æƒ…å†µ2ï¼šç›´æ¥Ctrl+Xå‰ªåˆ‡</h4><p>é‚£ä¹ˆä¸€åˆ‡éƒ½å¾ˆæ­£å¸¸</p><h3 id="ç§»åŠ¨OneDrive"><a href="#ç§»åŠ¨OneDrive" class="headerlink" title="ç§»åŠ¨OneDrive"></a>ç§»åŠ¨OneDrive</h3><p>ä½ ä»¥ä¸ºè¿™åˆåˆå®Œäº†ï¼Œå¤ªå¹´è½»äº†å…„å¼Ÿ</p><p>æœ‰æ²¡æœ‰æƒ³è¿‡ï¼ŒOneDriveä¹Ÿæ˜¯åœ¨Cç›˜çš„ï¼Œå¾ˆå ç©ºé—´çš„</p><p>é‚£å‡å¦‚æˆ‘è¦ç§»åŠ¨OneDriveæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­çš„â€œéŸ³ä¹â€æ–‡ä»¶å¤¹ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œè¦å¦‚ä½•ç§»åŠ¨OneDriveï¼ˆè¿™ç©æ„å„¿æ˜¯ä¸ªç½‘ç›˜å•Šï¼Œå¯ä¸æ˜¯ä¸€èˆ¬çš„æ–‡ä»¶å¤¹ï¼‰</p><p>éœ€è¦å‚è€ƒä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://support.microsoft.com/zh-cn/office/%E6%9B%B4%E6%94%B9-onedrive-%E6%96%87%E4%BB%B6%E5%A4%B9%E7%9A%84%E4%BD%8D%E7%BD%AE-f386fb81-1461-40a7-be2c-712676b2c4ae">æ›´æ”¹ OneDrive æ–‡ä»¶å¤¹çš„ä½ç½® - Microsoft æ”¯æŒ</a></p><ol><li>å–æ¶ˆæ­¤ç”µè„‘é“¾æ¥</li><li>ç§»åŠ¨ï¼ˆå‰ªåˆ‡ï¼‰OneDriveæ–‡ä»¶å¤¹</li><li>é‡æ–°åˆå§‹åŒ–OneDriveï¼Œå¹¶é€‰æ‹©OneDriveæ–‡ä»¶å¤¹ä½ç½®ï¼ˆç§»åŠ¨åï¼‰</li></ol><p>å¥½çš„ï¼Œé‚£ä¹ˆOneDriveä¸­çš„Musicæ–‡ä»¶å¤¹ä¼šæ€ä¹ˆæ ·ï¼Œèƒ½ä¿æŒæ­£å®«ä½ç½®å—</p><p>è¯·çœ‹ä¸€æ®µå¹¿å‘Šï¼Œæˆ‘ä»¬ç¨åå›æ¥â€”â€”</p><p>å¥½çš„ï¼Œæ²¡æœ‰èµåŠ©å•†ï¼Œæ­æ™“ç­”æ¡ˆï¼š<code>OneDrive\Music</code>å®ˆä½äº†å®åº§ï¼Œéå¸¸æ­£å¸¸ï¼Œç”šè‡³æ³¨å†Œè¡¨ä¹ŸåŒæ­¥æ›´æ–°äº†</p><p>ä¸ºä»€ä¹ˆå‘¢ï¼Œç©¶ç«Ÿæ˜¯è¢«åŒ…è£…åœ¨OneDriveä¸­çš„åŸå› ï¼Œè¿˜æ˜¯OneDriveå–æ¶ˆé“¾æ¥ï¼Œä»ç½‘ç›˜é€€åŒ–ä¸ºæ™®é€šæ–‡ä»¶å¤¹çš„åŸå› ï¼</p><p>ä¸ºäº†éªŒè¯ï¼Œæˆ‘ä»¬å…ˆå–æ¶ˆOneDriveé“¾æ¥ï¼Œä½¿å…¶é€€åŒ–ä¸ºæ™®é€šæ–‡ä»¶å¤¹ï¼Œç„¶åå‰ªåˆ‡<code>Music</code>æ–‡ä»¶å¤¹</p><p>å‘ç°ï¼šè¿˜æ˜¯æ²¡æœ‰åµç”¨ï¼Œ<code>Music</code>æ–‡ä»¶å¤¹ä¾æ—§é€€åŒ–</p><p>å¯„ï¼ŒOneDriveæ–‡ä»¶å¤¹çœŸç¥å¥‡</p><h2 id="Rebuild"><a href="#Rebuild" class="headerlink" title="Rebuild"></a>Rebuild</h2><p>å¦‚æœæˆ‘ä»¬æŠŠ<code>OneDrive\Music</code>åˆ é™¤ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p><p>æ­¤æ—¶åœ¨<code>user</code>æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„<strong>Music</strong>æ–‡ä»¶å¤¹</p><p>é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬æŠŠè¿™ä¸ª<code>C:\Users\&#123;name&#125;\Music</code>ç»§ç»­åˆ é™¤å‘¢</p><p>emmmï¼Œé‚£å°±æ²¡äº†</p><p>æ­¤æ—¶ï¼Œ<code>SHGetKnownFolderPath</code>çš„è¿”å›<code>Error</code>ï¼ˆ<code>hr != S_OK</code>ï¼‰ï¼Œä½†æ˜¯æ³¨å†Œè¡¨ä¸­è®°å½•çš„è¿˜æ˜¯é»˜è®¤ä½ç½® &#x2F;&#x2F;çœ‹æ¥ä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨</p><p>å¦‚ä½•æ‰¾å›å‘¢ï¼Ÿ</p><h3 id="OneDriveå¤‡ä»½"><a href="#OneDriveå¤‡ä»½" class="headerlink" title="OneDriveå¤‡ä»½"></a>OneDriveå¤‡ä»½</h3><p>å¦‚æœæˆ‘ä»¬ç›´æ¥æ‰“å¼€OneDriveåŒæ­¥ä¸å¤‡ä»½ä¸­çš„<strong>Music</strong>å¼€å…³</p><p>é‚£ä¹ˆOneDriveä¸­ä¼šå¥‡è¿¹èˆ¬åœ°å‡ºç°â€œéŸ³ä¹â€æ–‡ä»¶å¤¹ï¼ŒåŒæ—¶æ³¨å†Œè¡¨ä¹Ÿæ›´æ–°äº†</p><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p>å…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡<code>SHGetKnownFolderPath</code>æ‰‹åŠ¨æ–°å»ºç³»ç»Ÿæ–‡ä»¶å¤¹</p><p>åªè¦å°†<code>dwFlags</code>è®¾ç½®ä¸ºè¯¥å€¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">KF_FLAG_CREATE<br>å€¼ï¼š <span class="hljs-number">0x00008000</span><br>æŒ‡å®šå¼ºåˆ¶åˆ›å»ºæŒ‡å®šæ–‡ä»¶å¤¹ï¼ˆå¦‚æœè¯¥æ–‡ä»¶å¤¹å°šä¸å­˜åœ¨ï¼‰ã€‚ åº”ç”¨ä¸ºè¯¥æ–‡ä»¶å¤¹é¢„å®šä¹‰çš„å®‰å…¨é¢„é…ã€‚ å¦‚æœæ–‡ä»¶å¤¹ä¸å­˜åœ¨ä¸”æ— æ³•åˆ›å»ºï¼Œåˆ™è¯¥å‡½æ•°å°†è¿”å›å¤±è´¥ä»£ç ï¼Œå¹¶ä¸”ä¸ä¼šè¿”å›ä»»ä½•è·¯å¾„<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">SHGetKnownFolderPath</span>(FOLDERID_Music, KF_FLAG_CREATE, <span class="hljs-literal">nullptr</span>, &amp;path);<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œ<code>Music</code>æ–‡ä»¶å¤¹å°±ä¼šåœ¨é»˜è®¤ä½ç½®é‡æ–°è¢«åˆ›å»ºäº†ï¼ˆBrand-Newï¼‰ï¼</p><p>&#x2F;&#x2F; å¦‚æœæƒ³è¦è·å–æŸæ–‡ä»¶å¤¹çš„é»˜è®¤å­˜å‚¨ä½ç½®ï¼ˆç§»åŠ¨å‰çš„ï¼‰å¯ä»¥è¿™æ ·ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">SHGetKnownFolderPath</span>(FOLDERID_Music, KF_FLAG_DONT_VERIFY | KF_FLAG_DEFAULT_PATH, <span class="hljs-literal">nullptr</span>, &amp;path);<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">KF_FLAG_DEFAULT_PATH<br>å€¼ï¼š <span class="hljs-number">0x00000400</span><br>æŒ‡å®šæ£€ç´¢å·²çŸ¥æ–‡ä»¶å¤¹çš„é»˜è®¤è·¯å¾„ã€‚ å¦‚æœæœªè®¾ç½®æ­¤æ ‡å¿—ï¼Œåˆ™è¯¥å‡½æ•°å°†æ£€ç´¢æ–‡ä»¶å¤¹çš„å½“å‰è·¯å¾„ï¼ˆå¯èƒ½é‡å®šå‘ï¼‰ã€‚ é™¤éè®¾ç½®äº† KF_FLAG_DONT_VERIFY ï¼Œå¦åˆ™æ­¤æ ‡å¿—çš„æ‰§è¡ŒåŒ…æ‹¬éªŒè¯æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ã€‚<br></code></pre></td></tr></table></figure><h3 id="é™è§‚å…¶å˜"><a href="#é™è§‚å…¶å˜" class="headerlink" title="é™è§‚å…¶å˜"></a>é™è§‚å…¶å˜</h3><p>æ—¢ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡APIå»åˆ›å»ºä¸ªäººæ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆåŒç†ï¼Œå…¶ä»–è½¯ä»¶å¦‚æœéœ€è¦å¾€è¿™äº›æ–‡ä»¶å¤¹å†™å…¥æ•°æ®ä½†æ˜¯å‘ç°<strong>Not Found</strong>ï¼Œå¯èƒ½å¤§æ¦‚åº”è¯¥ä¼šé‡æ–°å¸®æˆ‘ä»¬åˆ›å»º</p><p>æ‰€ä»¥ï¼Œæ”¾å‡ å¤©å¤§æ¦‚å°±å¥½äº†å§ï¼Œå•Šå“ˆå“ˆ</p><p>&#x2F;&#x2F; ä¾‹å¦‚ï¼šæ‰“å¼€ç½‘æ˜“äº‘éŸ³ä¹å°±ä¼šè‡ªåŠ¨åˆ›å»º</p><h3 id="æ‰‹åŠ¨æ–°å»º"><a href="#æ‰‹åŠ¨æ–°å»º" class="headerlink" title="æ‰‹åŠ¨æ–°å»º"></a>æ‰‹åŠ¨æ–°å»º</h3><p>æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä¸€ä¸‹æ³¨å†Œè¡¨ä¸­å¯¹åº”æ–‡ä»¶å¤¹çš„ä½ç½®ï¼Œç„¶åæ‰‹åŠ¨æ–°å»ºä¸€ä¸ªä¸€æ¯›ä¸€æ ·çš„æ–‡ä»¶å¤¹ï¼Œç„¶åé‡å¯èµ„æºç®¡ç†å™¨ï¼Œå¤§æ¦‚å°±ä¼šè¢«è®¤ä¸ºæ˜¯æ­£å®«äº†</p><p>Justæ²¡æœ‰å›¾æ ‡ï¼Œé‚£ä¹ˆæ–‡ä»¶å¤¹å›¾æ ‡æ˜¯å“ªæ¥çš„å‘¢ï¼Ÿ</p><p>å…¶å®æ˜¯æ–‡ä»¶å¤¹ä¸‹çš„ä¸€ä¸ªéšè—æ–‡ä»¶ï¼ˆä¸”è¢«ç³»ç»Ÿä¿æŠ¤ï¼‰ï¼š<code>desktop.ini</code></p><p><img src="/img/image-20240403182634322.png" alt="æ˜¾ç¤ºéšè—æ–‡ä»¶"></p><p>å¯¹äº<code>Music</code>æ–‡ä»¶å¤¹ï¼Œ<code>desktop.ini</code>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[.ShellClassInfo]</span><br><span class="hljs-attr">LocalizedResourceName</span>=@%SystemRoot%\system32\windows.storage.dll,-<span class="hljs-number">21790</span><br><span class="hljs-attr">InfoTip</span>=@%SystemRoot%\system32\shell32.dll,-<span class="hljs-number">12689</span><br><span class="hljs-attr">IconResource</span>=%SystemRoot%\system32\imageres.dll,-<span class="hljs-number">108</span><br><span class="hljs-attr">IconFile</span>=%SystemRoot%\system32\shell32.dll<br><span class="hljs-attr">IconIndex</span>=-<span class="hljs-number">237</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œè®¾ç½®äº†æ–‡ä»¶å¤¹çš„æœ¬åœ°åŒ–åç§°ï¼Œå³åœ¨ä¸åŒè¯­è¨€ç¯å¢ƒä¸‹æ˜¾ç¤ºçš„åç§°</p><p>è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆ<strong>éŸ³ä¹æ–‡ä»¶å¤¹</strong>æ˜¾ç¤ºä¸ºâ€<strong>éŸ³ä¹</strong>â€œï¼Œä½†å®é™…è·¯å¾„ä¸­æ˜¯â€<strong>Music</strong>â€œ</p><p>ä»”ç»†çœ‹å¯ä»¥å‘ç°ï¼Œå®é™…ä¸Šæ˜¯ä»<code>windows.storage.dll</code>ä¸­æå–IDä¸º21790çš„èµ„æºï¼ˆå­—ç¬¦ä¸²ï¼‰</p><p>æˆ‘ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp">HMODULE hModule = <span class="hljs-built_in">LoadLibrary</span>(<span class="hljs-built_in">TEXT</span>(<span class="hljs-string">&quot;C:\\Windows\\System32\\windows.storage.dll&quot;</span>));<br><span class="hljs-keyword">if</span> (hModule == <span class="hljs-literal">nullptr</span>) &#123;<br>    std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to load DLL.&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-type">int</span> resourceID = <span class="hljs-number">21790</span>; <span class="hljs-comment">// èµ„æºæ ‡è¯†ç¬¦</span><br><br>WCHAR buffer[<span class="hljs-number">1024</span>];<br><span class="hljs-type">int</span> length = <span class="hljs-built_in">LoadStringW</span>(hModule, resourceID, buffer, <span class="hljs-built_in">sizeof</span>(buffer) / <span class="hljs-built_in">sizeof</span>(WCHAR));<br><span class="hljs-keyword">if</span> (length &gt; <span class="hljs-number">0</span>) &#123;<br>    std::wcout &lt;&lt; <span class="hljs-string">L&quot;Resource string: &quot;</span> &lt;&lt; buffer &lt;&lt; std::endl;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to load string resource.&quot;</span> &lt;&lt; std::endl;<br>&#125;<br><span class="hljs-built_in">FreeLibrary</span>(hModule); <span class="hljs-comment">// é‡Šæ”¾ DLL æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š<code>Resource string: éŸ³ä¹</code></p><ul><li><code>iconTip</code>è®¾ç½®äº†å½“ä½ å°†é¼ æ ‡æ‚¬åœåœ¨æ–‡ä»¶å¤¹å›¾æ ‡ä¸Šæ—¶æ˜¾ç¤ºçš„æç¤ºä¿¡æ¯</li><li><code>IconResource</code>æ˜¯å›¾æ ‡èµ„æºï¼Œå’Œ<code>IconFile &amp; IconIndex</code>åº”è¯¥æ˜¯é‡å¤çš„ï¼Œå¤§æ¦‚æ˜¯ä¸ºäº†å…¼å®¹æ€§è€ƒè™‘</li></ul><p>æ‰€ä»¥å…¶å®éƒ½æ˜¯ä¸æ˜¯å¾ˆé‡è¦çš„ä¿¡æ¯ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±æ–°å»º<code>Music</code>æ–‡ä»¶çš„è¯ï¼Œå¤§æ¦‚å¯èƒ½æŠŠè¿™ä¸ª<code>desktop.ini</code>å»ºå‡ºæ¥ï¼Œå¤–è¡¨å°±å¤§å·®ä¸å¤§äº†</p><h2 id="ç–‘ç‚¹"><a href="#ç–‘ç‚¹" class="headerlink" title="ç–‘ç‚¹"></a>ç–‘ç‚¹</h2><p>ç°åœ¨è¿˜å‰©ä¸‹ä¸€ä¸ªæœ€å¤§çš„ç–‘ç‚¹ï¼Œä¸ºä»€ä¹ˆä¸ªäººæ–‡ä»¶å¤¹ï¼ˆå¦‚ï¼šéŸ³ä¹ï¼‰ä¸€æ—¦è¿›å…¥OneDriveï¼Œå†ç§»åŠ¨ï¼ˆå‰ªåˆ‡ï¼‰å‡ºæ¥ï¼Œå°±ä¼šå¤±å»ç³»ç»Ÿå±æ€§ï¼Œå •è½ä¸ºæ™®é€šæ–‡ä»¶å¤¹å‘¢</p><p>æ˜¯å› ä¸º<code>desktop.ini</code>å—ï¼Ÿ</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç§»åŠ¨æ–‡ä»¶å¤¹ï¼Œ<code>desktop.ini</code>ä½œä¸ºæ–‡ä»¶å¤¹å†…çš„ä¸€ä¸ªæ–‡ä»¶è‚¯å®šä¹Ÿä¼šè¢«ç§»åŠ¨çš„</p><p>ä¸è¿‡åœ¨OneDriveä¸­çš„Musicæ¯”è¾ƒç‰¹æ®Šï¼Œå¦‚æœåœ¨æ–‡ä»¶å¤¹é€‰é¡¹ä¸­å‹¾é€‰äº†â€œ<code>éšè—å—ä¿æŠ¤çš„æ“ä½œç³»ç»Ÿæ–‡ä»¶ï¼ˆæ¨èï¼‰</code>â€</p><p>é‚£ä¹ˆ<code>desktop.ini</code>ä¼šè¢«éšè—ï¼Œæ­¤æ—¶å‰ªåˆ‡Musicæ–‡ä»¶å¤¹ï¼Œç§»å‡ºOneDriveï¼Œä¼šå‘ç°ï¼Œ<code>desktop.ini</code>çš„å†…å®¹å‘ç”Ÿäº†å˜åŒ–</p><p>åªå‰©ä¸‹æ›´æ”¹æ–‡ä»¶å¤¹åç§°çš„è¿™ä¸€è¡Œäº†ï¼ˆä½†å…¶å®çœŸæ˜¯æ–‡ä»¶åä¹Ÿå˜æˆäº†â€éŸ³ä¹â€ï¼‰</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">LocalizedResourceName</span>=@%SystemRoot%\system32\windows.storage.dll,-<span class="hljs-number">21790</span><br></code></pre></td></tr></table></figure><p>è¿™å°±å¾ˆå¥‡æ€ªäº†ï¼Œä¸€èˆ¬æ–‡ä»¶å¤¹çš„å‰ªåˆ‡åº”è¯¥ä¿ç•™<code>desktop.ini</code>æ‰å¯¹</p><p>ç¬¬äºŒç§æƒ…å†µï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å‹¾é€‰â€œ<code>éšè—å—ä¿æŠ¤çš„æ“ä½œç³»ç»Ÿæ–‡ä»¶ï¼ˆæ¨èï¼‰</code>â€ï¼Œé‚£å°±èƒ½çœ‹åˆ°<code>desktop.ini</code></p><p>æ­¤æ—¶ä¼šæœ‰å‡ ä¸ªè­¦å‘Šï¼Œé—®ä½ è¦ä¸è¦è½¬ç§»å’Œè¦†ç›–<code>desktop.ini</code></p><p>ä¼šå¼¹å‡ºå¾ˆå¤šæ¬¡è­¦å‘Šï¼Œè¿˜æœ‰ä¸€æ¬¡è¦†ç›–4ä¸ªæ–‡ä»¶ï¼ŸæŒºå¥‡æ€ªçš„ï¼ˆé‡Œé¢æ€»å…±å°±ä¿©<code>desktop.ini</code>ï¼‰</p><p>ç„¶åå‘¢ï¼Œè½¬ç§»æˆåŠŸï¼Œä¼šå‘ç°ï¼Œå›¾æ ‡ä»€ä¹ˆçš„éƒ½ä¿ç•™äº†ï¼Œ<code>desktop.ini</code>ä¹Ÿæ˜¯æ­£ç¡®çš„</p><p>ä½†æ˜¯ï¼Œä¸€çœ‹æ³¨å†Œè¡¨ï¼Œå“å‘€ï¼Œåˆ<strong>fallback</strong>åˆ°äº†<code>C:\Users\&#123;name&#125;\</code>ä¸‹ï¼Œè€Œä¸”è¿˜ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„æ­£å®«</p><p>å¯„</p><p><strong>ä¸–ç•Œåå¤§æœªè§£ä¹‹è°œï¼šè®¡ç®—æœºä¸­çš„å¹½çµ</strong></p><h2 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h2><p>æˆ‘ä¸å¹²äº†ï¼Œç­‰æˆ‘å…¥èŒå¾®è½¯å†è¯´å§</p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/shlobj_core/nf-shlobj_core-shgetknownfolderpath">SHGetKnownFolderPath å‡½æ•° (shlobj_core.h) - Win32 apps | Microsoft Learn</a></p><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha">SHGetFolderPathA å‡½æ•° (shlobj_core.h) - Win32 apps | Microsoft Learn</a></p><p><a href="https://support.microsoft.com/zh-cn/topic/-%E6%88%91%E7%9A%84%E6%96%87%E6%A1%A3-%E6%96%87%E4%BB%B6%E5%A4%B9%E7%9A%84%E9%85%8D%E7%BD%AE-dfd9a90d-8f80-18d6-e7cc-f1566fc3b10b">â€œæˆ‘çš„æ–‡æ¡£â€æ–‡ä»¶å¤¹çš„é…ç½® - Microsoft æ”¯æŒ</a></p><p><a href="https://blog.csdn.net/yao_hou/article/details/122333819">Qtè·å–windowsæ–‡æ¡£ã€ä¸‹è½½ã€å›¾ç‰‡ç­‰ç›®å½•è·¯å¾„_qtè·å–downloadç›®å½•-CSDNåšå®¢</a></p><p><a href="https://segmentfault.com/q/1010000042734462">c++ - è·å–æˆ‘çš„æ–‡æ¡£çš„è·¯å¾„ - SegmentFault æ€å¦</a></p><p><a href="https://support.microsoft.com/zh-cn/office/%E6%9B%B4%E6%94%B9-onedrive-%E6%96%87%E4%BB%B6%E5%A4%B9%E7%9A%84%E4%BD%8D%E7%BD%AE-f386fb81-1461-40a7-be2c-712676b2c4ae">æ›´æ”¹ OneDrive æ–‡ä»¶å¤¹çš„ä½ç½® - Microsoft æ”¯æŒ</a></p><p><a href="https://zhuanlan.zhihu.com/p/36950695">ç§»åŠ¨Onedriveæ–‡ä»¶å¤¹è‡³Dç›˜ç›®å½• - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://www.zhihu.com/question/20167122">ã€Œå¸¦ BOM çš„ UTF-8ã€å’Œã€Œæ—  BOM çš„ UTF-8ã€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç½‘é¡µä»£ç ä¸€èˆ¬ä½¿ç”¨å“ªä¸ªï¼Ÿ - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://blog.csdn.net/tscaxx/article/details/108390520">ANSIæ˜¯ä»€ä¹ˆç¼–ç ï¼Ÿ-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/maxsky/article/details/41546029">è§£å†³ C++ printf æ±‰å­—é—®å·ã€‚å« _tprintf(), printf(), wprintf() è¯¦è§£_c++æ±‰å­—å˜æˆé—®å·-CSDNåšå®¢</a></p><p><a href="https://www.cnblogs.com/zyl910/archive/2013/01/20/wchar_crtbug_01.html">[C++] coutã€wcoutæ— æ³•æ­£å¸¸è¾“å‡ºä¸­æ–‡å­—ç¬¦é—®é¢˜çš„æ·±å…¥è°ƒæŸ¥ï¼ˆ1ï¼‰ï¼šå„ç§ç¼–è¯‘å™¨æµ‹è¯• - zyl910 - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://support.microsoft.com/zh-cn/office/%E6%9B%B4%E6%94%B9-onedrive-%E6%96%87%E4%BB%B6%E5%A4%B9%E7%9A%84%E4%BD%8D%E7%BD%AE-f386fb81-1461-40a7-be2c-712676b2c4ae">æ›´æ”¹ OneDrive æ–‡ä»¶å¤¹çš„ä½ç½® - Microsoft æ”¯æŒ</a></p><p><a href="https://zhuanlan.zhihu.com/p/36950695">ç§»åŠ¨Onedriveæ–‡ä»¶å¤¹è‡³Dç›˜ç›®å½• - çŸ¥ä¹ (zhihu.com)</a></p>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
      <tag>OneDrive</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springboot @Scheduled å®šæ—¶åŸç†ç®€æ</title>
    <link href="/2024/03/18/Springboot-Scheduled-%E5%AE%9A%E6%97%B6%E5%8E%9F%E7%90%86%E7%AE%80%E6%9E%90/"/>
    <url>/2024/03/18/Springboot-Scheduled-%E5%AE%9A%E6%97%B6%E5%8E%9F%E7%90%86%E7%AE%80%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Springboot</code>ä¸­å¯ä»¥ç”¨<code>@Scheduled</code>å¼€å¯å®šæ—¶ä»»åŠ¡</p><p>è¿™ä¸ªæ—¶å€™æœ‰äººå°±è¯´äº†ï¼šå®šæ—¶ä»»åŠ¡æœ‰ä»€ä¹ˆå¥½è®²çš„ï¼Œä¸å°±æ˜¯å®šæ—¶ã®ä»»åŠ¡å˜›</p><p>æœ‰ç‚¹é“ç†ï¼Œå¹²è®²æ²¡æœ‰ä»€ä¹ˆæ„æ€ï¼Œæˆ‘ä»¬æ¥è¯•æƒ³è¿™æ ·ä¸€ç§åœºæ™¯ï¼š</p><ul><li><strong>å‡å¦‚æœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯å°æ—¶è§¦å‘ä¸€æ¬¡ï¼Œä½†æ˜¯ç³»ç»Ÿï¼ˆ<code>Windows</code>ï¼‰ä¼‘çœ äº†6ä¸ªå°æ—¶</strong></li></ul><p>é‚£ä¹ˆï¼šè¿™ä¸ªå®šæ—¶ä»»åŠ¡ä¼šåœ¨å¼€æœºåç«‹åˆ»è¢«è§¦å‘å—ï¼Œè§¦å‘å‡ æ¬¡å‘¢ï¼Ÿ</p><h2 id="æ­£ç‰‡å åº•"><a href="#æ­£ç‰‡å åº•" class="headerlink" title="æ­£ç‰‡å åº•"></a>æ­£ç‰‡å åº•</h2><p>å¥½çš„ï¼Œå¸Œæœ›è¿™ä¸ªé—®é¢˜è®©ä½ æèµ·äº†ä¸€ç‚¹ç‚¹å…´è¶£</p><p><code>@Scheduled</code>ä¸€å…±æœ‰ä¸‰ç§å®šæ—¶æ–¹å¼ï¼š</p><ul><li><p><a href="https://www.cnblogs.com/qianjinyan/p/10415140.html">cron</a>ï¼šå®šä¹‰äº†ä¸€ä¸ªå¦‚ä½•å¾ªç¯çš„æ—¶é—´æ¨¡å¼ï¼Œæ¯”å¦‚â€œæ¯å¤©å‡Œæ™¨1ç‚¹æ‰§è¡Œâ€ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å®šä¹‰ä¸ºâ€œæ¯ä¸ªå°æ—¶çš„0åˆ†æ‰§è¡Œâ€ï¼›</p><p><code>cron</code>è¡¨è¾¾å¼ç”±å…­ä¸ªå­—æ®µç»„æˆï¼š[ç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨]</p><p>è¿™ä¹ˆè¯´å¯èƒ½æ¯”è¾ƒæŠ½è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ï¼š</p><ul><li>â€œ0 * * * * *â€ï¼šæ¯åˆ†é’Ÿçš„0ç§’éƒ½æ‰§è¡Œä¸€æ¬¡</li><li>â€œ0 0 9 * * *â€ï¼šæ¯å¤©9ç‚¹0åˆ†0ç§’æ‰§è¡Œä¸€æ¬¡</li><li>â€œ0 0 9 * * MONâ€ï¼šæ¯å‘¨ä¸€çš„ä¸Šåˆ9ç‚¹æ•´æ‰§è¡Œ</li><li>â€œ0 0 9 1 * *â€ï¼šæ¯æœˆçš„ç¬¬ä¸€å¤©ä¸Šåˆ9ç‚¹æ•´æ‰§è¡Œ</li></ul><p>æ€»ä¹‹å°±å¾ˆå¼ºå¤§ï¼Œå¯ä»¥å»äº†è§£ä¸€ä¸‹</p></li><li><p><code>fixedRate</code>ï¼šæ˜¯æŒ‡ä»æ¯æ¬¡æ‰§è¡Œå¼€å§‹åˆ°ä¸‹ä¸€æ¬¡æ‰§è¡Œå¼€å§‹çš„å›ºå®šé—´éš”</p></li><li><p><code>fixedDelay</code>ï¼šæ˜¯æŒ‡ä¸€æ¬¡æ‰§è¡Œå®Œæˆåˆ°ä¸‹ä¸€æ¬¡æ‰§è¡Œå¼€å§‹ä¹‹é—´çš„å›ºå®šç­‰å¾…æ—¶é—´ï¼ˆä¼šç®—ä¸Šæ‰§è¡Œæ—¶é—´ï¼‰</p></li></ul><p>é‚£ä¹ˆä»–ä»¬åœ¨é¢å¯¹ç³»ç»Ÿä¼‘çœ è€Œé”™è¿‡ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´çš„æƒ…å†µï¼Œä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p><ul><li><p><code>corn</code>ï¼šå½“ç³»ç»Ÿå”¤é†’åï¼Œ<code>cron</code> è°ƒåº¦çš„ä»»åŠ¡ä¼šåœ¨ä¸‹ä¸€ä¸ªç¬¦åˆè¡¨è¾¾å¼çš„æ—¶é—´ç‚¹æ‰§è¡Œã€‚å®ƒä¸ä¼šå› ä¸ºé”™è¿‡äº†é¢„å®šæ—¶é—´è€Œå°è¯•â€œè¡¥å¿â€æ‰§è¡Œ</p></li><li><p><code>fixedRate</code>ï¼šæ ¹æ®å®éªŒï¼Œç³»ç»Ÿå”¤é†’åï¼Œå¹¶ä¸ä¼šç«‹å³æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ˜¯<strong>ç»§ç»­ç­‰å¾…</strong>ï¼Œå‡ ååˆ†é’Ÿåï¼Œå‡ ä¹åŒæ—¶æ‰§è¡Œäº†<strong>å¤šæ¬¡</strong>ä»»åŠ¡ï¼ˆä¼‘çœ ä¸­é”™è¿‡çš„é‚£å‡ æ¬¡ï¼‰ï¼Œè¡¥å¿äº†å¤±å»çš„è¿‡å»ï¼ˆå¯èƒ½æ˜¯æŒ‰ç…§é¢„è®¡çš„æ—¶é—´è®¡ç®—äº†ä¸‹ä¸€æ¬¡çš„æ—¶é—´ï¼Œæ²¡æœ‰æ ¹æ®å®é™…ç³»ç»Ÿæ—¶é—´æ ¡æ­£ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">#ScheduledTask.Clean <span class="hljs-number">00</span>:<span class="hljs-number">44</span>:<span class="hljs-number">40.224923500</span><br>... <span class="hljs-comment">//ä¼‘çœ ä¸­</span><br>#ScheduledTask.Clean <span class="hljs-number">12</span>:<span class="hljs-number">25</span>:<span class="hljs-number">07.292055800</span> <span class="hljs-comment">//11ç‚¹å¤šå”¤é†’çš„ï¼Œè¿‡äº†ä¸€ä¼šå„¿æ‰æ‰§è¡Œ</span><br>#ScheduledTask.Clean <span class="hljs-number">12</span>:<span class="hljs-number">25</span>:<span class="hljs-number">07.293056400</span><br>#ScheduledTask.Clean <span class="hljs-number">12</span>:<span class="hljs-number">25</span>:<span class="hljs-number">07.293056400</span><br>#ScheduledTask.Clean <span class="hljs-number">12</span>:<span class="hljs-number">25</span>:<span class="hljs-number">07.293056400</span><br>#ScheduledTask.Clean <span class="hljs-number">12</span>:<span class="hljs-number">25</span>:<span class="hljs-number">07.293056400</span><br>#ScheduledTask.Clean <span class="hljs-number">12</span>:<span class="hljs-number">25</span>:<span class="hljs-number">07.293056400</span><br>#ScheduledTask.Clean <span class="hljs-number">12</span>:<span class="hljs-number">25</span>:<span class="hljs-number">07.293056400</span><br>#ScheduledTask.Clean <span class="hljs-number">12</span>:<span class="hljs-number">25</span>:<span class="hljs-number">07.293056400</span><br>#ScheduledTask.Clean <span class="hljs-number">12</span>:<span class="hljs-number">25</span>:<span class="hljs-number">07.293056400</span><br>#ScheduledTask.Clean <span class="hljs-number">12</span>:<span class="hljs-number">25</span>:<span class="hljs-number">07.293056400</span><br>#ScheduledTask.Clean <span class="hljs-number">12</span>:<span class="hljs-number">25</span>:<span class="hljs-number">07.293056400</span><br>#ScheduledTask.Clean <span class="hljs-number">12</span>:<span class="hljs-number">44</span>:<span class="hljs-number">10.973081</span><br></code></pre></td></tr></table></figure></li><li><p><code>fixedDelay</code>ï¼šæ¨æµ‹ï¼Œä¹Ÿæ˜¯ç»§ç»­ç­‰å¾…æ”’æ»¡<code>Interval</code>ï¼Œä½†æ˜¯ä¸ä¼šè¡¥å¿æ‰§è¡Œï¼Œå› ä¸ºé—´éš”æ˜¯ä»ä¸Šä¸€æ¬¡ä»»åŠ¡ç»“æŸåå¼€å§‹è®¡ç®—çš„</p></li></ul><p><code>fixedRate</code>å’Œ<code>fixedDelay</code>çš„æ‰§è¡Œæœºåˆ¶åº”è¯¥å¤§å·®ä¸å¤§</p><p>è®©æˆ‘ä»¬ä»<code>fixedRate</code>ç®¡ä¸­çª¥è±¹ï¼Œçœ‹çœ‹å…¶åº•å±‚å®šæ—¶æœºåˆ¶</p><h2 id="å®šæ—¶æœºåˆ¶"><a href="#å®šæ—¶æœºåˆ¶" class="headerlink" title="å®šæ—¶æœºåˆ¶"></a>å®šæ—¶æœºåˆ¶</h2><p><code>@Scheduled</code>å¯ä»¥å®ç°å®šæ—¶ä»»åŠ¡ï¼Œè¿™æ— å¯åšéï¼Œä¸å¿…è´¨ç–‘ï¼Œçœ‹èµ·æ¥ç†æ‰€å½“ç„¶ï¼Œç†åº”å¦‚æ­¤</p><blockquote><p>ä»æ¥å¦‚æ­¤ï¼Œä¾¿æ¥å—äº†å—ï¼Ÿ</p></blockquote><p>ä¸ºä»€ä¹ˆå‘¢ï¼Œä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œ<strong>å®šæ—¶</strong>ï¼Œæ˜¯å¦‚ä½•å®ç°çš„</p><p>æœ‰ä¸¤ç§å¯èƒ½ï¼Œå›ºå®šæ—¶é—´ç‚¹ &amp; å›ºå®šæ—¶é—´é—´éš”</p><p>ç¬¬ä¸€ç§ï¼Œå‡å¦‚æˆ‘ä»¬è¦åœ¨æ¯å¤©çš„23:00æé†’ç”¨æˆ·ç¡è§‰</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½åœ¨23:00æ‰§è¡Œç‰¹å®šä»»åŠ¡</p><p>è°æ¥é€šçŸ¥æˆ‘ä»¬ï¼Œç°åœ¨å·²ç»æ˜¯23:00äº†</p><ul><li>ä¸€ä¸ªç®€å•çš„æƒ³æ³•æ˜¯ï¼šæ¯ç§’è½®è¯¢ä¸€æ¬¡æ—¶é—´ï¼Œå¦‚æœæ­£å¥½æ˜¯23æ—¶ï¼Œ0åˆ†ï¼Œåˆ™æ‰§è¡Œä»»åŠ¡</li></ul><p>é‚£ä¹ˆé—®é¢˜å°±æ˜¯ï¼Œä»»åŠ¡ä¼šè¢«å¤šæ¬¡è§¦å‘ï¼ˆ60æ¬¡ maybeï¼‰</p><ul><li>é‚£å¯ä»¥å¢åŠ ä¸€ä¸ªå˜é‡æ¥è®°å½•æ˜¯å¦æ‰§è¡Œè¿‡ï¼Œ</li><li>æˆ–è€…æŠŠæ¯ç§’è½®è¯¢æ”¹ä¸ºæ¯åˆ†é’Ÿè½®è¯¢ï¼ˆå»¶è¿Ÿå¤§ï¼‰ï¼Œ</li><li>æˆ–è€…æ£€æµ‹23æ—¶0åˆ†0ç§’ï¼ˆå¯èƒ½é”™è¿‡ï¼Œå®šæ—¶ä¸ä¸€å®šç²¾å‡†ï¼‰</li><li>æˆ–è€…æ”¹ä¸ºæ¯æ¯«ç§’æ‰§è¡Œï¼ˆå¼€é”€å¤§ï¼‰ï¼Œ</li><li>æˆ–è€…åˆ¤æ–­ä¸¤æ¬¡æ‰§è¡Œçš„é—´éš”ä¸­åŒ…ä¸åŒ…å«ç‰¹å®šæ—¶é—´ç‚¹ï¼ˆ23:00:00.0000ï¼‰ï¼ˆæœ€ä¿é™©ï¼‰</li></ul><p>å¥½çš„ï¼Œå¥½çš„ï¼Œå…ˆåˆ«çº ç»“è¿™ä¸ªäº†</p><p>ä½ åˆšåˆšæ˜¯ä¸æ˜¯è¯´ï¼š<strong>æ¯ç§’è½®è¯¢</strong>ä¸€æ¬¡æ—¶é—´</p><p>æ¯ç§’ï¼Œè½®è¯¢ï¼Œè¿™ä¸åˆæ˜¯å®šæ—¶å—ï¼Œä½ æ€ä¹ˆåˆç»•å›æ¥äº†ï¼Œè‡ªä¾èµ–æ˜¯å§ï¼ˆå®šæ—¶ä¾èµ–å®šæ—¶ï¼‰</p><p>æˆ‘ä»¬æ€ä¹ˆå®ç°æ¯ç§’è½®è¯¢ï¼Ÿ</p><ul><li>ä¸€ä¸ªç®€å•çš„æƒ³æ³•æ˜¯ï¼šWhileå¾ªç¯ + Sleep(1000)</li></ul><p>å¥½çš„å¥½çš„ï¼Œå¾ˆå®Œç¾ï¼Œå°±æ˜¯æœ‰ç‚¹ç®€é™‹</p><p>å…¶å®ï¼Œæ“ä½œç³»ç»Ÿæä¾›äº†å®šæ—¶å™¨ï¼Œä¾‹å¦‚linuxçš„cronï¼ŒWindowsçš„å®šæ—¶ä»»åŠ¡</p><blockquote><p>ç¡¬ä»¶æ—¶é’Ÿå’Œæ—¶é’Ÿä¸­æ–­ï¼ˆby GPT-4ï¼‰</p><ul><li><strong>åŸºç¡€</strong>ï¼šå¤§å¤šæ•°è®¡ç®—æœºç³»ç»Ÿéƒ½æœ‰ä¸€ç§ç¡¬ä»¶æ—¶é’Ÿï¼ˆé€šå¸¸æ˜¯å®æ—¶æ—¶é’ŸRTCå’Œé«˜ç²¾åº¦äº‹ä»¶å®šæ—¶å™¨HPETï¼‰ï¼Œå®ƒä»¬å¯ä»¥ç”Ÿæˆä¸­æ–­ã€‚è¿™äº›æ—¶é’Ÿä»¥å›ºå®šé¢‘ç‡è¿è¡Œï¼Œå½“è¾¾åˆ°é¢„å®šæ—¶é—´æ—¶ï¼Œå®ƒä»¬ä¼šå‘CPUå‘é€ä¸­æ–­ä¿¡å·ã€‚</li><li><strong>å·¥ä½œåŸç†</strong>ï¼šæ“ä½œç³»ç»Ÿå†…æ ¸é€šè¿‡å¤„ç†è¿™äº›ä¸­æ–­æ¥ç»´æŒç³»ç»Ÿæ—¶é—´å’Œè°ƒåº¦å®šæ—¶ä»»åŠ¡ã€‚å½“æ—¶é’Ÿä¸­æ–­å‘ç”Ÿæ—¶ï¼Œæ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨ä¼šæ£€æŸ¥æ˜¯å¦æœ‰éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚</li></ul></blockquote><p>å¦‚æ­¤ä¾èµ–ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å®ç°æ¯ç§’è½®è¯¢äº†ï¼Œå›ºå®šç‚¹æ‰§è¡Œä»»åŠ¡ GET</p><p>å¯¹äºå›ºå®šé—´éš”ï¼Œæˆ‘ä»¬åªè¦æ ¹æ®ç°åœ¨çš„æ—¶é—´è®¡ç®—å‡ºä¸‹ä¸€æ¬¡é¢„è®¡æ‰§è¡Œçš„æ—¶é—´ç‚¹å³å¯ï¼Œå®Œç¾</p><h3 id="å°é—®é¢˜"><a href="#å°é—®é¢˜" class="headerlink" title="å°é—®é¢˜"></a>å°é—®é¢˜</h3><p>å°±æ˜¯æœ‰ä¸ªé—®é¢˜å“¦ï¼Œæ¯ç§’è½®è¯¢ä¸€æ¬¡è²Œä¼¼æœ‰ç‚¹éå¸¸ä¸é‚£ä¹ˆç²¾ç¡®</p><p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚æˆ‘éœ€è¦æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼Œé‚£ä¹ˆæ¯ç§’çš„è¿™äº›è½®è¯¢å°±æå¤§åœ°æµªè´¹äº†CPU</p><p><em>&#x2F;&#x2F;å¥½å§ å…¶å®å¯¹CPUæ¥è®²æ˜¯å°caseå•¦ï¼Œä½†æ˜¯å¬ç€å°±å¾ˆä¸ä¼˜é›…å¥½å§</em></p><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¡ç®—å‡ºè·ç¦»æ—¶é—´ç‚¹çš„é—´éš”ï¼Œç„¶åä½¿ç”¨ç³»ç»Ÿçš„å®šæ—¶å™¨ï¼Œä½¿å…¶ä¸€å°æ—¶åé€šçŸ¥æˆ‘ä»¬</p><h3 id="Scheduledå®šæ—¶æœºåˆ¶"><a href="#Scheduledå®šæ—¶æœºåˆ¶" class="headerlink" title="@Scheduledå®šæ—¶æœºåˆ¶"></a>@Scheduledå®šæ—¶æœºåˆ¶</h3><p>è¯´äº†é‚£ä¹ˆå¤šï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹çœ‹<code>@Scheduled</code>çš„å®šæ—¶æœºåˆ¶æ˜¯æ€ä¹ˆæ ·çš„</p><p>çš„</p><p>çš„</p><p>â€¦</p><p>å‘†â€”â€”</p><p>æ²¡é”™ä½ å¡äº†</p><p>ç»è¿‡ä¸€ä¸‹åˆçš„æœç´¢å’Œæºç é˜…è¯»ï¼ˆåç¼–è¯‘çš„.classï¼‰</p><p>æˆ‘è§‰å¾—ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŠ“é‡ç‚¹å§ï¼Œæ¯•ç«Ÿè®²é‚£ä¹ˆç»†ä¹Ÿæ²¡ä»€ä¹ˆç”¨ï¼Œå¯¹å•Šï¼Œå•Šhahaha</p><p>&gt; &lt;</p><p>å€Ÿä¸€ä¸‹<a href="https://www.cnblogs.com/throwable/p/12616945.html">å¤§ä½¬</a>çš„å›¾å§</p><p><img src="/img/s-b-s-f-2.jpg" alt="Schedulingæ¨¡å—çš„å·¥ä½œæµç¨‹"></p><p>åæ­£å°±æ˜¯</p><ul><li><code>ScheduledAnnotationBeanPostProcessor</code>ä¼šè§£æ<code>@Scheduled</code>æ³¨è§£ï¼Œå¹¶ä¸”æŠŠæ–¹æ³•ï¼ˆä»»åŠ¡ï¼‰å°è£…ä¸ºä¸åŒç±»å‹çš„<code>Task</code>å®ä¾‹ï¼Œç¼“å­˜åœ¨<code>ScheduledTaskRegistrar</code>ä¸­</li><li>å…¶é’©å­æ–¹æ³•<code>afterSingletonsInstantiated()</code>åœ¨æ‰€æœ‰å•ä¾‹åˆå§‹åŒ–å®Œæˆä¹‹åå›è°ƒè§¦å‘ï¼Œåœ¨æ­¤æ–¹æ³•ä¸­è®¾ç½®äº†<code>ScheduledTaskRegistrar</code>ä¸­çš„ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆ<code>TaskScheduler</code>æˆ–è€…<code>ScheduledExecutorService</code>ç±»å‹ï¼‰å®ä¾‹ï¼Œå¹¶ä¸”è°ƒç”¨<code>ScheduledTaskRegistrar#afterPropertiesSet()</code>æ–¹æ³•æ·»åŠ æ‰€æœ‰ç¼“å­˜çš„<code>Task</code>å®ä¾‹åˆ°ä»»åŠ¡è°ƒåº¦å™¨ä¸­æ‰§è¡Œ</li></ul><h4 id="ä»»åŠ¡è°ƒåº¦å™¨"><a href="#ä»»åŠ¡è°ƒåº¦å™¨" class="headerlink" title="ä»»åŠ¡è°ƒåº¦å™¨"></a>ä»»åŠ¡è°ƒåº¦å™¨</h4><p><code>Scheduling</code>æ¨¡å—æ”¯æŒ<code>TaskScheduler</code>æˆ–è€…<code>ScheduledExecutorService</code>ç±»å‹çš„ä»»åŠ¡è°ƒåº¦å™¨ï¼Œè€Œ<code>ScheduledExecutorService</code>å…¶å®æ˜¯<code>java.util.concurrent</code>çš„æ¥å£ï¼Œä¸€èˆ¬å®ç°ç±»å°±æ˜¯è°ƒåº¦çº¿ç¨‹æ± <code>ScheduledThreadPoolExecutor</code></p><h4 id="ScheduledThreadPoolExecutor"><a href="#ScheduledThreadPoolExecutor" class="headerlink" title="ScheduledThreadPoolExecutor"></a>ScheduledThreadPoolExecutor</h4><p>å¥½çš„å¥½çš„ï¼Œå…¶å®è¿™é‡Œè®²äº†ä¸€å¤§å †ï¼Œæˆ‘çœ‹é‚£æºç çœŸçš„æ˜¯è·³æ¥è·³å»ï¼Œäº‘é‡Œé›¾é‡Œï¼Œè¿˜éƒ½æ˜¯åç¼–è¯‘çš„ï¼Œè¿˜éƒ½æ²¡æœ‰ç´¢å¼•ï¼Œè¿˜éƒ½æ‰¾ä¸åˆ°è¢«è°è°ƒç”¨äº†</p><p>å¥½å¥½å¥½</p><p>æ€»ä¹‹å‘¢ï¼Œä»»åŠ¡è¢«æ”¾åˆ°äº†ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼ˆ<a href="https://www.cnblogs.com/dwlsxj/p/delayedQueue.html">å»¶è¿Ÿé˜Ÿåˆ— <code>DelayQueue</code></a>ï¼‰é‡Œ</p><p>å†…éƒ¨æ˜¯ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼ŒæŒ‰ç…§é¢„è®¡æ‰§è¡Œæ—¶é—´æ’åˆ—ï¼Œå¤´éƒ¨æ˜¯æœ€å…ˆæ‰§è¡Œçš„ï¼Œ<code>take</code>è·å–å¤´éƒ¨æ—¶ï¼Œå¦‚æœæ—¶é—´è¿˜æ²¡åˆ°ï¼Œå°±ä¼šä¼‘çœ ç­‰å¾…</p><p>ä¸è¿‡å‘¢ï¼Œçœ‹æºç çš„è¯ï¼Œè²Œä¼¼æ˜¯è‡ªå·±å®ç°äº†ä¸€ä¸ªç±»ä¼¼çš„ç»“æ„ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨<code>DelayQueue</code></p><p><em>&#x2F;&#x2F; å†…éƒ¨çš„<code>RunnableScheduledFuture</code>ç»§æ‰¿äº†<code>Delayed</code></em></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DelayedWorkQueue</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueue</span>&lt;Runnable&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BlockingQueue</span>&lt;Runnable&gt;<br></code></pre></td></tr></table></figure><p>æ˜¯<code>ScheduledThreadPoolExecutor</code>ä¸­çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»</p><p>æ¥çœ‹ä¸€ä¸‹æ ¸å¿ƒçš„<code>take</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> RunnableScheduledFuture&lt;?&gt; take() <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.lock;<br>    lock.lockInterruptibly();<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>                RunnableScheduledFuture&lt;?&gt; first = <span class="hljs-built_in">this</span>.queue[<span class="hljs-number">0</span>];<br>                <span class="hljs-keyword">if</span> (first != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-type">long</span> <span class="hljs-variable">delay</span> <span class="hljs-operator">=</span> first.getDelay(TimeUnit.NANOSECONDS);<br>                    <span class="hljs-keyword">if</span> (delay &lt;= <span class="hljs-number">0L</span>) &#123;<br>                        <span class="hljs-type">RunnableScheduledFuture</span> <span class="hljs-variable">var14</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.finishPoll(first);<br>                        <span class="hljs-keyword">return</span> var14;<br>                    &#125;<br><br>                    first = <span class="hljs-literal">null</span>;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.leader != <span class="hljs-literal">null</span>) &#123;<br>                        <span class="hljs-built_in">this</span>.available.await();<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-type">Thread</span> <span class="hljs-variable">thisThread</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>                        <span class="hljs-built_in">this</span>.leader = thisThread;<br><br>                        <span class="hljs-keyword">try</span> &#123;<br>                            <span class="hljs-built_in">this</span>.available.awaitNanos(delay); <span class="hljs-comment">//</span><br>                        &#125; <span class="hljs-keyword">finally</span> &#123;<br>                            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.leader == thisThread) &#123;<br>                                <span class="hljs-built_in">this</span>.leader = <span class="hljs-literal">null</span>;<br>                            &#125;<br><br>                        &#125;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-built_in">this</span>.available.await();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.leader == <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-built_in">this</span>.queue[<span class="hljs-number">0</span>] != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-built_in">this</span>.available.signal();<br>        &#125;<br><br>        lock.unlock();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‡‡ç”¨äº†<code>Leader-Follower</code>æ¨¡å¼</p><p>æ¯”è¾ƒå¤æ‚ï¼Œå…ˆä¸ç®¡é‚£ä¸ªï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯ææ˜ç™½ä¸ºä»€ä¹ˆç³»ç»Ÿä¼‘çœ å”¤é†’åï¼Œè¶…æ—¶ä¸ä¼šç«‹å³æ‰§è¡Œä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-built_in">this</span>.available.awaitNanos(delay);<br></code></pre></td></tr></table></figure><p>å¦‚æœç¬¬ä¸€ä¸ªä»»åŠ¡çš„æ—¶é—´è¿˜æ²¡åˆ°çš„è¯ï¼Œå°±ä¼šç­‰å¾…ï¼Œé‡‡ç”¨<code>Condition</code>çš„<code>awaitNanos</code>æ–¹æ³•ï¼Œè¿›å…¥ä¼‘çœ </p><p>è€Œè¿™ä¸ªæ–¹æ³•çš„å®ç°å†…éƒ¨åˆè°ƒç”¨äº†<code>LockSupport.parkNanos(this, nanos);</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parkNanos</span><span class="hljs-params">(Object blocker, <span class="hljs-type">long</span> nanos)</span> &#123;<br>    <span class="hljs-keyword">if</span> (nanos &gt; <span class="hljs-number">0L</span>) &#123;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>        setBlocker(t, blocker);<br>        U.park(<span class="hljs-literal">false</span>, nanos); <span class="hljs-comment">//</span><br>        setBlocker(t, (Object)<span class="hljs-literal">null</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åæ˜¯è°ƒç”¨äº†<code>Unsafe</code>çš„<code>park</code>æ–¹æ³•</p><p>è¿™æ˜¯ä¸€ä¸ª<code>native</code>æ–¹æ³•ï¼Œä»Javaå±‚é¢æ— æ³•ç»§ç»­å¾€ä¸‹äº†ï¼Œåº”è¯¥æ˜¯åœ¨è™šæ‹Ÿæœºä¸­è°ƒç”¨äº†C++ä»£ç ï¼Œç„¶åè¿›è¡Œç³»ç»Ÿè°ƒç”¨</p><p>é‚£ä¹ˆï¼Œè¿™ä¸ª<code>Unsafe.park</code>æ‰€ç­‰å¾…çš„æ—¶é—´åœ¨Windowsä¸Šï¼Œæœ‰å¯èƒ½ï¼Œåœ¨ä¼‘çœ æ—¶æš‚åœè®¡æ—¶ï¼Œå”¤é†’æ—¶ç»§ç»­è®¡æ—¶ï¼Œä¼‘çœ æ—¶é—´ä¸è®¡å…¥</p><p>è¿™æ˜¯æ¨æµ‹</p><p>ä¸è¿‡<code>@Scheduled-fixedRate</code>ç¡®å®åœ¨ä¼‘çœ æ—¶æš‚åœäº†è®¡æ—¶ï¼Œè¿™æ˜¯å®éªŒç»“æœ</p><h4 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h4><p>å¥½çš„ï¼Œä»¥ä¸Šéƒ½æ˜¯ä¹±æŸ¥æŸ¥ä¹±çœ‹çœ‹ + æ¨æµ‹</p><p>ä»…åšæŠ›ç –å¼•ç‰ï¼Œä¸ä¿è¯æ­£ç¡®æ€§ï¼Œå› ä¸ºè¿™ä»£ç ä¹Ÿå¤ªç»•äº†ï¼Œè€Œä¸”è¿˜æ˜¯åç¼–è¯‘çš„ï¼</p><h3 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h3><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://zhuanlan.zhihu.com/p/309822935">Thread.sleepã€synchronizedã€LockSupport.parkçš„çº¿ç¨‹é˜»å¡åŒºåˆ« - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://blog.csdn.net/weixin_39687783/article/details/85058686">LockSupportä¸­çš„parkä¸unparkåŸç†_locksupport park-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/gaodebao1/article/details/51789225">springBootä¸­@Scheduledæ‰§è¡ŒåŸç†è§£æ_åœ¨springbootä¸­æ‰§è¡Œå®šæ—¶ä»»åŠ¡æœ‰å…ˆåé¡ºåº-CSDNåšå®¢</a></p><p><a href="https://www.cnblogs.com/throwable/p/12616945.html">é€šè¿‡æºç ç†è§£Springä¸­@Scheduledçš„å®ç°åŸç†å¹¶ä¸”å®ç°è°ƒåº¦ä»»åŠ¡åŠ¨æ€è£…è½½ - throwable - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://www.jianshu.com/p/aeb391e4edb0">Javaå®šæ—¶è°ƒåº¦æœºåˆ¶ - ScheduledExecutorService - ç®€ä¹¦ (jianshu.com)</a></p><p><a href="https://www.cnblogs.com/dwlsxj/p/delayedQueue.html">DelayQueueå»¶è¿Ÿé˜Ÿåˆ—åŸç†å‰–æ - BattleHeart - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://javaguide.cn/java/collection/delayqueue-source-code.html#delayqueue-%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E6%9C%89%E5%93%AA%E4%BA%9B">DelayQueue æºç åˆ†æ | JavaGuide</a></p><p><a href="https://juejin.cn/post/7127110677214429221">Java å»¶è¿Ÿé˜Ÿåˆ— DelayQueue çš„åŸç† - æ˜é‡‘ (juejin.cn)</a></p>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Springboot</tag>
      
      <tag>@Scheduled</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Qtæºç è§£æ: QCursor::pos()</title>
    <link href="/2024/03/13/Qt%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-QCursor-pos/"/>
    <url>/2024/03/13/Qt%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-QCursor-pos/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p><code>QCursor::pos()</code>çœ‹èµ·æ¥ç®€å•ï¼Œè¿”å›é¼ æ ‡åæ ‡</p><p>å…¶å®åœ¨é«˜DPIç¼©æ”¾ä¸‹ï¼Œè¿”å›çš„ç¡®æ˜¯é€»è¾‘åæ ‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œç®¡ä¸­çª¥è±¹</p><p>ç†è§£Qtæ˜¯å¦‚ä½•åœ¨é€»è¾‘åæ ‡ç³»ä¸ç‰©ç†åæ ‡ç³»ä¹‹é—´è½¬æ¢çš„</p><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QPoint <span class="hljs-title">QCursor::pos</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> QCursor::<span class="hljs-built_in">pos</span>(QGuiApplication::<span class="hljs-built_in">primaryScreen</span>());<br>&#125;<br><br><span class="hljs-function">QPoint <span class="hljs-title">QCursor::pos</span><span class="hljs-params">(<span class="hljs-type">const</span> QScreen *screen)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (screen) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-type">const</span> QPlatformCursor *cursor = screen-&gt;<span class="hljs-built_in">handle</span>()-&gt;<span class="hljs-built_in">cursor</span>()) &#123;<br>            <span class="hljs-type">const</span> QPlatformScreen *ps = screen-&gt;<span class="hljs-built_in">handle</span>();<br>            QPoint nativePos = cursor-&gt;<span class="hljs-built_in">pos</span>(); <span class="hljs-comment">//åŸç”Ÿç‰©ç†åæ ‡</span><br>            ps = ps-&gt;<span class="hljs-built_in">screenForPosition</span>(nativePos); <span class="hljs-comment">//å¯»æ‰¾nativePosæ‰€åœ¨Screen</span><br>            <span class="hljs-keyword">return</span> QHighDpi::<span class="hljs-built_in">fromNativePixels</span>(nativePos, ps-&gt;<span class="hljs-built_in">screen</span>()); <span class="hljs-comment">//</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> QGuiApplicationPrivate::lastCursorPosition.<span class="hljs-built_in">toPoint</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹<code>QCursor::pos()</code>çš„é€»è¾‘å•Š</p><p>æœ‰ä¸¤ä¸ªé‡è½½ï¼Œæ— å‚ç‰ˆæœ¬é»˜è®¤æŠŠä¸»æ˜¾ç¤ºå™¨ä¼ ç»™äº†æœ‰å‚ç‰ˆæœ¬</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç–‘æƒ‘ï¼Œè¯¶ï¼Œä¸ºä»€ä¹ˆéœ€è¦<code>QScreen</code>å‚æ•°å‘¢ï¼Œå…‰æ ‡åæ ‡å’Œå±å¹•æœ‰å…³å—</p><p>åˆ«æ€¥ï¼Œæ¥ç€å¾€ä¸‹çœ‹</p><p>é¦–å…ˆï¼Œè·å–äº†åŸç”Ÿå±å¹•æŒ‡é’ˆï¼ˆ<code>QPlatformScreen</code>ï¼‰ï¼Œç„¶åé€šè¿‡<code>QPlatformCursor</code>è·å–åˆ°äº†å…‰æ ‡çš„åŸç”Ÿç‰©ç†åæ ‡ï¼ˆ<code>nativePos</code>ï¼‰</p><p>æ¥ç€é€šè¿‡<code>ps = ps-&gt;screenForPosition(nativePos)</code>æ›´æ–°äº†å±å¹•æŒ‡é’ˆï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/*!</span><br><span class="hljs-comment">  Find the sibling screen corresponding to \a globalPos.</span><br><span class="hljs-comment">  Returns this screen if no suitable screen is found at the position.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-type">const</span> QPlatformScreen *<span class="hljs-title">QPlatformScreen::screenForPosition</span><span class="hljs-params">(<span class="hljs-type">const</span> QPoint &amp;point)</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">geometry</span>().<span class="hljs-built_in">contains</span>(point)) &#123;<br>        <span class="hljs-type">const</span> <span class="hljs-keyword">auto</span> screens = <span class="hljs-built_in">virtualSiblings</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> QPlatformScreen *screen : screens) &#123;<br>            <span class="hljs-keyword">if</span> (screen-&gt;<span class="hljs-built_in">geometry</span>().<span class="hljs-built_in">contains</span>(point))<br>                <span class="hljs-keyword">return</span> screen;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ³¨é‡Šå’Œä»£ç é‡Œéƒ½æåˆ°äº†ä¸€ä¸ªè¯ï¼š<code>sibling</code></p><p>æ¥çœ‹ä¸€ä¸‹Qtæ–‡æ¡£çš„è§£é‡Š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QList&lt;QScreen *&gt; <span class="hljs-title">QScreen::virtualSiblings</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"><span class="hljs-comment">//Get the screen&#x27;s virtual siblings.</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-comment">//The virtual siblings are the screen instances sharing the same virtual desktop. They share a common coordinate system, and windows can //freely be moved or positioned across them without having to be re-created.</span></span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œ<code>sibling screens</code>ä¹Ÿå°±æ˜¯ä¸€ä¸ªè™šæ‹Ÿæ¡Œé¢å†…çš„æ‰€æœ‰ç›¸é‚»æ˜¾ç¤ºå™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸<code>qApp-&gt;screens()</code>ç›¸ç­‰</p><p>å› æ­¤ï¼Œ<code>screenForPosition()</code>ä¼šéå†å±å¹•ï¼Œæ‰¾åˆ°é¼ æ ‡å…‰æ ‡æ‰€åœ¨çš„é‚£ä¸€å—</p><p>æ‰€ä»¥æˆ‘ä»¬ä¸å¿…çº ç»“ï¼Œä¸ºä»€ä¹ˆä¸€å¼€å§‹ä¼ å…¥çš„æ˜¯<code>primaryScreen()</code>ï¼Œä¼šä¸ä¼šä¸å‡†ç¡®</p><p>å…¶å®ä¼ å…¥ä»€ä¹ˆ<code>screen</code>éƒ½å¯ä»¥ï¼Œåªè¦åœ¨åŒä¸€ä¸ªè™šæ‹Ÿæ¡Œé¢å†…ï¼Œä¼šè‡ªè¡Œå®šä½</p><p>è¿™é‡Œä¼ å…¥ä¸€ä¸ªæŒ‡é’ˆï¼Œæ˜¯ä¸ºäº†å®šä½è™šæ‹Ÿæ¡Œé¢è€Œå·²</p><h4 id="more-more-moreï¼šQHighDpi-fromNativePixels"><a href="#more-more-moreï¼šQHighDpi-fromNativePixels" class="headerlink" title="more more moreï¼šQHighDpi::fromNativePixels"></a>more more moreï¼šQHighDpi::fromNativePixels</h4><p>é¡¾åæ€ä¹‰ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†ä»–å¯ä»¥ä»ç‰©ç†åæ ‡ï¼ˆåŸç”Ÿåƒç´ ï¼‰è½¬åŒ–ä¸ºé€»è¾‘åæ ‡</p><p>é‚£ä¹ˆç¨å¾®çœ‹ä¸€ä¸‹æºç å§</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span> C&gt;<br><span class="hljs-function">T <span class="hljs-title">fromNativePixels</span><span class="hljs-params">(<span class="hljs-type">const</span> T &amp;value, <span class="hljs-type">const</span> C *context)</span></span><br><span class="hljs-function"></span>&#123;<br>    QPoint nativePosition = <span class="hljs-built_in">position</span>(value); <span class="hljs-comment">//è½¬æ¢ä¸ºQPoint</span><br>    QHighDpiScaling::ScaleAndOrigin so = QHighDpiScaling::<span class="hljs-built_in">scaleAndOrigin</span>(context, &amp;nativePosition);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">scale</span>(value, <span class="hljs-built_in">qreal</span>(<span class="hljs-number">1</span>) / so.factor, so.origin);<br>&#125;<br></code></pre></td></tr></table></figure><p>OKï¼Œå¾ˆçŸ­ï¼Œå°±ä¸‰è¡Œï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>QHighDpiScaling::scaleAndOrigin</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QHighDpiScaling::ScaleAndOrigin <span class="hljs-title">QHighDpiScaling::scaleAndOrigin</span><span class="hljs-params">(<span class="hljs-type">const</span> QPlatformScreen *platformScreen, QPoint *nativePosition)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (!m_active)<br>        <span class="hljs-keyword">return</span> &#123; <span class="hljs-built_in">qreal</span>(<span class="hljs-number">1</span>), <span class="hljs-built_in">QPoint</span>() &#125;;<br>    <span class="hljs-keyword">if</span> (!platformScreen)<br>        <span class="hljs-keyword">return</span> &#123; m_factor, <span class="hljs-built_in">QPoint</span>() &#125;; <span class="hljs-comment">// the global factor</span><br>    <span class="hljs-type">const</span> QPlatformScreen *actualScreen = nativePosition ?<br>        platformScreen-&gt;<span class="hljs-built_in">screenForPosition</span>(*nativePosition) : platformScreen;<br>    <span class="hljs-keyword">return</span> &#123; m_factor * <span class="hljs-built_in">screenSubfactor</span>(actualScreen), actualScreen-&gt;<span class="hljs-built_in">geometry</span>().<span class="hljs-built_in">topLeft</span>() &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå†æ¬¡è°ƒç”¨<code>screenForPosition()</code>å®šä½äº†å…‰æ ‡æ‰€åœ¨å±å¹•ï¼Œéå¸¸ä¸¥è°¨</p><p>è¿”å›å€¼æœ‰ä¿©ï¼š</p><ul><li>è®¡ç®—ç¼©æ”¾æ¯”ï¼š<code>m_factor * screenSubfactor(actualScreen)</code>ï¼Œå·´æ‹‰å·´æ‹‰bombï¼Œå¯èƒ½æ˜¯å†…éƒ¨ç¼©æ”¾æ¯” * å¤–éƒ¨ç¼©æ”¾æ¯”ï¼Ÿä¸ç®¡äº†</li><li>è®¡ç®—å…‰æ ‡æ‰€åœ¨å±å¹•çš„å·¦ä¸Šè§’ç‰©ç†åæ ‡ï¼š<code>actualScreen-&gt;geometry().topLeft()</code></li></ul><p>è¿™ç¬¬äºŒä¸ªå°±æ˜¯é‡ç‚¹äº†ï¼Œè·Ÿæˆ‘ä»¬è‡ªè¡Œè®¡ç®—çš„æ–¹æ³•æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œä¸è¿‡ä»–è¿™é‡Œè·å–åˆ°çš„æ˜¯çœŸçœŸæ­£æ­£çš„ç‰©ç†åæ ‡</p><p>ç„¶åè°ƒç”¨<code>scale(value, qreal(1) / so.factor, so.origin)</code>è¿›è¡Œæœ€åçš„è®¡ç®—</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">inline</span> QPoint <span class="hljs-title">scale</span><span class="hljs-params">(<span class="hljs-type">const</span> QPoint &amp;pos, qreal scaleFactor, QPoint origin = QPoint(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>))</span></span><br><span class="hljs-function"></span>&#123;<br>     <span class="hljs-keyword">return</span> (pos - origin) * scaleFactor + origin;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆå‡å»å·¦ä¸Šè§’çš„åæ ‡ï¼Œå½’ä¸€åŒ–ä¸ºï¼ˆ0,0ï¼‰ï¼Œç„¶åç›´æ¥ä¹˜é™¤ç¼©æ”¾æ¯”ï¼Œå†æŠŠå·¦ä¸Šè§’åŠ å›æ¥ hhhhhh</p><p>å•Šï¼Œå“ˆï¼Œå•Šå“ˆå“ˆå“ˆ</p><h2 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h2><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://codebrowser.dev/qt5/qtbase/src/gui/kernel/qhighdpiscaling_p.h.html#_ZN8QHighDpi16fromNativePixelsERKT_PKT0_">qtbase&#x2F;src&#x2F;gui&#x2F;kernel&#x2F;qhighdpiscaling_p.h] - Codebrowser</a></p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>æºç è§£æ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Qt é«˜DPIç¼©æ”¾ï¼ˆé«˜åˆ†å±é€‚é…ï¼‰æŠ€æœ¯ç®€æ</title>
    <link href="/2024/03/12/Qt-%E9%AB%98DPI%E7%BC%A9%E6%94%BE%EF%BC%88%E9%AB%98%E5%88%86%E5%B1%8F%E9%80%82%E9%85%8D%EF%BC%89%E6%8A%80%E6%9C%AF%E7%AE%80%E6%9E%90/"/>
    <url>/2024/03/12/Qt-%E9%AB%98DPI%E7%BC%A9%E6%94%BE%EF%BC%88%E9%AB%98%E5%88%86%E5%B1%8F%E9%80%82%E9%85%8D%EF%BC%89%E6%8A%80%E6%9C%AF%E7%AE%80%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œéƒ½å·²ç»2024å¹´äº†ï¼Œä¸ä¼šè¿˜æœ‰äººåœ¨ç”¨<code>1080P</code>æ˜¾ç¤ºå±å§ï¼ˆæ²¡é”™å°±æ˜¯æˆ‘ï¼‰</p><p>åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œ<code>1080P</code>æ˜¾ç¤ºå±ï¼ˆ1920 px * 1080 pxï¼‰æ˜¯ä¸šå†…è®¾è®¡UIçš„å‚è€ƒæ ‡å‡†ä¸ç›®æ ‡</p><p>ä½†æ˜¯ï¼Œå½“é«˜åˆ†è¾¨ç‡å±å¹•ï¼ˆ2Kã€4Kï¼‰é€æ¸æ™®åŠä¹‹åï¼Œäººä»¬å‘ç°ï¼ŒåŸå…ˆçš„UIè®¾è®¡åœ¨è¿™äº›å±å¹•ä¸Šæ˜¾å¾—å¾ˆå°</p><p>ä¸éš¾ç†è§£ï¼Œè¿™æ˜¯å› ä¸ºé«˜åˆ†å±åœ¨ä¿æŒå°ºå¯¸ç›¸å½“çš„æƒ…å†µä¸‹ï¼Œå¡ä¸‹äº†æ›´å¤šçš„åƒç´ ï¼Œå¢åŠ äº†åƒç´ å¯†åº¦ï¼Œæˆ–è€…è¯´é«˜DPIï¼ˆDot Per Inchï¼‰</p><p>æ¯è‹±å¯¸çš„åƒç´ æ•°é‡å¢åŠ äº†ï¼Œç›¸åŒåƒç´ æ‰€å é¢ç§¯å‡å°äº†ï¼Œé‚£ä¹ˆä»¥åƒç´ ä¸ºå•ä½çš„UIè®¾è®¡ï¼Œè‡ªç„¶æ˜¾å¾—â€œæ›´å°â€</p><p><img src="/img/image-20240312163134690.png" alt="1080Pæ­£å¸¸æ˜¾ç¤ºæ•ˆæœ"></p><p><img src="/img/image-20240312162917916.png" alt="4Kæ˜¾ç¤ºå™¨æ•ˆæœ"></p><p>å¯ä»¥çœ‹åˆ°4Kæ˜¾ç¤ºå™¨ä¸‹ï¼Œæˆ‘ä»¬åŸæœ¬å®Œç¾çš„UIè®¾è®¡æ¯”ä¾‹å…¨éƒ¨è¢«æ‰“ä¹±ï¼Œæ˜¾å¾—åˆå°ï¼ŒåˆæŒ¤ï¼Œåˆä¸‘</p><p>è¿™ï¼Œè¿™è°å®¶çš„è½¯ä»¶å•Šï¼Œæˆ‘ï¼Œæˆ‘ä¸è®¤è¯†ä½ </p><h2 id="æ€åŠ"><a href="#æ€åŠ" class="headerlink" title="æ€åŠ"></a>æ€åŠ</h2><p>é‚£æ€ä¹ˆåŠå‘¢ï¼Œæœ€å®¹æ˜“æƒ³åˆ°çš„åŠæ³•æ˜¯å¯¹UIè¿›è¡Œç­‰æ¯”ç¼©æ”¾</p><p><strong>æ ‡å‡†æ˜¾ç¤ºå¯†åº¦</strong>ï¼š<code>96 DPI</code>å·²ç»è¢«Windowsæ“ä½œç³»ç»Ÿä½œä¸ºä¼ ç»Ÿçš„æ˜¾ç¤ºæ ‡å‡†é‡‡ç”¨ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨é»˜è®¤çš„100%ç¼©æ”¾è®¾ç½®ä¸‹ï¼Œç³»ç»Ÿé¢„æœŸæ˜¾ç¤ºå™¨èƒ½å¤Ÿåœ¨æ¯è‹±å¯¸çš„é•¿åº¦ä¸Šæ˜¾ç¤º96ä¸ªåƒç´ ç‚¹ã€‚è¿™ä¸€æ ‡å‡†ç¡®ä¿äº†åœ¨å¼€å‘å’Œè®¾è®¡è½¯ä»¶åº”ç”¨æ—¶ï¼Œç•Œé¢å…ƒç´ ï¼ˆå¦‚æ–‡å­—ã€å›¾æ ‡ï¼‰çš„å¤§å°èƒ½å¤Ÿåœ¨ä¸åŒçš„æ˜¾ç¤ºå™¨ä¸Šä¿æŒç›¸å¯¹ä¸€è‡´æ€§ã€‚</p><p>æ‰€ä»¥Windowsç³»ç»Ÿçš„<strong>é€»è¾‘DPI</strong>ä¸€èˆ¬éƒ½æ˜¯96ï¼ˆç¼©æ”¾100%æƒ…å†µä¸‹ï¼‰ï¼Œä½†æ˜¯<strong>ç‰©ç†DPI</strong>é€šå¸¸æ¯”è¿™ä¸ªè¦å¤§ï¼Œä¾‹å¦‚æˆ‘æ‰‹ä¸Šçš„è¿™å°1080Pæ˜¾ç¤ºå™¨çš„<strong>ç‰©ç†DPI</strong>æ˜¯ï¼š127.628</p><p>åœ¨DPIæ’å®šçš„æƒ…å†µä¸‹ï¼Œå¢åŠ åˆ†è¾¨ç‡ï¼Œé‚£ä¹ˆå±å¹•å°ºå¯¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯æ‰€æœ‰è½¯ä»¶UIç‰©ç†å°ºå¯¸ä¸å˜</p><p>ä½†æ˜¯å¯¹äºç°ä»£æ˜¾ç¤ºå™¨è€Œè¨€ï¼Œé€šå¸¸æ˜¯å¢åŠ åƒç´ å¯†åº¦ï¼Œä¾‹å¦‚æˆ‘æ‰‹å¤´è¿™å°4Kæ˜¾ç¤ºå™¨çš„<strong>ç‰©ç†DPI</strong>æ˜¯ï¼š161.962</p><p>é‚£ä¹ˆåœ¨ç›¸åŒé•¿åº¦ä¸Šï¼Œä»–ä¼šæ¯”ä¸€èˆ¬çš„96 DPIä½åˆ†è¾¨å±ï¼Œæ˜¾ç¤ºæ›´å¤šåƒç´ </p><h3 id="é€»è¾‘DPI-vs-ç‰©ç†DPI"><a href="#é€»è¾‘DPI-vs-ç‰©ç†DPI" class="headerlink" title="é€»è¾‘DPI vs ç‰©ç†DPI"></a>é€»è¾‘DPI vs ç‰©ç†DPI</h3><p>æˆ‘ä»¬åˆšåˆšè°ˆåˆ°äº†Windowsä¸­çš„<strong>é€»è¾‘DPI</strong>ä¸<strong>ç‰©ç†DPI</strong>ï¼Œé‚£ä¹ˆè¿™ä¿©ç©¶ç«Ÿæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢</p><p>ç‰©ç†DPIå¥½ç†è§£ï¼Œå°±æ˜¯å±å¹•è®¾å¤‡çœŸå®çš„DPIï¼ˆå±å¹•åƒç´ æ•° &#x2F; å±å¹•å°ºå¯¸ï¼‰ï¼Œå¯¹äºä¸€å°ç‰¹å®šè®¾å¤‡ï¼Œä¸ä¼šå‘ç”Ÿå˜åŒ–</p><p>é€»è¾‘DPIå¬èµ·æ¥æ¯”è¾ƒè¿·æƒ‘ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£ä¸ºWindowsæŒ‰ç…§ä»€ä¹ˆæ ·çš„æ¯”ä¾‹æ¥ç»˜åˆ¶UI</p><p>æˆ–è€…å¸Œæœ›è½¯ä»¶æŒ‰ç…§ä»€ä¹ˆæ ·çš„DPIæ¥è§„åˆ’è‡ªå·±çš„UI</p><p>è¿™ä¸ªæ•°å€¼ä¸ç‰©ç†DPIæ— å…³ï¼Œåœ¨Windowsç¼©æ”¾100%æƒ…å†µä¸‹ï¼Œé€»è¾‘DPIé€šå¸¸æ’ç­‰äº96</p><p><strong>è€Œä¸”è¿™ä¸ªå€¼ï¼ˆé€»è¾‘DPIï¼‰ä¸ 96 çš„æ¯”å€¼å°±ç­‰äºWindowsç¼©æ”¾æ¯”</strong>ï¼š<code>Scale = é€»è¾‘DPI / 96</code></p><p>å¦‚æœç¼©æ”¾æ¯”ä¸º150%ï¼Œé‚£ä¹ˆé€»è¾‘DPIä¸º144ï¼ŒWindowsä»¥1.5å€çš„åƒç´ æ•°æ¥æ¸²æŸ“UI</p><p>é€šè¿‡æ¨¡æ‹Ÿä¸€ä¸ªè™šå‡çš„DPIï¼ŒWindowså°±å¯ä»¥æ¬ºéª—è½¯ä»¶ï¼Œä¼ªé€ å¤–ç•Œçš„DPIï¼Œä»¥å®ç°æ§åˆ¶ç¬¬ä¸‰æ–¹è½¯ä»¶çš„UIç¼©æ”¾</p><p>å…¶å®è¿™é‡Œæœ‰ä¸‰ç§æƒ…å†µï¼š</p><ul><li>ç¬¬ä¸€ç§ï¼Œè½¯ä»¶ä»€ä¹ˆéƒ½ä¸åšï¼Œä¹Ÿä¸ç®¡å¤–ç•Œçš„DPIï¼Œé‚£ä¹ˆä¸ç®¡Windowsç¼©æ”¾æ¯”å¦‚ä½•å˜åŒ–ï¼Œè½¯ä»¶çª—å£çš„å¤§å°ä¿æŒæ’å®šï¼ˆä½†æ˜¯å¦‚æœå­—ä½“çš„å•ä½æ˜¯ptï¼Œåˆ™å­—ä½“ä¼šå˜åŒ–ï¼‰</li><li>ç¬¬äºŒç§ï¼Œè½¯ä»¶ä»€ä¹ˆéƒ½ä¸åšï¼Œä½†æ˜¯å§”æ‰˜ç»™Windowsè¿›è¡Œç¼©æ”¾ç®¡ç†ï¼ˆé…ç½®<code>dpiAwareness</code>ï¼‰ï¼Œé‚£ä¹ˆWindowså°±ä¼šæ¥ç®¡ï¼Œè¿›è¡Œç¼©æ”¾</li><li>ç¬¬ä¸‰ç§ï¼Œè½¯ä»¶è¯»å–å¤–éƒ¨é€»è¾‘DPIï¼ˆå¦‚æœæ˜¯ç‰©ç†DPIçš„è¯ï¼Œä¹Ÿè¡Œï¼Œå°±æ˜¯æ’å®šå¤§å°äº†ï¼‰ï¼Œé€šè¿‡å…¶ä¸96çš„æ¯”å€¼ï¼Œè‡ªè¡Œç¼©æ”¾UIï¼Œä¾‹å¦‚ <code>width *= scale;</code>ï¼Œé‚£ä¹ˆæ˜¾ç¤ºæ•ˆæœæœ€å¥½ï¼Œä½†æ˜¯ç°å¸¸éº»çƒ¦</li></ul><p>å¯¹äºç¬¬äºŒå’Œç¬¬ä¸‰ç§æƒ…å†µï¼Œè¢«Windowsç¼©æ”¾æ¯”æ‰€å½±å“çš„é€»è¾‘DPIå°±å¯ä»¥å‘æŒ¥ä½œç”¨ï¼Œè¿™æ ·ä¹Ÿæœ€ç¬¦åˆç”¨æˆ·éœ€è¦</p><p>æ‰€ä»¥å…¶å®å¯¹äºè½¯ä»¶å¼€å‘è€…ï¼Œå¦‚æœè¦è‡ªè¡Œç¼©æ”¾UIçš„è¯ï¼Œä¸ç”¨å•ç‹¬è€ƒè™‘é€»è¾‘DPIçš„å®é™…å«ä¹‰ï¼Œåªè¦å…³æ³¨å…¶ä¸96çš„æ¯”å€¼ï¼ˆç¼©æ”¾æ¯”ï¼‰å³å¯</p><h2 id="WindowsåŸç”ŸDPIæ„ŸçŸ¥-vs-Qté«˜DPIç¼©æ”¾"><a href="#WindowsåŸç”ŸDPIæ„ŸçŸ¥-vs-Qté«˜DPIç¼©æ”¾" class="headerlink" title="WindowsåŸç”ŸDPIæ„ŸçŸ¥ vs Qté«˜DPIç¼©æ”¾"></a>WindowsåŸç”ŸDPIæ„ŸçŸ¥ vs Qté«˜DPIç¼©æ”¾</h2><h3 id="Windows-DPIæ„ŸçŸ¥"><a href="#Windows-DPIæ„ŸçŸ¥" class="headerlink" title="Windows DPIæ„ŸçŸ¥"></a>Windows DPIæ„ŸçŸ¥</h3><p>æœ€ç®€å•çš„æ–¹æ³•æ˜¯å§”æ‰˜ç»™Windowsè¿›è¡Œå¤„ç†</p><p>å¯ä»¥è°ƒç”¨ä»¥ä¸‹API</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ShellScalingAPI.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(lib, <span class="hljs-string">&quot;Shcore.lib&quot;</span>)</span><br><br>HRESULT hr = <span class="hljs-built_in">SetProcessDpiAwareness</span>(PROCESS_SYSTEM_DPI_AWARE);<br></code></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨qt.confï¼Œåœ¨èµ„æºqrcé‡Œæ·»åŠ ï¼Œ<code>:/qt/etc/qt.conf</code>, qt.confæ–‡ä»¶å†…å®¹ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs conf">[Platforms]<br>WindowsArguments = dpiawareness=1<br></code></pre></td></tr></table></figure><p>4Kæ˜¾ç¤ºå™¨æ•ˆæœå¦‚å›¾ï¼šï¼ˆè¾¹ç¼˜çš„ç°è‰²æ˜¯æ¡Œé¢èƒŒæ™¯ï¼‰</p><p><img src="/img/image-20240312162452700.png" alt="WindowsåŸç”ŸDPIæ„ŸçŸ¥"></p><p>çœ‹èµ·æ¥æœ‰ç‚¹æ¨¡ç³Šï¼Œä½†æ˜¯å„ç§åŠŸèƒ½éƒ½æ­£å¸¸ï¼Œæ‡’äººç¦åˆ©ï¼</p><h3 id="Qté«˜DPIç¼©æ”¾"><a href="#Qté«˜DPIç¼©æ”¾" class="headerlink" title="Qté«˜DPIç¼©æ”¾"></a>Qté«˜DPIç¼©æ”¾</h3><p>Qtä½œä¸ºä¸€ä¸ªè·¨å¹³å°çš„æ¡Œé¢æ¡†æ¶ï¼Œè‡ªç„¶ä¸å¯é¿å…è¦è§£å†³é«˜åˆ†å±é€‚é…çš„é—®é¢˜</p><p>è¿‘å‡ å¹´æ¥ï¼Œç‰¹åˆ«æ˜¯Qt5.15ç‰ˆæœ¬ä¹‹åï¼Œå¯¹é«˜åˆ†å±çš„æ”¯æŒå˜å¾—æ›´åŠ èƒ½ç”¨äº†</p><p>æ¯”å¦‚ï¼Œè¿™ä¸€è¡Œå¯ä»¥è®©Qtæ”¯æŒéæ•´å€æ•°çš„ç¼©æ”¾æ¯”ï¼Œ1.25 1.5ç­‰ï¼Œï¼ˆä»¥å‰åªèƒ½1x 2xåœ°ç¼©æ”¾ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++">QApplication::<span class="hljs-built_in">setHighDpiScaleFactorRoundingPolicy</span>(Qt::HighDpiScaleFactorRoundingPolicy::PassThrough);<br></code></pre></td></tr></table></figure><p>Qtå¼€å¯é«˜DPIç¼©æ”¾åªéœ€è¦ä¸€è¡Œï¼š(ä½†æ˜¯ä¸ºäº†æ›´åŠ å¥½ç”¨ï¼Œè¯·åŠ ä¸Šä¸Šé¢é‚£è¡Œâ†‘)ï¼Œï¼ˆå¬è¯´åœ¨Qt6ä¸­æ˜¯é»˜è®¤å¼€å¯çš„ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++">QCoreApplication::<span class="hljs-built_in">setAttribute</span>(Qt::AA_EnableHighDpiScaling, <span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæ‰€ä»¥é’ˆå¯¹é«˜DPIç¼©æ”¾ç­–ç•¥çš„è°ƒæ•´è¯·åœ¨<code>QApplication</code>æ„é€ ä¹‹å‰å®Œæˆ</p><p>å½“å¼€å¯ç¼©æ”¾æ—¶ï¼Œå›¾ç‰‡å’Œå›¾æ ‡å¯èƒ½ä¼šå˜å¾—æ¨¡ç³Šï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¼€å¯Qtå¯¹<strong>é«˜åˆ†è¾¨ç‡ç‰ˆæœ¬pixmap</strong>ï¼ˆHigh resolution versions of pixmapsï¼‰çš„æ”¯æŒï¼Œç„¶åæŒ‰ç…§ç‰¹å®šç­–ç•¥æä¾›å›¾ç‰‡èµ„æºï¼ˆç±»ä¼¼äº<code>logo@2x.png</code>ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">QCoreApplication::<span class="hljs-built_in">setAttribute</span>(Qt::AA_UseHighDpiPixmaps, <span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><p>Qt å°†åœ¨è¿è¡Œæ—¶è‡ªåŠ¨é€‰æ‹©ç›®æ ‡æ˜¾ç¤ºçš„æœ€ä½³è¡¨ç¤ºå½¢å¼ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://doc.qt.io/qt-6/qicon.html#high-dpi-icons">High-DPI-Icons</a></p><p>æ‰€ä»¥ç»¼åˆèµ·æ¥å°±æ˜¯ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs C++">QCoreApplication::<span class="hljs-built_in">setAttribute</span>(Qt::AA_EnableHighDpiScaling, <span class="hljs-literal">true</span>);<br>QCoreApplication::<span class="hljs-built_in">setAttribute</span>(Qt::AA_UseHighDpiPixmaps, <span class="hljs-literal">true</span>);<br>QApplication::<span class="hljs-built_in">setHighDpiScaleFactorRoundingPolicy</span>(Qt::HighDpiScaleFactorRoundingPolicy::PassThrough);<br></code></pre></td></tr></table></figure><p><img src="/img/image-20240312174416634.png" alt="Qté«˜DPIç¼©æ”¾"></p><p>å¯ä»¥çœ‹åˆ°å­—ä½“æ›´åŠ é”åˆ©</p><h3 id="Who-is-better"><a href="#Who-is-better" class="headerlink" title="Who is better"></a>Who is better</h3><p>é‚£ä¹ˆåˆ°åº•é€‰å“ªä¸ªå‘¢ï¼Ÿ</p><p>åªèƒ½è¯´å„æœ‰åƒç§‹</p><ul><li>Windows DPIæ„ŸçŸ¥å‘ç”Ÿåœ¨ç³»ç»Ÿå±‚ï¼Œæ•…å…¼å®¹æ€§æœ€å¥½ï¼ŒBugæ¯”è¾ƒå°‘ï¼Œä½†æ˜¯æ˜¾ç¤ºæ•ˆæœä¸å¤Ÿå¥½ï¼Œå› ä¸ºæ˜¯ç›´æ¥æ‹‰ä¼¸ï¼ˆç±»ä¼¼äºå›¾ç‰‡ç¼©æ”¾ï¼‰</li><li>è€ŒQtæœ¬èº«å°±æ˜¯UIæ¡†æ¶ï¼Œç¼©æ”¾æ˜¯åœ¨æ¸²æŸ“å±‚é¢ä¸Šè¿›è¡Œçš„ï¼Œå›¾åƒå’Œæ–‡æœ¬å¯ä»¥ä¿æŒå…¶æ¸…æ™°åº¦ï¼Œä¸ä¼šå‡ºç°åƒç´ åŒ–æˆ–æ¨¡ç³Šï¼ˆä½†æ˜¯è¾¹ç¼˜å¯èƒ½å‡ºç°å¥‡æ€ªçš„çº¿ï¼Œä¸çŸ¥é“Qt6è§£å†³æ²¡ï¼‰</li></ul><p>é‚£ä¹ˆï¼ŒQtèƒœå‡ºï¼Ÿ</p><p>ä¸ï¼Œäº‹æƒ…è¿œè¿œæ²¡æœ‰è¿™ä¹ˆç®€å•</p><h3 id="Qt-é«˜DPIç¼©æ”¾çš„åŸç†"><a href="#Qt-é«˜DPIç¼©æ”¾çš„åŸç†" class="headerlink" title="Qt é«˜DPIç¼©æ”¾çš„åŸç†"></a>Qt é«˜DPIç¼©æ”¾çš„åŸç†</h3><p>Qtå†…éƒ¨é‡‡ç”¨äº†<strong>é€»è¾‘åæ ‡ç³»ç»Ÿ</strong>ï¼šä½¿ç”¨é€»è¾‘åæ ‡æ¥æè¿°ç•Œé¢å…ƒç´ ï¼Œè¿™äº›åæ ‡æ˜¯ç›¸å¯¹å•ä½ï¼Œä¸å±å¹•çš„å®é™…ç‰©ç†åƒç´ ç‚¹æ•°ç‹¬ç«‹ï¼Œè€Œåœ¨æ¸²æŸ“æ—¶è‡ªåŠ¨ç¼©æ”¾è½¬æ¢ä¸ºç‰©ç†åæ ‡</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é’ˆå¯¹96 DPIï¼Œ1080Pæ˜¾ç¤ºå™¨è®¾è®¡çš„ä»¥<code>px</code>ä¸ºå•ä½çš„UIå¸ƒå±€æ— éœ€æ›´æ”¹ï¼Œæˆ‘ä»¬è¿˜æ˜¯å‡è®¾ç¨‹åºè¿è¡Œåœ¨è¿™æ ·ä¸€å—æ ‡å‡†æ˜¾ç¤ºå™¨ä¸Šï¼ŒQtä¼šè‡ªåŠ¨å¤„ç†ç¼©æ”¾</p><h3 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h3><p>æƒ³æ³•å¾ˆç¾å¥½ï¼Œä½†æ˜¯ç»“æœå‘¢</p><p>ç»“æœæ˜¯<code>Windows API</code>é‡‡ç”¨çš„æ˜¯ç‰©ç†åæ ‡ï¼ˆè®¾å¤‡ç›¸å…³åæ ‡ï¼‰ï¼Œè€ŒQtå†…éƒ¨é‡‡ç”¨çš„æ˜¯é€»è¾‘åæ ‡ï¼ˆè®¾å¤‡æ— å…³åæ ‡ï¼‰ï¼ˆæ‰€æœ‰å…¬å¼€å‡½æ•°éƒ½è¿”å›é€»è¾‘åæ ‡ï¼Œå¦‚<code>QCursor::pos()</code>ï¼‰</p><p>è¿™åè€Œå¢åŠ äº†å¤æ‚æ€§ï¼Œæˆ‘ä»¬è°ƒç”¨<code>Windows API</code>è·å¾—çš„åæ ‡è¦å…ˆè½¬æ¢ä¸ºQtå†…éƒ¨çš„é€»è¾‘åæ ‡æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œå¦åˆ™å°±å…¨ä¹±äº†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">Widget::nativeEvent</span><span class="hljs-params">(<span class="hljs-type">const</span> QByteArray&amp; eventType, <span class="hljs-type">void</span>* message, <span class="hljs-type">long</span>* result)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">Q_UNUSED</span>(eventType);<br>    MSG* msg = (MSG*)message;<br>    <span class="hljs-keyword">switch</span> (msg-&gt;message) &#123;<br>    <span class="hljs-keyword">case</span> WM_NCHITTEST:<br>        <span class="hljs-type">int</span> winX = <span class="hljs-built_in">GET_X_LPARAM</span>(msg-&gt;lParam);<br>        <span class="hljs-type">int</span> winY = <span class="hljs-built_in">GET_Y_LPARAM</span>(msg-&gt;lParam);<br>...<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œåœ¨åŸç”Ÿäº‹ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¼šæ¥æ”¶åˆ°<code>Windows</code>ä¼ é€’æ¥çš„å‚æ•°</p><p>è¿™äº›å‚æ•°ä¸­çš„åæ ‡ï¼Œä¸€å®šæ˜¯ç‰©ç†åæ ‡</p><p>æˆ‘ä»¬éœ€è¦å°†å…¶è½¬æ¢ä¸º<code>Qt</code>å†…éƒ¨é€»è¾‘åæ ‡ï¼Œæ‰èƒ½ç»§ç»­ä½¿ç”¨</p><p>è¿™é‡Œä¹Ÿæœ‰ä¸¤ç§æƒ…å†µ</p><ol><li>å¦‚æœä½ åªæœ‰ä¸€å—æ˜¾ç¤ºå™¨ï¼Œé‚£ä¹ˆå¾ˆç®€å•ï¼Œç¼©æ”¾ä¸­å¿ƒå°±æ˜¯å·¦ä¸Šè§’ï¼ˆ0,0ï¼‰ï¼Œç›´æ¥<code>winX / scale</code>å³å¯</li><li>å¦‚æœä½ æœ‰å¤šå—æ˜¾ç¤ºå™¨ï¼Œè€Œä¸”<code>DPI</code>è¿˜ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆé—®é¢˜å°±å¤§å‘äº†</li></ol><p>å‡å¦‚ä½ çš„çª—å£åˆæ­£å¥½ä¸åœ¨ä¸»æ˜¾ç¤ºå™¨ä¸Šï¼Œé‚£ä¹ˆè¯¥æ˜¾ç¤ºå™¨çš„å·¦ä¸Šè§’å°±ä¸æ˜¯ï¼ˆ0,0ï¼‰äº†ï¼Œå› ä¸ºæ˜¾ç¤ºå™¨ä¸Šçš„åæ ‡æ˜¯å”¯ä¸€çš„</p><p>è¿™ä¸ªæ—¶å€™çš„è½¬æ¢ç¨å¾®éº»çƒ¦ä¸€ç‚¹</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦è·å–Qtç‰©ç†åƒç´ å’Œé€»è¾‘åƒç´ çš„æ¯”å€¼ï¼Œä¹Ÿå°±æ˜¯<code>devicePixelRatio</code>ï¼Œä¸€èˆ¬ç­‰äº<code>Windows</code>ç¼©æ”¾æ¯”</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">qreal <span class="hljs-title">Util::devicePixelRatio</span><span class="hljs-params">(QWidget* widget)</span></span><br><span class="hljs-function"></span>&#123;<br>    qreal dprScale = <span class="hljs-number">1.0</span>;<br>    QScreen *screen = QGuiApplication::<span class="hljs-built_in">screenAt</span>(widget-&gt;<span class="hljs-built_in">pos</span>());<br>    <span class="hljs-keyword">if</span> (screen != <span class="hljs-literal">nullptr</span>) &#123;<br>        dprScale = screen-&gt;<span class="hljs-built_in">devicePixelRatio</span>(); <span class="hljs-comment">//ç‰©ç†åƒç´ /é€»è¾‘åƒç´ ï¼Œä¹Ÿå°±æ˜¯Windowsç¼©æ”¾æ¯”</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// åœ¨å±å¹•ä¹‹é—´æ‹–åŠ¨æ—¶ï¼Œä¼šæœ‰çŸ­æš‚çš„nullptrçš„æƒ…å†µï¼</span><br>        dprScale = QGuiApplication::<span class="hljs-built_in">primaryScreen</span>()-&gt;<span class="hljs-built_in">devicePixelRatio</span>();<br>    &#125;<br>    <span class="hljs-keyword">return</span> dprScale;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¦æ³¨æ„ï¼Œåœ¨å±å¹•ä¹‹é—´æ‹–åŠ¨æ—¶ï¼Œä¼šæœ‰çŸ­æš‚çš„<code>nullptr</code>çš„æƒ…å†µï¼Œæˆ‘ä»¬è¦å¤„ç†è¿™ç§æƒ…å†µï¼Œèµ‹äºˆé»˜è®¤å€¼ï¼Œå¦åˆ™å°±ä¼šç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œç„¶åå´©æºƒï¼ˆC++åŸºæ“ï¼‰</p><p>ç„¶åï¼Œæˆ‘ä»¬è¦åŸºäºç¼©æ”¾æ¯”è¿›è¡Œè®¡ç®—</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-type">const</span> <span class="hljs-type">float</span> DPR = Util::<span class="hljs-built_in">devicePixelRatio</span>(<span class="hljs-keyword">this</span>); <span class="hljs-comment">//like 1.25 1.5 1.75 2.0</span><br><span class="hljs-comment">// è·å–å±å¹•çš„å‡ ä½•ä¿¡æ¯</span><br>QScreen *screen = QGuiApplication::<span class="hljs-built_in">screenAt</span>(<span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">pos</span>());<br>QRect screenGeometry = screen-&gt;<span class="hljs-built_in">geometry</span>(); <span class="hljs-comment">//logical!</span><br><span class="hljs-comment">// è½¬æ¢ç‰©ç†åæ ‡ä¸ºQtçš„é€»è¾‘åæ ‡</span><br>QPoint logicalPos;<br>logicalPos = (<span class="hljs-built_in">QPoint</span>(winX, winY) - screenGeometry.<span class="hljs-built_in">topLeft</span>()) / DPR;<br>logicalPos += screenGeometry.<span class="hljs-built_in">topLeft</span>();<br></code></pre></td></tr></table></figure><p>å¤§è‡´æ€æƒ³å°±æ˜¯ï¼Œå°†ç‰©ç†åæ ‡å‡å»è¯¥æ˜¾ç¤ºå™¨å·¦ä¸Šè§’åæ ‡ï¼Œå‡è£…è‡ªå·±æ˜¯ä¸»æ˜¾ç¤ºå™¨ï¼Œå·¦ä¸Šè§’ä¸ºï¼ˆ0,0ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥è¿›è¡Œç®€å•ä¹˜é™¤ç¼©æ”¾äº†</p><p>ç¼©æ”¾å®Œæ¯•åï¼Œå†æŠŠåˆšåˆšå‡å»çš„åç§»é‡åŠ å›æ¥å³å¯å¾—åˆ°Qtçš„é€»è¾‘åæ ‡</p><h4 id="çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ"><a href="#çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ" class="headerlink" title="çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ"></a>çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ</h4><p>è¿˜è®°å¾—æˆ‘è¯´è¿‡ä»€ä¹ˆå—</p><blockquote><p>Qtå†…éƒ¨é‡‡ç”¨çš„æ˜¯é€»è¾‘åæ ‡</p></blockquote><p>é‚£ä¹ˆï¼Œ<code>screen-&gt;geometry()</code>ä¸ä¹Ÿå°±æ˜¯é€»è¾‘åæ ‡å—ï¼Ÿ</p><p>åœ¨å¤šæ˜¾ç¤ºå™¨æƒ…å†µä¸‹ï¼Œå‡è®¾ç°åœ¨çš„<code>screen</code>ä¸æ˜¯ä¸»å±å¹•ï¼Œé‚£ä¹ˆ<code>screenGeometry.topLeft()</code>å°±æœ‰å¯èƒ½ä¸ç‰©ç†åæ ‡ä¸æƒ³ç­‰</p><p>é‚£ä¹ˆä¸€ä¸ªç‰©ç†åæ ‡ï¼ˆ<code>QPoint(winX, winY)</code>ï¼‰å‡å»ä¸€ä¸ªé€»è¾‘åæ ‡ï¼ˆ<code>screenGeometry.topLeft()</code>ï¼‰ï¼Œç»“æœæ˜¯æ˜¾è€Œæ˜“è§çš„</p><p>å‡å¦‚ä¸»å±å¹•ï¼ˆæˆ–å‰å‡ å—å±å¹•ï¼‰çš„<code>Windows</code>ç¼©æ”¾ä¸æ˜¯<code>100%</code>ï¼Œå°±ä¼šçˆ†ç‚¸ï¼ˆå‡å¦‚é€»è¾‘åæ ‡è¿ç»­ï¼‰</p><h4 id="åƒµå±€"><a href="#åƒµå±€" class="headerlink" title="åƒµå±€"></a>åƒµå±€</h4><p>é‚£ä¹ˆæ—¢ç„¶Qtå†…éƒ¨å‡½æ•°è¿”å›çš„éƒ½æ˜¯é€»è¾‘åæ ‡ï¼Œè‡ªç„¶ä¸å¯èƒ½æ‰¾åˆ°ä¸€ä¸ªèƒ½å°†é€»è¾‘åæ ‡è½¬æ¢ç‰©ç†åæ ‡çš„å‡½æ•°äº†</p><p>é‚£ä¹ˆä¸æ˜¯æ­»é”äº†å˜›</p><p>è¦ä¸æˆ‘ä»¬å†çœ‹ä¸€çœ¼<a href="https://doc.qt.io/qt-6/highdpi.html#dprgadget">å®˜æ–¹æ–‡æ¡£</a>å§</p><p><img src="/img/image-20240313093044936.png" alt="DprGadget"></p><p>è¯¶ï¼Œ<code>Qt6</code>å±…ç„¶æ¯”<code>Qt5</code>å¤šå‡ºä¸ªå°å·¥å…·ï¼ˆ<a href="https://github.com/qt/qtbase/blob/885aba7ffdfaf410f16364f315411cf8d77da38a/tests/manual/highdpi/dprgadget/main.cpp#L172">DprGadget</a>ï¼‰ï¼Œè²Œä¼¼æ˜¯ç”¨äºé«˜DPI Debugç”¨çš„ï¼Œçœ‹åˆ°å‡ ä¸ªNativeå­—æ ·ï¼Œè®©æˆ‘æ‰’ä¸€æ‰’ä½ ç”¨äº†ä»€ä¹ˆç¥å¥‡å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++">QPlatformWindow *platformWindow = <span class="hljs-built_in">windowHandle</span>()-&gt;<span class="hljs-built_in">handle</span>();<br>nativeSizeLabel-&gt;<span class="hljs-built_in">setText</span>(<span class="hljs-built_in">QString</span>(<span class="hljs-string">&quot;native size %1 %2&quot;</span>).<span class="hljs-built_in">arg</span>(platformWindow-&gt;<span class="hljs-built_in">geometry</span>().<span class="hljs-built_in">width</span>())<br>                         .<span class="hljs-built_in">arg</span>(platformWindow-&gt;<span class="hljs-built_in">geometry</span>().<span class="hljs-built_in">height</span>()));<br></code></pre></td></tr></table></figure><p>ä»€ä¹ˆï¼ç­‰ä¸€ä¸‹ï¼Œ<code>QPlatformWindow</code>ï¼Œè¿™ä¸ªåå­—ä¸€å¬å°±å¾ˆç‰©ç†åæ ‡å•Šï¼ˆè€Œä¸”<code>label</code>çš„åå­—ä¹ŸåŒ…å«<code>native</code>ï¼‰ï¼Œå¿«è®©æˆ‘åº·åº·ï¼</p><p>åŸæ¥æ˜¯ç”¨äº†<code>#include &lt;QtGui/qpa/qplatformwindow.h&gt;</code>å¤´æ–‡ä»¶ï¼Œã‚ˆã—</p><p>è¯¶ä¸è¿‡ï¼Œä¸ºä»€ä¹ˆæç¤º<code>Not Found</code></p><p>æœ‰ç»éªŒçš„å°ä¼™ä¼´åº”è¯¥æ•é”åœ°å¯Ÿè§‰åˆ°äº†ï¼Œè¿™ç§æƒ…å†µè¦ä¹ˆæ˜¯ç‰ˆæœ¬ä¸å¯¹ï¼Œè¦ä¹ˆæ˜¯ç¼ºå°‘æ¨¡å—</p><p>å¾ˆå¿«å•Šï¼Œæˆ‘åæ‰‹å°±æ‰“å¼€äº†ä»–çš„<a href="https://github.com/qt/qtbase/blob/885aba7ffdfaf410f16364f315411cf8d77da38a/tests/manual/highdpi/dprgadget/dprgadget.pro"><code>.pro</code>æ–‡ä»¶</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pro">QT += widgets gui_private<br></code></pre></td></tr></table></figure><p>å¥½å®¶ä¼™ï¼Œ<code>gui_private</code>æ¨¡å—ï¼Œè—ç€æ–ç€ï¼Œå¥½å¥½å¥½ï¼Œè¿™ä¹ˆç©æ˜¯å§</p><p>æœç„¶å¯ä»¥ç”¨äº†ï¼</p><h4 id="more"><a href="#more" class="headerlink" title="more"></a>more</h4><p>ä¸è¿‡åˆ«æ€¥ï¼Œæ¥éƒ½æ¥äº†ï¼Œæˆ‘ä»¬æ·±æŒ–ä¸€ä¸‹</p><p>é¦–å…ˆï¼Œ<code>#include &lt;QtGui/qpa/qplatformwindow.h&gt;</code>ä¸­çš„<code>qpa</code>æŒ‡çš„æ˜¯ä»€ä¹ˆ</p><p>å…¨ç§°ä¸ºï¼š<a href="https://doc.qt.io/qt-5/qpa.html">Qt Platform Abstraction</a>ï¼Œä¸€å¬å°±å¾ˆä¸è·¨å¹³å°å•Š</p><p>ä½†æ˜¯å¾ˆæ¥åœ°æ°”ï¼Œæ˜¾ç„¶æ˜¯æˆ‘ä»¬æƒ³è¦çš„</p><p>è®©æˆ‘çœ‹çœ‹éƒ½æœ‰<a href="https://doc.qt.io/qt-5/qpa.html#class-overview">ä»€ä¹ˆç±»</a></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c++">QAbstractEventDispatcher<br>QPlatformAccessibility<br>QPlatformBackingStore<br>QPlatformClipboard<br>QPlatformCursor<br>QPlatformDrag<br>QPlatformFontDatabase<br>QPlatformGraphicsBuffer<br>QPlatformInputContext<br>QPlatformNativeInterface<br>QPlatformOffscreenSurface<br>QPlatformOpenGLContext<br>QPlatformScreen<br>QPlatformServices<br>QPlatformSharedGraphicsCache<br>QPlatformSurface<br>QPlatformWindow<br></code></pre></td></tr></table></figure><p>è¿™ä¸ª<code>QPlatformScreen</code>ä¸€å¬å°±å¾ˆé¦™å•Šï¼Œä¾è‘«èŠ¦ç”»ç“¢</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//QScreen::handle() -&gt; QPlatformScreen*</span><br>QScreen::<span class="hljs-built_in">handle</span>()-&gt;<span class="hljs-built_in">geometry</span>()<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¾—åˆ°äº†çœŸçœŸæ­£æ­£çš„ç‰©ç†åæ ‡ï¼ï¼å“­è¾½</p><h4 id="more-more"><a href="#more-more" class="headerlink" title="more more"></a>more more</h4><p>äº‹æƒ…åˆ°è¿™é‡Œå°±ç»“æŸäº†å—ï¼Œå¤§æ¦‚ä¹Ÿè®¸</p><p>ä½†æ˜¯ä½ ä¸è§‰å¾—ï¼Œè·å–å±å¹•å·¦ä¸Šè§’ç‰©ç†åæ ‡ï¼Œç„¶åå†å››åˆ™è¿ç®—ä¸€ä¸‹ï¼Œæœ‰ç‚¹å†—ä½™å—</p><p>ä½ æƒ³æƒ³ï¼Œ<code>Qt</code>å†…éƒ¨é‡‡ç”¨é€»è¾‘åæ ‡ï¼Œæ¸²æŸ“é‡‡ç”¨ç‰©ç†åæ ‡ï¼Œé‚£ä¹ˆè‚¯å®šæœ‰è½¬æ¢å‡½æ•°å­˜åœ¨å‘€ï¼</p><p>è¯´æ—¶è¿Ÿé‚£æ—¶å¿«ï¼ˆï¼Ÿï¼‰ï¼Œä½ æƒ³æƒ³ï¼š<code>QCursor::pos()</code></p><p><code>QCursor::pos()</code>è¿”å›çš„æ˜¯é€»è¾‘åæ ‡ï¼Œä½†æ˜¯è¦åœ¨<code>Windows</code>ä¸Šè·å–é¼ æ ‡åæ ‡ï¼Œè‚¯å®šè°ƒç”¨äº†<code>Windows API</code>ï¼ˆç‰©ç†åæ ‡ï¼‰å•Š</p><p>é‚£ä¹ˆå…¶å†…éƒ¨å¿…ç„¶æœ‰è½¬æ¢å‡½æ•°</p><p>å¾ˆå¿«å•Šï¼Œæˆ‘ç›´æ¥æ‰“å¼€Qt5 <a href="https://codebrowser.dev/qt5/qtbase/src/gui/kernel/qcursor.cpp.html#_ZN7QCursor3posEPK7QScreen">QCurosr::pos()</a>æºç </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QPoint <span class="hljs-title">QCursor::pos</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> QCursor::<span class="hljs-built_in">pos</span>(QGuiApplication::<span class="hljs-built_in">primaryScreen</span>());<br>&#125;<br><br><span class="hljs-function">QPoint <span class="hljs-title">QCursor::pos</span><span class="hljs-params">(<span class="hljs-type">const</span> QScreen *screen)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (screen) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-type">const</span> QPlatformCursor *cursor = screen-&gt;<span class="hljs-built_in">handle</span>()-&gt;<span class="hljs-built_in">cursor</span>()) &#123;<br>            <span class="hljs-type">const</span> QPlatformScreen *ps = screen-&gt;<span class="hljs-built_in">handle</span>();<br>            QPoint nativePos = cursor-&gt;<span class="hljs-built_in">pos</span>(); <span class="hljs-comment">//åŸç”Ÿç‰©ç†åæ ‡</span><br>            ps = ps-&gt;<span class="hljs-built_in">screenForPosition</span>(nativePos); <span class="hljs-comment">//å¯»æ‰¾nativePosæ‰€åœ¨Screen</span><br>            <span class="hljs-keyword">return</span> QHighDpi::<span class="hljs-built_in">fromNativePixels</span>(nativePos, ps-&gt;<span class="hljs-built_in">screen</span>()); <span class="hljs-comment">//</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> QGuiApplicationPrivate::lastCursorPosition.<span class="hljs-built_in">toPoint</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸çœ‹ä¸å¾—äº†å•Šï¼Œä¸€çœ‹å°±ç•™å£æ°´å•Š</p><p><code>QHighDpi::fromNativePixels</code>ï¼Œè¿™ä¹ˆå¥½ç”¨çš„å‡½æ•°ä½ ä¸æ‹¿å‡ºæ¥ç»™å¤§å®¶ä¼™ç”¨ï¼</p><h4 id="QCursor-pos"><a href="#QCursor-pos" class="headerlink" title="QCursor::pos()"></a>QCursor::pos()</h4><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹<code>QCursor::pos()</code>çš„é€»è¾‘å•Š</p><p>æœ‰ä¸¤ä¸ªé‡è½½ï¼Œæ— å‚ç‰ˆæœ¬é»˜è®¤æŠŠä¸»æ˜¾ç¤ºå™¨ä¼ ç»™äº†æœ‰å‚ç‰ˆæœ¬</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç–‘æƒ‘ï¼Œè¯¶ï¼Œä¸ºä»€ä¹ˆéœ€è¦QScreenå‚æ•°å‘¢ï¼Œå…‰æ ‡åæ ‡å’Œå±å¹•æœ‰å…³å—</p><p>åˆ«æ€¥ï¼Œæ¥ç€å¾€ä¸‹çœ‹</p><p>é¦–å…ˆï¼Œè·å–äº†åŸç”Ÿå±å¹•æŒ‡é’ˆï¼ˆ<code>QPlatformScreen</code>ï¼‰ï¼Œç„¶åé€šè¿‡<code>QPlatformCursor</code>è·å–åˆ°äº†å…‰æ ‡çš„åŸç”Ÿç‰©ç†åæ ‡ï¼ˆ<code>nativePos</code>ï¼‰</p><p>æ¥ç€é€šè¿‡<code>ps = ps-&gt;screenForPosition(nativePos)</code>æ›´æ–°äº†å±å¹•æŒ‡é’ˆï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/*!</span><br><span class="hljs-comment">  Find the sibling screen corresponding to \a globalPos.</span><br><span class="hljs-comment">  Returns this screen if no suitable screen is found at the position.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-type">const</span> QPlatformScreen *<span class="hljs-title">QPlatformScreen::screenForPosition</span><span class="hljs-params">(<span class="hljs-type">const</span> QPoint &amp;point)</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">geometry</span>().<span class="hljs-built_in">contains</span>(point)) &#123;<br>        <span class="hljs-type">const</span> <span class="hljs-keyword">auto</span> screens = <span class="hljs-built_in">virtualSiblings</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> QPlatformScreen *screen : screens) &#123;<br>            <span class="hljs-keyword">if</span> (screen-&gt;<span class="hljs-built_in">geometry</span>().<span class="hljs-built_in">contains</span>(point))<br>                <span class="hljs-keyword">return</span> screen;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ³¨é‡Šå’Œä»£ç é‡Œéƒ½æåˆ°äº†ä¸€ä¸ªè¯ï¼š<code>sibling</code></p><p>æ¥çœ‹ä¸€ä¸‹Qtæ–‡æ¡£çš„è§£é‡Š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QList&lt;QScreen *&gt; <span class="hljs-title">QScreen::virtualSiblings</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"><span class="hljs-comment">//Get the screen&#x27;s virtual siblings.</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-comment">//The virtual siblings are the screen instances sharing the same virtual desktop. They share a common coordinate system, and windows can //freely be moved or positioned across them without having to be re-created.</span></span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œ<code>sibling screens</code>ä¹Ÿå°±æ˜¯ä¸€ä¸ªè™šæ‹Ÿæ¡Œé¢å†…çš„æ‰€æœ‰ç›¸é‚»æ˜¾ç¤ºå™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸<code>qApp-&gt;screens()</code>ç›¸ç­‰</p><p>å› æ­¤ï¼Œ<code>screenForPosition()</code>ä¼šéå†å±å¹•ï¼Œæ‰¾åˆ°é¼ æ ‡å…‰æ ‡æ‰€åœ¨çš„é‚£ä¸€å—</p><p>æ‰€ä»¥æˆ‘ä»¬ä¸å¿…çº ç»“ï¼Œä¸ºä»€ä¹ˆä¸€å¼€å§‹ä¼ å…¥çš„æ˜¯<code>primaryScreen()</code>ï¼Œä¼šä¸ä¼šä¸å‡†ç¡®</p><p>å…¶å®ä¼ å…¥ä»€ä¹ˆ<code>screen</code>éƒ½å¯ä»¥ï¼Œåªè¦åœ¨åŒä¸€ä¸ªè™šæ‹Ÿæ¡Œé¢å†…ï¼Œä¼šè‡ªè¡Œå®šä½</p><p>è¿™é‡Œä¼ å…¥ä¸€ä¸ªæŒ‡é’ˆï¼Œæ˜¯ä¸ºäº†å®šä½è™šæ‹Ÿæ¡Œé¢è€Œå·²</p><h4 id="more-more-moreï¼šQHighDpi-fromNativePixels"><a href="#more-more-moreï¼šQHighDpi-fromNativePixels" class="headerlink" title="more more moreï¼šQHighDpi::fromNativePixels"></a>more more moreï¼šQHighDpi::fromNativePixels</h4><p>é¡¾åæ€ä¹‰ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†ä»–å¯ä»¥ä»ç‰©ç†åæ ‡ï¼ˆåŸç”Ÿåƒç´ ï¼‰è½¬åŒ–ä¸ºé€»è¾‘åæ ‡</p><p>é‚£ä¹ˆç¨å¾®çœ‹ä¸€ä¸‹æºç å§</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span> C&gt;<br><span class="hljs-function">T <span class="hljs-title">fromNativePixels</span><span class="hljs-params">(<span class="hljs-type">const</span> T &amp;value, <span class="hljs-type">const</span> C *context)</span></span><br><span class="hljs-function"></span>&#123;<br>    QPoint nativePosition = <span class="hljs-built_in">position</span>(value); <span class="hljs-comment">//è½¬æ¢ä¸ºQPoint</span><br>    QHighDpiScaling::ScaleAndOrigin so = QHighDpiScaling::<span class="hljs-built_in">scaleAndOrigin</span>(context, &amp;nativePosition);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">scale</span>(value, <span class="hljs-built_in">qreal</span>(<span class="hljs-number">1</span>) / so.factor, so.origin);<br>&#125;<br></code></pre></td></tr></table></figure><p>OKï¼Œå¾ˆçŸ­ï¼Œå°±ä¸‰è¡Œï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>QHighDpiScaling::scaleAndOrigin</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QHighDpiScaling::ScaleAndOrigin <span class="hljs-title">QHighDpiScaling::scaleAndOrigin</span><span class="hljs-params">(<span class="hljs-type">const</span> QPlatformScreen *platformScreen, QPoint *nativePosition)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (!m_active)<br>        <span class="hljs-keyword">return</span> &#123; <span class="hljs-built_in">qreal</span>(<span class="hljs-number">1</span>), <span class="hljs-built_in">QPoint</span>() &#125;;<br>    <span class="hljs-keyword">if</span> (!platformScreen)<br>        <span class="hljs-keyword">return</span> &#123; m_factor, <span class="hljs-built_in">QPoint</span>() &#125;; <span class="hljs-comment">// the global factor</span><br>    <span class="hljs-type">const</span> QPlatformScreen *actualScreen = nativePosition ?<br>        platformScreen-&gt;<span class="hljs-built_in">screenForPosition</span>(*nativePosition) : platformScreen;<br>    <span class="hljs-keyword">return</span> &#123; m_factor * <span class="hljs-built_in">screenSubfactor</span>(actualScreen), actualScreen-&gt;<span class="hljs-built_in">geometry</span>().<span class="hljs-built_in">topLeft</span>() &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå†æ¬¡è°ƒç”¨<code>screenForPosition()</code>å®šä½äº†å…‰æ ‡æ‰€åœ¨å±å¹•ï¼Œéå¸¸ä¸¥è°¨</p><p>è¿”å›å€¼æœ‰ä¿©ï¼š</p><ul><li>è®¡ç®—ç¼©æ”¾æ¯”ï¼š<code>m_factor * screenSubfactor(actualScreen)</code>ï¼Œå·´æ‹‰å·´æ‹‰bombï¼Œå¯èƒ½æ˜¯å†…éƒ¨ç¼©æ”¾æ¯” * å¤–éƒ¨ç¼©æ”¾æ¯”ï¼Ÿä¸ç®¡äº†</li><li>è®¡ç®—å…‰æ ‡æ‰€åœ¨å±å¹•çš„å·¦ä¸Šè§’ç‰©ç†åæ ‡ï¼š<code>actualScreen-&gt;geometry().topLeft()</code></li></ul><p>è¿™ç¬¬äºŒä¸ªå°±æ˜¯é‡ç‚¹äº†ï¼Œè·Ÿæˆ‘ä»¬è‡ªè¡Œè®¡ç®—çš„æ–¹æ³•æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œä¸è¿‡ä»–è¿™é‡Œè·å–åˆ°çš„æ˜¯çœŸçœŸæ­£æ­£çš„ç‰©ç†åæ ‡</p><p>ç„¶åè°ƒç”¨<code>scale(value, qreal(1) / so.factor, so.origin)</code>è¿›è¡Œæœ€åçš„è®¡ç®—</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">inline</span> QPoint <span class="hljs-title">scale</span><span class="hljs-params">(<span class="hljs-type">const</span> QPoint &amp;pos, qreal scaleFactor, QPoint origin = QPoint(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>))</span></span><br><span class="hljs-function"></span>&#123;<br>     <span class="hljs-keyword">return</span> (pos - origin) * scaleFactor + origin;<br>&#125;<br></code></pre></td></tr></table></figure><p>å“å‘€ï¼Œè¿™ä¸å°±æ˜¯æˆ‘ä»¬çš„è®¡ç®—å…¬å¼å—</p><p>å…ˆå‡å»å·¦ä¸Šè§’çš„åæ ‡ï¼Œå½’ä¸€åŒ–ä¸ºï¼ˆ0,0ï¼‰ï¼Œç„¶åç›´æ¥ä¹˜é™¤ç¼©æ”¾æ¯”ï¼Œå†æŠŠå·¦ä¸Šè§’åŠ å›æ¥ hhhhhh</p><p>å•Šï¼Œå“ˆï¼Œå•Šå“ˆå“ˆå“ˆ</p><h4 id="and-MORE"><a href="#and-MORE" class="headerlink" title="and MORE!"></a>and MORE!</h4><p>äº‹æƒ…è¿œè¿œæ²¡æœ‰è¿™ä¹ˆç®€å•ï¼ˆå·²ç»å¾ˆå¤æ‚äº†å¥½å˜›å–‚ï¼‰</p><p>å¦‚å›¾ï¼Œç»è¿‡æµ‹è¯•ï¼Œæ¯ä¸€å—å±å¹•çš„è™šæ‹Ÿåæ ‡ç³»ï¼ˆé»„è‰²åŒºåŸŸï¼‰æ˜¯å•ç‹¬è®¡ç®—çš„ï¼Œå…¶å·¦ä¸Šè§’åæ ‡å°±æ˜¯<strong>ç‰©ç†åæ ‡</strong>ï¼Œï¼ˆè™½ç„¶Sizeæ˜¯ç¼©æ”¾è¿‡çš„ï¼‰</p><ul><li>æµ‹è¯•è®¾å¤‡ä¸ºï¼š4Kæ˜¾ç¤ºå™¨ï¼ˆ150%ç¼©æ”¾ï¼‰ + 1080Pæ˜¾ç¤ºå™¨ï¼ˆ100%ç¼©æ”¾ï¼‰</li></ul><p><img src="/img/image-20240313122842885.png" alt="ç‰©ç†åæ ‡ç³» &amp; é€»è¾‘åæ ‡ç³»ï¼ˆé»„ï¼‰"></p><p>æƒŠå¤©å¤§å‘ç°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè™šæ‹Ÿåæ ‡ç³»ä¸­çš„æ¯ä¸€å—å±å¹•æ˜¯<strong>ä¸è¿ç»­</strong>çš„ï¼</p><p>é¼ æ ‡ä»å³è¾¹å±å¹•çš„å·¦ä¾§è¾¹ç¼˜ï¼Œç§»åŠ¨åˆ°å·¦ä¾§æ˜¾ç¤ºå™¨çš„å³è¾¹ç¼˜ï¼Œåœ¨Qtå†…éƒ¨ï¼Œé€»è¾‘åæ ‡æ˜¯ä¼šå‘ç”Ÿçªå˜çš„</p><p><code>(3840,1071) -&gt; (2559,720)</code></p><p>æ‰€ä»¥ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œæ¯ä¸€å—æ˜¾ç¤ºå™¨çš„<code>QScreen::geometry().topLeft()</code>å…¶å®æ˜¯å‡†ç¡®çš„<strong>ç‰©ç†åæ ‡</strong>ï¼Œï¼ˆè™½ç„¶å…¶Sizeæ˜¯é€»è¾‘å€¼ï¼‰</p><p>å› æ­¤ï¼Œç¬¬ä¸€ç§è½¬æ¢æ–¹æ¡ˆå…¶å®ä¹Ÿæ²¡é—®é¢˜ï¼Œä½†æ˜¯<code>QHighDpi::fromNativePixels</code>æ˜¾ç„¶æ›´ç®€å•hhhh</p><p><strong>å¦‚æœä¸æƒ³å¼•å…¥<code>private</code>æ¨¡å—ï¼Œç›´æ¥ç”¨ç¬¬ä¸€ç§æ–¹å¼å››åˆ™è¿ç®—è‡ªè¡Œè½¬æ¢ä¹Ÿè¡Œ</strong></p><h3 id="Other-Problem"><a href="#Other-Problem" class="headerlink" title="Other Problem"></a>Other Problem</h3><p>åœ¨å¤šæ˜¾ç¤ºå™¨ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯èƒ½é‡åˆ°åˆ«çš„å‘</p><p>æ¯”å¦‚ï¼š<code>QListWidget</code>çš„<code>item</code>çš„å¸ƒå±€æ²¡æœ‰åˆ·æ–° &amp; æ¯”ä¾‹ä¸æ­£ç¡®</p><p><strong>æ›´æ–°ï¼š</strong>å¦‚æœä¸å¯ç”¨<code>QApplication::setHighDpiScaleFactorRoundingPolicy(Qt::HighDpiScaleFactorRoundingPolicy::PassThrough)</code>æ‰ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜</p><p><strong>åŠ ä¸Šä¹‹åï¼Œè²Œä¼¼å°±æ²¡é—®é¢˜äº†~</strong> Over</p><p>æ­¤æ—¶å¯ä»¥ç”¨<code>QListWidget::doItemsLayout</code>è¿›è¡Œå¼ºåˆ¶åˆ·æ–°ï¼ˆè¿™ä¸ªå‡½æ•°å±…ç„¶æ–‡æ¡£é‡Œæ²¡æœ‰ï¼<code>GPT-4</code>å‘Šè¯‰æˆ‘çš„ï¼‰</p><p>ä¸è¿‡ä»€ä¹ˆæ—¶æœºç”¨å‘¢ï¼Ÿ</p><p>è²Œä¼¼æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ª<code>signal</code>å¯ä»¥æŒ‡ç¤ºçª—å£ä»ä¸€ä¸ªæ˜¾ç¤ºå™¨åˆ°å¦ä¸€ä¸ªæ˜¾ç¤ºå™¨</p><p>é‚£ä¹ˆå¯ä»¥åœ¨<code>moveEvent()</code>ä¸­ï¼Œè‡ªè¡Œæ£€æµ‹å½“å‰æ˜¾ç¤ºå™¨æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼ˆ<code>QScreen</code>ï¼‰</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>å…¶å®å¦‚æœä¸Windows åŸç”ŸAPIäº¤äº’ä¸æ˜¯å¤ªå¤šçš„è¯ï¼Œ<code>Qt</code>è‡ªå¸¦çš„é«˜DPIé€‚é…å·²ç»è¶³å¤Ÿä¼˜ç§€äº†ï¼Œæ¯•ç«Ÿæ˜¯è·¨å¹³å°çš„ï¼Œæ¨èä½¿ç”¨</p><p>å¦‚æœæœ‰å°‘é‡Windows APIè¯ï¼Œå¯ä»¥æ‰‹åŠ¨ç¼©æ”¾ä¸€ä¸‹åæ ‡ï¼Œé—®é¢˜ä¸å¤§</p><h2 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h2><p>å˜›ï¼Œåæ­£Qtä½œä¸ºä¸€ä¸ªçœ‹ä¼¼æ˜¯å‰ç«¯ï¼ˆä¼ ç»Ÿå‰ç«¯è¿˜æœ‰æµè§ˆå™¨å±è”½ç»†èŠ‚å‘¢ï¼‰å…¶å®æ¯”å…¨æ ˆè¿˜è¦éº»çƒ¦ï¼ˆè¦è€ƒè™‘åº•å±‚ç³»ç»Ÿäº¤äº’ï¼‰çš„æŠ€æœ¯ç‚¹</p><p>åªèƒ½è¯´å‘æ˜¯è¸©ä¸å®Œçš„ï¼Œè€Œä¸”å›½å†…ç”¨æˆ·å…¶å®ä¸æ˜¯å¾ˆå¤šï¼Œèµ„æ–™ä¹Ÿä¸å¥½æ‰¾</p><p>ä¸è¯´äº†ï¼Œéƒ½æ˜¯æ³ªï¼Œä¸”çœ‹ä¸”çæƒœï¼Œæˆ‘åˆé¥­è¿˜æ²¡åƒå‘¢</p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://doc.qt.io/qt-6/qicon.html#high-dpi-icons">QIcon ç±» | Qt å›¾å½¢ç”¨æˆ·ç•Œé¢ 6.6.2 â€” QIcon Class | Qt GUI 6.6.2</a></p><p><a href="https://doc.qt.io/qt-6/highdpi.html">é«˜DPI | Qt 6.6 â€” High DPI | Qt 6.6</a></p><p><a href="https://zhuanlan.zhihu.com/p/595553974">Qtä¹‹é«˜DPIæ˜¾ç¤ºå™¨ - è§£å†³æ–¹æ¡ˆæ•´ç† - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://blog.csdn.net/qq_34305316/article/details/132970047">å…³äºQté€‚é…ä¸åŒåˆ†è¾¨ç‡å’Œç¼©æ”¾ç‡æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ_qt å±å¹•åˆ†è¾¨ç‡-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/yinyuchen1/article/details/99607722">Qté«˜æ¸…DPIä¸‹çš„æ˜¾ç¤ºï¼Œè‡ªé€‚åº”åˆ†è¾¨ç‡ qt-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/startl/article/details/105862817">Qt Windowsé«˜æ¸…DPIè‡ªé€‚åº”åˆ†è¾¨ç‡ç¼©æ”¾ï¼Œæ¯”è¾ƒå®Œç¾çš„è§£å†³æ–¹æ¡ˆ-CSDNåšå®¢</a></p><p><a href="https://www.zhihu.com/question/451021591">ç›®å‰Qtæœ‰æ²¡æœ‰æ¯”è¾ƒå¥½è§£å†³é«˜åˆ†å±ä¸‹ç¼©æ”¾æ˜¾ç¤ºçš„æ–¹æ¡ˆï¼Ÿ - çŸ¥ä¹ (zhihu.com)</a></p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>High-DPI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springbootå¤šç¯å¢ƒé…ç½®</title>
    <link href="/2024/01/12/Springboot%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <url>/2024/01/12/Springboot%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>æœ¬æ–‡æ˜¯ä»[<strong>å¦‚ä½•ä¼˜é›…åœ°éƒ¨ç½²Springboot in Ubuntu</strong>]ä¸€æ–‡ä¸­æ‘˜å½•çš„ï¼Œä¸ºäº†ä¾¿äºæ£€ç´¢</p><h2 id="æ­£ç‰‡"><a href="#æ­£ç‰‡" class="headerlink" title="æ­£ç‰‡"></a>æ­£ç‰‡</h2><p>ä¸ºä»€ä¹ˆéœ€è¦<code>Springboot</code>å¤šç¯å¢ƒé…ç½®å‘¢</p><p>ä¸»è¦åŸå› æ˜¯æˆ‘ä»¬åœ¨å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒï¼ˆor æµ‹è¯•ç¯å¢ƒï¼‰ä¸­å¯¹äºåŒä¸€ä¸ªé…ç½®å±æ€§å¯èƒ½éœ€è¦ä¸åŒçš„å€¼</p><p>ä¾‹å¦‚ï¼šæ•°æ®åº“å¯†ç ã€æ—¥å¿—å­˜æ”¾è·¯å¾„ã€é™æ€èµ„æºæœåŠ¡å™¨åœ°å€ç­‰ç­‰</p><p>æ‰€ä»¥æœ€æ–¹ä¾¿çš„æ–¹å¼æ˜¯å†™ä¸¤å¥—é…ç½®æ–‡ä»¶ï¼Œç„¶åå†ä¸åŒåœºæ™¯è¿›è¡Œåˆ‡æ¢ï¼Œå¦‚ï¼š</p><ul><li>application.yml</li><li>application-dev.yml</li><li>application-prod.yml</li></ul><p>æ³¨ï¼šå‘½åè§„åˆ™ï¼š<code>application-&#123;profile&#125;.yml</code><br>æ³¨ï¼šåŒåå±æ€§ä¼˜å…ˆçº§ï¼šå…·ä½“é…ç½®æ–‡ä»¶ &gt; é€šç”¨é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰<br>æ³¨ï¼šå…¶å®ä½ æƒ³æŠŠä¸åŒç¯å¢ƒé…ç½®æ–‡ä»¶å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œä¹Ÿå¯ä»¥ï¼Œç”¨<code>---</code>åˆ†å‰²ï¼Œä½†æ˜¯åˆ«å§ï¼Œå¤§å“¥</p><p>è¯¶ç­‰ç­‰ï¼Œæ€ä¹ˆæœ‰ä¸‰ä¸ªé…ç½®æ–‡ä»¶</p><blockquote><p>ä½ å‚»å•Šï¼Œé€šç”¨çš„é…ç½®æ”¾<code>application.yml</code>å°±å¥½äº†éš¾é“ä½ è¦å†™ä¸¤éå•Š</p></blockquote><p>å¥½çš„ï¼Œé‚£è¦æ€ä¹ˆåˆ‡æ¢é…ç½®å‘¢</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¹Ÿå°±æ˜¯<code>default</code>ç¯å¢ƒï¼Œåªå¯ç”¨<code>application.yml</code> or propertiesï¼ˆè¿™ä¿©ä¸€æ ·çš„ï¼Œä¸å¤šèµ˜è¿°ï¼‰</p><p>æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥åˆ‡æ¢</p><ul><li>åœ¨<code>application.properties</code>ä¸­å†™ä¸Šï¼š<code>spring.profiles.active=dev</code> or prodç­‰ç­‰</li><li>åœ¨<code>java -jar</code>çš„æ—¶å€™ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°<code>--spring.profiles.active=prod</code>æ¥æ¿€æ´»ç”Ÿäº§ç¯å¢ƒé…ç½®</li><li>åœ¨<code>IDEA</code>ä¸­é…ç½®ï¼šç¼–è¾‘è¿è¡Œ&#x2F;è°ƒè¯•é…ç½®-&gt;æ´»åŠ¨&#x2F;æœ‰æ•ˆé…ç½®ï¼ˆå¯ä»¥æ‰¾æ‰¾ï¼Œè¿™ä¸ªç®€å•ï¼Œä¸»è¦ä¸æƒ³æ”¾å›¾äº†ï¼‰</li></ul><p>æ€ä¹ˆçŸ¥é“<code>Springboot</code>ç°åœ¨æ˜¯ä»€ä¹ˆç¯å¢ƒå‘¢ï¼Ÿåœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ä¼šè¾“å‡º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">2024-01-12 19:41:19.130 INFO [main] - com.mrbean.test.TestApplication  :  The following 1 profile is active: <span class="hljs-string">&quot;dev&quot;</span><br></code></pre></td></tr></table></figure><p>å¥½çš„ï¼Œé…±ç´«å°±å¯ä»¥å®Œç¾åˆ‡æ¢é…ç½®æ–‡ä»¶äº†ï¼Œè¦æ˜¯è¿˜æœ‰ä»€ä¹ˆéœ€è¦ä¿®æ”¹çš„ï¼Œåªè¦åœ¨ç”Ÿæˆç¯å¢ƒæ–°å»ºä¸€ä¸ª<code>application-prod.yml</code>ï¼Œå°±å¯ä»¥è¦†ç›–å¯¹åº”çš„å±æ€§äº†ï¼Œè¿™ä¸ªå¤§å®¶åº”è¯¥å¾ˆæ‡‚çš„ï¼Œæˆ‘å°±ä¸è¯´äº†</p><h3 id="é…ç½®æ–‡ä»¶åä½œæœ€ä½³å®è·µ"><a href="#é…ç½®æ–‡ä»¶åä½œæœ€ä½³å®è·µ" class="headerlink" title="é…ç½®æ–‡ä»¶åä½œæœ€ä½³å®è·µ"></a>é…ç½®æ–‡ä»¶åä½œæœ€ä½³å®è·µ</h3><p>æˆ‘ä»¬åˆšåˆšè¯´äº†ï¼Œæœ‰ä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯ä¸€æ—¦è¿›å…¥<code>Git</code>å¤šäººåä½œï¼Œå°±ä¼šç›´æ¥çˆ†ç‚¸</p><p>å› ä¸ºæ¯ä¸ªäººçš„æœ¬åœ°ç¯å¢ƒæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥<code>application-dev.yml</code>åŠ¿å¿…ä¼šè¢«æ”¹æ¥æ”¹å»ï¼Œç„¶åè¿˜ä¸Šä¼ <code>Git</code></p><p>ç„¶å<code>pull</code>çš„æ—¶å€™å°±ä¼šç›´æ¥è¦†ç›–ä½ çš„å¼€å‘é…ç½®ï¼Œå°±ä¼šæƒ³è¦ * é˜Ÿå‹äº†</p><h4 id="è¾£æ€ä¹ˆåŠ"><a href="#è¾£æ€ä¹ˆåŠ" class="headerlink" title="è¾£æ€ä¹ˆåŠ"></a>è¾£æ€ä¹ˆåŠ</h4><p>è¦ä¹ˆå°±æ˜¯ä¸ä¸Šä¼ <code>application-dev.yml</code></p><p>é‚£ä¸æˆå•Šï¼Œé‚£æƒ³æ–°å¢&#x2F;ä¿®æ”¹é…ç½®ï¼Œå…¶ä»–æˆå‘˜å®Œå…¨é˜¿å·´æ€ä¹ˆåŠ</p><p>å…¶å®æˆ‘ä»¬å¯ä»¥å»ºç«‹<code>application-dev-template.yml</code>æ–‡ä»¶ï¼Œä½œä¸ºæ¨¡æ¿ï¼Œéå¿…è¦ä¸ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶</p><p>ç„¶åæ¯ä¸ªæˆå‘˜è‡ªå·±æ ¹æ®æ¨¡æ¿æ–°å»º<code>application-dev.yml</code>ï¼Œä¸”åŠ å…¥<code>.gitignore</code>ä¸ä¸Šä¼ <code>Git</code></p><h2 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h2><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://blog.csdn.net/qq_44885775/article/details/123471021">31 SpringBootå¤šç¯å¢ƒçš„åˆ‡æ¢(ç”Ÿäº§ç¯å¢ƒã€å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒ)_spring bootç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒ-CSDNåšå®¢</a></p>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Springboot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springboot Utilå·¥å…·ç±»å¦‚ä½•è¯»å–é…ç½®æ–‡ä»¶(yml)</title>
    <link href="/2024/01/08/Springboot-Util%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%A6%82%E4%BD%95%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-yml/"/>
    <url>/2024/01/08/Springboot-Util%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%A6%82%E4%BD%95%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-yml/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæ²¡æœ‰<code>Util</code>å·¥å…·ç±»çš„<code>Java</code>ç¨‹åºæ˜¯ä¸å®Œæ•´çš„</p><p>è¿™å¤©ï¼Œæˆ‘ä»¬æ‰“å¼€äº†ä¸€ä¸ª<code>Springboot</code>é¡¹ç›®ï¼Œå¹¶æ‰“ç®—åŠ å…¥ä¸€ä¸ªé€šç”¨æ–¹æ³•ï¼ˆç”¨æ¥æ‹¼æ¥é™æ€èµ„æºè¯·æ±‚è·¯å¾„ï¼‰ï¼Œé‚£å°±å†™ä¸€ä¸ª<code>Util</code>ç±»å§</p><blockquote><p> <strong>GPT-4:</strong><br>åœ¨Javaä¸­ï¼Œä¸€ä¸ªå…¸å‹çš„å·¥å…·ï¼ˆUtilï¼‰ç±»é€šå¸¸åŒ…å«ä¸€äº›é™æ€æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ç”¨äºæä¾›é€šç”¨çš„ã€éç‰¹å®šäºå¯¹è±¡çš„åŠŸèƒ½ã€‚è¿™äº›ç±»é€šå¸¸è¢«è®¾è®¡æˆä¸å¯å®ä¾‹åŒ–å’Œä¸å¯ç»§æ‰¿çš„</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Util</span> &#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;staticServer&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String staticServer; <span class="hljs-comment">//é™æ€èµ„æºæœåŠ¡å™¨åœ°å€</span><br>    <br>    <span class="hljs-comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼Œé˜²æ­¢å®ä¾‹åŒ–</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">MyUtils</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AssertionError</span>(<span class="hljs-string">&quot;No MyUtils instances for you!&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-comment">//æ‹¼æ¥å®Œæ•´é™æ€èµ„æºURLï¼Œå¦‚ https://static.server/images/cat.jpg</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getStaticResourceURI</span><span class="hljs-params">(String prefix, String filename)</span> &#123;<br>        <span class="hljs-keyword">return</span> staticServer + prefix + <span class="hljs-string">&#x27;/&#x27;</span> + encodeUri(filename);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">encodeUri</span><span class="hljs-params">(String uri)</span> &#123;<br>        <span class="hljs-keyword">return</span> UriUtils.encode(uri, StandardCharsets.UTF_8);<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä¼˜é›…ï¼Œå¤ªä¼˜é›…äº†</p><p>ç¼–è¯‘ï¼</p><p>è¿è¡Œï¼</p><p>Bombï¼</p><p>å¥½çš„ï¼Œå®ŒçŠŠå­äº†ï¼Œä½ çŒœè¿™æ€ä¹ˆç€ï¼Œ<code>staticServer == null</code></p><h2 id="å¯æ€œ-å¼±å°-åˆæ— åŠ©"><a href="#å¯æ€œ-å¼±å°-åˆæ— åŠ©" class="headerlink" title="å¯æ€œ å¼±å° åˆæ— åŠ©"></a>å¯æ€œ å¼±å° åˆæ— åŠ©</h2><p>è¿™ä¸æ ¸ç†ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Œå¯¹é™æ€æˆå‘˜çš„æ³¨å…¥ä»æŠ€æœ¯ä¸Šåº”è¯¥æ˜¯å¯ä»¥å®ç°çš„</p><p>ä¸è¿‡é™æ€æˆå‘˜å¹¶ä¸å±äºå®ä¾‹å¯¹è±¡ï¼Œå¯èƒ½ä¸<code>IOC</code>å®¹å™¨ &amp; ä¾èµ–æ³¨å…¥çš„ç†å¿µä¸ç¬¦ï¼Œæ‰€ä»¥<code>Springboot</code>å¹¶ä¸ç›´æ¥æ”¯æŒ</p><h2 id="è¾£æ€åŠ"><a href="#è¾£æ€åŠ" class="headerlink" title="è¾£æ€åŠ"></a>è¾£æ€åŠ</h2><p>ä½†æ˜¯è¿™ä¸ªéœ€æ±‚å¾ˆåˆç†å¥½å§ï¼Œåœ¨å·¥å…·ç±»ä¸­ç”¨åˆ°é…ç½®æ–‡ä»¶ä¸­çš„é”®å€¼</p><h3 id="Pre"><a href="#Pre" class="headerlink" title="Pre"></a>Pre</h3><p>ä¸è¿‡ä¸‘è¯è¯´åœ¨å‰å¤´ï¼Œå¦‚æœè¦æƒ³è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œé‚£ä¹ˆ<code>Util</code>ç±»å¿…é¡»æ˜¯ä¸€ä¸ª<code>Bean</code>ï¼Œå› ä¸ºåªæœ‰<code>Bean</code>æ‰èƒ½è¢«<code>IOC</code>å®¹å™¨ç®¡ç†</p><p>æ‰€ä»¥ï¼Œ<code>Util</code>çš„æ„é€ å‡½æ•°ä¸èƒ½æ˜¯ç§æœ‰çš„ï¼Œè¿˜çœŸå°±å¾—å¼€æ”¾ç»™<code>Springboot</code>ä½¿ç”¨</p><p>æ€»ä¸èƒ½åˆè¦éšç§ï¼Œåˆè¦èººç€æŠŠé’±æŒ£äº†å§ï¼ˆå“ªæœ‰è¿™å¥½äº‹ï¼‰</p><p>æ‰€ä»¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span> <span class="hljs-comment">//æ³¨å†Œä¸ºBean</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Util</span> &#123;<br>    <span class="hljs-comment">//private MyUtils() &#123; å…¬å¼€å•¦ï¼å“­</span><br>    <span class="hljs-comment">//    throw new AssertionError(&quot;No MyUtils instances for you!&quot;);</span><br>    <span class="hljs-comment">//&#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-åˆ©ç”¨setæ–¹æ³•æ³¨å…¥"><a href="#1-åˆ©ç”¨setæ–¹æ³•æ³¨å…¥" class="headerlink" title="1. åˆ©ç”¨setæ–¹æ³•æ³¨å…¥"></a>1. åˆ©ç”¨setæ–¹æ³•æ³¨å…¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Util</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String staticServer; <span class="hljs-comment">//é™æ€èµ„æºæœåŠ¡å™¨åœ°å€</span><br>    <br>    <span class="hljs-meta">@Value(&quot;$&#123;staticServer&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStaticServer</span><span class="hljs-params">(String staticServer)</span> &#123; <span class="hljs-comment">//</span><br>        Util.staticServer = staticServer;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getStaticResourceURI</span><span class="hljs-params">(String prefix, String filename)</span> &#123;<br>        <span class="hljs-keyword">return</span> staticServer + prefix + <span class="hljs-string">&#x27;/&#x27;</span> + encodeUri(filename);<br>    &#125;<br>...<br>    &#125;<br></code></pre></td></tr></table></figure><p>æŠŠ<code>@Value</code>å†™åœ¨éé™æ€æˆå‘˜æ–¹æ³•ä¸Šï¼Œå°±å¯ä»¥æ­£å¸¸è¢«æ‰§è¡Œ</p><p>ç„¶ååœ¨å‡½æ•°ä½“é‡Œå¯¹<code>static</code>æˆå‘˜èµ‹å€¼ï¼Œç‹¸çŒ«æ¢å¤ªå­</p><h3 id="2-åˆ©ç”¨-PostConstructæ³¨è§£"><a href="#2-åˆ©ç”¨-PostConstructæ³¨è§£" class="headerlink" title="2. åˆ©ç”¨@PostConstructæ³¨è§£"></a>2. åˆ©ç”¨@PostConstructæ³¨è§£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Util</span> &#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;staticServer&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String staticServer;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Util INS;<br><br>    <span class="hljs-meta">@PostConstruct</span> <span class="hljs-comment">// åœ¨æ„é€ å‡½æ•°å’Œä¾èµ–æ³¨å…¥å®Œæˆåæ‰§è¡Œï¼›æ„é€ æ–¹æ³• &gt; @Autowired &gt; @PostConstructï¼Œæ¯•ç«Ÿæ„é€ å®Œæˆæ‰èƒ½æ³¨å…¥æˆå‘˜</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>        INS = <span class="hljs-built_in">this</span>; <span class="hljs-comment">// è·å–Beanå®ä¾‹ï¼Œèµ‹å€¼ç»™é™æ€å˜é‡ï¼Œæ–¹ä¾¿staticå‡½æ•°è®¿é—®</span><br>    &#125; <span class="hljs-comment">// å®¹å™¨ç®¡ç†çš„Beané»˜è®¤æ˜¯å•ä¾‹çš„ï¼Œæ‰€ä»¥è¿™é‡Œçš„INSæ˜¯å”¯ä¸€çš„</span><br><br>    <span class="hljs-comment">// æ‹¼æ¥å®Œæ•´é™æ€èµ„æºURLï¼Œåªå¯¹filenameè¿›è¡Œç¼–ç </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getStaticResourceURI</span><span class="hljs-params">(String prefix, String filename)</span> &#123;<br>        <span class="hljs-keyword">return</span> INS.staticServer + prefix + <span class="hljs-string">&#x27;/&#x27;</span> + encodeUri(filename);<br>    &#125;<br><br>    <span class="hljs-comment">// å¯¹uriè¿›è¡Œç¼–ç ï¼Œæ³¨æ„&#x27;/&#x27;ä¹Ÿä¼šè¢«ç¼–ç </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">encodeUri</span><span class="hljs-params">(String uri)</span> &#123;<br>        <span class="hljs-keyword">return</span> UriUtils.encode(uri, StandardCharsets.UTF_8); <span class="hljs-comment">//URLEncoderä¼šæŠŠ&#x27; &#x27;ç¼–ç ä¸º&#x27;+&#x27;è€Œé&#x27;%20&#x27;é€ æˆé”™è¯¯</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™ä¸ªåå­—ï¼ˆ<code>@PostConstruct</code>ï¼‰ï¼Œä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æƒ³èµ·ä»€ä¹ˆ</p><p>äºŒå‰æ ‘çš„ååºéå†ï¼š<strong>PostOrder</strong></p><p>è¯¶ï¼Œä¸ºä»€ä¹ˆéƒ½æ˜¯<code>Post</code>ï¼Œé©¬è¨å¡</p><p>å¯¹å–½ï¼Œ<code>PostConstruct</code>æ˜¯åœ¨æ„é€ å‡½æ•°ä¹‹åæ‰§è¡Œçš„ï¼Œæ ¸ç†</p><p>ç”±äºæ‰§è¡Œé¡ºåºæ˜¯ï¼š<code>æ„é€ æ–¹æ³• &gt; @Autowired &gt; @PostConstruct</code></p><p>æ‰€ä»¥ï¼Œæ‰§è¡Œ<code>@PostConstruct</code>çš„æ—¶å€™ï¼Œ<code>staticSever</code>å·²ç»æ³¨å…¥å®Œæˆï¼Œä¸ç”¨æ‹…å¿ƒï¼Œä¸€åˆ‡å°±ç»ª</p><p>æˆ‘ä»¬åªè¦æŠŠ<code>IOC</code>å®¹å™¨ä¸­çš„<code>Util</code>å®ä¾‹çš„<code>this</code>æŒ‡é’ˆèµ‹å€¼ç»™<code>static</code>å˜é‡<code>INS</code>å³å¯ï¼ˆæŒ‡é’ˆçš„èµ‹å€¼å•Šï¼Œé—®é¢˜ä¸å¤§ï¼‰</p><blockquote><p> ä»€ä¹ˆï¼Œä½ é—®æˆ‘å“ªæ¥çš„<code>this</code>ï¼Ÿ</p><p>ä½ åŠ äº†@Componentæ³¨å†Œä¸ºäº†Beanï¼ŒIOCå®¹å™¨é»˜è®¤ä¼šæ„é€ å•ä¾‹å¯¹è±¡çš„</p></blockquote><blockquote><p>ä»€ä¹ˆï¼Œä½ é—®æˆ‘<code>Util</code>å¼€æ”¾äº†æ„é€ å‡½æ•°æœ‰å¤šä¸ªå®ä¾‹æ€ä¹ˆåŠï¼Ÿ</p><p>@Componenté»˜è®¤æ˜¯å•ä¾‹çš„ï¼Œé—®é¢˜ä¸å¤§ï¼Œåªè¦ä½ ä¸è¦è‡ªå·±æ„é€ ä¸€ä¸ªå‡ºæ¥</p></blockquote><blockquote><p>ä»€ä¹ˆï¼Œä½ é—®æˆ‘è¦æ˜¯åŒäº‹æ„é€ äº†<code>Util</code>æ€ä¹ˆåŠï¼Ÿ</p><p>ç äº†ta</p><p>é—®é¢˜ä¸å¤§ï¼Œæœ¬æ¥ä¹Ÿæ²¡å­˜ä»€ä¹ˆçŠ¶æ€</p></blockquote><h3 id="3-ConfigurationProperties"><a href="#3-ConfigurationProperties" class="headerlink" title="3. @ConfigurationProperties"></a>3. @ConfigurationProperties</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Util</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String staticServer;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStaticServer</span><span class="hljs-params">(String staticServer)</span> &#123;<br>        Util.staticServer = staticServer;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå…¶å®æœ¬è´¨ä¸Šä¹Ÿæ˜¯åˆ©ç”¨<code>set</code>æ–¹æ³•è¿›è¡Œæ³¨å…¥çš„ï¼Œæ‰€ä»¥å¹¶ä¸è¿åè§„åˆ™</p><p>å¥½çš„å¥½çš„ï¼Œä¸‹ç­</p><h3 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h3><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://blog.csdn.net/myli92/article/details/124183788">springbootæ³¨å…¥é™æ€å˜é‡çš„ä¸¤ç§æ–¹å¼_springboot æ³¨å…¥é™æ€å˜é‡-CSDNåšå®¢</a></p><p><a href="https://cloud.tencent.com/developer/article/1896241">SpringBootä¸­é™æ€å˜é‡æ³¨å…¥æ–¹æ¡ˆ,ä¸€ç½‘æ‰“å°½-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></p><p><a href="https://www.jianshu.com/p/149c5a951ffc">@ConfigurationPropertiesä¸é™æ€åŠ è½½é…ç½®æ–‡ä»¶ - ç®€ä¹¦ (jianshu.com)</a></p>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Springboot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨Nginxéƒ¨ç½²httpsç½‘ç«™ï¼ˆå‰åç«¯ï¼‰</title>
    <link href="/2024/01/05/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Nginx%E9%83%A8%E7%BD%B2https%E7%BD%91%E7%AB%99%EF%BC%88%E5%89%8D%E5%90%8E%E7%AB%AF%EF%BC%89/"/>
    <url>/2024/01/05/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Nginx%E9%83%A8%E7%BD%B2https%E7%BD%91%E7%AB%99%EF%BC%88%E5%89%8D%E5%90%8E%E7%AB%AF%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>åˆ«æ€¥ è¿‡å‡ å¤©å†™</p>]]></content>
    
    
    <categories>
      
      <category>è¿ç»´</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Ubuntu</tag>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•ä¼˜é›…åœ°éƒ¨ç½²Springboot in Ubuntu</title>
    <link href="/2024/01/05/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%9C%B0%E9%83%A8%E7%BD%B2Springboot-in-Ubuntu/"/>
    <url>/2024/01/05/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%9C%B0%E9%83%A8%E7%BD%B2Springboot-in-Ubuntu/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Springboot</code>å†…ç½®äº†<code>Tomcat</code>ï¼Œé»˜è®¤æ‰“<code>jar</code>åŒ…ï¼Œéƒ¨ç½²éå¸¸æ–¹ä¾¿</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ java -jar test.jar<br>  .   ____          _            __ _ _<br> /\\ / ___<span class="hljs-string">&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="hljs-string">( ( )\___ | &#x27;</span>_ | <span class="hljs-string">&#x27;_| | &#x27;</span>_ \/ _` | \ \ \ \<br> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )<br>  <span class="hljs-string">&#x27;  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="hljs-string"> =========|_|==============|___/=/_/_/_/</span><br><span class="hljs-string"> :: Spring Boot ::                (v3.2.1)</span><br></code></pre></td></tr></table></figure><p>å¥½ï¼Œèˆ’æœäº†ï¼Œä¸‹ç­ï¼</p><h3 id="åˆ«æ€¥"><a href="#åˆ«æ€¥" class="headerlink" title="åˆ«æ€¥"></a>åˆ«æ€¥</h3><p>åœ¨ä½ å…³ä¸Šç”µè„‘çš„é‚£ä¸€ç¬é—´ï¼Œç»ˆç«¯ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥ï¼Œ<code>Springboot</code>åç«¯ç›´æ¥<strong>BOMB</strong></p><p>å¥½çš„ï¼Œä½ å¯ä»¥åŠ ç­äº†</p><h3 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h3><p>SSHç»ˆç«¯ä¸­å¼€å¯çš„è¿›ç¨‹é»˜è®¤æ˜¯ç»ˆç«¯çš„å­è¿›ç¨‹ï¼Œç»ˆç«¯å…³é—­åï¼Œå­è¿›ç¨‹ä¹Ÿä¼šä¸€å¹¶åœæ­¢ï¼ˆæ”¶åˆ°<code>SIGHUP</code>ä¿¡å·ï¼‰</p><h3 id="è‚¿ä¹ˆåŠ"><a href="#è‚¿ä¹ˆåŠ" class="headerlink" title="è‚¿ä¹ˆåŠ"></a>è‚¿ä¹ˆåŠ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">nohup</span> java -jar test.jar &amp;<br></code></pre></td></tr></table></figure><p>é—®é¢˜ä¸å¤§ï¼Œåªè¦åŠ ä¸Š<code>nohup</code>å’Œ<code>&amp;</code>å³å¯</p><ul><li><code>nohup</code>ï¼šNo Hang UPï¼Œæ„ä¸ºå¿½ç•¥æŒ‚æ–­ä¿¡å·ï¼ˆ<code>SIGHUP</code>ï¼‰ã€‚å³ä½¿SSHä¼šè¯ç»“æŸï¼Œè¿™ä¸ªè¿›ç¨‹ä»ä¼šç»§ç»­è¿è¡Œ</li><li><code>&amp;</code>ï¼šå°†å‘½ä»¤æ”¾å…¥åå°æ‰§è¡Œã€‚å½“ä½ åœ¨å‘½ä»¤çš„æœ«å°¾åŠ ä¸Š<code>&amp;</code>ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šç«‹å³è¿”å›ï¼Œè€Œä¸ä¼šé˜»å¡å½“å‰çš„ç»ˆç«¯</li></ul><p>å®Œç¾ï¼Œé…±ç´«<code>Springboot</code>å°±å¯ä»¥åœ¨åå°å®‰ç¨³è¿è¡Œäº†</p><p>ä¸‹ç­ï¼</p><h3 id="ç­‰ä¸€ä¸‹"><a href="#ç­‰ä¸€ä¸‹" class="headerlink" title="ç­‰ä¸€ä¸‹"></a>ç­‰ä¸€ä¸‹</h3><p>æ²¡äº”åˆ†é’Ÿï¼Œå‰ç«¯åä¸ä½äº†ï¼š</p><blockquote><p>è¯¶ï¼Œä½ è¿™ä¸ªæ€ä¹ˆ<code>500 Internal Server Error</code></p></blockquote><h3 id="ä½ åˆå›åˆ°äº†å·¥ä½ä¸Š"><a href="#ä½ åˆå›åˆ°äº†å·¥ä½ä¸Š" class="headerlink" title="ä½ åˆå›åˆ°äº†å·¥ä½ä¸Š"></a>ä½ åˆå›åˆ°äº†å·¥ä½ä¸Š</h3><p>æ‰“å¼€ç”µè„‘ï¼Œè¿ä¸ŠæœåŠ¡å™¨ï¼Œé¢å¯¹ç©ºç™½çš„ç»ˆç«¯ï¼Œå¿ƒæƒ³ï¼š</p><blockquote><p>è¯¶ï¼Œæˆ‘æ—¥å¿—å‘¢</p></blockquote><p>å°¬ä½äº†</p><p>ä¸è¿‡å¥½åœ¨ï¼Œ<code>ls</code>ä¸€ä¸‹ï¼Œå‘ç°<code>test.jar</code>åŒç›®å½•å¤šäº†ä¸€ä¸ª<code>nohup.out</code>æ–‡ä»¶ï¼Œè¿˜å¥½é‡Œé¢å°±æ˜¯æ—¥å¿—ï¼Œå‘¼å‘¼å‘¼</p><h3 id="è‡ªå®šä¹‰æ—¥å¿—è·¯å¾„"><a href="#è‡ªå®šä¹‰æ—¥å¿—è·¯å¾„" class="headerlink" title="è‡ªå®šä¹‰æ—¥å¿—è·¯å¾„"></a>è‡ªå®šä¹‰æ—¥å¿—è·¯å¾„</h3><p>ä¸è¿‡ï¼Œæœ‰æ²¡æœ‰åŠæ³•è‡ªå®šä¹‰ä¸€ä¸‹æ—¥å¿—æ–‡ä»¶åå’Œç›®å½•å‘¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">nohup</span> java -jar test.jar &gt; test.log 2&gt;&amp;1 &amp;<br></code></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨<code>&gt;</code>ç¬¦å·ï¼Œæ¥é‡å®šå‘æ ‡å‡†è¾“å‡º</p><ul><li><code>&gt; test.log</code>ï¼šé‡å®šå‘æ ‡å‡†è¾“å‡ºï¼ˆæ ‡è¯†ä¸º1ï¼‰åˆ°<code>test.log</code>æ–‡ä»¶</li><li><code>2&gt;&amp;1</code>ï¼šå°†æ ‡å‡†é”™è¯¯ï¼ˆ2ï¼‰é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºï¼ˆ&amp;1ï¼‰ï¼ˆå–åœ°å€ç¬¦ï¼ï¼Œ<code>C++</code>äººç‹‚å–œï¼‰</li></ul><p>å¥½çš„ï¼Œé…±ç´«ï¼Œæ ‡å‡†è¾“å‡ºï¼Œå’Œé”™è¯¯è¾“å‡ºï¼Œéƒ½åˆ°<code>test.log</code>æ–‡ä»¶äº†ï¼Œå®Œç¾</p><blockquote><p>å¤ªPerfectäº†ï¼Œæˆ‘å°±æ˜¯å‘½ä»¤è¡Œçš„ç¥ï¼Œä¸‹ç­ï¼</p></blockquote><h3 id="åä¸‹"><a href="#åä¸‹" class="headerlink" title="åä¸‹"></a>åä¸‹</h3><p>å‰ç«¯è¯´çš„<code>500 Internal Server Error</code>è¿˜æ²¡è§£å†³å‘¢ï¼Œä¸‹å•¥ç­</p><p>å“¦å“¦ï¼Œé‚£è¡Œå§</p><p>çœ‹äº†çœ¼æ—¥å¿—ï¼Œåœ¨<code>IDEA</code>é‡Œå­å“§å­å“§ä¸€é¡¿æ”¹ï¼Œé‡æ–°æ‰“åŒ…ï¼Œæ‹·è´åˆ°æœåŠ¡å™¨ä¸Š</p><h3 id="é‡å¯"><a href="#é‡å¯" class="headerlink" title="é‡å¯"></a>é‡å¯</h3><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•é‡å¯<code>Springboot</code></p><p>è¿™ä¸ªç®€å•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps -aux | grep java<br></code></pre></td></tr></table></figure><p>ç„¶åå†æ ¹æ®è¿›ç¨‹IDï¼Œæ‰§è¡Œ<code>kill</code></p><p>å®Œç¾ï¼Œæ¥ä¸‹æ¥åªè¦å†ä¾è‘«èŠ¦ç”»ç“¢è¿›è¡Œ<code>java -jar</code>å°±å¥½å•¦hhhhhhh</p><p>å“¦ åˆå¿˜äº† <code>nohup</code> é </p><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>è¯è¯´ï¼Œ<code>Springboot</code>é»˜è®¤åœ¨å·¥ä½œç›®å½•ä¸‹å¯»æ‰¾<code>.yml | .properties</code>é…ç½®æ–‡ä»¶ï¼Œè€Œä¸æ˜¯<code>.jar</code>åŒç›®å½•ä¸‹å“¦</p><p>é…ç½®æ–‡ä»¶åŠ è½½ä¼˜å…ˆçº§ï¼š</p><ul><li><strong>å½“å‰å·¥ä½œç›®å½•</strong>ï¼ˆä»ä¸­å¯åŠ¨åº”ç”¨çš„ç›®å½•ï¼‰ä¸‹çš„<code>/config</code>å­ç›®å½•ã€‚</li><li><strong>å½“å‰å·¥ä½œç›®å½•</strong>ã€‚</li><li><strong>classpath</strong>ä¸‹çš„<code>/config</code>åŒ…ã€‚</li><li><strong>classpath</strong>çš„æ ¹è·¯å¾„ã€‚</li></ul><p>é…±ç´«æœ€å¥½æ‰‹åŠ¨æŒ‡å®šä¸€ä¸‹ç»å¯¹è·¯å¾„å“¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">nohup</span> java -jar test.jar --spring.config.location=file:/www/Springboot/TestDir/ &gt; test.log 2&gt;&amp;1 &amp; <br></code></pre></td></tr></table></figure><p>å¥½çš„ï¼Œæ€ä¹ˆå¥½åƒæ‰‹æ•²çš„å‹åŠ›å¼€å§‹å¢å¤§äº† &#x2F;æ±—</p><p><del>ï¼ˆå°å£°ï¼šè¿˜æœ‰è™šæ‹Ÿæœºå‚æ•° <code>-Xmx1024M -Xms256M</code> å·´æ‹‰å·´æ‹‰çš„ï¼‰</del></p><p><del>ï¼ˆå°å£°ï¼šè¿˜æœ‰å¼€æœºè‡ªå¯åŠ¨å·´æ‹‰çš„ï¼‰</del></p><h2 id="Systemd-æœåŠ¡è¿›ç¨‹"><a href="#Systemd-æœåŠ¡è¿›ç¨‹" class="headerlink" title="Systemd æœåŠ¡è¿›ç¨‹"></a>Systemd æœåŠ¡è¿›ç¨‹</h2><p>ä¸ä¼šå§ï¼Œä¸ä¼šå§ï¼Œä¸ä¼šè¿˜æœ‰äººå‘½ä»¤è¡Œè£¸æ•²<code>java -jar</code>ï¼Œç¾å…¶åæ›°<strong>éƒ¨ç½²</strong>å§</p><h3 id="Systemd"><a href="#Systemd" class="headerlink" title="Systemd"></a>Systemd</h3><blockquote><p>systemd æ˜¯ Linux ä¸Šçš„ä¸€ç§ç³»ç»Ÿå’ŒæœåŠ¡ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç†ç³»ç»Ÿä¸Šè¿è¡Œçš„è¿›ç¨‹å’ŒæœåŠ¡ã€‚systemd æœåŠ¡æ˜¯ä¸€ç§å¯ä»¥ç”± systemd ç®¡ç†çš„åå°è¿›ç¨‹æˆ–æœåŠ¡</p></blockquote><p>æˆ‘ä»¬å¯ä»¥å°†<code>Springboot</code>ç¨‹åºåˆ¶ä½œä¸º<code>systemd</code>æœåŠ¡ï¼Œå°±å¯ä»¥æ–¹ä¾¿åœ°å¯åŠ¨ã€åœæ­¢ã€é‡å¯ä»¥åŠçŠ¶æ€æ£€æµ‹</p><h3 id="How"><a href="#How" class="headerlink" title="How"></a>How</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°†<code>Springboot</code>ç¨‹åºæ³¨å†Œä¸ºSystemdæœåŠ¡</p><p>å¾ˆç®€å•ï¼Œåªè¦åœ¨<code>/etc/systemd/system/</code>ç›®å½•ä¸‹ï¼Œåˆ›å»º<code>myapp.service</code>æ–‡ä»¶å³å¯ï¼ˆæœåŠ¡å•å…ƒæ–‡ä»¶ï¼Œæ–‡ä»¶åå³æœåŠ¡åï¼‰</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=My Spring Boot Application<br><span class="hljs-comment"># æœåŠ¡æè¿°ï¼šè¿™é‡Œæè¿°äº†æœåŠ¡çš„åŠŸèƒ½æˆ–ç”¨é€”</span><br><span class="hljs-attr">After</span>=syslog.target network.target<br><span class="hljs-comment"># ä¾èµ–æ€§å’Œé¡ºåºï¼šæŒ‡å®šäº†è¯¥æœåŠ¡åœ¨å“ªäº›æœåŠ¡ä¹‹åå¯åŠ¨ã€‚è¿™é‡ŒæŒ‡å®šäº†åœ¨syslogå’Œç½‘ç»œæœåŠ¡ï¼ˆnetwork.targetï¼‰ä¹‹åå¯åŠ¨ã€‚</span><br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">User</span>=somebody     <br><span class="hljs-comment"># è¿è¡ŒæœåŠ¡çš„ç”¨æˆ·</span><br><span class="hljs-attr">WorkingDirectory</span>=/opt/Test/ <br><span class="hljs-comment"># å·¥ä½œç›®å½•</span><br><span class="hljs-attr">ExecStart</span>=java -jar Test-<span class="hljs-number">0.0</span>.<span class="hljs-number">1</span>-SNAPSHOT.jar --spring.profiles.active=prod<br><span class="hljs-comment"># å¯åŠ¨å‘½ä»¤ï¼šæŒ‡å®šå¯åŠ¨æœåŠ¡æ—¶æ‰§è¡Œçš„å‘½ä»¤</span><br><span class="hljs-attr">SuccessExitStatus</span>=<span class="hljs-number">143</span><br><span class="hljs-comment"># æˆåŠŸé€€å‡ºçŠ¶æ€ç ï¼šå½“æœåŠ¡ä»¥è¿™äº›çŠ¶æ€ç é€€å‡ºæ—¶ï¼Œå°†è¢«è§†ä¸ºæ­£å¸¸é€€å‡ºã€‚143æ˜¯Spring Bootåº”ç”¨åœ¨æ¥æ”¶åˆ°SIGTERMä¿¡å·æ—¶çš„æ ‡å‡†é€€å‡ºä»£ç </span><br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br><span class="hljs-comment"># å®‰è£…è®¾ç½®ï¼šæŒ‡å®šå½“ä½¿ç”¨ &#x27;systemctl enable&#x27; å‘½ä»¤å¯ç”¨æœåŠ¡æ—¶ï¼Œè¯¥æœåŠ¡åº”è¯¥è¢«å“ªä¸ªç›®æ ‡æ‰€å¼•ç”¨</span><br><span class="hljs-comment"># è¿™æ„å‘³ç€ï¼Œå½“ç³»ç»Ÿè¾¾åˆ°multi-user.targetæ—¶ï¼Œä½ çš„æœåŠ¡ä¼šè‡ªåŠ¨å¯åŠ¨</span><br><span class="hljs-comment"># multi-user.target é€‚ç”¨äºå¤šç”¨æˆ·çš„è¿è¡Œçº§åˆ«ï¼Œè¿™æ„å‘³ç€æœåŠ¡å°†åœ¨ç³»ç»Ÿè¾¾åˆ°å¤šç”¨æˆ·æ¨¡å¼æ—¶å¯åŠ¨</span><br></code></pre></td></tr></table></figure><p>æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„</p><ol><li>å°†<code>Springboot</code>é…ç½®ä¸ºç³»ç»ŸæœåŠ¡åï¼Œä¸éœ€è¦å†<code>nohup</code>ï¼Œé»˜è®¤å¼€å¯æ–°åå°è¿›ç¨‹</li><li>æˆ‘ä»¬æŒ‡å®šäº†å·¥ä½œç›®å½•ï¼Œä¼šè‡ªåŠ¨å¯»æ‰¾é…ç½®æ–‡ä»¶ï¼Œä¸éœ€è¦å†æŒ‡å®š</li><li>å…³äºå·¥ä½œç›®å½•çš„é€‰å€ï¼Œæœ€å¥½æ˜¯æ”¾åœ¨<code>/opt/</code>ä¸‹ï¼Œè€Œä¸æ˜¯ç”¨æˆ·çš„<code>home</code>ç›®å½•ï¼Œè¿™æ ·æ–¹ä¾¿ä¹‹å<code>Nginx</code>è®¿é—®é™æ€èµ„æºï¼Œè€Œä¸”è¿™ä¸ªç›®å½•æ˜¯ä¸“é—¨ç”¨äºç¬¬ä¸‰æ–¹åº”ç”¨çš„</li><li>å…³äºUserï¼Œéšä¾¿æŒ‡å®šä¸€ä¸ªæ™®é€šç”¨æˆ·å°±è¡Œäº†ï¼ˆæœ€å¥½ä¸è¦rootï¼‰</li><li>ä¸€èˆ¬åªéœ€è¦æ›´æ”¹<code>WorkingDirectory</code> &amp; <code>ExecStart</code>ï¼Œå…¶ä»–çš„æ— ä¼¤å¤§é›…</li></ol><p>å®Œæˆä¹‹åï¼Œæˆ‘ä»¬éœ€è¦é€šçŸ¥<code>systemd</code>æœåŠ¡é‡è½½é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl daemon-reload<br></code></pre></td></tr></table></figure><p>ç„¶åå¯åŠ¨<code>myapp</code>æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl start myapp<br></code></pre></td></tr></table></figure><p>æœåŠ¡é»˜è®¤æ˜¯æ²¡æœ‰å¼€æœºè‡ªå¯åŠ¨çš„ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°å¼€å¯æˆ–å…³é—­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl <span class="hljs-built_in">enable</span> myapp<br>sudo systemctl <span class="hljs-built_in">disable</span> myapp<br></code></pre></td></tr></table></figure><p>åœæ­¢ &amp; é‡å¯ä¹Ÿæ˜¯ä¿¡æ‰‹æ‹ˆæ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl stop myapp<br>sudo systemctl restart myapp<br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ä½¿ç”¨<code>status</code>å‘½ä»¤æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl status myapp.service<br>â— myapp.service - My Spring Boot Application<br>     Loaded: loaded (/etc/systemd/system/myapp.service; disabled; vendor preset: enabled)<br>     Active: active (running) since Sat 2024-01-06 20:45:56 CST; 5 days ago<br>   Main PID: 109708 (java)<br>      Tasks: 37 (<span class="hljs-built_in">limit</span>: 4150)<br>     Memory: 210.4M<br>        CPU: 7min 33.637s<br>     CGroup: /system.slice/myapp.service<br>             â””â”€109708 java -jar Test-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod<br><br>Jan 06 20:45:58 ubuntu-HK java[109708]:   .   ____          _            __ _ _<br>Jan 06 20:45:58 ubuntu-HK java[109708]:  /\\ / ___<span class="hljs-string">&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="hljs-string">Jan 06 20:45:58 ubuntu-HK java[109708]: ( ( )\___ | &#x27;</span>_ | <span class="hljs-string">&#x27;_| | &#x27;</span>_ \/ _` | \ \ \ \<br>Jan 06 20:45:58 ubuntu-HK java[109708]:  \\/  ___)| |_)| | | | | || (_| |  ) ) ) )<br>Jan 06 20:45:58 ubuntu-HK java[109708]:   <span class="hljs-string">&#x27;  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="hljs-string">Jan 06 20:45:58 ubuntu-HK java[109708]:  =========|_|==============|___/=/_/_/_/</span><br><span class="hljs-string">Jan 06 20:45:58 ubuntu-HK java[109708]:  :: Spring Boot ::                (v3.0.1)</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>.service</code>æ–‡ä»¶çš„ä½ç½®ï¼Œæ˜¯å¦å¼€æœºè‡ªå¯ï¼Œä»¥åŠå½“å‰çš„çŠ¶æ€ï¼ˆactive (running)ï¼‰</p><p>åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜èƒ½çœ‹åˆ°ç¨‹åºçš„éƒ¨åˆ†æ—¥å¿—</p><h2 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h2><p>å¯¹äº†ï¼Œåº”ç”¨ç¨‹åºå˜æˆä¸€ä¸ªç³»ç»ŸæœåŠ¡ä¹‹åï¼Œæ—¥å¿—æ˜¯å¦‚ä½•ç®¡ç†çš„å‘¢</p><h3 id="Default"><a href="#Default" class="headerlink" title="Default"></a>Default</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåº”ç”¨çš„æ‰€æœ‰æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰å’Œæ ‡å‡†é”™è¯¯ï¼ˆstderrï¼‰æ—¥å¿—éƒ½ä¼šè¢«<code>systemd</code>æ•è·</p><p><code>systemd</code>ä½¿ç”¨<code>journald</code>æœåŠ¡æ¥ç®¡ç†è¿™äº›æ—¥å¿—ï¼Œå¯ä»¥é€šè¿‡<code>journalctl</code>å‘½ä»¤æ¥æŸ¥çœ‹å’Œç®¡ç†è¿™äº›æ—¥å¿—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo journalctl -u myapp<br></code></pre></td></tr></table></figure><p>çœ‹ä¼¼å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å¤±å»äº†å¯¹æ—¥å¿—çš„æ§åˆ¶æƒ</p><p>å¦‚ä½•åˆ†å‰²æ—¥å¿—ï¼Œå¦‚ä½•æ¸…ç†æ—¥å¿—ï¼Œéƒ½å˜å¾—ä¸å¤ªå¯æ§</p><h3 id="LogBack"><a href="#LogBack" class="headerlink" title="LogBack"></a>LogBack</h3><p><code>Springboot</code>é»˜è®¤æ”¯æŒäº†<code>Logback</code>æ—¥å¿—æ¡†æ¶ï¼ˆå®ç°äº†<code>Slf4j</code>æ—¥å¿—é—¨é¢ï¼‰</p><p>æ‰€ä»¥åªéœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œå³å¯è¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">logging.file.name</span>=<span class="hljs-string">myapp.log</span><br><span class="hljs-attr">logging.file.path</span>=<span class="hljs-string">/var/log</span><br></code></pre></td></tr></table></figure><p>å¥½çš„ï¼Œç°åœ¨æ—¥å¿—å·²ç»ä»¥æ–‡ä»¶çš„å½¢å¼ä¿å­˜ä¸‹æ¥äº†</p><p>ä½†æ˜¯ä¸ºä»€ä¹ˆ<code>journalctl -u myapp</code>è¿˜æ˜¯å¯ä»¥çœ‹åˆ°æ—¥å¿—å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºæ—¥å¿—åŒæ—¶è¾“å‡ºåˆ°äº†æ§åˆ¶å°ï¼ˆæ ‡å‡†è¾“å‡ºã€é”™è¯¯è¾“å‡ºï¼‰ &amp; æ–‡ä»¶</p><p>æ‰€ä»¥æ—¥å¿—è¾“å‡ºåˆ°äº†ä¸¤ä¸ªç›®çš„åœ°ï¼Œæ§åˆ¶å°çš„è¾“å‡ºè¢«<code>journalctl</code>æ•è·ï¼Œè¿™æ ·åŠ¿å¿…ä¼šé€ æˆç©ºé—´æµªè´¹</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å…³é—­æ§åˆ¶å°è¾“å‡ºï¼Œå¹¶ä¸”ä¸ºäº†æ›´ç²¾ç»†åœ°æ§åˆ¶æ—¥å¿—ç­–ç•¥ï¼ˆæ»šåŠ¨åˆ†å‰²ç­‰ï¼‰ï¼Œæˆ‘ä»¬æœ€å¥½è¿˜æ˜¯è‡ªå·±å†™<code>Logback</code>çš„é…ç½®æ–‡ä»¶</p><h4 id="Logbacké…ç½®æ–‡ä»¶"><a href="#Logbacké…ç½®æ–‡ä»¶" class="headerlink" title="Logbacké…ç½®æ–‡ä»¶"></a>Logbacké…ç½®æ–‡ä»¶</h4><p>æˆ‘ä»¬å¯ä»¥åœ¨å·¥ç¨‹çš„<code>Resources</code>æ–‡ä»¶å¤¹ä¸‹æ–°å»º<code>logback-spring.xml</code>æ–‡ä»¶</p><p>å…¶å®ä¹Ÿå¯ä»¥æ˜¯<code>logback.xml</code>ï¼Œä½†æ˜¯è¿™ä¹ˆå†™æ˜¯ä¸èƒ½è¯»å–<code>Springboot</code>çš„é…ç½®æ–‡ä»¶çš„ï¼ˆå¬è¯´æœ‰äº›ç‰ˆæœ¬ä¸èƒ½ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--ä» yml|properties é…ç½®æ–‡ä»¶ä¸­è¯»å–é”®å€¼ ä»¥æ–¹ä¾¿ä¿®æ”¹æ—¥å¿—è·¯å¾„--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">springProperty</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;context&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LOG_HOME&quot;</span> <span class="hljs-attr">source</span>=<span class="hljs-string">&quot;log.path&quot;</span> <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">&quot;logs-default&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%pï¼šçº§åˆ« %msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;PATTERN&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %p [%t] - %logger&#123;50&#125;  :  %m%n&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;PATTERN_COLOR&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %highlight(%p) [%t] - %cyan(%logger&#123;50&#125;)  :  %m%n&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--é«˜äº®ä¼šè¾“å‡ºå¤šä½™å­—ç¬¦ï¼Œæ‰€ä»¥åœ¨FILEä¸­ä¸å¼€å¯--&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!--é…ç½®æ§åˆ¶å°è¾“å‡º--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$&#123;PATTERN_COLOR&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--æ–‡ä»¶æ—¥å¿—ï¼Œ æŒ‰ç…§æ¯å¤©ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ï¼Œä¼˜å…ˆçº§é«˜äºymlæ–‡ä»¶ä¸­çš„logging.file.path--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶å--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">FileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/%d&#123;yyyy-MM-dd&#125;.log<span class="hljs-tag">&lt;/<span class="hljs-name">FileNamePattern</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">MaxHistory</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">MaxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$&#123;PATTERN&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--ALL &lt; TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; OFF--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><span class="hljs-comment">&lt;!-- devç¯å¢ƒä¸è¾“å‡ºåˆ°æ–‡ä»¶ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;STDOUT&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;prod&quot;</span>&gt;</span><span class="hljs-comment">&lt;!-- prodç¯å¢ƒä»…è¾“å‡ºåˆ°æ–‡ä»¶ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;FILE&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨<code>.properties</code>é…ç½®æ–‡ä»¶é‡ŒæŒ‡å®šæ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆè‡ªå®šä¹‰é”®ï¼‰</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">log.path</span>=<span class="hljs-string">/logs</span><br></code></pre></td></tr></table></figure><p>ä¸ºäº†é¿å…å’Œå†…ç½®çš„<code>logging.file.path</code>å†²çªï¼Œæˆ‘ä»¬è¿™é‡Œé‡‡ç”¨äº†è‡ªå®šä¹‰é”®</p><p>å°è´´å£«ï¼šå…¶å®æˆ‘ä»¬åœ¨<code>logback-spring.xml</code>ä¸­è‡ªå®šä¹‰äº†è¾“å‡ºçš„æ–‡ä»¶ä½ç½®ä¹‹åï¼Œ<code>logging.file.path</code>ä¼šè¢«è¦†ç›–ï¼Œç”¨æˆ·çš„<code>xml</code>é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§æ›´é«˜</p><p>ä½†æ˜¯ä¸ºäº†è¯­ä¹‰æ›´æ¸…æ™°ï¼Œè¿˜æ˜¯é‡‡ç”¨è‡ªå®šä¹‰é”®å§ï¼ˆbaï¼‰</p><h4 id="Logbackå¤šç¯å¢ƒé…ç½®"><a href="#Logbackå¤šç¯å¢ƒé…ç½®" class="headerlink" title="Logbackå¤šç¯å¢ƒé…ç½®"></a>Logbackå¤šç¯å¢ƒé…ç½®</h4><p>æ³¨æ„ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†<code>&lt;springProfile name=&quot;dev&quot;&gt;</code>è¿™æ ·æ ‡ç­¾</p><p>taå¯ä»¥æ ¹æ®<code>Springboot</code>å½“å‰æ¿€æ´»çš„é…ç½®æ–‡ä»¶ï¼ˆç¯å¢ƒï¼‰ï¼Œæ¥åŠ¨æ€å¾—é‡‡å–ä¸åŒçš„æ—¥å¿—ç­–ç•¥ï¼Œå¦‚ï¼š</p><ul><li>åœ¨<code>dev</code>å¼€å‘ç¯å¢ƒä¸­ï¼Œä»…è¾“å‡ºæ—¥å¿—åˆ°æ§åˆ¶å°</li><li>åœ¨<code>prod</code>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä»…è¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶ï¼ˆé˜²æ­¢è¾“å‡ºåˆ°æ§åˆ¶å°è¢«<code>journalctl</code>æ•è·ï¼Œäº§ç”Ÿä¸¤ä»½æ—¥å¿—ï¼‰</li></ul><h2 id="Springbootå¤šç¯å¢ƒé…ç½®"><a href="#Springbootå¤šç¯å¢ƒé…ç½®" class="headerlink" title="Springbootå¤šç¯å¢ƒé…ç½®"></a>Springbootå¤šç¯å¢ƒé…ç½®</h2><p>åˆšåˆšæåˆ°äº†æ ¹æ®<code>Springboot</code>å½“å‰ç¯å¢ƒæ¥é€‰æ‹©æ—¥å¿—ç­–ç•¥</p><p>é‚£ä¹ˆ<code>Springboot</code>ç¯å¢ƒé…ç½®æ˜¯ä»€ä¹ˆæ„æ€å‘¢</p><p>ä¸»è¦åŸå› æ˜¯æˆ‘ä»¬åœ¨å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¸­å¯¹äºåŒä¸€ä¸ªé…ç½®å±æ€§å¯èƒ½éœ€è¦ä¸åŒçš„å€¼</p><p>ä¾‹å¦‚ï¼šæ•°æ®åº“å¯†ç ã€æ—¥å¿—å­˜æ”¾è·¯å¾„ã€é™æ€èµ„æºæœåŠ¡å™¨åœ°å€ç­‰ç­‰</p><p>æ‰€ä»¥æœ€æ–¹ä¾¿çš„æ–¹å¼æ˜¯å†™ä¸¤å¥—é…ç½®æ–‡ä»¶ï¼Œç„¶åå†ä¸åŒåœºæ™¯è¿›è¡Œåˆ‡æ¢ï¼Œå¦‚ï¼š</p><ul><li>application.yml</li><li>application-dev.yml</li><li>application-prod.yml</li></ul><p>æ³¨ï¼šå‘½åè§„åˆ™ï¼š<code>application-&#123;profile&#125;.yml</code><br>æ³¨ï¼šåŒåå±æ€§ä¼˜å…ˆçº§ï¼šå…·ä½“é…ç½®æ–‡ä»¶ &gt; é€šç”¨é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰<br>æ³¨ï¼šå…¶å®ä½ æƒ³æŠŠä¸åŒç¯å¢ƒé…ç½®æ–‡ä»¶å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œä¹Ÿå¯ä»¥ï¼Œç”¨<code>---</code>åˆ†å‰²ï¼Œä½†æ˜¯åˆ«å§ï¼Œå¤§å“¥</p><p>è¯¶ç­‰ç­‰ï¼Œæ€ä¹ˆæœ‰ä¸‰ä¸ªé…ç½®æ–‡ä»¶</p><blockquote><p>ä½ å‚»å•Šï¼Œé€šç”¨çš„é…ç½®æ”¾<code>application.yml</code>å°±å¥½äº†éš¾é“ä½ è¦å†™ä¸¤éå•Š</p></blockquote><p>å¥½çš„ï¼Œé‚£è¦æ€ä¹ˆåˆ‡æ¢é…ç½®å‘¢</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¹Ÿå°±æ˜¯<code>default</code>ç¯å¢ƒï¼Œåªå¯ç”¨<code>application.yml</code> or propertiesï¼ˆè¿™ä¿©ä¸€æ ·çš„ï¼Œä¸å¤šèµ˜è¿°ï¼‰</p><p>æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥åˆ‡æ¢</p><ul><li>åœ¨<code>application.properties</code>ä¸­å†™ä¸Šï¼š<code>spring.profiles.active=dev</code> or prodç­‰ç­‰</li><li>åœ¨<code>java -jar</code>çš„æ—¶å€™ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°<code>--spring.profiles.active=prod</code>æ¥æ¿€æ´»ç”Ÿäº§ç¯å¢ƒé…ç½®</li><li>åœ¨<code>IDEA</code>ä¸­é…ç½®ï¼šç¼–è¾‘è¿è¡Œ&#x2F;è°ƒè¯•é…ç½®-&gt;æ´»åŠ¨&#x2F;æœ‰æ•ˆé…ç½®ï¼ˆå¯ä»¥æ‰¾æ‰¾ï¼Œè¿™ä¸ªç®€å•ï¼Œä¸»è¦ä¸æƒ³æ”¾å›¾äº†ï¼‰</li></ul><p>æ€ä¹ˆçŸ¥é“<code>Springboot</code>ç°åœ¨æ˜¯ä»€ä¹ˆç¯å¢ƒå‘¢ï¼Ÿåœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ä¼šè¾“å‡º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">2024-01-12 19:41:19.130 INFO [main] - com.mrbean.test.TestApplication  :  The following 1 profile is active: <span class="hljs-string">&quot;dev&quot;</span><br></code></pre></td></tr></table></figure><p>å¥½çš„ï¼Œé…±ç´«å°±å¯ä»¥å®Œç¾åˆ‡æ¢é…ç½®æ–‡ä»¶äº†ï¼Œè¦æ˜¯è¿˜æœ‰ä»€ä¹ˆéœ€è¦ä¿®æ”¹çš„ï¼Œåªè¦åœ¨ç”Ÿæˆç¯å¢ƒæ–°å»ºä¸€ä¸ª<code>application-prod.yml</code>ï¼Œå°±å¯ä»¥è¦†ç›–å¯¹åº”çš„å±æ€§äº†ï¼Œè¿™ä¸ªå¤§å®¶åº”è¯¥å¾ˆæ‡‚çš„ï¼Œæˆ‘å°±ä¸è¯´äº†</p><h3 id="é…ç½®æ–‡ä»¶åä½œæœ€ä½³å®è·µ"><a href="#é…ç½®æ–‡ä»¶åä½œæœ€ä½³å®è·µ" class="headerlink" title="é…ç½®æ–‡ä»¶åä½œæœ€ä½³å®è·µ"></a>é…ç½®æ–‡ä»¶åä½œæœ€ä½³å®è·µ</h3><p>ï¼ˆè¿™æ–‡å°±å†™ä¸å®Œäº†æ˜¯å§ï¼ï¼‰</p><p>æˆ‘ä»¬åˆšåˆšè¯´äº†ï¼Œæœ‰ä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯ä¸€æ—¦è¿›å…¥<code>Git</code>å¤šäººåä½œï¼Œå°±ä¼šç›´æ¥çˆ†ç‚¸</p><p>å› ä¸ºæ¯ä¸ªäººçš„æœ¬åœ°ç¯å¢ƒæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥<code>application-dev.yml</code>åŠ¿å¿…ä¼šè¢«æ”¹æ¥æ”¹å»ï¼Œç„¶åè¿˜ä¸Šä¼ <code>Git</code></p><p>ç„¶å<code>pull</code>çš„æ—¶å€™å°±ä¼šç›´æ¥è¦†ç›–ä½ çš„å¼€å‘é…ç½®ï¼Œå°±ä¼šæƒ³è¦ * é˜Ÿå‹äº†</p><h4 id="è¾£æ€ä¹ˆåŠ"><a href="#è¾£æ€ä¹ˆåŠ" class="headerlink" title="è¾£æ€ä¹ˆåŠ"></a>è¾£æ€ä¹ˆåŠ</h4><p>è¦ä¹ˆå°±æ˜¯ä¸ä¸Šä¼ <code>application-dev.yml</code></p><p>é‚£ä¸æˆå•Šï¼Œé‚£æƒ³æ–°å¢&#x2F;ä¿®æ”¹é…ç½®ï¼Œå…¶ä»–æˆå‘˜å®Œå…¨é˜¿å·´æ€ä¹ˆåŠ</p><p>å…¶å®æˆ‘ä»¬å¯ä»¥å»ºç«‹<code>application-dev-template.yml</code>æ–‡ä»¶ï¼Œä½œä¸ºæ¨¡æ¿ï¼Œéå¿…è¦ä¸ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶</p><p>ç„¶åæ¯ä¸ªæˆå‘˜è‡ªå·±æ ¹æ®æ¨¡æ¿æ–°å»º<code>application-dev.yml</code>ï¼Œä¸”åŠ å…¥<code>.gitignore</code>ä¸ä¸Šä¼ <code>Git</code></p><h2 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h2><p>å®Œç¾ï¼Œè¿™ä¸‹æ€»å¯ä»¥ä¸‹ç­äº†å§</p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://blog.csdn.net/chengmin123456789/article/details/108829987">Springboot æŒ‡å®šè¿è¡Œæ—¶é…ç½®æ–‡ä»¶çš„å‡ ç§æ–¹å¼_dspring.config.location-CSDNåšå®¢</a></p><p><a href="https://juejin.cn/post/7230415879883276346">å…³äº springboot æœåŠ¡åˆ¶ä½œæˆ systemd æœåŠ¡ - æ˜é‡‘ (juejin.cn)</a></p><p><a href="https://zhuanlan.zhihu.com/p/106234119">Spring bootä½¿ç”¨logbackå®ç°å¤šç¯å¢ƒé…ç½® - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://blog.csdn.net/qq_44885775/article/details/123471021">31 SpringBootå¤šç¯å¢ƒçš„åˆ‡æ¢(ç”Ÿäº§ç¯å¢ƒã€å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒ)_spring bootç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒ-CSDNåšå®¢</a></p>]]></content>
    
    
    <categories>
      
      <category>è¿ç»´</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Springboot</tag>
      
      <tag>Ubuntu</tag>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>å¤šç¯å¢ƒ</tag>
      
      <tag>æ—¥å¿—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git:å¦‚ä½•å°†[ä»…æºç (zip)]ä¸è¿œç«¯ä»“åº“å…³è”</title>
    <link href="/2023/12/15/Git-%E5%A6%82%E4%BD%95%E5%B0%86-%E4%BB%85%E6%BA%90%E7%A0%81-zip-%E4%B8%8E%E8%BF%9C%E7%AB%AF%E4%BB%93%E5%BA%93%E5%85%B3%E8%81%94/"/>
    <url>/2023/12/15/Git-%E5%A6%82%E4%BD%95%E5%B0%86-%E4%BB%85%E6%BA%90%E7%A0%81-zip-%E4%B8%8E%E8%BF%9C%E7%AB%AF%E4%BB%93%E5%BA%93%E5%85%B3%E8%81%94/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå¤§ä¸­ååŒºä¿¡å·ä¸è¦å¤ªå¥½ï¼Œæ‰“ä¸é€š<code>Github</code>æ˜¯å¸¸æ€</p><p><code>git clone</code>ä¹Ÿæ˜¯æ—¶å¸¸<code>error</code></p><p>å¯¹äºä¸€ä¸ªå¤§ä»“åº“ï¼Œè¿˜ä¸å¦‚ç›´æ¥ä¸‹è½½<code>æºç zip</code>æ¥å¾—å¿«</p><p>ä½†æ˜¯è§£å‹ä¹‹åæˆ‘ä»¬ä¼šå‘ç°ï¼Œè¿™ä¸ª<code>zip</code>é‡Œæ²¡æœ‰<code>.git</code>æ–‡ä»¶å¤¹ï¼Œå®›å¦‚ä¸€åªç¦»å¼€èœ‚ç¾¤çš„æ— äººæœºï¼Œå†ä¹Ÿæ— æ³•å›å®¶</p><p>æ²¡æœ‰<code>.git</code>æ–‡ä»¶å¤¹å°±æ„å‘³ç€æ²¡æœ‰åŠ å…¥ç‰ˆæœ¬æ§åˆ¶ï¼Œå°±æ— æ³•ä¸è¿œç«¯<code>Github</code>ä»“åº“äº§ç”Ÿè”ç³»ï¼Œå°±æ˜¯è£¸ä»£ç ï¼ˆ<code>raw codes</code>ï¼‰ï¼Œå†ä¹Ÿæ— æ³•<code>fetch</code>å’Œ<code>push</code>äº†ï¼Œå“­</p><h2 id="è¾£æ€ä¹ˆåŠ"><a href="#è¾£æ€ä¹ˆåŠ" class="headerlink" title="è¾£æ€ä¹ˆåŠ"></a>è¾£æ€ä¹ˆåŠ</h2><blockquote><p>è¾£å°±å–ç‰›å¥¶</p></blockquote><p>ä¸ç®¡æ€ä¹ˆè¯´ï¼Œæ€»å¾—å…ˆåˆ›å»ºä¸€ä¸ªæœ¬åœ°<code>git</code>ä»“åº“å§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git init<br></code></pre></td></tr></table></figure><p>okï¼Œé‚£ä¹ˆæ€ä¹ˆå’Œè¿œç«¯<code>Github</code>ä»“åº“äº§ç”Ÿå…³è”å‘¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git remote add origin https://github.com/XXX/XXX.git<br></code></pre></td></tr></table></figure><p>é…±ç´«å°±æ·»åŠ äº†ä¸€ä¸ªåä¸º<code>origin</code>çš„è¿œç¨‹ä»“åº“äº†</p><p>åæ˜ åœ¨<code>.git\config</code>æ–‡ä»¶ä¸­å°±æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs config">[remote &quot;origin&quot;]<br>url = https://github.com/XXX/XXX.git<br>fetch = +refs/heads/*:refs/remotes/origin/*<br></code></pre></td></tr></table></figure><p>è¿™æ®µè¡¨æ˜ï¼š</p><ul><li>å£°æ˜äº†ä¸€ä¸ªè¿œç«¯ä»“åº“ï¼Œåä¸º<code>origin</code></li><li>å…¶<code>url</code>ä¸ºï¼š<code>https://github.com/XXX/XXX.git</code></li><li>æ‰§è¡Œ <code>git fetch</code> æ“ä½œæ—¶ï¼Œè¿œç¨‹ä»“åº“çš„æ‰€æœ‰åˆ†æ”¯ä¼šè¢«æŠ“å–å¹¶å¼ºåˆ¶æ›´æ–°åˆ°æœ¬åœ°çš„ <code>origin/*</code> å¼•ç”¨ä¸Šï¼ˆç®€è€Œè¨€ä¹‹å°±æ˜¯ç”¨è¿œç«¯æ›´æ–°æœ¬åœ°ï¼‰</li></ul><h3 id="By-the-way"><a href="#By-the-way" class="headerlink" title="By the way"></a>By the way</h3><p>å…¶å®ä¸€ä¸ªè¿œç¨‹ä»“åº“ä¹Ÿå¯ä»¥å¯¹åº”ä¸¤ä¸ª<code>url</code>ï¼ˆå¦‚ï¼šåŒæ—¶æ¨é€åˆ°giteeå’Œgithubï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git remote set-url --add origin git@github.com:XXX/XXX.git<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs config">[remote &quot;origin&quot;]<br>url = https://gitee.com/XXX/XXX.git<br>url = git@github.com:XXX/XXX.git    #è¿™é‡Œç”¨gitæˆ–httpåè®®éƒ½å¯ä»¥<br>fetch = +refs/heads/*:refs/remotes/origin/*<br></code></pre></td></tr></table></figure><p>ç±»ä¼¼é…±ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä»å“ªä¸ªurl fetchå‘¢</p><blockquote><p>ç­”ï¼šé»˜è®¤æ˜¯ç¬¬ä¸€ä¸ªurl</p></blockquote><p>ä¸”<code>push</code>æ—¶ä¼šåŒæ—¶å‘ä¸¤ä¸ª<code>url</code>æ¨é€ï¼Œå¯ä»¥ç”¨<code>git remote -v</code>æŸ¥çœ‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git remote -v<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">origin  https://gitee.com/XXX/XXX.git (fetch)<br>origin  https://gitee.com/XXX/XXX.git (push)<br>origin  git@github.com:XXX/XXX.git (push)<br></code></pre></td></tr></table></figure><h3 id="Okay-back"><a href="#Okay-back" class="headerlink" title="Okay back"></a>Okay back</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªè¿œç¨‹ä»“åº“<code>origin</code>ï¼Œä½†ä¹Ÿä»…æ­¤è€Œå·²</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git <span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git branch -a<br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ä»€ä¹ˆéƒ½æ²¡æœ‰è¾“å‡ºï¼Œç”šè‡³è¿ä¸€ä¸ªæœ¬åœ°åˆ†æ”¯éƒ½æ²¡æœ‰ï¼ˆä¸»åˆ†æ”¯ä¹Ÿæ²¡æœ‰ï¼‰</p><p>å•¥ä¹Ÿæ²¡æœ‰äº†å±äºæ˜¯ï¼Œ<code>no commit, no branch</code></p><p>é‚£å’‹æ•´å•Šï¼Œä¸ç®¡äº†ï¼Œå…ˆ<code>fetch</code>ä¸€ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git fetch <span class="hljs-comment">#é»˜è®¤ä»originæ‹‰å– å› ä¸ºåªæœ‰ä¸€ä¸ªä»“åº“</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git branch -a<br>  remotes/origin/dev<br>  remotes/origin/master<br></code></pre></td></tr></table></figure><p>å¤ªå¥½äº†ï¼Œç°åœ¨æœ‰äº†å‡ ä¸ªè¿œç¨‹åˆ†æ”¯ï¼Œä½†æ˜¯ä»ç„¶æ²¡æœ‰æœ¬åœ°åˆ†æ”¯ï¼ˆ<code>git branch</code>æ˜¾ç¤ºå½“å‰åˆ†æ”¯ä¸ºç©ºï¼‰</p><p>ä¸ºä»€ä¹ˆæ²¡æœ‰æœ¬åœ°åˆ†æ”¯ï¼Œä¹Ÿæ²¡æœ‰å½“å‰åˆ†æ”¯å‘¢ï¼Ÿ</p><p>å› ä¸ºæ²¡æœ‰<code>commit</code>ï¼ŒHEADæŒ‡é’ˆå°±ä¸çŸ¥é“æŒ‡å‘è°ï¼Œä¹Ÿå°±æ²¡æœ‰åˆ†æ”¯äº†</p><p>æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å…¶å®è¿˜æ˜¯æ²¡æœ‰å’Œè¿œç«¯äº§ç”Ÿè¾ƒå¥½çš„å…³è”ï¼ˆæ²¡æœ‰æœ¬åœ°åˆ†æ”¯è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯ï¼‰</p><p>åŒæ—¶ï¼Œç”±äºæ²¡æœ‰æ´»åŠ¨åˆ†æ”¯ï¼Œä¹Ÿæ— æ³•è¿›è¡Œ<code>merge</code>ï¼ˆä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>pull = fetch + merge</code>ï¼‰</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬è¦æ€ä¹ˆè®©æœ¬åœ°æ‹¥æœ‰å’Œè¿œç«¯<code>master</code>ä¸€æ ·çš„<code>commit</code>è®°å½•å‘¢ï¼Ÿ</p><p>å…¶å®å°±æ˜¯æ£€å‡ºï¼ˆ<code>checkout</code>ï¼‰åˆ°è¿œç¨‹åˆ†æ”¯å˜›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git checkout -b master origin/master<br><span class="hljs-comment"># git checkout -b [branch-name] origin/[branch-name]</span><br><span class="hljs-comment"># è¿™ä¼šåˆ›å»ºä¸€ä¸ªåä¸º [branch-name] çš„æ–°æœ¬åœ°åˆ†æ”¯ï¼Œè¯¥åˆ†æ”¯è·Ÿè¸ªè¿œç¨‹çš„ origin/[branch-name] åˆ†æ”¯ã€‚</span><br></code></pre></td></tr></table></figure><p>åœ¨è¾ƒæ–°Gitç‰ˆæœ¬ä¸­ï¼Œå¦‚æœæœ¬åœ°ä¸å­˜åœ¨<code>master</code>åˆ†æ”¯ï¼Œä¹Ÿå¯ä»¥ç®€å†™ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git checkout master<br></code></pre></td></tr></table></figure><p>Git ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„æœ¬åœ°åˆ†æ”¯ <code>master</code> å¹¶å°†å…¶è®¾ç½®ä¸ºè·Ÿè¸ªè¿œç¨‹çš„ <code>master</code> åˆ†æ”¯ï¼Œè¿™åœ¨ Git 2.23 åŠä»¥ä¸Šç‰ˆæœ¬ä¸­æ›´å¸¸è§</p><p>ä½†æ˜¯æ˜¾ç„¶ï¼Œæ— è®ºæ˜¯å“ªä¸ªå‘½ä»¤ï¼Œ<code>checkout</code>éƒ½ä¼šå¤±è´¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git checkout master <br>error: The following untracked working tree files would be overwritten by checkout:<br>        README.md<br>        abc.txt<br>Please move or remove them before you switch branches.<br>Aborting<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºï¼šå·¥ä½œç›®å½•ä¸­å­˜åœ¨ä¸€äº›æœªè·Ÿè¸ªçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶åœ¨è¿œç¨‹<code>master</code> åˆ†æ”¯ä¸­ä¹Ÿå­˜åœ¨ï¼Œå› æ­¤Git é˜»æ­¢äº†åˆ†æ”¯åˆ‡æ¢ä»¥é¿å…è¿™äº›æœªè·Ÿè¸ªæ–‡ä»¶è¢«è¦†ç›–</p><h4 id="Solutionï¼š"><a href="#Solutionï¼š" class="headerlink" title="Solutionï¼š"></a>Solutionï¼š</h4><ol><li>åˆ é™¤æ‰€æœ‰æœªè·Ÿè¸ªæ–‡ä»¶ï¼š<code>git clean -f</code></li><li>æš‚å­˜ï¼š<code>git stash --include-untracked</code></li><li>æäº¤ï¼š<code>git add . &amp; git commit -m &quot;Add untracked files&quot;</code></li><li>å¼ºåˆ¶åˆ‡æ¢ï¼š<code>git checkout -f master</code></li></ol><p>å¥½çš„ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¼ºåˆ¶åˆ‡æ¢å§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git checkout -f master<br>Switched to a new branch <span class="hljs-string">&#x27;master&#x27;</span><br>branch <span class="hljs-string">&#x27;master&#x27;</span> <span class="hljs-built_in">set</span> up to track <span class="hljs-string">&#x27;origin/master&#x27;</span>.<br></code></pre></td></tr></table></figure><p>Perfect</p><p>ç°åœ¨å°±è·Ÿç›´æ¥æ‰§è¡Œ<code>git clone</code>ä¹‹åçš„ä»“åº“ä¸€æ¯›ä¸€æ ·äº†</p><h3 id="å¥½å¥½å¥½-å†æä¸€å˜´-è·Ÿè¸ªåˆ†æ”¯æ˜¯æ€ä¹ˆå›äº‹"><a href="#å¥½å¥½å¥½-å†æä¸€å˜´-è·Ÿè¸ªåˆ†æ”¯æ˜¯æ€ä¹ˆå›äº‹" class="headerlink" title="å¥½å¥½å¥½ å†æä¸€å˜´ è·Ÿè¸ªåˆ†æ”¯æ˜¯æ€ä¹ˆå›äº‹"></a>å¥½å¥½å¥½ å†æä¸€å˜´ è·Ÿè¸ªåˆ†æ”¯æ˜¯æ€ä¹ˆå›äº‹</h3><blockquote><p>branch â€˜masterâ€™ set up to track â€˜origin&#x2F;masterâ€™.</p></blockquote><p>æ³¨æ„è¿™ä¸€å¥æç¤ºï¼Œ<code>checkout</code>çš„æ—¶å€™æœ¬åœ°<code>master</code>è‡ªåŠ¨è·Ÿè¸ªçš„è¿œç¨‹çš„<code>origin master</code>åˆ†æ”¯</p><p>è¿™ä¸ªä½“ç°åœ¨<code>.git\config</code>å°±æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs config">[branch &quot;master&quot;]<br>remote = origin<br>merge = refs/heads/master<br></code></pre></td></tr></table></figure><p>æ„å‘³ç€ï¼Œ<code>pull</code> &amp; <code>merge</code>çš„æ—¶å€™ï¼Œè‡ªåŠ¨åˆå¹¶<code>origin</code>ä»“åº“çš„<code>master</code>åˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯è·Ÿè¸ªäº†è¿œç¨‹åˆ†æ”¯å˜› å·®ä¸å¤šå°±é…±</p><h3 id="æ–¹æ³•2"><a href="#æ–¹æ³•2" class="headerlink" title="æ–¹æ³•2"></a>æ–¹æ³•2</h3><p>æˆ‘ä»¬åˆšåˆšé‡‡ç”¨çš„æ˜¯<code>fetch + checkout -f</code>æ³•ï¼Œé‚£èƒ½ä¸èƒ½ç›´æ¥<code>pull</code>å‘¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git pull origin master<br>...<br>error: The following untracked working tree files would be overwritten by merge:<br>        README.md<br>        abc.txt<br>Please move or remove them before you merge.<br>Aborting<br><br>$ git branch -a<br>  remotes/origin/master<br></code></pre></td></tr></table></figure><p>å¥½çš„ï¼Œæ˜¾ç„¶æ˜¯ä¸è¡Œï¼Œä½†æ˜¯ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°<code>pull = fetch + merge</code></p><p>é‚£ä¹ˆåŸå› è¿˜æ˜¯ç±»ä¼¼ï¼Œæœ‰æœªè·Ÿè¸ªæ–‡ä»¶å­˜åœ¨ï¼Œä¸”æœ‰è¢«è¦†ç›–çš„é£é™©</p><p>é‚£ä¹ˆ<code>pull</code>æˆ–<code>merge</code>æœ‰æ²¡æœ‰ç±»ä¼¼<code>-f</code>çš„å¼ºåˆ¶æŒ‡ä»¤å‘¢</p><p>ç­”æ¡ˆæ˜¯æ²¡æœ‰ï¼Œå› ä¸º<code>checkout</code>æ˜¯åˆ‡æ¢åˆ†æ”¯ï¼Œæœ‰è¦†ç›–çš„è¯­ä¹‰ï¼Œä½†æ˜¯<code>merge</code>æˆ–<code>pull</code>æ˜¯åˆå¹¶ä¸¤ä¸ªåˆ†æ”¯ï¼Œæ˜¯å¹³ç­‰çš„</p><p>æ‰€ä»¥æˆ‘ä»¬åªèƒ½æ‰‹åŠ¨æ¸…ç†è¿™äº›æ–‡ä»¶äº†</p><p>ç”±äºè¿™äº›ä»£ç æ˜¯ç›´æ¥ä¸‹è½½çš„<code>zip</code>ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰ä¿®æ”¹ï¼Œæ‰€ä»¥åˆ äº†ä¹Ÿä¸å¿ƒç–¼ï¼Œå¾…ä¼šå„¿<code>pull</code>å°±æ¢å¤äº†ï¼Œæ‰€ä»¥ç›´æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git clean -f<br></code></pre></td></tr></table></figure><p>åº“æ“¦ä¸€ä¸‹ï¼Œå·¥ä½œåŒºç©ºäº† &#x2F;å“­</p><p>ç„¶å</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git pull origin master<br>From https://github.com/Zulaikha12/git-test<br> * branch            master     -&gt; FETCH_HEAD<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git branch -a<br>* master<br>  remotes/origin/master<br></code></pre></td></tr></table></figure><p>ç›´æ¥å®Œç¾æˆåŠŸï¼Œæœ¬åœ°ä¹Ÿæœ‰äº†<code>master</code>åˆ†æ”¯</p><p>ä½†æ˜¯èªæ˜çš„å°ä¼™ä¼´å¯èƒ½å‘ç°äº†ï¼Œæœ¬åœ°æ²¡æœ‰åˆ†æ”¯æ€ä¹ˆèƒ½<code>merge</code></p><p>æ ¹æ®<code>GPT-4</code>çš„è¯´æ³•ï¼š<code>Git</code>ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬<code>checkout</code>ä¸€ä¸ªæ–°åˆ†æ”¯å¹¶è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯å·´æ‹‰ï¼Œåæ­£å°±æ˜¯å™¼é‡Œå•ªå•¦å°±å¥½äº†</p><blockquote><p>æ³¨ï¼šå®æµ‹å‘ç°ï¼Œnononoï¼Œå¹¶ä¸ä¼šè‡ªåŠ¨è®¾ç½®è¿œç¨‹è·Ÿè¸ªåˆ†æ”¯ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®<br><code>git branch --set-upstream-to=origin/master master</code></p></blockquote><h3 id="Tip"><a href="#Tip" class="headerlink" title="Tip"></a>Tip</h3><p>å¦‚æœä»“åº“å®åœ¨å¤ªå¤§ï¼Œ<code>fetch</code>è·Ÿ<code>clone</code>å…¶å®å‹åŠ›æ˜¯ä¸€æ ·çš„</p><p>ï¼ˆåªä¸è¿‡ä¸‹è½½zipèƒ½è®©ä½ æ›´å¿«åœ°å¼€å§‹å·¥ä½œï¼Œä¹‹åå†è€ƒè™‘fetchï¼‰&amp; ç„å­¦ï¼šè¯´ä¸å®šfetchç½‘ç»œæ›´å¥½</p><p>å’³å’³</p><p>å…¶å®æˆ‘ä»¬å¯ä»¥åª<code>clone</code>æœ€è¿‘çš„å‡ æ¬¡æäº¤ï¼ˆæµ…å…‹éš†ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git <span class="hljs-built_in">clone</span> --depth 1 https://github.com/XXX/XXX<br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦å®Œæ•´çš„å†å²è®°å½•ï¼Œå¯ä»¥é€šè¿‡ <code>git fetch --unshallow</code> å°†æµ…å…‹éš†çš„ä»“åº“è½¬æ¢ä¸ºå®Œæ•´çš„ä»“åº“ï¼›è¿™ä¸ªå‘½ä»¤ä¼šæ‹‰å–å‰©ä½™çš„å†å²è®°å½•ã€‚</p><p>Peace</p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><code>GPT-4</code></p><p><a href="https://zhuanlan.zhihu.com/p/597688197">åŠ é€Ÿå‡ åå€ git clone é€Ÿåº¦çš„ â€“depth 1ï¼Œå®ƒçš„åé—ç—‡æ€ä¹ˆè§£å†³ï¼Ÿ - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://blog.csdn.net/astonishqft/article/details/83029490">gitåˆ‡æ¢åˆ°æŒ‡å®šè¿œç¨‹åˆ†æ”¯_git åˆ‡æ¢è¿œç¨‹åˆ†æ”¯-CSDNåšå®¢</a></p>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¼‚æ­¥çš„æœ¬è´¨</title>
    <link href="/2023/11/29/%E5%BC%82%E6%AD%A5%E7%9A%84%E6%9C%AC%E8%B4%A8/"/>
    <url>/2023/11/29/%E5%BC%82%E6%AD%A5%E7%9A%84%E6%9C%AC%E8%B4%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼šå¤šè¿›ç¨‹ã€å¤šçº¿ç¨‹</p><p>ä¼—ä¹Ÿå‘¨é—»ï¼šå¼‚æ­¥ï¼ˆAsynchronousï¼‰ã€åç¨‹ï¼ˆCoroutineï¼‰</p><p>äººå°½çš†çŸ¥ï¼šåŒæ­¥ï¼ˆSynchronousï¼‰ã€é˜»å¡</p><p>æˆ‘ä»¬å¸¸å¤„äºä¸€ç§ï¼šæ¸…æ™°çš„æ··æ²Œæ€ï¼›çŸ¥è€Œåˆä¸çŸ¥</p><blockquote><p> è¿™å°±å¥½åƒä½ çŸ¥é“è‡ªå·±æ‹¥æœ‰æ„è¯†ï¼Œå¯ä»€ä¹ˆæ˜¯æ„è¯†</p></blockquote><blockquote><p>é¦’å¤´å¡å³ç­”ï¼šæ„è¯†ä¸æªæ³•å¹¶é‡ï¼Œèƒ½å¤Ÿåœ¨å¤©æ—¶åœ°åˆ©ä¸‹åšå‡ºæ­£ç¡®å†³æ–­ï¼Œåœ¨æ®Šæ­»ç»å¢ƒä¸­åè´¥ä¸ºèƒœ</p></blockquote><h2 id="é—®å¤©"><a href="#é—®å¤©" class="headerlink" title="é—®å¤©"></a>é—®å¤©</h2><p>ä»€ä¹ˆæ˜¯å¼‚æ­¥å‘¢ï¼Ÿ</p><p>ä¹Ÿè®¸è¿™ä¸ªé—®é¢˜æœ‰ç‚¹éš¾ï¼Œé‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯åŒæ­¥å‘¢</p><p>å¯èƒ½ä¹Ÿä¸å¥½å›ç­”</p><p>è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªä¾‹å­å§ï¼šå‘é€ç½‘ç»œè¯·æ±‚å¹¶ç­‰å¾…å“åº”ï¼ˆæˆ–è€…è¯´ç‚¹é¤å¹¶ç­‰å¾…ä¸Šèœï¼‰</p><ul><li>åŒæ­¥çš„ä»£ç æ˜¯é˜»å¡çš„ï¼šä½œä¸ºä¸€ä¸ªæ™®é€šçš„å•çº¿ç¨‹ç¨‹åºï¼Œæ‰§è¡Œæµå°†å¡åœ¨<code>wait()</code>è¿™ä¸€è¡Œï¼Œç›´åˆ°æœåŠ¡å™¨å‘æ¥å“åº”ï¼Œé‚£ä¹ˆç”¨æˆ·å°†çœ‹åˆ°ä¸€ä¸ªå¡æ­»çš„ç•Œé¢</li><li>å¼‚æ­¥çš„ä»£ç æ˜¯éé˜»å¡çš„ï¼šæˆ‘ä»¬æäº¤è¯·æ±‚ï¼ˆsbmitï¼‰åï¼Œé‚£è¡Œå‘é€è¯·æ±‚çš„å‡½æ•°ä»£ç ç›´æ¥è¿”å›ï¼Œå¹¶ä¸ç†ä¼šå“åº”ï¼Œç›´æ¥æ‰§è¡Œä¹‹åçš„å…¶ä»–é€»è¾‘</li></ul><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¼‚æ­¥çš„ä»£ç ç›´æ¥è¿”å›ï¼Œä¸ç­‰å¾…å“åº”ï¼Œé‚£ä¹ˆå¦‚ä½•è·å–å“åº”å‘¢ï¼Ÿ</p><h2 id="å¦‚ä½•å®ç°å¼‚æ­¥"><a href="#å¦‚ä½•å®ç°å¼‚æ­¥" class="headerlink" title="å¦‚ä½•å®ç°å¼‚æ­¥"></a>å¦‚ä½•å®ç°å¼‚æ­¥</h2><p>å®ç°æœºåˆ¶æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚å‰ç«¯çš„<code>XMLHttpRequest</code>é‡‡ç”¨çš„æ˜¯å¤šè¿›ç¨‹</p><h3 id="å¤šè¿›ç¨‹"><a href="#å¤šè¿›ç¨‹" class="headerlink" title="å¤šè¿›ç¨‹"></a>å¤šè¿›ç¨‹</h3><p>ä¸»è¿›ç¨‹é€šè¿‡<code>IPC</code>ï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰åˆ©ç”¨ç½‘ç»œè¿›ç¨‹å‘é€å’Œç®¡ç†è¯·æ±‚ï¼Œç½‘ç»œè¿›ç¨‹ä»£æ›¿ä¸»çº¿ç¨‹å»ç›‘æ§å“åº”çš„è¿”å›ä¸å¦ï¼Œå¹¶é€‚æ—¶é€šçŸ¥ä¸»è¿›ç¨‹ï¼ˆé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼‰</p><p>ä¸»è¿›ç¨‹æœ‰ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼ˆä¸<code>Qt</code>ç±»ä¼¼ï¼‰ï¼Œä¼šè½®è¯¢æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè·å–å“åº”</p><img src="/img/image-20231129203822655.png" alt="XMLHttpRequestè¯·æ±‚" style="zoom: 80%;" /><p>å¦‚æ­¤ä¸€æ¥ï¼Œä¸»æ¸²æŸ“è¿›ç¨‹å°±æ— é¡»ç­‰å¾…å“åº”ï¼Œå¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡</p><h3 id="äº‹ä»¶å¾ªç¯ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰"><a href="#äº‹ä»¶å¾ªç¯ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰" class="headerlink" title="äº‹ä»¶å¾ªç¯ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰"></a>äº‹ä»¶å¾ªç¯ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰</h3><p>é‚£ä¹ˆäº‹ä»¶å¾ªç¯æ˜¯ä»€ä¹ˆå‘¢ï¼Œå…¶å®è¿™ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§å¼‚æ­¥</p><p>ä»¥<code>Qt</code>ä¸ºä¾‹ï¼Œ<code>Qt GUI</code>ç¨‹åºçš„<code>main</code>å‡½æ•°å…¶å®éå¸¸ç®€çŸ­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">QApplication <span class="hljs-title">a</span><span class="hljs-params">(argc, argv)</span></span>;<br>    Widget w;<br>    w.<span class="hljs-built_in">show</span>();<br>    <span class="hljs-keyword">return</span> a.<span class="hljs-built_in">exec</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>è€Œ<code>a.exec()</code>æœ€ç»ˆè°ƒç”¨äº†<code>QEventLoop::exec()</code>ï¼Œå…¶å†…éƒ¨æœ‰ä¸€ä¸ªæ­»å¾ªç¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">while</span> (!d-&gt;exit.<span class="hljs-built_in">loadAcquire</span>())<br>        <span class="hljs-built_in">processEvents</span>(flags | WaitForMoreEvents | EventLoopExec);<br></code></pre></td></tr></table></figure><p>ä¸æ–­åœ°ä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å‡ºå¹¶å¤„ç†äº‹ä»¶</p><p><img src="/img/image-20231129205036046.png" alt="Qtäº‹ä»¶å¾ªç¯"></p><p>å½“ä½ å¯åŠ¨ä¸€ä¸ªçª—å£ç¨‹åºçš„æ—¶å€™ï¼Œä½ å°±å·²ç»è¢«å›°åœ¨è¿™ä¸ªå¾ªç¯é‡Œäº†</p><p>ä½ å¯èƒ½ä¼šæ„Ÿåˆ°è¯§å¼‚ï¼Œä½†æ˜¯ä»”ç»†æƒ³æƒ³ï¼š</p><p>ä½ çš„æ¯ä¸€æ¬¡ç‚¹å‡»ï¼Œæ¯ä¸€æ¬¡æŒ‰é”®ï¼Œ<code>Windows</code>ç³»ç»Ÿéƒ½ä¼šå°è£…ä¸ºä¸€ä¸ªæ¶ˆæ¯ï¼Œè€Œæˆ‘ä»¬åˆåœ¨å¾ªç¯ä¸­ç›‘å¬è¿™äº›æ¶ˆæ¯å¹¶å¤„ç†</p><p>åœ¨æ¯ä¸€æ¬¡å¾ªç¯ä¸­è·å–äº‹ä»¶ï¼Œå¤„ç†äº‹ä»¶ï¼Œåˆ·æ–°UIï¼Œå¹¶äº§ç”Ÿæ–°äº‹ä»¶ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ï¼‰ï¼Œå¦‚æ­¤å¾€å¤ï¼Œä¸å°±å½¢æˆäº†ä¸€ä¸ªä¸ªåŠ¨äººçš„GUIç¨‹åºäº†å˜›</p><p>è¿™ç®—å¼‚æ­¥å—ï¼Œå¤§ä½“ç®—å§ï¼Œæˆ‘å¯ä»¥å¼€å¯ä¸€ä¸ª<code>Timer</code>ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±å»ç›‘å¬ç½‘ç»œè¯·æ±‚æ˜¯å¦è¿”å›ï¼ŒåŒæ ·å¯ä»¥å®ç°éé˜»å¡</p><blockquote><p>è¿™å½“ç„¶ç®—å¼‚æ­¥ï¼Œä½†æ˜¯ï¼Œæ ¸å¿ƒä¸æ˜¯äº‹ä»¶å¾ªç¯æä¾›äº†å¼‚æ­¥èƒ½åŠ›ï¼Œè€Œæ˜¯ç³»ç»Ÿçš„å¼‚æ­¥IOæˆ–è€…å¤šçº¿ç¨‹åœ¨é»˜é»˜å·¥ä½œ</p></blockquote><h3 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h3><p>å…¶å®å¤šçº¿ç¨‹å½“ç„¶ä¹Ÿç®—ä¸€ç§å¼‚æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè€—æ—¶ä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªæ–°çº¿ç¨‹ï¼ˆæˆ–çº¿ç¨‹æ± ï¼‰ä¸Šï¼Œå®ç°éé˜»å¡æ•ˆæœ</p><p>å‚è€ƒ<code>C++ï¼šstd::sync</code></p><h4 id="ä¸è¿‡å¤šçº¿ç¨‹ä¸äº‹ä»¶å¾ªç¯çš„å¼‚æ­¥æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#ä¸è¿‡å¤šçº¿ç¨‹ä¸äº‹ä»¶å¾ªç¯çš„å¼‚æ­¥æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="ä¸è¿‡å¤šçº¿ç¨‹ä¸äº‹ä»¶å¾ªç¯çš„å¼‚æ­¥æœ‰ä»€ä¹ˆåŒºåˆ«"></a>ä¸è¿‡å¤šçº¿ç¨‹ä¸äº‹ä»¶å¾ªç¯çš„å¼‚æ­¥æœ‰ä»€ä¹ˆåŒºåˆ«</h4><p>çº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„æœ€å°å•ä½ï¼Œæ‰€ä»¥çº¿ç¨‹çš„æ‰§è¡Œè¿‡ç¨‹å¯èƒ½è¢«éšæ—¶æ‰“æ–­ï¼ˆä¿å­˜ä¸æ¢å¤æ ˆï¼‰ï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£</p><p>ä½†æ˜¯äº‹ä»¶å¾ªç¯çš„æ¯ä¸€ä¸ªäº‹ä»¶å‡½æ•°æ˜¯ä¸èƒ½è¢«æ‰“æ–­çš„ï¼Œä¹Ÿå°±æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥å¯ä»¥ç§°ä¸ºåŸºäºåŒæ­¥çš„å¼‚æ­¥ï¼ˆæˆ‘çèµ·çš„åå­—ï¼‰</p><h2 id="Rustå¼‚æ­¥ç¼–ç¨‹"><a href="#Rustå¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="Rustå¼‚æ­¥ç¼–ç¨‹"></a>Rustå¼‚æ­¥ç¼–ç¨‹</h2><p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹<code>Rust</code>åœ¨å•çº¿ç¨‹ä¸Šæ˜¯å¦‚ä½•å®ç°å¼‚æ­¥æ“ä½œçš„</p><p><code>Rust</code>é‡‡ç”¨çš„æ˜¯<strong>async&#x2F;await</strong>æ¨¡å‹ï¼Œ è¯¥æ¨¡å‹æ€§èƒ½é«˜ï¼Œè¿˜èƒ½æ”¯æŒåº•å±‚ç¼–ç¨‹ï¼ŒåŒæ—¶åˆåƒçº¿ç¨‹å’Œåç¨‹é‚£æ ·æ— éœ€è¿‡å¤šçš„æ”¹å˜ç¼–ç¨‹æ¨¡å‹ï¼Œä½†æœ‰å¾—å¿…æœ‰å¤±ï¼Œ<code>async</code> æ¨¡å‹çš„é—®é¢˜å°±æ˜¯å†…éƒ¨å®ç°æœºåˆ¶è¿‡äºå¤æ‚ï¼Œç†è§£å’Œä½¿ç”¨èµ·æ¥ä¹Ÿæ²¡æœ‰çº¿ç¨‹å’Œåç¨‹ç®€å•</p><p>è¿™ç§æ¨¡å‹ä¸­ä¸€èˆ¬éƒ½ä¼šå‡ºç°<code>Future</code>è¿™ä¸ªè¯ï¼Œæˆ–è€…<code>JS</code>çš„<code>Promise</code>ï¼Œè¿™æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªåœ¨æœªæ¥ä¼šè¿”å›çš„ä»»åŠ¡</p><p><code>Rust</code>çš„<code>Future</code>å’Œå…¶ä»–è¯­è¨€ä¸å¤ªä¸€æ ·</p><ul><li><strong>Future åœ¨ Rust ä¸­æ˜¯æƒ°æ€§çš„</strong>ï¼Œåªæœ‰åœ¨è¢«è½®è¯¢(<code>poll</code>)æ—¶æ‰ä¼šè¿è¡Œï¼Œ å› æ­¤ä¸¢å¼ƒä¸€ä¸ª <code>future</code> ä¼šé˜»æ­¢å®ƒæœªæ¥å†è¢«è¿è¡Œ</li></ul><p><code>Future</code>æ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œæˆ–è€…è¯´ä¸€æ®µå‡½æ•°çš„åŒ…è£…ï¼Œåªè¦ç”¨<code>async</code>ä¿®é¥°å‡½æ•°æˆ–ä»£ç å—ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªFutureå¯¹è±¡</p><p>è€Œpollå‡½æ•°ä¼š<strong>éé˜»å¡</strong>åœ°è¿”å›è¯¥ä»»åŠ¡çš„<strong>å½“å‰çŠ¶æ€</strong>ï¼ˆ<code>Pending or Ready</code>ï¼‰</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Rust"><span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-comment">// ä¸€äº›åŒæ­¥ä»£ç </span><br>    fut_one.<span class="hljs-keyword">await</span>;<br>    <span class="hljs-comment">// å¦ä¸€äº›åŒæ­¥ä»£ç </span><br>    fut_two.<span class="hljs-keyword">await</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¼šè¢«ç¼–è¯‘å™¨å±•å¼€ï¼Œè‡ªåŠ¨ä¸ºå…¶å®ç°<code>Future</code>æ¥å£ï¼Œå¹¶å°†å…¶<code>poll</code>å‡½æ•°å®ç°ä¸ºä¸€ä¸ª<strong>çŠ¶æ€æœº</strong>ï¼Œæ¯ä¸€ä¸ª<code>await</code>å°±æ˜¯ä¸€ä¸ªçŠ¶æ€ç‚¹</p><p>å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠä¸€æ®µå¼‚æ­¥ä»£ç æ‹†åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µäº†ï¼Œæ¯ä¸ªé˜¶æ®µå†…éƒ¨ä¸å¯æ‰“æ–­ï¼Œåªæœ‰åˆ°awaitæ‰ä¼šä¿å­˜çŠ¶æ€å¹¶äº¤è¿˜æ§åˆ¶æƒ</p><p>çœ‹èµ·æ¥<code>fut_one.await;</code>å’Œ<code>fut_two.await;</code>æ˜¯ä¸²è¡Œçš„ï¼Œæ˜¯åŒæ­¥é˜»å¡çš„ï¼Œä½†å…¶å®æ¯ä¸€ä¸ª<code>.await</code>è°ƒç”¨çš„éƒ½æ˜¯pollï¼Œéƒ½åªæ˜¯è¯¢é—®çŠ¶æ€ï¼ˆç«‹å³è¿”å›ï¼‰ï¼Œç©ºé—²ä¸‹æ¥çš„æ—¶é—´å…¶å®æ˜¯å»è½®è¯¢å…¶ä»–çš„Futureä»»åŠ¡äº†ï¼ˆç”±å¤–å±‚<code>Executor</code>æ§åˆ¶ï¼Œå¾…ä¼šå„¿è¯´ï¼‰</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs Rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">AsyncFuture</span> &#123;<br>    fut_one: FutOne,<br>    fut_two: FutTwo,<br>    state: AsyncState,<br>&#125;<br><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">AsyncState</span> &#123;<br>    Start,<br>    AwaitingFutOne,<br>    BetweenFuts,<br>    AwaitingFutTwo,<br>    Done,<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Future</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">AsyncFuture</span> &#123;<br>    <span class="hljs-keyword">type</span> <span class="hljs-title class_">Output</span> = ();<br><br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">poll</span>(<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>: Pin&lt;&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">Self</span>&gt;, cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-symbol">&#x27;_</span>&gt;) <span class="hljs-punctuation">-&gt;</span> Poll&lt;()&gt; &#123;<br>        <span class="hljs-keyword">match</span> <span class="hljs-keyword">self</span>.state &#123;<br>            AsyncState::Start =&gt; &#123;<br>                <span class="hljs-comment">// æ‰§è¡Œä¸€äº›åŒæ­¥ä»£ç </span><br>                <span class="hljs-keyword">self</span>.state = AsyncState::AwaitingFutOne;<br>            &#125;<br>            AsyncState::AwaitingFutOne =&gt; <span class="hljs-keyword">match</span> <span class="hljs-keyword">self</span>.fut_one.<span class="hljs-title function_ invoke__">poll</span>(cx) &#123;<br>                Poll::<span class="hljs-title function_ invoke__">Ready</span>(()) =&gt; &#123;<br>                    <span class="hljs-comment">// ç¬¬ä¸€ä¸ª await å®Œæˆï¼Œæ‰§è¡Œä¸­é—´çš„åŒæ­¥ä»£ç </span><br>                    <span class="hljs-comment">// æ‰§è¡Œå¦ä¸€äº›åŒæ­¥ä»£ç </span><br>                    <span class="hljs-keyword">self</span>.state = AsyncState::AwaitingFutTwo;<br>                &#125;<br>                Poll::Pending =&gt; <span class="hljs-keyword">return</span> Poll::Pending,<br>            &#125;,<br>            AsyncState::AwaitingFutTwo =&gt; <span class="hljs-keyword">match</span> <span class="hljs-keyword">self</span>.fut_two.<span class="hljs-title function_ invoke__">poll</span>(cx) &#123;<br>                Poll::<span class="hljs-title function_ invoke__">Ready</span>(()) =&gt; <span class="hljs-keyword">self</span>.state = AsyncState::Done,<br>                Poll::Pending =&gt; <span class="hljs-keyword">return</span> Poll::Pending,<br>            &#125;,<br>            AsyncState::Done =&gt; <span class="hljs-keyword">return</span> Poll::<span class="hljs-title function_ invoke__">Ready</span>(()),<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¯ä¸€ä¸ª<code>X.await</code>éƒ½æ„å‘³ç€Xæ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œæ˜¯ä¸€ä¸ª<code>Future</code>ï¼Œé‚£ä¹ˆå±•å¼€åçš„ä»£ç ä¸­ï¼Œå…¶<code>poll</code>å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œç”¨ä»¥æ¨è¿›ä»»åŠ¡</p><p>æ‰€ä»¥<code>poll</code>å‡½æ•°ä¼šä¸€å±‚å±‚åµŒå¥—ï¼Œç›´åˆ°ä¸€ä¸ª<code>Leaf Future</code>ï¼ˆè‡ªè¡Œå®ç°äº†pollæ¥ç®¡ç†å…¶Pendingå’ŒReadyçš„çŠ¶æ€ï¼Œæˆ–è€…æ˜¯ä¸€æ®µå®Œå…¨åŒæ­¥çš„æ— <code>await</code>ä»£ç ï¼‰</p><h3 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h3><h4 id="ä½ ä»¬è‚¯å®šå¾ˆå¥½å¥‡ï¼Œæˆ‘ä»¬ä¸æ–­åœ°è¯¢é—®ï¼ˆpollï¼‰ä»»åŠ¡çš„çŠ¶æ€ï¼Œé‚£ä¹ˆè°å»æ‰§è¡Œå‘¢ï¼Ÿ"><a href="#ä½ ä»¬è‚¯å®šå¾ˆå¥½å¥‡ï¼Œæˆ‘ä»¬ä¸æ–­åœ°è¯¢é—®ï¼ˆpollï¼‰ä»»åŠ¡çš„çŠ¶æ€ï¼Œé‚£ä¹ˆè°å»æ‰§è¡Œå‘¢ï¼Ÿ" class="headerlink" title="ä½ ä»¬è‚¯å®šå¾ˆå¥½å¥‡ï¼Œæˆ‘ä»¬ä¸æ–­åœ°è¯¢é—®ï¼ˆpollï¼‰ä»»åŠ¡çš„çŠ¶æ€ï¼Œé‚£ä¹ˆè°å»æ‰§è¡Œå‘¢ï¼Ÿ"></a>ä½ ä»¬è‚¯å®šå¾ˆå¥½å¥‡ï¼Œæˆ‘ä»¬ä¸æ–­åœ°è¯¢é—®ï¼ˆpollï¼‰ä»»åŠ¡çš„çŠ¶æ€ï¼Œé‚£ä¹ˆè°å»æ‰§è¡Œå‘¢ï¼Ÿ</h4><p>å› ä¸ºå®é™…ä»»åŠ¡è‚¯å®šæ˜¯é‡é‡çº§çš„ï¼Œæ˜¯é˜»å¡çš„ï¼Œæ˜¯æ¶ˆè€—æ—¶é—´çš„ï¼Œæˆ‘ä»¬æ‰éœ€è¦ç”¨å¼‚æ­¥æ–¹å¼å»è§£å†³å¯¹å§</p><p>é‚£ä¹ˆæ‰€æœ‰<code>poll</code>å‡½æ•°éƒ½æ˜¯éé˜»å¡çš„ï¼Œç«‹å³è¿”å›çš„ï¼Œåªæ˜¯è¯¢é—®çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡æ€ä¹ˆå¯èƒ½è¢«å®Œæˆï¼ˆæ‰€æœ‰äººéƒ½åœ¨æ‘¸é±¼ï¼‰</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯ï¼šè¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶ï¼›ä¹Ÿå°±æ˜¯æœ€å†…å±‚çš„<code>poll</code>å‡½æ•°åœ¨æ­»å¾ªç¯è¯»æ–‡ä»¶</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">poll</span>()&#123;<br>    <span class="hljs-title function_ invoke__">while</span>(line = <span class="hljs-title function_ invoke__">next_line</span>())&#123;<br>    <span class="hljs-type">str</span> += line;<br>&#125;<br>    <span class="hljs-keyword">return</span> Ready;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬èƒ½ä»å¤–å±‚æœŸæœ›è°ƒç”¨è¿™ä¸ªpollå‡½æ•°æ¥è¿”å›è¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€å—ï¼Œæ˜¯<code>Pending</code>è¿˜æ˜¯<code>Ready</code></p><p>é‚£æ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼Œä½œä¸ºä¸€ä¸ªå•çº¿ç¨‹ï¼Œæ€ä¹ˆå¯èƒ½åœ¨ä¸€ä¸ªé˜»å¡çš„Whileå¾ªç¯è¿›è¡Œæ—¶ï¼Œåˆä»å¤–éƒ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°</p><p>ä¸€æ—¦è¿›å…¥äº†è¿™ä¸ª<code>poll</code>å‡½æ•°ï¼Œé‚£ä¹ˆå°±å¿…é¡»è¢«é˜»å¡åˆ°æ–‡ä»¶è¯»å–å®Œæ¯•ï¼Œæ‰è¿”å›Readyï¼Œé‚£ä¹ˆï¼Œä¹Ÿå°±è°ˆä¸ä¸Šä»€ä¹ˆå¼‚æ­¥äº†</p><h4 id="æ‰€ä»¥å…¶å®è¦ç†è§£Rustæ˜¯å¦‚ä½•å®ç°å¼‚æ­¥çš„ï¼Œå°±è¦å»æ€è€ƒæœ€ç»ˆçš„Leaf-Futureçš„pollå‡½æ•°æ˜¯æ€ä¹ˆå†™çš„"><a href="#æ‰€ä»¥å…¶å®è¦ç†è§£Rustæ˜¯å¦‚ä½•å®ç°å¼‚æ­¥çš„ï¼Œå°±è¦å»æ€è€ƒæœ€ç»ˆçš„Leaf-Futureçš„pollå‡½æ•°æ˜¯æ€ä¹ˆå†™çš„" class="headerlink" title="æ‰€ä»¥å…¶å®è¦ç†è§£Rustæ˜¯å¦‚ä½•å®ç°å¼‚æ­¥çš„ï¼Œå°±è¦å»æ€è€ƒæœ€ç»ˆçš„Leaf Futureçš„pollå‡½æ•°æ˜¯æ€ä¹ˆå†™çš„"></a>æ‰€ä»¥å…¶å®è¦ç†è§£Rustæ˜¯å¦‚ä½•å®ç°å¼‚æ­¥çš„ï¼Œå°±è¦å»æ€è€ƒæœ€ç»ˆçš„Leaf Futureçš„pollå‡½æ•°æ˜¯æ€ä¹ˆå†™çš„</h4><p>æ¯”å¦‚è¯´ï¼Œæˆ‘æ¯è¯»ä¸€è¡Œå°±è¿”å›æ€ä¹ˆæ ·</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">poll</span>()&#123;<br>    line = <span class="hljs-title function_ invoke__">next_line</span>()<br>    <span class="hljs-keyword">if</span> line == EOF <span class="hljs-keyword">return</span> Ready;<br>    <span class="hljs-type">str</span> += line;<br>    <span class="hljs-keyword">return</span> Pending;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™å°±æ˜¯è¯´ï¼Œå¤–éƒ¨æ¯è°ƒç”¨ä¸€æ¬¡pollï¼Œå°±ä¼šæ¨è¿›è¿™ä¸ªä»»åŠ¡çš„è¿›åº¦ï¼ˆè¯»ä¸€è¡Œï¼‰ï¼Œä¸æƒ°æ€§çš„Futureè«åå¾ˆæ­æœ‰æ²¡æœ‰</p><p>é‚£ä¹ˆè¯»å®Œä¸€è¡Œåï¼Œå°±ä¼šäº¤è¿˜æ§åˆ¶æƒç»™å¤–éƒ¨ï¼Œä½¿å…¶å¯ä»¥å¤„ç†å…¶ä»–ä»»åŠ¡</p><p>è¿™æœ¬è´¨ä¸Šå°±æ˜¯<strong>æ—¶é—´ç‰‡è½®è½¬ç®—æ³•</strong>æˆ–è€…è¯´<strong>å¤šä»»åŠ¡å¹¶å‘</strong>ï¼Œä¸åœ¨Qtäº‹ä»¶å¾ªç¯ä¸­ï¼Œæ¯è¯»è‹¥å¹²è¡Œå°±<code>processEvents()</code>ï¼ˆä»¥å¤„ç†äº‹ä»¶é˜Ÿåˆ—ä¸­çš„å…¶ä»–äº‹ä»¶ï¼Œå¦‚UIåˆ·æ–°ï¼‰å¹¶æ— äºŒå¼‚</p><p>é‚£ä¹ˆä½ è¯´ï¼Œè¿™ç§å¤šä»»åŠ¡å¹¶å‘ç®—æ˜¯å¼‚æ­¥å—ï¼Ÿè¿™æ˜¯ä¸ªå€¼å¾—è®¨è®ºçš„é—®é¢˜</p><p>ä½†æ˜¯è¿™ç§æ–¹å¼ï¼Œè¯»å–æ–‡ä»¶çš„æ€»æ—¶é•¿å¹¶æ²¡æœ‰å˜åŒ–ï¼Œç”šè‡³ä»è¯»æ–‡ä»¶å¼€å§‹åˆ°ç»“æŸä¼šæ¶ˆè€—æ›´å¤šçš„æ—¶é—´ï¼ˆæœŸé—´å¤„ç†å…¶ä»–ä»»åŠ¡ï¼‰</p><p>å”¯ä¸€çš„å¥½å¤„æ˜¯ï¼Œåœ¨GUIç¨‹åºä¸­ï¼Œå¯ä»¥ä¿è¯ä¸»çº¿ç¨‹ï¼ˆGUIçº¿ç¨‹ï¼‰ä¸è¢«é˜»å¡</p><p>å¦‚æœä½ çœŸè¦æé«˜æ–‡ä»¶è¯»å–æ•ˆç‡ï¼Œä¸ºä»€ä¹ˆä¸å¼€å¤šçº¿ç¨‹å‘¢</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè®¨è®ºçš„æ˜¯å•çº¿ç¨‹å¼‚æ­¥ï¼Œæ‰€ä»¥ä¸Šè¿°åˆ†ç‰‡ç­–ç•¥è¡Œä¸å¤ªé€š</p><h4 id="å¤§å®¶å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œç£ç›˜IOå’Œç½‘ç»œIOç¡®å®å­˜åœ¨å¾ˆå¤§çš„ä¸åŒ"><a href="#å¤§å®¶å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œç£ç›˜IOå’Œç½‘ç»œIOç¡®å®å­˜åœ¨å¾ˆå¤§çš„ä¸åŒ" class="headerlink" title="å¤§å®¶å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œç£ç›˜IOå’Œç½‘ç»œIOç¡®å®å­˜åœ¨å¾ˆå¤§çš„ä¸åŒ"></a>å¤§å®¶å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œç£ç›˜IOå’Œç½‘ç»œIOç¡®å®å­˜åœ¨å¾ˆå¤§çš„ä¸åŒ</h4><p>åŒºåˆ«åœ¨å“ªå‘¢ï¼Œæˆ‘ä»¬å¹³æ—¶ä¸éƒ½è¯´æ˜¯å¼‚æ­¥IOå—</p><ul><li>ç£ç›˜IOæ˜¯çœŸçš„ä¸€ç›´åœ¨è¯»æ•°æ®ï¼Œä½ å·æ‡’äº†ä¸€ç§’ï¼Œé‚£ä¹ˆå°±è¦å¤šèŠ±ä¸€ç§’å»è¯»</li><li>ç½‘ç»œIOå¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç­‰å¾…ï¼Œç­‰å¾…æœåŠ¡å™¨å›ä¼ æ•°æ®ï¼Œæ•°æ®å¯èƒ½å¾ˆå°‘ï¼Œç­‰å¾…è¦å¥½å‡ ç§’ï¼›è¿™æ„å‘³ç€ï¼Œå°±ç®—ä½ è¿™ä¸€ç§’å»å¹²åˆ«çš„äº‹äº†ï¼Œä¹Ÿä¸å¤ªè€½è¯¯ä½ å¯¹æ•°æ®çš„è¯»å–</li></ul><p>æ‰€ä»¥ï¼Œéš”ä¸€æ®µæ—¶é—´å»è¯»æ–‡ä»¶ï¼Œå’Œéš”ä¸€æ®µæ—¶é—´å»ç›‘æµ‹ç½‘ç»œæ•°æ®æ˜¯å®Œå…¨ä¸åŒçš„æ¦‚å¿µ</p><p>æ‰€ä»¥æŠŠä¸Šè¿°çš„æ–‡ä»¶IOä»£ç æ¢æˆç½‘ç»œIOï¼Œå°±å®Œå…¨æ˜¯ä¸€ä¸ªå¯è¡Œçš„å¼‚æ­¥äº†</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">poll</span>()&#123;<br>    <span class="hljs-keyword">if</span> <span class="hljs-title function_ invoke__">isDataOk</span>()&#123; <span class="hljs-comment">//linuxä¸­select epoll poll</span><br>        <span class="hljs-title function_ invoke__">readData</span>();<br>        <span class="hljs-keyword">return</span> Reday;<br>    &#125;<br>    <span class="hljs-keyword">return</span> Pending;<br>&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºä½ çœŸçš„å¯ä»¥å»å¹²åˆ«çš„äº‹æƒ…ï¼Œè€Œä¸è€½è¯¯ç­‰å¾…äº†ï¼›ç›¸å½“äºåˆ†ç‰‡å¹¶å‘è½®è¯¢ï¼Œå’Œäº‹ä»¶å¾ªç¯ä¹Ÿæ˜¯ç±»ä¼¼çš„</p><p>è¿™å°±ä½“ç°äº†ä¸ºä»€ä¹ˆçœŸæ­£çš„å•çº¿ç¨‹å¼‚æ­¥é€šå¸¸è¦ä¾èµ–äºæ“ä½œç³»ç»Ÿæä¾›çš„å¼‚æ­¥API</p><h4 id="é‚£ä¹ˆç£ç›˜IOå°±æ²¡æœ‰å¼‚æ­¥APIå—"><a href="#é‚£ä¹ˆç£ç›˜IOå°±æ²¡æœ‰å¼‚æ­¥APIå—" class="headerlink" title="é‚£ä¹ˆç£ç›˜IOå°±æ²¡æœ‰å¼‚æ­¥APIå—"></a>é‚£ä¹ˆç£ç›˜IOå°±æ²¡æœ‰å¼‚æ­¥APIå—</h4><p>èƒ½ä¸èƒ½è®©ç³»ç»Ÿæ›¿æˆ‘è¯»æ–‡ä»¶ï¼Œè¯»å®Œå†å‘Šè¯‰æˆ‘</p><p>å½“ç„¶æœ‰ï¼Œå¦‚ï¼š</p><ul><li>IOCP æ˜¯ Windows æä¾›çš„ä¸€ç§é«˜æ•ˆçš„çº¿ç¨‹æ± æŠ€æœ¯ï¼Œç”¨äºå¤„ç†å¼‚æ­¥ I&#x2F;O æ“ä½œ</li><li>Linux æä¾›äº†ä¸€ç»„ POSIX å¼‚æ­¥ I&#x2F;O (AIO) æ¥å£ï¼Œç”±å†…æ ¸å®ŒæˆIOæ“ä½œ</li></ul><p>ç£ç›˜IOæ˜¯ä¸€ä¸ªå®å®åœ¨åœ¨çš„è´Ÿè½½ä»»åŠ¡ï¼Œæ€»è¦æœ‰äººè´Ÿé‡å‰è¡Œçš„ï¼Œè¦ä¹ˆæ˜¯å¤šçº¿ç¨‹ï¼Œè¦ä¹ˆæ˜¯å†…æ ¸ï¼ˆå‡è£…ä¹Ÿç®—çº¿ç¨‹ï¼‰</p><p>æ‰€ä»¥ä¸ä¾èµ–å¤–ç‰©ï¼ŒçœŸæ­£çš„å•çº¿ç¨‹å¼‚æ­¥ç£ç›˜IOæ˜¯å¾ˆéš¾å®ç°çš„</p><h4 id="æ‰€ä»¥çœŸçš„æœ‰å•çº¿ç¨‹å¼‚æ­¥å—"><a href="#æ‰€ä»¥çœŸçš„æœ‰å•çº¿ç¨‹å¼‚æ­¥å—" class="headerlink" title="æ‰€ä»¥çœŸçš„æœ‰å•çº¿ç¨‹å¼‚æ­¥å—"></a>æ‰€ä»¥çœŸçš„æœ‰å•çº¿ç¨‹å¼‚æ­¥å—</h4><p>å¦‚æœå†…æ ¸ç®—ä¸€ä¸ªçº¿ç¨‹ï¼Œæ›¿æˆ‘ä»¬å®Œæˆç›‘æµ‹ã€ç­‰å¾…å·¥ä½œçš„è¯ï¼Œé‚£ç¡®å®æ²¡æœ‰å•çº¿ç¨‹å¼‚æ­¥äº†</p><p>ä¸è¿‡å¦‚æœæˆ‘ä»¬è°ˆè®ºçš„çº¿ç¨‹æ˜¯<strong>ç”¨æˆ·ç©ºé—´çš„çº¿ç¨‹</strong>çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥ä¾èµ–ç³»ç»Ÿå¼‚æ­¥APIå®ç°</p><h4 id="æš´è®ºï¼šå•çº¿ç¨‹å¼‚æ­¥é«˜åº¦ä¾èµ–ç³»ç»Ÿå¼‚æ­¥API"><a href="#æš´è®ºï¼šå•çº¿ç¨‹å¼‚æ­¥é«˜åº¦ä¾èµ–ç³»ç»Ÿå¼‚æ­¥API" class="headerlink" title="æš´è®ºï¼šå•çº¿ç¨‹å¼‚æ­¥é«˜åº¦ä¾èµ–ç³»ç»Ÿå¼‚æ­¥API"></a>æš´è®ºï¼šå•çº¿ç¨‹å¼‚æ­¥é«˜åº¦ä¾èµ–ç³»ç»Ÿå¼‚æ­¥API</h4><blockquote><p>é™¤éä½ è¦å†™ä¸€ä¸ª runtimeï¼Œå¦åˆ™ä½ ä¸å¤ªå¯èƒ½è‡ªå·±å®ç°ä¸€ä¸ªå¶å­ Futureï¼Œæˆ–è€…æ›´å¤šçš„æ˜¯é’ˆå¯¹ Leaf-Future çš„å°è£…</p></blockquote><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬å¾ˆéš¾ç†è§£Rustæ˜¯å¦‚ä½•å®ç°å•çº¿ç¨‹å¼‚æ­¥çš„åŸå› ï¼Œæ ¸å¿ƒçš„æ“ä½œéƒ½è¢«å°è£…åœ¨<code>tokio</code>åº“å†…éƒ¨å®šä¹‰çš„å¶å­<code>Future</code>ä¸­äº†ï¼ˆè¦ä¹ˆå¤šçº¿ç¨‹ã€è¦ä¹ˆç³»ç»ŸAPIï¼‰</p><p>ä½†æ˜¯å¦‚æœä¸ç†è§£å¶å­<code>Future</code>çš„å®ç°åŸç†ï¼Œç­‰äºé˜¿å·´</p><h3 id="ç»§ç»­Rustå¼‚æ­¥"><a href="#ç»§ç»­Rustå¼‚æ­¥" class="headerlink" title="ç»§ç»­Rustå¼‚æ­¥"></a>ç»§ç»­Rustå¼‚æ­¥</h3><p>Okayï¼Œæˆ‘ä»¬ç»§ç»­æ¥è®²<code>Rust</code>æ˜¯å¦‚ä½•å®ç°å¼‚æ­¥çš„</p><h4 id="é¦–å…ˆï¼Œä¸ºä»€ä¹ˆè¦ç”¨çŠ¶æ€æœº"><a href="#é¦–å…ˆï¼Œä¸ºä»€ä¹ˆè¦ç”¨çŠ¶æ€æœº" class="headerlink" title="é¦–å…ˆï¼Œä¸ºä»€ä¹ˆè¦ç”¨çŠ¶æ€æœº"></a>é¦–å…ˆï¼Œä¸ºä»€ä¹ˆè¦ç”¨çŠ¶æ€æœº</h4><p>è¿™æ˜¯ä¸ºäº†<strong>ä¿å­˜çŠ¶æ€</strong>ï¼Œä¸€ä¸ªå¼‚æ­¥å‡½æ•°å†…å¯ä»¥åŒ…æ‹¬å¤šä¸ªå¼‚æ­¥æ“ä½œ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Rust"><span class="hljs-keyword">async</span> &#123;<br>    fut_one.<span class="hljs-keyword">await</span>;<br>    fut_two.<span class="hljs-keyword">await</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œå‡å¦‚æ²¡æœ‰çŠ¶æ€æœºï¼Œæˆ‘ä»¬æ¯æ¬¡è¿›å…¥è¿™ä¸ªå¼‚æ­¥å‡½æ•°ï¼ˆpollï¼‰ï¼Œéƒ½ä¼šé‡å¤æ‰§è¡Œè¿™ä¸¤ä¸ªå¼‚æ­¥æ“ä½œï¼Œä¹Ÿä¸çŸ¥é“ç¬¬ä¸€ä¸ªæ‰§è¡Œå®Œæ²¡</p><p>å¹¶ä¸”ï¼Œå‡å¦‚ä¸¤ä¸ªå¼‚æ­¥æ“ä½œè§æœ‰ä¸€äº›åŒæ­¥ä»£ç çš„è¯ï¼Œä¹Ÿä¼šè¢«é‡å¤æ‰§è¡Œï¼Œé‚£å°±å¯„äº†</p><p>æ¯ä¸€ä¸ª<code>.await</code>éƒ½æ˜¯ä¸€ä¸ªå…³é”®ç‚¹ï¼Œä»£è¡¨å¯ä»¥åœ¨è¿™é‡Œé€€å‡ºä¸æ¢å¤å¼‚æ­¥å‡½æ•°</p><p>ä¸¤ä¸ª<code>.await</code>ä¹‹é—´å‡å¦‚æœ‰åŒæ­¥ä»£ç çš„è¯ï¼Œæ˜¯ä¸å¯ä»¥è¢«æ‰“æ–­çš„ï¼Œæ¯ä¸ªçŠ¶æ€å†…éƒ¨éƒ½æ˜¯åŒæ­¥çš„</p><h4 id="æ‰€ä»¥ï¼Œæš´è®ºï¼šRustå¼‚æ­¥çš„æœ¬è´¨æ˜¯å°†å¤§åŒæ­¥æ‹†åˆ†ä¸ºå°åŒæ­¥ï¼Œå¤§ä»»åŠ¡æ‰‹åŠ¨æ‹†åˆ†ä¸ºå°ä»»åŠ¡ï¼Œè€Œæ¯ä¸ªä»»åŠ¡æ˜¯åŒæ­¥çš„ï¼ˆä¸å¯è¢«æ‰“æ–­ï¼‰ï¼Œè™½ç„¶åœ¨åŒæ­¥ä»»åŠ¡é‡Œè°ƒç”¨äº†å¼‚æ­¥ä»£ç -hhhï¼ˆå¥½å§-å½“æˆ‘æ²¡è¯´"><a href="#æ‰€ä»¥ï¼Œæš´è®ºï¼šRustå¼‚æ­¥çš„æœ¬è´¨æ˜¯å°†å¤§åŒæ­¥æ‹†åˆ†ä¸ºå°åŒæ­¥ï¼Œå¤§ä»»åŠ¡æ‰‹åŠ¨æ‹†åˆ†ä¸ºå°ä»»åŠ¡ï¼Œè€Œæ¯ä¸ªä»»åŠ¡æ˜¯åŒæ­¥çš„ï¼ˆä¸å¯è¢«æ‰“æ–­ï¼‰ï¼Œè™½ç„¶åœ¨åŒæ­¥ä»»åŠ¡é‡Œè°ƒç”¨äº†å¼‚æ­¥ä»£ç -hhhï¼ˆå¥½å§-å½“æˆ‘æ²¡è¯´" class="headerlink" title="æ‰€ä»¥ï¼Œæš´è®ºï¼šRustå¼‚æ­¥çš„æœ¬è´¨æ˜¯å°†å¤§åŒæ­¥æ‹†åˆ†ä¸ºå°åŒæ­¥ï¼Œå¤§ä»»åŠ¡æ‰‹åŠ¨æ‹†åˆ†ä¸ºå°ä»»åŠ¡ï¼Œè€Œæ¯ä¸ªä»»åŠ¡æ˜¯åŒæ­¥çš„ï¼ˆä¸å¯è¢«æ‰“æ–­ï¼‰ï¼Œè™½ç„¶åœ¨åŒæ­¥ä»»åŠ¡é‡Œè°ƒç”¨äº†å¼‚æ­¥ä»£ç  hhhï¼ˆå¥½å§ å½“æˆ‘æ²¡è¯´"></a>æ‰€ä»¥ï¼Œæš´è®ºï¼šRustå¼‚æ­¥çš„æœ¬è´¨æ˜¯å°†å¤§åŒæ­¥æ‹†åˆ†ä¸ºå°åŒæ­¥ï¼Œå¤§ä»»åŠ¡æ‰‹åŠ¨æ‹†åˆ†ä¸ºå°ä»»åŠ¡ï¼Œè€Œæ¯ä¸ªä»»åŠ¡æ˜¯åŒæ­¥çš„ï¼ˆä¸å¯è¢«æ‰“æ–­ï¼‰ï¼Œè™½ç„¶åœ¨åŒæ­¥ä»»åŠ¡é‡Œè°ƒç”¨äº†å¼‚æ­¥ä»£ç  hhhï¼ˆå¥½å§ å½“æˆ‘æ²¡è¯´</h4><h4 id="çŠ¶æ€ä¿å­˜ï¼š"><a href="#çŠ¶æ€ä¿å­˜ï¼š" class="headerlink" title="çŠ¶æ€ä¿å­˜ï¼š"></a>çŠ¶æ€ä¿å­˜ï¼š</h4><p>å…¶å®Rustå¼‚æ­¥æœ¬è´¨ä¸Šæ˜¯åŸºäºæ— æ ˆåç¨‹çš„ï¼Œè¿™ä¸ªçŠ¶æ€æœºç®€ç›´ä¸€æ¯›ä¸€æ ·</p><p>ä½ æƒ³æƒ³å¤šçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹ç”±CPUè°ƒåº¦ï¼Œå¯èƒ½è¢«éšæ—¶æ‰“æ–­ï¼Œæ¯ä¸ªçº¿ç¨‹çš„çŠ¶æ€ä¿å­˜åœ¨è‡ªå·±çš„æ ˆä¸Šï¼Œæ‰€ä»¥æ— è®ºä½•æ—¶è¢«æ‰“æ–­éƒ½èƒ½ä¿å­˜çŠ¶æ€</p><p>æœ‰æ ˆåç¨‹ä¹Ÿæ˜¯æ¨¡æ‹Ÿäº†è¿™ä¸ªè¿‡ç¨‹</p><p>è€ŒåŸºäºçŠ¶æ€æœºçš„æ— æ ˆåç¨‹å’Œ<code>Rust</code>çš„å¼‚æ­¥<code>poll</code>ï¼Œä¹Ÿæ˜¯ä¸ºäº†ä¿å­˜çŠ¶æ€ï¼Œä½†æ˜¯åªèƒ½ä¿å­˜ç‰¹å®šç‚¹ï¼ˆ<code>.await</code>ï¼‰çš„çŠ¶æ€</p><p>ä»…æ­¤è€Œå·²</p><h3 id="ç»§ç»­ï¼šé‚£ä¹ˆpollå‡½æ•°ç”±è°æ¥è°ƒç”¨å‘¢"><a href="#ç»§ç»­ï¼šé‚£ä¹ˆpollå‡½æ•°ç”±è°æ¥è°ƒç”¨å‘¢" class="headerlink" title="ç»§ç»­ï¼šé‚£ä¹ˆpollå‡½æ•°ç”±è°æ¥è°ƒç”¨å‘¢"></a>ç»§ç»­ï¼šé‚£ä¹ˆpollå‡½æ•°ç”±è°æ¥è°ƒç”¨å‘¢</h3><p>å…¶å®Rustè¯­è¨€æœ¬èº«åªæä¾›äº†æœ€åŸºæœ¬çš„å¼‚æ­¥å…³é”®å­—ï¼Œä½†æ˜¯æ²¡æœ‰æä¾›è¿è¡Œæ—¶</p><p>æ‰€è°“è¿è¡Œæ—¶ï¼Œå°±æ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œå»ä¸»åŠ¨è°ƒç”¨<code>Future</code>çš„<code>poll</code>å‡½æ•°</p><p>æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ç¬¬ä¸‰æ–¹åº“<code>Tokio</code>çš„å®ç°ï¼š</p><p>æˆ‘ä»¬ä¸€èˆ¬æ˜¯è¿™æ ·ä½¿ç”¨çš„</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#[tokio::main]</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Hello world&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶å®ä¼šè¢«å±•å¼€ä¸º</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    tokio::runtime::Builder::<span class="hljs-title function_ invoke__">new_multi_thread</span>() <span class="hljs-comment">//å¯ä»¥æ˜¯å•çº¿ç¨‹orå¤šçº¿ç¨‹</span><br>        .<span class="hljs-title function_ invoke__">enable_all</span>()<br>        .<span class="hljs-title function_ invoke__">build</span>()<br>        .<span class="hljs-title function_ invoke__">unwrap</span>()<br>        .<span class="hljs-title function_ invoke__">block_on</span>(<span class="hljs-keyword">async</span> &#123;<br>            <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Hello world&quot;</span>);<br>        &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·çœ‹å°±å¾ˆæ¸…æ¥šäº†ï¼Œ<code>block_on</code>å°±è·ŸQtçš„<code>exec</code>ä¸€æ ·ï¼Œ<code>main</code>å‡½æ•°ä»ä¸€å¼€å§‹ï¼Œå°±è¿›å…¥äº†ä¸€ä¸ªæ­»å¾ªç¯</p><p>è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„å®ç°ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs rust"><br><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Executor</span> &#123;<br>    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">block_on</span>&lt;F, T, O&gt;(&amp;<span class="hljs-keyword">self</span>, f: F) <span class="hljs-punctuation">-&gt;</span> O<br>    &#123;<br>        <span class="hljs-keyword">let</span> <span class="hljs-variable">_waker</span> = waker_fn::<span class="hljs-title function_ invoke__">waker_fn</span>(|| &#123;&#125;);<br>        <span class="hljs-keyword">let</span> <span class="hljs-variable">cx</span> = &amp;<span class="hljs-keyword">mut</span> Context::<span class="hljs-title function_ invoke__">from_waker</span>(&amp;_waker);<br><br>        EX.<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-keyword">self</span>, || &#123;<br>            <span class="hljs-keyword">let</span> <span class="hljs-variable">fut</span> = <span class="hljs-title function_ invoke__">f</span>();<br>            pin_utils::pin_mut!(fut);<br>            <span class="hljs-keyword">loop</span> &#123;<br>                <span class="hljs-comment">// return if the outer future is ready</span><br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-variable">std</span>::task::Poll::<span class="hljs-title function_ invoke__">Ready</span>(t) = fut.<span class="hljs-title function_ invoke__">as_mut</span>().<span class="hljs-title function_ invoke__">poll</span>(cx) &#123;<br>                    <span class="hljs-keyword">break</span> t;<br>                &#125;<br><br>                <span class="hljs-comment">// consume all tasks</span><br>                <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-variable">Some</span>(t) = <span class="hljs-keyword">self</span>.local_queue.<span class="hljs-title function_ invoke__">pop</span>() &#123;<br>                    <span class="hljs-keyword">let</span> <span class="hljs-variable">future</span> = t.future.<span class="hljs-title function_ invoke__">borrow_mut</span>();<br>                    <span class="hljs-keyword">let</span> <span class="hljs-variable">w</span> = <span class="hljs-title function_ invoke__">waker</span>(t.<span class="hljs-title function_ invoke__">clone</span>());<br>                    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">context</span> = Context::<span class="hljs-title function_ invoke__">from_waker</span>(&amp;w);<br>                    <span class="hljs-keyword">let</span> <span class="hljs-variable">_</span> = Pin::<span class="hljs-title function_ invoke__">new</span>(future).<span class="hljs-title function_ invoke__">as_mut</span>().<span class="hljs-title function_ invoke__">poll</span>(&amp;<span class="hljs-keyword">mut</span> context);<br>                &#125;<br><br>                <span class="hljs-comment">// no task to execute now, it may ready</span><br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-variable">std</span>::task::Poll::<span class="hljs-title function_ invoke__">Ready</span>(t) = fut.<span class="hljs-title function_ invoke__">as_mut</span>().<span class="hljs-title function_ invoke__">poll</span>(cx) &#123;<br>                    <span class="hljs-keyword">break</span> t;<br>                &#125;<br><br>                <span class="hljs-comment">// block for io</span><br>                <span class="hljs-keyword">self</span>.reactor.<span class="hljs-title function_ invoke__">borrow_mut</span>().<span class="hljs-title function_ invoke__">wait</span>();<br>            &#125;<br>        &#125;)<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å¯¹å§ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œä¸æ–­åœ°ä»ä»»åŠ¡é˜Ÿåˆ—é‡Œå–å‡º<code>Future</code>ï¼Œç”¨<code>poll</code>è½®è¯¢å’Œæ¨è¿›</p><p>è€Œåœ¨<code>poll</code>å‡½æ•°ä¸­ï¼Œå¦‚æœé‡åˆ°äº†éœ€è¦å¼‚æ­¥è¿›è¡Œçš„ä»»åŠ¡ï¼ˆå¦‚ç½‘ç»œIOï¼‰</p><p>å°±ä¼šä¸»åŠ¨å°†ä»»åŠ¡äº¤ç»™<code>reactor</code>ï¼ˆç”¨ä»¥ç»Ÿä¸€ç›‘å¬IOï¼‰å¹¶è¿”å›<code>Pending</code>ï¼šåœ¨æ¯ä¸€æ¬¡å¾ªç¯æœ«å°¾ä¼šè¿›è¡Œ<code>self.reactor.borrow_mut().wait();</code></p><p>è¿™ä¸ªå¯ä»¥æ˜¯é˜»å¡çš„ï¼Œå› ä¸ºåªæœ‰å½“ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼ˆéƒ½åœ¨ç­‰å¾…IOæ—¶ï¼‰æ‰ä¼šè¿›å…¥wait</p><blockquote><p>æ‰€ä»¥å¼‚æ­¥ä¸åŒæ­¥çš„åŒºåˆ«å°±åœ¨äº åœ¨åˆé€‚çš„æ—¶é—´åšåˆé€‚çš„äº‹æƒ…</p></blockquote><p>å½“IOå‡†å¤‡å®Œæ¯•æ—¶ï¼Œ<code>reactor</code>ä¼šå”¤é†’ç›¸å…³çš„<code>Future</code>ä»»åŠ¡ï¼ˆå°†å…¶åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼‰</p><p>è¿™æ ·ï¼Œä»–ä¸‹æ¬¡åˆä¼šè¢«è°ƒç”¨<code>poll</code>å‡½æ•°ï¼ŒåŒæ—¶å› ä¸ºæœ‰çŠ¶æ€æœºè®°å½•çŠ¶æ€ï¼Œå¯ä»¥è¿…é€Ÿåœ°è¿›è¡ŒIO</p><p>å¤§æ¦‚å°±é…±</p><h2 id="æ‰€ä»¥å¼‚æ­¥çš„æœ¬è´¨æ˜¯ä»€ä¹ˆ"><a href="#æ‰€ä»¥å¼‚æ­¥çš„æœ¬è´¨æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ‰€ä»¥å¼‚æ­¥çš„æœ¬è´¨æ˜¯ä»€ä¹ˆ"></a>æ‰€ä»¥å¼‚æ­¥çš„æœ¬è´¨æ˜¯ä»€ä¹ˆ</h2><p>æ˜¯å¯¹æ—¶é—´çš„å‹æ¦¨ï¼Œæ˜¯å°½é‡å‡å°‘æ— è°“çš„ç­‰å¾…ï¼Œæ˜¯åœ¨åˆé€‚çš„æ—¶é—´åŒæ­¥ï¼Œæ˜¯å¯¹ä»»åŠ¡çš„æ‹†åˆ†ï¼Œæ˜¯å°æ˜å€’èŒ¶é—®é¢˜</p><h3 id="å¼‚æ­¥çš„å®ç°æ–¹å¼æœ‰ä»€ä¹ˆ"><a href="#å¼‚æ­¥çš„å®ç°æ–¹å¼æœ‰ä»€ä¹ˆ" class="headerlink" title="å¼‚æ­¥çš„å®ç°æ–¹å¼æœ‰ä»€ä¹ˆ"></a>å¼‚æ­¥çš„å®ç°æ–¹å¼æœ‰ä»€ä¹ˆ</h3><p>æ€»ç»“èµ·æ¥å°±ä¿©</p><ul><li>å¤šçº¿ç¨‹ï¼ˆå¤šè¿›ç¨‹ä¹Ÿæ˜¯å¤šçº¿ç¨‹ï¼‰</li><li>ç³»ç»Ÿå¼‚æ­¥API</li></ul><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://zhuanlan.zhihu.com/p/611781411">Rust Tokioï¼Œè¿è¡Œæ—¶ä»¥åŠä»»åŠ¡ç›¸å…³API - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://rustmagazine.github.io/rust_magazine_2021/chapter_12/monoio.html">å­—èŠ‚è·³åŠ¨ | Rust å¼‚æ­¥è¿è¡Œæ—¶çš„è®¾è®¡ä¸å®ç° - Rustç²¾é€‰ (rustmagazine.github.io)</a></p><p><a href="https://github.com/ihciah/mini-rust-runtime/tree/master">ihciah&#x2F;mini-rust-runtime (github.com)</a></p><p><a href="https://blog.rustforever.top/2021/11/24/rust/futures/future-explained1/">future explained(1) - Hexo (rustforever.top)</a></p><p><a href="https://zhuanlan.zhihu.com/p/611587154">Rustå­¦ä¹ ç¬”è®°-å¼‚æ­¥ç¼–ç¨‹(async&#x2F;await&#x2F;Future) - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://course.rs/advance/async/getting-started.html">async ç¼–ç¨‹å…¥é—¨ - Rustè¯­è¨€åœ£ç»(Rust Course)</a></p><p><a href="https://zhuanlan.zhihu.com/p/474274504">æ— æ ˆåç¨‹ï¼ˆstackless coroutineï¼‰ - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://zhuanlan.zhihu.com/p/347445164">æµ…è°ˆæœ‰æ ˆåç¨‹ä¸æ— æ ˆåç¨‹ - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://blog.csdn.net/tianlangstudio/article/details/107310211?spm=1001.2101.3001.6650.3&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-3-107310211-blog-115638777.235%5Ev38%5Epc_relevant_anti_vip_base&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-3-107310211-blog-115638777.235%5Ev38%5Epc_relevant_anti_vip_base&utm_relevant_index=6">ä¸€æ–‡è¯»æ‡‚Rustçš„async_rust async-CSDNåšå®¢</a></p>]]></content>
    
    
    <categories>
      
      <category>å¼‚æ­¥ç¼–ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Rust</tag>
      
      <tag>å¼‚æ­¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>C++ äºŒçº§æŒ‡é’ˆä¸äºŒç»´æ•°ç»„</title>
    <link href="/2023/11/11/C-%E4%BA%8C%E7%BA%A7%E6%8C%87%E9%92%88%E4%B8%8E%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84/"/>
    <url>/2023/11/11/C-%E4%BA%8C%E7%BA%A7%E6%8C%87%E9%92%88%E4%B8%8E%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> a[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>] = &#123; <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span> &#125;;<br><span class="hljs-type">int</span>** ptr = (<span class="hljs-type">int</span>**)a;<br></code></pre></td></tr></table></figure><p>æŠŠäºŒç»´æ•°ç»„èµ‹å€¼ç»™äºŒçº§æŒ‡é’ˆï¼Œè¯¥å¦‚ä½•é€šè¿‡<code>ptr</code>å¯¹ç¬¬iè¡Œç¬¬jåˆ—è¿›è¡Œè®¿é—®å‘¢ï¼Ÿ</p><p>æœ‰äººè¯´ï¼Œç®€å•ï¼š<code>ptr[i][j]</code></p><p>é‚£ä¹ˆå¥½ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼š<code>ptr[i][j] == *(*(ptr+i)+j)</code> &#x2F;&#x2F;ç¼–è¯‘å™¨å±•å¼€</p><p>é‚£ä¹ˆ<code>ptr + i</code> çš„æ­¥é•¿æ˜¯å¤šå°‘ï¼Œæˆ–è€…è¯´<code>ptr + 1</code> ç§»åŠ¨äº†å‡ ä¸ªå­—èŠ‚</p><p>é‚£ä¹ˆæ˜¾ç„¶æ˜¯ç§»åŠ¨ã€æŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ çš„å¤§å°ã€‘ï¼Œä¹Ÿå°±æ˜¯<code>int*</code> çš„å¤§å°</p><p>é‚£ä¹ˆæ˜¾ç„¶ï¼š<code>ptr[i][j]</code> ä¸èƒ½æ­£ç¡®å®šä½ç¬¬iè¡Œç¬¬jåˆ—</p><blockquote><p>å…¶å®ï¼Œ<code>int** ptr = a;</code>å°±ä¼šå‘å‡ºè­¦å‘Š <code>&quot;int(*)[3]&quot;ç±»å‹çš„å€¼ä¸èƒ½ç”¨äºåˆå§‹åŒ–&quot;int**&quot;ç±»å‹çš„å®ä½“</code> ä¹Ÿè®¸ï¼Œè¿™è¯´æ˜ï¼Œæ•°ç»„åªèƒ½é€€åŒ–ä¸ºä¸€çº§æŒ‡é’ˆ</p></blockquote><p>å¦‚æœåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæƒ³è¦å¼ºè¡Œé€šè¿‡<code>ptr</code>è®¿é—®</p><p>åªèƒ½ï¼š<code>*((int*)ptr + i * N + j)</code> å¼ºè½¬ä¸ºä¸€çº§æŒ‡é’ˆ &#x2F;&#x2F;Næ˜¯ä¸€è¡Œçš„å…ƒç´ ä¸ªæ•°</p><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><p>åŒæ—¶ï¼Œ<code>**ptr</code> ä¼šç›´æ¥é€ æˆè¶Šç•Œè®¿é—®</p><p>è¿™æ˜¯å› ä¸ºç¬¬ä¸€æ¬¡è§£å¼•ç”¨<code>*ptr</code> å…¶å®å°±å·²ç»æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼<code>1</code> äº† &#x2F;&#x2F;32ä½ç³»ç»Ÿä¸‹</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>(int)(*ptr)</code> &#x3D;&#x3D; 1 &#x2F;&#x2F;32ä½ç³»ç»Ÿä¸‹</p><p>è€Œä¸”ï¼Œè§£å¼•ç”¨æ„å‘³ç€æ‰¾åˆ°æŒ‡é’ˆæ‰€å­˜åœ°å€ä¸Šçš„å€¼</p><p>å¦‚æœæŠŠç¬¬ä¸€ä¸ªå…ƒç´ çœ‹åšæŒ‡é’ˆï¼Œé‚£ä¹ˆè¯¥æŒ‡é’ˆæ‰€å­˜çš„åœ°å€æ˜¯<code>1</code>å—ï¼Ÿä¸ä¸€å®š</p><ul><li>32ä½ç³»ç»Ÿä¸‹ï¼ŒæŒ‡é’ˆæ˜¯4ä¸ªå­—èŠ‚</li><li>64ä½ç³»ç»Ÿä¸‹ï¼ŒæŒ‡é’ˆæ˜¯8ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆç¬¬ä¸€ç¬¬äºŒä¸ªå…ƒç´ ä¼šè¢«å…±åŒè§£é‡Šä¸ºåœ°å€</li></ul><p>ç„¶åä¼šå»è¯¥åœ°å€ï¼ˆæ¯”å¦‚0000000200000001ï¼‰å¯»æ‰¾å€¼</p><p>é‚£ä¹ˆæ˜¾ç„¶è¶Šç•Œè®¿é—®äº†ï¼Œç›´æ¥bombï¼Œå¼‚å¸¸</p><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="æ‰€ä»¥ï¼Œæ–¹æ³•1ï¼šint-ptr-3-a"><a href="#æ‰€ä»¥ï¼Œæ–¹æ³•1ï¼šint-ptr-3-a" class="headerlink" title="æ‰€ä»¥ï¼Œæ–¹æ³•1ï¼šint (*ptr)[3] = a;"></a>æ‰€ä»¥ï¼Œæ–¹æ³•1ï¼š<code>int (*ptr)[3] = a;</code></h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼šå³å·¦æ³•åˆ™ï¼ˆæ³¨æ„æ‹¬å·ï¼‰ï¼Œè·Ÿæˆ‘è¯»ï¼š<code>ptr</code>æ˜¯ä¸€ä¸ªæŒ‡é’ˆ(*)ï¼ŒæŒ‡å‘ä¸€ä¸ªæ•°ç»„([3])ï¼Œè¿™ä¸ªæ•°ç»„æœ‰3ä¸ªå…ƒç´ ï¼Œå…ƒç´ ç±»å‹æ˜¯<code>int</code></p><p>æ’æ²³é‡Œ</p><p>æ‰€ä»¥ï¼Œ<code>a[2][3]</code>å®é™…ä¸Šå°±æ˜¯æœ‰ä¸¤ä¸ªè¿™æ ·çš„ä¸€ç»´æ•°ç»„[3]ï¼Œæ•°ç»„çš„æ•°ç»„</p><p>é…±ç´«çš„è¯ï¼Œ<code>ptr++</code>ï¼Œå°±å¯ä»¥åœ¨è¿™ä¸¤ä¸ªä¸€ç»´æ•°ç»„çš„é¦–åœ°å€è·³è·ƒäº†ï¼Œæ­¥é•¿ä¸º<code>int[3]</code></p><p>æ‰€ä»¥ä¹Ÿå¯ä»¥<code>ptr[i][j]</code>è¿›è¡Œè®¿é—®</p><h3 id="æ–¹æ³•2ï¼šint-ptr-new-int-N"><a href="#æ–¹æ³•2ï¼šint-ptr-new-int-N" class="headerlink" title="æ–¹æ³•2ï¼šint** ptr = new int*[N];"></a>æ–¹æ³•2ï¼š<code>int** ptr = new int*[N];</code></h3><p>è¿™å°†æ„å‘³ç€ï¼Œç”³è¯·çš„ç©ºé—´æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯<code>int*</code> ç±»å‹</p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ª<code>int*</code>éƒ½ä¼šæŒ‡å‘ä¸€ä¸ªä¸€ç»´æ•°ç»„</p><p>æ‰€ä»¥<code>ptr[i]</code>å°±æ˜¯ç¬¬iä¸ªä¸€ç»´æ•°ç»„çš„é¦–åœ°å€ï¼Œ<code>ptr[i][j]</code>å°±æ˜¯è¿™ä¸ªæ•°ç»„çš„ç¬¬jä¸ªå…ƒç´ </p><p>æ‰€ä»¥å¯ä»¥æ­£å¸¸è®¿é—®</p><p>å°±æ˜¯éœ€è¦å¾ªç¯ç”³è¯·å†…å­˜</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span>** ptr = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>*[rows];<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; rows; i++) &#123;<br>    ptr[i] = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[cols];<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h2>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>pointer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>QMediaPlayerä¸è§£ç å™¨æµ…æ</title>
    <link href="/2023/09/26/QMediaPlayer%E4%B8%8E%E8%A7%A3%E7%A0%81%E5%99%A8%E6%B5%85%E6%9E%90/"/>
    <url>/2023/09/26/QMediaPlayer%E4%B8%8E%E8%A7%A3%E7%A0%81%E5%99%A8%E6%B5%85%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Qt</code>å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½¿ç”¨<code>QMediaPlayer</code>ç±»æ’­æ”¾éŸ³è§†é¢‘ï¼ˆmp3ã€mp4ç­‰ï¼‰</p><p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å…´è‡´å†²å†²åœ°å¼€å§‹<code>play</code>æ—¶ï¼Œå´åªæ”¶è·äº†ä¸€è¡ŒErrorï¼š</p><blockquote><p>DirectShowPlayerService::doRender: Unresolved error code 80040266</p></blockquote><p>è¿™æ˜¯å› ä¸º<code>QMediaPlayer</code>åº•å±‚æ˜¯ä½¿ç”¨<code>DirectShowPlayerService</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº<code>DirectShow</code>æ¡†æ¶çš„åç«¯å®ç°</p><p>ä½†æ˜¯<code>DirectShowPlayerService</code>æ²¡æœ‰è‡ªå¸¦è§£ç åº“ï¼Œè€Œæ˜¯å¯¹å¹³å°ç›¸å…³çš„æ’­æ”¾å™¨æ¡†æ¶åšäº†å°è£…ï¼Œæä¾›äº†å¹³å°æ— å…³çš„API</p><p>ä¸”<code>DirectShow</code>æ¡†æ¶é»˜è®¤åªæ”¯æŒä¸€äº›å¸¸è§çš„æ ¼å¼ï¼ˆå¦‚WMVã€AVIã€MPGç­‰ï¼‰ï¼Œå¦‚æœè¦æ’­æ”¾å…¶ä»–æ ¼å¼çš„éŸ³è§†é¢‘æ–‡ä»¶ï¼Œå°±éœ€è¦é¢å¤–å®‰è£…è§£ç å™¨</p><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/directshow/supported-formats-in-directshow">DirectShow ä¸­æ”¯æŒçš„æ ¼å¼ - Win32 apps | Microsoft Learn</a></p><h2 id="Pre-æ­£ç‰‡"><a href="#Pre-æ­£ç‰‡" class="headerlink" title="Pre - æ­£ç‰‡"></a>Pre - æ­£ç‰‡</h2><p>å¥½çš„ ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†<code>QMediaPlayer</code>ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œé™¤æŸäº›æ ¼å¼å¤–ï¼Œéœ€è¦é…åˆç¬¬ä¸‰æ–¹è§£ç å™¨ä½¿ç”¨</p><p>é‚£ä¹ˆä»€ä¹ˆè§£ç å™¨åˆé€‚å‘¢ï¼Ÿ</p><p>éšä¾¿ä¸Šç½‘ä¸€æœæŠ¥é”™ï¼Œç»™å‡ºçš„ç­”æ¡ˆéƒ½æ˜¯<a href="https://github.com/Nevcairiel/LAVFilters/releases">LAVFilters</a></p><p>ç›´æ¥å¹²ï¼Œå™¼é‡Œå•ªå•¦å®‰è£…åˆ°<code>Qt</code>ç›®å½•ä¸‹ï¼ˆä¸ç¡®å®šå®‰è£…ä½ç½®æ˜¯å¦æœ‰è¦æ±‚ï¼‰</p><p>å®‰è£…è¿‡ç¨‹ä¼šè‡ªåŠ¨å‘<code>Windows</code>æ³¨å†Œè§£ç å™¨ï¼Œæ— éœ€æˆ‘ä»¬æ‰‹åŠ¨æ“ä½œï¼ˆä¸éœ€è¦åœ¨Qtä¸­æŒ‡å®šè§£ç å™¨ä½ç½®ä¹‹ç±»çš„ï¼‰</p><p>å¥½çš„ï¼Œç°åœ¨å¯ä»¥æ’­æ”¾<code>mp3</code>éŸ³é¢‘æ–‡ä»¶äº†ï¼Œã‚ˆã‹ã£ãŸæ”¶å·¥</p><h2 id="æ­£ç‰‡"><a href="#æ­£ç‰‡" class="headerlink" title="æ­£ç‰‡"></a>æ­£ç‰‡</h2><p>æ—¶å…‰èè‹’ï¼Œæ–—è½¬æ˜Ÿç§»ï¼Œè½¬çœ¼é—´ï¼Œæ•°å¹´è¿‡å»äº†</p><p><a href="https://github.com/SpriteOvO/AirPodsDesktop">AirpodsDesktop</a>éœ€è¦ä½¿ç”¨<code>QMediaPlayer</code>æ’­æ”¾<code>.avi</code>è§†é¢‘</p><p>å‡ºç°äº†ä»¤äººè´¹è§£çš„æ— æ³•æ¸²æŸ“å’Œå¡é¡¿ç°è±¡</p><blockquote><p>èµ·åˆï¼Œæ²¡æœ‰äººåœ¨æ„è¿™åœºç¾éš¾ã€‚è¿™åªä¸è¿‡æ˜¯ä¸€æ¬¡å¡é¡¿ï¼Œä¸€é¡¿é»‘å±ï¼Œä¸€ä¸ªè§†é¢‘çš„ç­ç»ï¼Œä¸€ä¸ªæ§ä»¶çš„æ¶ˆå¤±ã€‚ç›´åˆ°æ¯ä¸ªè§£ç å™¨å’Œè¿™åœºç¾éš¾æ¯æ¯ç›¸å…³ã€‚</p></blockquote><p>æ˜¯çš„ï¼Œç»è¿‡ä¸€é¡¿æœç´¢ï¼Œè¿™ä¸è§£ç å™¨æœ‰ç€è„±ä¸å¼€çš„å¹²ç³»</p><p>åœ¨å¸è½½äº†<code>LAVFilters</code>ä¹‹åï¼Œ<code>.avi</code>è§†é¢‘å¯ä»¥æ­£å¸¸æ’­æ”¾äº†</p><h3 id="ä½†æ˜¯mp3æ’­æ”¾ä¸äº†äº†aaaa"><a href="#ä½†æ˜¯mp3æ’­æ”¾ä¸äº†äº†aaaa" class="headerlink" title="ä½†æ˜¯mp3æ’­æ”¾ä¸äº†äº†aaaa"></a>ä½†æ˜¯mp3æ’­æ”¾ä¸äº†äº†aaaa</h3><p>ä¹Ÿå°±æ˜¯è¯´<code>mp3</code>éœ€è¦ä¾èµ–<code>LAVFilters</code>è§£ç ï¼Œ<code>avi</code>ä¸éœ€è¦ï¼Œä¸”<code>LAVFilters</code>è¿˜ä¼šé€ æˆ<a href="https://blog.csdn.net/windxgz/article/details/108603033">åä½œç”¨</a></p><p>åˆç»è¿‡ä¸€é¡¿æœç´¢å‘ç°è¿™ç§ç°è±¡å¹¶ä¸ç½•è§ï¼Œ<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåˆ©ç”¨æ•ˆæœæ›´å¥½çš„<a href="http://codecguide.com/download_k-lite_codec_pack_standard.htm">K-Lite</a>æ›¿ä»£<code>LAVFilters</code></p><p>é…±ç´«<code>mp3</code>å’Œ<code>avi</code>éƒ½å¯ä»¥æ­£å¸¸æ’­æ”¾å•¦ï¼Œå¯å–œå¯è´ºï¼</p><h2 id="One-More-Thing"><a href="#One-More-Thing" class="headerlink" title="One More Thing"></a>One More Thing</h2><p>ç­‰ä¸€ä¸‹ï¼Œå…ˆåˆ«é«˜å…´å¾—å¤ªæ—©</p><p>å¤§å“¥ï¼Œä½ å¼€å‘çš„å¯æ˜¯è½¯ä»¶ï¼Œæ˜¯è¦ç»™ç”¨æˆ·ä½¿ç”¨çš„ï¼Œè§£ç å™¨æ€ä¹ˆå®‰è£…</p><p>é¦–å…ˆï¼Œä»å®‰è£…éš¾åº¦å’Œå®‰è£…åŒ…å¤§å°æ¥è¯´ï¼Œ<code>K-Lite</code>è¦è¿œé«˜äº<code>LAVFilters</code></p><p>ä»–ä¿©éƒ½æ˜¯åŸºäº<code>FFmpeg</code>å¼€å‘çš„ï¼Œè€Œä¸”è²Œä¼¼<code>K-Lite</code>å†…å«ä¸€ä¸ª<code>LAVFilters</code>ï¼ˆNewBingè¯´çš„ï¼‰</p><p>LAVFiltersæ‰€åŒ…å«çš„ç»„ä»¶è¾ƒå°‘ï¼Œå¤§æ¦‚å°±æ˜¯<code>dll + ax + manifest</code>ï¼ˆåœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼‰</p><p>åªè¦åœ¨å®‰è£…æ—¶ï¼Œåœ¨ç”¨æˆ·ç”µè„‘é‡Œè‡ªåŠ¨æ‰§è¡Œaxçš„å®‰è£…è„šæœ¬å³å¯</p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/zyhse/article/details/113716578">åœ¨Windowsä¸‹ä½¿ç”¨QMediaPlayerå®ç°æ’­æ”¾è§†é¢‘CSDNåšå®¢</a></p><p>ä½†æ˜¯<code>K-Lite</code>å¯èƒ½æ²¡è¿™ä¹ˆæ–¹ä¾¿</p><p>å¦‚æœè®©ç”¨æˆ·æ‰‹åŠ¨å®‰è£…çš„è¯ï¼Œè¿˜éœ€è¦ä¸€äº›æŒ‡å¼•ï¼ˆ<code>K-Lite</code>é€‰é¡¹ä¸æ­¥éª¤ç¹å¤šï¼‰</p><p>æ‰€ä»¥ä»è¿™ä¸ªå±‚é¢æ¥è¯´<code>LAVFilters</code>æ›´èƒœä¸€ç­¹ï¼ˆå½“ç„¶ä¸ºäº†å…¨é¢åŠŸèƒ½æ€§ï¼Œè¿˜æ˜¯å¾—è€ƒè™‘K-Liteï¼‰</p><h3 id="ç‰¹äº‹ç‰¹åŠ"><a href="#ç‰¹äº‹ç‰¹åŠ" class="headerlink" title="ç‰¹äº‹ç‰¹åŠ"></a>ç‰¹äº‹ç‰¹åŠ</h3><p>ä¸è¿‡ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>AirpodsDesktop</code>ä½¿ç”¨çš„æ˜¯<code>avi</code>æ–‡ä»¶ï¼Œ<code>QMediaPlayer</code>ä¸éœ€è¦é¢å¤–çš„è§£ç å™¨å°±å¯ä»¥æ’­æ”¾è¿™ä¸ªå¤è€çš„æ ¼å¼ï¼Œè€Œæˆ‘çš„<a href="https://github.com/MrBeanCpp/Right-Player">Right-Player</a>éœ€è¦è§£ç å™¨æ¥æ’­æ”¾<code>mp3</code></p><p>ä¸ºäº†è°ƒå’Œè¿™ä¸ªçŸ›ç›¾ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®‰è£…<code>LAVFilters</code>æ—¶ï¼Œå–æ¶ˆå‹¾é€‰è§†é¢‘è§£ç å™¨ï¼ˆä½†æ˜¯è¦ä¿ç•™Splitteråˆ†ç¦»å™¨ï¼‰</p><h2 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h2><p>å¯èƒ½æœ‰äººä¼šæƒ³ï¼Œä¸ºä»€ä¹ˆEdgeè¿™æ ·çš„è½¯ä»¶ä¸éœ€è¦é¢å¤–å®‰è£…è§£ç å™¨å‘¢ï¼Ÿ</p><p><code>NewBing</code>çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><blockquote><p>Edgeä¹Ÿæ˜¯ä½¿ç”¨DirectShowæ¡†æ¶æ¥æ’­æ”¾éŸ³é¢‘å’Œè§†é¢‘æ–‡ä»¶ï¼Œä½†å®ƒä¸æ˜¯ä½¿ç”¨DirectShowPlayerServiceï¼Œè€Œæ˜¯ä½¿ç”¨è‡ªå·±çš„åç«¯å®ç°ï¼Œå®ƒå¯ä»¥åˆ©ç”¨Windows Media Foundationï¼ˆWMFï¼‰æˆ–Media Foundationï¼ˆMFï¼‰æ¥æä¾›æ›´é«˜æ•ˆå’Œæ›´ç¨³å®šçš„è§£ç æœåŠ¡</p><p>Edgeä¸éœ€è¦LAVFiltersè§£ç å™¨ï¼Œæ˜¯å› ä¸ºå®ƒå¯ä»¥ä½¿ç”¨WMFæˆ–MFæ¥æä¾›è§£ç å™¨ï¼Œè€ŒWMFæˆ–MFé»˜è®¤æ”¯æŒæ›´å¤šçš„è§†é¢‘æ ¼å¼ï¼Œä¾‹å¦‚H.264ã€H.265ã€VP8ã€VP9ç­‰ã€‚è¿™äº›æ ¼å¼æ¶µç›–äº†å¤§éƒ¨åˆ†çš„ç½‘ç»œè§†é¢‘å’Œæµåª’ä½“æœåŠ¡ï¼Œå› æ­¤Edgeå¯ä»¥ç›´æ¥æ’­æ”¾è¿™äº›è§†é¢‘æ–‡ä»¶ï¼Œä¸éœ€è¦é¢å¤–å®‰è£…è§£ç å™¨ã€‚</p></blockquote><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://blog.csdn.net/birenxiaofeigg/article/details/104129207">QMediaPlayerè§†é¢‘æ²¡æœ‰ç”»é¢æ˜¾ç¤ºï¼Œæˆ–æ’­æ”¾å¡é¡¿é—®é¢˜è§£å†³_vsä¸­é€šè¿‡qmediaplayer åŠ è½½ä¸å‡ºè§†é¢‘-CSDNåšå®¢</a></p><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/directshow/supported-formats-in-directshow">DirectShow ä¸­æ”¯æŒçš„æ ¼å¼ - Win32 apps | Microsoft Learn</a></p><p><a href="https://blog.csdn.net/windxgz/article/details/108603033">QTæ€»ç»“11â€”â€”QMediaPlayeræ— æ³•æ˜¾ç¤ºè§†é¢‘_qtä¸­qmediaplayeræ’­æ”¾è§†é¢‘æ— ååº”-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/qq_37631516/article/details/105124407">QTè§†é¢‘æ’­æ”¾ä¸å‡ºæ¥ï¼ŒæŠ¥é”™ DirectShowPlayerService::doRender: Unresolved error code 80040266â€”â€”æ²¡æœ‰å®‰è£…è§†é¢‘è§£ç å™¨-CSDNåšå®¢</a></p><p><a href="https://github.com/SpriteOvO/AirPodsDesktop">SpriteOvO&#x2F;AirPodsDesktop: â˜„ï¸ AirPods desktop user experience enhancement program, for Windows and Linux (WIP) (github.com)</a></p><p><a href="https://github.com/MrBeanCpp/Right-Player">MrBeanCpp&#x2F;Right-Player: ä¸€æ¬¾è½»é‡çº§éŸ³ä¹æ’­æ”¾å™¨ï¼Œæ‹¥æœ‰ç®€æ´ç¾è§‚çš„UIè®¾è®¡ (github.com)</a></p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>QMediaPlayerï¼Œè§£ç å™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaä¸ºä»€ä¹ˆä¸æ”¯æŒæ³›å‹æ•°ç»„</title>
    <link href="/2023/07/15/Java%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%94%AF%E6%8C%81%E6%B3%9B%E5%9E%8B%E6%95%B0%E7%BB%84/"/>
    <url>/2023/07/15/Java%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%94%AF%E6%8C%81%E6%B3%9B%E5%9E%8B%E6%95%B0%E7%BB%84/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Java</code>çš„æ³›å‹å¹¶ä¸æ˜¯çœŸæ­£çš„æ³›å‹</p><p>ä½†æ˜¯ï¼Œç©¶ç«Ÿä»€ä¹ˆæ‰æ˜¯çœŸæ­£çš„æ³›å‹å‘¢ï¼Ÿ</p><h3 id="çœŸæ­£çš„æ³›å‹"><a href="#çœŸæ­£çš„æ³›å‹" class="headerlink" title="çœŸæ­£çš„æ³›å‹"></a>çœŸæ­£çš„æ³›å‹</h3><p>æ ¹æ®<code>New Bing</code>çš„è¯´æ³•ï¼š</p><p>çœŸæ­£çš„æ³›å‹æ˜¯æŒ‡æ³›å‹ç±»å‹åœ¨ç¼–è¯‘æ—¶å’Œ<strong>è¿è¡Œæ—¶</strong>éƒ½èƒ½ä¿æŒç±»å‹ä¿¡æ¯</p><p>çœŸæ­£çš„æ³›å‹çš„å®ç°æ–¹å¼é€šå¸¸æ˜¯ç±»å‹è†¨èƒ€ï¼Œä¹Ÿå°±æ˜¯ä¸ºæ¯ä¸ªæ³›å‹å‚æ•°ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„ç±»æˆ–æ–¹æ³•</p><p>è¿™ä¸€ç‚¹å¯ä»¥å‚è€ƒ<code>C++</code>çš„æ¨¡æ¿å®ç°æ–¹å¼ï¼Œåœ¨ç¼–è¯‘æœŸä¸ºæ¯ä¸€ç§ä½¿ç”¨çš„å…·ä½“ç±»å‹ç”Ÿæˆå®ä¾‹ã€‚</p><h3 id="Javaæ³›å‹"><a href="#Javaæ³›å‹" class="headerlink" title="Javaæ³›å‹"></a>Javaæ³›å‹</h3><p><code>Java</code>çš„æ³›å‹å¹¶ä¸æ˜¯çœŸæ­£çš„æ³›å‹ï¼Œè€Œæ˜¯ä¼ªæ³›å‹</p><p>é‡‡ç”¨äº†ä¸€ç§ç§°ä¸º <strong>ç±»å‹æ“¦é™¤</strong> çš„æŠ€æœ¯ã€‚ç±»å‹æ“¦é™¤çš„æ„æ€æ˜¯ï¼Œåœ¨ç¼–è¯‘æ—¶ï¼Œæ³›å‹ç±»å‹ä¼šè¢«æ›¿æ¢ä¸ºå®ƒçš„<strong>ä¸Šç•Œ</strong>ç±»å‹ï¼ˆå¦‚æœæ²¡æœ‰æŒ‡å®šä¸Šç•Œï¼Œåˆ™ä¸º <code>Object</code> ç±»å‹ï¼‰ï¼Œå¹¶ä¸”åœ¨å­—èŠ‚ç å±‚é¢ï¼Œæ³›å‹ä¿¡æ¯ä¼šè¢«æ“¦é™¤ï¼Œ<strong>ä¸ä¼šä¿ç•™åˆ°è¿è¡Œæ—¶</strong></p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ³›å‹ç±» <code>Pair&lt;T&gt;</code> ï¼Œå…¶ä¸­ <code>T</code> æ˜¯ä¸€ä¸ªæ— é™å®šçš„ç±»å‹å˜é‡ï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘åï¼Œå®ƒçš„åŸå§‹ç±»å‹å°±æ˜¯ <code>Pair&lt;Object&gt;</code> ï¼Œä¹Ÿå°±æ˜¯è¯´ T è¢«æ›¿æ¢ä¸ºäº† <code>Object</code> ç±»å‹ã€‚å¦‚æœæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ³›å‹ç±» <code>Pair&lt;T extends Comparable&gt;</code> ï¼Œå…¶ä¸­ <code>T</code> æ˜¯ä¸€ä¸ªæœ‰é™å®šçš„ç±»å‹å˜é‡ï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘åï¼Œå®ƒçš„åŸå§‹ç±»å‹å°±æ˜¯ <code>Pair&lt;Comparable&gt;</code> ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>T</code> è¢«æ›¿æ¢ä¸ºäº†å®ƒçš„ä¸Šç•Œ <code>Comparable</code> ç±»å‹</p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆ Java è¦é‡‡ç”¨ç±»å‹æ“¦é™¤çš„æ–¹å¼æ¥å®ç°æ³›å‹å‘¢ï¼Ÿè¿™ä¸»è¦æ˜¯å‡ºäº <strong>å‘åå…¼å®¹æ€§</strong> çš„è€ƒè™‘ã€‚Java æ³›å‹æ˜¯åœ¨ Java 5 ä¸­å¼•å…¥çš„ï¼Œè€Œåœ¨æ­¤ä¹‹å‰ï¼ŒJava å·²ç»æœ‰äº†å¾ˆå¤šç‰ˆæœ¬å’Œå¾ˆå¤šç±»åº“ã€‚å¦‚æœ Java è¦å®ç°çœŸæ­£çš„æ³›å‹ï¼Œå°±éœ€è¦ä¿®æ”¹ JVM çš„æŒ‡ä»¤é›†å’Œç±»æ–‡ä»¶æ ¼å¼ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ä¹‹å‰çš„ç‰ˆæœ¬å’Œç±»åº“æ— æ³•åœ¨æ–°ç‰ˆæœ¬çš„ JVM ä¸Šè¿è¡Œã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒJava è®¾è®¡è€…é€‰æ‹©äº†ä¸€ç§ä¸éœ€è¦ä¿®æ”¹ JVM çš„æ–¹å¼æ¥å®ç°æ³›å‹ï¼Œä¹Ÿå°±æ˜¯ç±»å‹æ“¦é™¤ã€‚</p><p>ç±»å‹æ“¦é™¤ä½¿å¾— Java æ³›å‹èƒ½å¤Ÿä¸ä¹‹å‰çš„ç‰ˆæœ¬å’Œç±»åº“ä¿æŒ<strong>å…¼å®¹</strong>ï¼Œä½†ä¹Ÿå¸¦æ¥äº†ä¸€äº›<strong>é™åˆ¶å’Œé—®é¢˜</strong>ï¼Œæ¯”å¦‚ï¼š</p><ul><li>ä¸èƒ½ä½¿ç”¨åŸºæœ¬ç±»å‹ä½œä¸ºæ³›å‹å‚æ•°ï¼Œåªèƒ½ä½¿ç”¨åŒ…è£…ç±» &#x2F;&#x2F; int Ã— Integer âˆš</li><li>ä¸èƒ½æ ¹æ®æ³›å‹å‚æ•°åˆ›å»º<strong>æ•°ç»„</strong>æˆ–å®ä¾‹åŒ–å¯¹è±¡ï¼Œåªèƒ½ä½¿ç”¨åå°„æˆ– Object ç±»å‹</li><li>ä¸èƒ½å¯¹æ³›å‹å‚æ•°è¿›è¡Œ instanceof æ£€æŸ¥æˆ–å¼ºåˆ¶è½¬æ¢ï¼Œåªèƒ½ä½¿ç”¨é€šé…ç¬¦æˆ–è¾¹ç•Œ</li><li>ä¸èƒ½åœ¨é™æ€æ–¹æ³•æˆ–é™æ€å˜é‡ä¸­ä½¿ç”¨æ³›å‹ç±»çš„ç±»å‹å‚æ•°</li><li>ä¸èƒ½åˆ›å»ºæ³›å‹å¼‚å¸¸ç±»</li></ul><h2 id="ä¸ºä»€ä¹ˆä¸æ”¯æŒæ³›å‹æ•°ç»„"><a href="#ä¸ºä»€ä¹ˆä¸æ”¯æŒæ³›å‹æ•°ç»„" class="headerlink" title="ä¸ºä»€ä¹ˆä¸æ”¯æŒæ³›å‹æ•°ç»„"></a>ä¸ºä»€ä¹ˆä¸æ”¯æŒæ³›å‹æ•°ç»„</h2><p>Javaä¸èƒ½æ ¹æ®æ³›å‹å‚æ•°åˆ›å»ºæ•°ç»„ï¼Œä¹Ÿä¸æ”¯æŒæ³›å‹æ•°ç»„</p><p>è¿™ä¿©çœ‹èµ·æ¥å¾ˆåƒï¼Œä½†å…¶å®æ˜¯ä¸¤ç§ä¸åŒçš„ä¸œä¸œï¼š</p><h3 id="ä¸èƒ½æ ¹æ®æ³›å‹å‚æ•°åˆ›å»ºæ•°ç»„"><a href="#ä¸èƒ½æ ¹æ®æ³›å‹å‚æ•°åˆ›å»ºæ•°ç»„" class="headerlink" title="ä¸èƒ½æ ¹æ®æ³›å‹å‚æ•°åˆ›å»ºæ•°ç»„"></a>ä¸èƒ½æ ¹æ®æ³›å‹å‚æ•°åˆ›å»ºæ•°ç»„</h3><p>ä¸èƒ½æ ¹æ®æ³›å‹å‚æ•°åˆ›å»ºæ•°ç»„ï¼Œæ˜¯æŒ‡ä¸èƒ½ä½¿ç”¨<code>new T[size]</code>è¿™æ ·çš„è¯­æ³•æ¥åˆ›å»ºä¸€ä¸ªæ³›å‹ç±»å‹çš„æ•°ç»„</p><p>å› ä¸ºåœ¨ç¼–è¯‘æ—¶<strong>æ— æ³•ç¡®å®š<code>T</code>çš„å…·ä½“ç±»å‹</strong>ï¼Œä¹Ÿå°±æ‰¾ä¸åˆ°å¯¹åº”çš„ç±»å­—èŠ‚ç æ–‡ä»¶</p><p>è§£å†³æ–¹æ¡ˆå‚è€ƒï¼š<a href="https://www.cnblogs.com/minghaiJ/p/11259318.html">Javaä¸­åˆ›å»ºæ³›å‹æ•°ç»„ - minghai - åšå®¢å›­</a></p><h3 id="ä¸æ”¯æŒæ³›å‹æ•°ç»„"><a href="#ä¸æ”¯æŒæ³›å‹æ•°ç»„" class="headerlink" title="ä¸æ”¯æŒæ³›å‹æ•°ç»„"></a>ä¸æ”¯æŒæ³›å‹æ•°ç»„</h3><p>ä¸æ”¯æŒæ³›å‹æ•°ç»„ï¼Œæ˜¯æŒ‡ä¸èƒ½ä½¿ç”¨<code>new ArrayList&lt;T&gt;[size]</code>è¿™æ ·çš„è¯­æ³•æ¥åˆ›å»ºä¸€ä¸ªæ³›å‹ç±»å‹çš„æ•°ç»„</p><p>å› ä¸ºè¿™æ ·åšä¼š<strong>ç ´åç±»å‹å®‰å…¨</strong>ï¼Œå¯¼è‡´è¿è¡Œæ—¶çš„<code>ClassCastException</code>å¼‚å¸¸</p><p>åŸå› æ˜¯Javaçš„æ³›å‹æ˜¯åŸºäºç±»å‹æ“¦é™¤å®ç°çš„ï¼Œåœ¨<strong>è¿è¡Œæ—¶</strong>æ³›å‹ç±»å‹å‚æ•°çš„<strong>å…·ä½“ç±»å‹ä¿¡æ¯æ˜¯è¢«æ“¦é™¤</strong>çš„ï¼Œåªå‰©ä¸‹<code>Object</code>ç±»å‹</p><p>è€ŒJavaçš„æ•°ç»„æ˜¯<strong>åå˜</strong>çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å­ç±»æ•°ç»„å¯ä»¥<strong>å‘ä¸Šè½¬å‹</strong>ä¸ºçˆ¶ç±»æ•°ç»„ï¼Œä¾‹å¦‚<code>String[]</code>å¯ä»¥è½¬ä¸º<code>Object[]</code></p><p>å¦‚æœJavaå…è®¸åˆ›å»ºæ³›å‹æ•°ç»„ï¼Œé‚£ä¹ˆå°±å¯èƒ½å‡ºç°å¦‚ä¸‹æƒ…å†µï¼šï¼ˆNew Bingæä¾›ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt;[] strListArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;[<span class="hljs-number">10</span>]; <span class="hljs-comment">//å‡è®¾è¿™æ ·å¯ä»¥åˆ›å»ºæ³›å‹æ•°ç»„</span><br>Object[] objArray = strListArray; <span class="hljs-comment">//ç”±äºæ•°ç»„åå˜ï¼Œå¯ä»¥å‘ä¸Šè½¬å‹ä¸ºObject[]</span><br>objArray[<span class="hljs-number">0</span>] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;(); <span class="hljs-comment">//ç”±äºObject[]å¯ä»¥å­˜æ”¾ä»»ä½•å¯¹è±¡ï¼Œå¯ä»¥æ”¾å…¥ä¸€ä¸ªArrayList&lt;Integer&gt;</span><br><span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> strListArray[<span class="hljs-number">0</span>].get(<span class="hljs-number">0</span>); <span class="hljs-comment">//ç”±äºstrListArrayæ˜¯List&lt;String&gt;[]ç±»å‹ï¼Œå¯ä»¥å–å‡ºä¸€ä¸ªString</span><br><span class="hljs-comment">//ä½†å®é™…ä¸ŠstrListArray[0]å­˜æ”¾çš„æ˜¯ä¸€ä¸ªArrayList&lt;Integer&gt;ï¼Œæ‰€ä»¥ä¼šæŠ›å‡ºClassCastException</span><br></code></pre></td></tr></table></figure><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿï¼ŒJavaåœ¨ç¼–è¯‘æ—¶å°±<strong>ç¦æ­¢</strong>äº†åˆ›å»ºæ³›å‹æ•°ç»„</p><blockquote><p>æ‰€ä»¥å¹¶ä¸æ˜¯Javaå®ç°ä¸äº†ï¼Œè€Œæ˜¯å‡ºäºå®‰å…¨ç¦æ­¢</p></blockquote><h2 id="Whatï¼Ÿï¼Ÿ"><a href="#Whatï¼Ÿï¼Ÿ" class="headerlink" title="Whatï¼Ÿï¼Ÿ"></a>Whatï¼Ÿï¼Ÿ</h2><p>å¥½çš„ï¼Œæƒ³å¿…ä»¥ä¸Šçš„ä»£ç å¹¶æ²¡æœ‰è§¦åŠæ ¹æœ¬ï¼Œçœ‹äº†ä¸€è„¸æ‡µé€¼</p><p>æˆ‘ä»¬æ¥ä»”ç»†èŠèŠ</p><p>é¦–å…ˆçœ‹ç¬¬ä¸‰è¡Œï¼š<code>objArray[0] = new ArrayList&lt;Integer&gt;();</code> &#x2F;&#x2F;Object[]å¯ä»¥å­˜æ”¾ä»»ä½•å¯¹è±¡</p><blockquote><p>æ˜¯æ²¡é”™ï¼Œé…±ç´«ç¼–è¯‘å¯ä»¥è¿‡ï¼Œä½†æ˜¯è¿™å’Œæ³›ä¸æ³›å‹åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</p></blockquote><p>çœ‹ä»¥ä¸‹ä¸¤æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Integer[] arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>[<span class="hljs-number">10</span>];<br>arr[<span class="hljs-number">0</span>] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float</span>(<span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure><p>è¿™ä¸€æ®µï¼ŒæŠŠ<code>Float</code>èµ‹å€¼ç»™<code>Integer</code>æ•°ç»„<code>arr</code>ï¼Œç¼–è¯‘å™¨ç›´æ¥æŠ¥é”™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Object[] arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>[<span class="hljs-number">10</span>];<br>arr[<span class="hljs-number">0</span>] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float</span>(<span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure><p>è¿™ä¸€æ®µï¼ŒæŠŠ<code>Float</code>èµ‹å€¼ç»™<code>Object</code>æ•°ç»„<code>arr</code>ï¼Œç¼–è¯‘é€šè¿‡ï¼Œä½†æ˜¯è¿è¡ŒæŠ›å‡ºå¼‚å¸¸ï¼ˆç±»å‹ä¸åŒ¹é…ï¼‰</p><p>å¯æ˜¯å¯æ˜¯ï¼Œä½ æœ‰æƒ³è¿‡ä¸ºä»€ä¹ˆå—ï¼Œæˆ‘å‡­ä»€ä¹ˆçŸ¥é“ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶å‡ºä¸å‡ºé”™</p><h3 id="é™æ€ç±»å‹-amp-åŠ¨æ€ç±»å‹"><a href="#é™æ€ç±»å‹-amp-åŠ¨æ€ç±»å‹" class="headerlink" title="é™æ€ç±»å‹ &amp; åŠ¨æ€ç±»å‹"></a>é™æ€ç±»å‹ &amp; åŠ¨æ€ç±»å‹</h3><p>Javaåœ¨ç¼–è¯‘æ—¶åªæ£€æŸ¥é™æ€ç±»å‹ï¼ˆå˜é‡ç±»å‹[Left]ï¼‰ï¼Œè¿è¡Œæ—¶æ‰æ£€æŸ¥åŠ¨æ€ç±»å‹ï¼ˆçœŸå®ç±»å‹ aka å¼•ç”¨æŒ‡å‘çš„ç±»å‹[Right]ï¼‰</p><p>ä¾‹å¦‚ï¼š<code>Object[] arr = new Integer[10];</code>ä¸­ï¼Œ<code>arr</code>çš„é™æ€ç±»å‹æ˜¯<code>Object[]</code>ï¼Œè€ŒåŠ¨æ€ç±»å‹æ˜¯<code>Integer[]</code></p><p>é‚£ä¹ˆï¼Œæœ‰èªæ˜çš„å°å¯çˆ±è¦é—®äº†ï¼Œä¸ºä»€ä¹ˆä¸åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥åŠ¨æ€ç±»å‹</p><p>å¥½é—®é¢˜ï¼Œå› ä¸ºç¼–è¯‘æ—¶æ²¡æ³•çŸ¥é“åŠ¨æ€ç±»å‹ï¼Œçœ‹åˆ°<strong>åŠ¨æ€</strong>ä¿©å­—äº†å˜›ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç”¨æˆ·è¾“å…¥æ”¹å˜å¼•ç”¨çš„ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Animal</span> <span class="hljs-variable">animal</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">//å£°æ˜ä¸€ä¸ªAnimalç±»å‹çš„å˜é‡</span><br><span class="hljs-type">int</span> <span class="hljs-variable">choice</span> <span class="hljs-operator">=</span> Integer.parseInt(args[<span class="hljs-number">0</span>]); <span class="hljs-comment">//ä»å‘½ä»¤è¡Œå‚æ•°è·å–ä¸€ä¸ªæ•´æ•°</span><br><span class="hljs-keyword">if</span> (choice)<br>    animal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(); <span class="hljs-comment">//å¦‚æœè¾“å…¥ä¸º1ï¼Œåˆ›å»ºä¸€ä¸ªDogå¯¹è±¡å¹¶èµ‹å€¼ç»™animal</span><br><span class="hljs-keyword">else</span><br>    animal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(); <span class="hljs-comment">//å¦åˆ™ï¼Œåˆ›å»ºä¸€ä¸ªAnimalå¯¹è±¡å¹¶èµ‹å€¼ç»™animal</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ç¼–è¯‘å™¨ç›´æ¥æ”¾å¼ƒæ£€æŸ¥åŠ¨æ€ç±»å‹ï¼Œåªåˆ¤æ–­é™æ€ç±»å‹</p><h3 id="æ³›å‹æ•°ç»„"><a href="#æ³›å‹æ•°ç»„" class="headerlink" title="æ³›å‹æ•°ç»„"></a>æ³›å‹æ•°ç»„</h3><p>okayokayï¼Œç»§ç»­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt;[] strListArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;[<span class="hljs-number">10</span>];<br>Object[] objArray = strListArray;<br>objArray[<span class="hljs-number">0</span>] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;();<br></code></pre></td></tr></table></figure><p>ç”±äºç¼–è¯‘å™¨<strong>ç±»å‹æ“¦é™¤</strong>çš„å­˜åœ¨ï¼Œä¼šå˜æˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt;[] strListArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>[<span class="hljs-number">10</span>];<br>Object[] objArray = strListArray;<br>objArray[<span class="hljs-number">0</span>] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ï¼šè¯¶ï¼Œ<code>ArrayList</code>å¯ä»¥å­˜å…¥<code>Object[]</code>ï¼Œè¿‡ï¼</p><p>è™šæ‹Ÿæœºï¼šè¯¶ï¼Œç±»å‹æ“¦é™¤ï¼Œæ²¡ç±»å‹ï¼Œé‚£å°±æ˜¯<code>ArrayList</code>å­˜å…¥<code>ArrayList[]</code>ï¼Œè¿‡ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> strListArray[<span class="hljs-number">0</span>].get(<span class="hljs-number">0</span>); <br></code></pre></td></tr></table></figure><p>ç”±äº<code>strListArray</code>æ˜¯<code>List&lt;String&gt;[]</code>ç±»å‹ï¼Œå¯ä»¥å–å‡ºä¸€ä¸ª<code>String</code></p><p>ä½†å®é™…ä¸Š<code>strListArray[0]</code>å­˜æ”¾çš„æ˜¯ä¸€ä¸ª<code>ArrayList&lt;Integer&gt;</code>ï¼Œæ‰€ä»¥ä¼šæŠ›å‡º<code>ClassCastException</code></p><p>ä½†æ˜¯åˆæœ‰å°å¯çˆ±ä¼šè¯´äº†ï¼š<strong>ä¸æ˜¯ç±»å‹æ“¦é™¤äº†å˜›ï¼Œæ€ä¹ˆè¿˜çŸ¥é“è‡ªå·±æ˜¯<code>ArrayList&lt;Integer&gt;</code></strong></p><p>è¿™æ˜¯å› ä¸ºå½“æˆ‘ä»¬ä»<code>strListArray</code>ä¸­å–å‡ºä¸€ä¸ªå…ƒç´ æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ’å…¥ä¸€ä¸ª<strong>å¼ºåˆ¶è½¬æ¢</strong>ï¼Œå°†å…¶è½¬æ¢ä¸º<code>List&lt;String&gt;</code>ç±»å‹ã€‚</p><p><strong>ç»“è®º</strong>ï¼šç”±äº<strong>ç±»å‹æ“¦é™¤</strong>çš„å­˜åœ¨ï¼Œç¼–è¯‘å™¨å’Œè™šæ‹Ÿæœºéƒ½æ²¡åŠæ³•åŒºåˆ†å †ä¸­çš„<strong>æ³›å‹æ•°ç»„</strong>åˆ°åº•å­˜çš„æ˜¯ä»€ä¹ˆ<strong>å…·ä½“ç±»å‹</strong>ï¼Œè€Œè¿™å¯¹å¼ºç±»å‹è¯­è¨€Javaæ¥è¯´æ˜¯<strong>ä¸å¯æ¥å—</strong>çš„ï¼Œä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œ<code>Java</code>ç›´æ¥ä¸æ”¯æŒæ³›å‹æ•°ç»„äº†</p><p><em>ä»¥ä¸Šå†…å®¹å‚è€ƒï¼šjavaä¸ºä»€ä¹ˆä¸æ”¯æŒæ³›å‹æ•°ç»„ï¼Ÿ - çº¢æ¾çš„å›ç­” - çŸ¥ä¹ <a href="https://www.zhihu.com/question/20928981/answer/2993376953">https://www.zhihu.com/question/20928981/answer/2993376953</a></em></p><h2 id="å’‹åŠ"><a href="#å’‹åŠ" class="headerlink" title="å’‹åŠ"></a>å’‹åŠ</h2><p>é‚£æ³›å‹æ•°ç»„ä¸èƒ½ç”¨å’‹åŠï¼Ÿ</p><p>å¯ä»¥ä½¿ç”¨<code>ArrayList</code>åŠ¨æ€æ•°ç»„ä»£æ›¿åŸç”Ÿæ•°ç»„</p><p>å› ä¸º<code>ArrayList</code>ä¸æ”¯æŒåå˜ï¼Œæ‰€ä»¥ä¹Ÿå°±å®‰å…¨å¾—å¤šï¼ˆã‹ã‚‚ï¼‰</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>æ€»è€Œè¨€ä¹‹ï¼Œè¨€è€Œæ€»ä¹‹</p><p>Javaçš„ç±»å‹æ“¦é™¤å®ç°æœºåˆ¶å¯¼è‡´è¿è¡Œæ—¶å¤±å»äº†æ³›å‹ä¿¡æ¯ï¼Œå¯¼è‡´äº†å¾ˆå¤šé™åˆ¶</p><p>æ·±ç©¶èµ·æ¥å°±é˜¿å·´é˜¿å·´äº†ï¼Œåæ­£å¤§æ¦‚å°±è¿™ä¸ªäºšå­ï¼Œaaaaaaaï¼Œå¯„äº†å†è¯´</p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://www.zhihu.com/question/20928981">javaä¸ºä»€ä¹ˆä¸æ”¯æŒæ³›å‹æ•°ç»„ï¼Ÿ - çŸ¥ä¹</a></p><p><a href="https://www.zhihu.com/question/28665443"> Java ä¸èƒ½å®ç°çœŸæ­£æ³›å‹çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://www.cnblogs.com/zawier/p/8505098.html">Java ä¸­ä¸ºä»€ä¹ˆä¸èƒ½åˆ›å»ºæ³›å‹æ•°ç»„ï¼Ÿ - _è·¯ä¸Š - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://blog.csdn.net/anlian523/article/details/100643209">Java æ³›å‹çš„æœ¬è´¨â€”â€”ç±»å‹æ“¦é™¤_anlian523çš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://www.cnblogs.com/minghaiJ/p/11259318.html">Javaä¸­åˆ›å»ºæ³›å‹æ•°ç»„ - minghai - åšå®¢å›­ (cnblogs.com)</a></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>æ³›å‹ï¼Œæ³›å‹æ•°ç»„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>C++ç»§æ‰¿ä½“ç³»ä¸‹å‡½æ•°è°ƒç”¨è¾¨æ</title>
    <link href="/2023/06/12/C-%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB%E4%B8%8B%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BE%A8%E6%9E%90/"/>
    <url>/2023/06/12/C-%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB%E4%B8%8B%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BE%A8%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><blockquote><p>Darliï¼šå¦‚æœæˆ‘æƒ³ç”¨å­ç±»çš„å®ä¾‹è°ƒç”¨çˆ¶ç±»çš„åŒåå‡½æ•°åº”è¯¥æ€ä¹ˆå†™ï¼Ÿ</p></blockquote><p>æµ‹è¯•Codeå¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br><span class="hljs-keyword">public</span>:<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">m</span><span class="hljs-params">()</span></span>&#123;<br>cout &lt;&lt;<span class="hljs-string">&quot; this is A(m)&quot;</span> &lt;&lt; endl;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">()</span></span>&#123;<br>cout &lt;&lt;<span class="hljs-string">&quot; this is A&quot;</span> &lt;&lt; endl;<br>&#125;<br>&#125;;<br> <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>: <span class="hljs-keyword">public</span> A &#123;<br><span class="hljs-keyword">public</span>:<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">m</span><span class="hljs-params">()</span></span>&#123;<br>cout &lt;&lt;<span class="hljs-string">&quot; this is B(m)&quot;</span> &lt;&lt; endl;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">()</span></span>&#123;<br>cout &lt;&lt;<span class="hljs-string">&quot; this is B&quot;</span> &lt;&lt; endl;<br>&#125;<br>&#125;;<br> <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>A a;<br>B b;<br>A* c = <span class="hljs-keyword">new</span> <span class="hljs-built_in">B</span>(); <br>a.<span class="hljs-built_in">func</span>();    <span class="hljs-comment">//this is A</span><br>b.<span class="hljs-built_in">func</span>();    <span class="hljs-comment">//this is B</span><br>b.A::<span class="hljs-built_in">func</span>();  <span class="hljs-comment">//this is A</span><br>c-&gt;<span class="hljs-built_in">func</span>();    <span class="hljs-comment">//this is B</span><br>c-&gt;A::<span class="hljs-built_in">func</span>(); <span class="hljs-comment">//this is A</span><br>((A)(*c)).<span class="hljs-built_in">func</span>();<span class="hljs-comment">//this is A ç”ŸæˆAä¸´æ—¶å¯¹è±¡å®ä¾‹</span><br>c-&gt;<span class="hljs-built_in">m</span>();<span class="hljs-comment">// this is A(m)</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Maybeï¼š<code>C++</code>ç»§æ‰¿çš„åŒåå‡½æ•°å¯ä»¥åˆ†ä¸ºè™šå‡½æ•°é‡å†™å’Œæ™®é€šåŒåå‡½æ•°ï¼Œè€Œ<code>Java</code>å°±é»˜è®¤é‡å†™äº†</p><p>åœ¨<code>C++</code>ä½“ç³»ä¸­ï¼Œæœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥å®ç°é€šè¿‡å­ç±»å®ä¾‹è°ƒç”¨çˆ¶ç±»åŒåå‡½æ•°ï¼š</p><ul><li>åŸŸæ“ä½œç¬¦(::) <code>b.A::func(); c-&gt;A::func();</code></li><li>å°†æŒ‡é’ˆè§£å¼•ç”¨å¹¶å¼ºè½¬ä¸ºçˆ¶ç±»ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªä¸´æ—¶çˆ¶ç±»å¯¹è±¡å®ä¾‹ï¼Œ<code>((A)(*c)).func();</code></li><li>çˆ¶ç±»å’Œå­ç±»ä¸­çš„æ™®é€šåŒåå‡½æ•°ï¼ˆévirtualï¼‰ï¼Œé…±ç´«çš„è¯ å°±å¤±å»äº†å¤šæ€æ€§ ä¹Ÿå°±æ˜¯ä¸çœ‹å®é™…ç±»å‹ åªçœ‹æ¥æ”¶çš„ç±»å‹ï¼Œæ¯”å¦‚<code>A* c = new B(); c-&gt;m();</code>è°ƒç”¨çš„å°±æ˜¯Açš„m()</li></ul><blockquote><p>æ•™å­¦ç›¸é•¿ä¹Ÿ C++é«˜æ·±ä¹Ÿ</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>ç»§æ‰¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Qt-OpenGL VAO, VBO, IBOç®€æ</title>
    <link href="/2023/03/06/Qt-OpenGL-VAO%E4%B8%8EIBO%E7%AE%80%E6%9E%90/"/>
    <url>/2023/03/06/Qt-OpenGL-VAO%E4%B8%8EIBO%E7%AE%80%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåˆå…¥<code>OpenGL</code>ç‚¼ç‹±ï¼Œä¾¿æ˜¯ä¸€å¨è®©äººä¸æ˜æ‰€ä»¥ã€ä¸€è„¸æ‡µé€¼çš„åè¯</p><p>æ¯”å¦‚ä»€ä¹ˆï¼š<code>VAO</code>ã€<code>VBO</code>ã€<code>IBO</code></p><blockquote><p>å•Šï¼Œå¯¹ï¼Œå°±ä½ ä»¬ä»¨ï¼Œæªæ‰“å‡ºå¤´é¸Ÿå•Šï¼Œå°±ä½ ä»¬ä»¨æ‰“å¤´é˜µå•Šï¼Œè¿˜éƒ½ä»¥Oç»“å°¾å•Š</p><p>é‚£å°±å¹²ä½ ä»¬äº†</p></blockquote><h2 id="VBOï¼ˆVertex-Buffer-Object-ï¼šé¡¶ç‚¹ç¼“å†²å¯¹è±¡ï¼‰"><a href="#VBOï¼ˆVertex-Buffer-Object-ï¼šé¡¶ç‚¹ç¼“å†²å¯¹è±¡ï¼‰" class="headerlink" title="VBOï¼ˆVertex Buffer Object ï¼šé¡¶ç‚¹ç¼“å†²å¯¹è±¡ï¼‰"></a>VBOï¼ˆVertex Buffer Object ï¼šé¡¶ç‚¹ç¼“å†²å¯¹è±¡ï¼‰</h2><p>è¿™ä¸€å¬å°±å’Œ<strong>é¡¶ç‚¹</strong>æœ‰å…³ï¼Œå®é™…ä¸Šå°±æ˜¯ç”¨æ¥å­˜å‚¨é¡¶ç‚¹ç›¸å…³ä¿¡æ¯çš„ï¼ˆåæ ‡ã€é¢œè‰²ã€è´´å›¾åæ ‡ã€æ³•å‘é‡ç­‰ï¼‰</p><p>è¿™ä¸ªå¯¹è±¡å¯ä»¥æŠŠé¡¶ç‚¹ç›¸å…³æ•°æ®ä¸€æ¬¡æ€§å‘é€åˆ°<code>GPU</code>ï¼Œå‡å°‘ä¸<code>CPU</code>é€šä¿¡å¼€é”€</p><blockquote><p>æ¯•ç«Ÿä¸‰ç»´ä¸–ç•Œä¹Ÿéœ€è¦äºŒç»´çš„çº¿å’Œä¸€ç»´çš„ç‚¹è¿›è¡Œæ„å»ºå˜›</p><p>æ‰€ä»¥é¡¶ç‚¹ä¿¡æ¯æ˜¯æœ€åŸºæœ¬çš„</p></blockquote><p>æ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">float</span> pos[] = &#123;<br>    <span class="hljs-number">-150</span>, <span class="hljs-number">-150</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<br>    <span class="hljs-number">150</span>, <span class="hljs-number">-150</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>,<br>    <span class="hljs-number">150</span>, <span class="hljs-number">150</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>,<br>    <span class="hljs-number">-150</span>, <span class="hljs-number">150</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªé¡¶ç‚¹çš„ä¿¡æ¯ï¼Œå‰ä¸¤ä¸ªæ•°ä»£è¡¨äºŒç»´åæ ‡ï¼Œåä¸¤ä¸ªæ•°ä»£è¡¨è´´å›¾åæ ‡ï¼ˆè´´å›¾ä¸é¡¶ç‚¹çš„å¯¹åº”å…³ç³»ï¼‰</p><p>ä½†æ˜¯ä½ ä¼šå‘ç°ä¸€ä¸ªå¥‡æ€ªçš„ç‚¹ï¼Œä¸ºä»€ä¹ˆæˆ‘è¦ç”¨ä¸€ç»´æ•°ç»„å‘¢ï¼Œé…±ç´«ä¸æ˜¯æ²¡æœ‰ä»»ä½•ç»“æ„ï¼ˆstruct or classï¼‰å—ï¼Ÿ</p><p>ä¸€ç‚¹ä¹Ÿä¸é¢å‘å¯¹è±¡å•Šï¼Œè¿™æ˜¯å› ä¸º<code>OpenGL</code>æä¾›çš„<code>API</code>å°±åªæ”¯æŒä¸€ç»´æ•°ç»„ï¼Œå¹¶ä¸”éœ€è¦æ‰‹åŠ¨è§£é‡Šå…¶ä¸­çš„æ•°æ®ï¼ˆåŒºåˆ†å“ªäº›æ˜¯åæ ‡ã€å“ªäº›æ˜¯é¢œè‰²ã€è´´å›¾ä¹‹ç±»çš„ï¼‰</p><p>ç±»ä¼¼äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp">GLuint buffer;<br><span class="hljs-built_in">glGenBuffers</span>(<span class="hljs-number">1</span>, &amp;buffer);<br><span class="hljs-built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, buffer);<br><span class="hljs-built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>)*<span class="hljs-number">8</span>, pos, GL_STATIC_DRAW);<br><span class="hljs-comment">//â†‘ç»‘å®šæ•°æ®ï¼ˆä¸Šä¼ åˆ°GPUï¼‰</span><br><br><span class="hljs-comment">//â†“è§£é‡Šæ•°æ®</span><br><span class="hljs-built_in">glEnableVertexAttribArray</span>(<span class="hljs-number">0</span>);<br><span class="hljs-built_in">glVertexAttribPointer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, GL_FLOAT, GL_FALSE, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>)*<span class="hljs-number">4</span>, <span class="hljs-number">0</span>);<br><br><span class="hljs-built_in">glEnableVertexAttribArray</span>(<span class="hljs-number">1</span>);<br><span class="hljs-built_in">glVertexAttribPointer</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, GL_FLOAT, GL_FALSE, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>)*<span class="hljs-number">4</span>, (<span class="hljs-type">void</span>*)(<span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>) * <span class="hljs-number">2</span>));<br></code></pre></td></tr></table></figure><p>é¡¶ç‚¹æ•°æ®æ˜¯æ€ä¹ˆè§£é‡Šçš„å‘¢ï¼Œå°±æ˜¯é€šè¿‡<code>glEnableVertexAttribArray</code>è¿™ä¸ªå‡½æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glVertexAttribPointer</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    GLuint index,</span></span><br><span class="hljs-params"><span class="hljs-function">    GLint size,</span></span><br><span class="hljs-params"><span class="hljs-function">    GLenum type,</span></span><br><span class="hljs-params"><span class="hljs-function">    GLboolean normalized,</span></span><br><span class="hljs-params"><span class="hljs-function">    GLsizei stride,</span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-type">const</span> GLvoid* pointer</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚è¿™ä¸€å¥ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glVertexAttribPointer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, GL_FLOAT, GL_FALSE, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>)*<span class="hljs-number">4</span>, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>taçš„æ„æ€å°±æ˜¯ï¼š</p><p><strong>å¯¹äº0å·å±æ€§ï¼ˆä¹Ÿå°±æ˜¯åæ ‡ï¼Œæ•°å­—ä¸é‡è¦ ä¸é‡å¤å°±è¡Œï¼‰ï¼Œç”±ç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ ç»„æˆï¼ˆäºŒç»´åæ ‡ï¼‰ï¼Œç±»å‹æ˜¯<code>GL_FLOAT</code>ï¼ˆæµ®ç‚¹å‹ï¼‰ï¼Œä¸å¼€å¯å½’ä¸€åŒ–ï¼ˆGL_FALSEï¼‰ï¼Œä¸¤ä¸ªæ•°æ®ï¼ˆåæ ‡ï¼‰ä¹‹é—´çš„æ­¥é•¿æ˜¯4ä¸ª<code>float</code>å­—èŠ‚çš„é•¿åº¦ï¼Œå¹¶ä¸”è·ç¦»æ•°ç»„èµ·ç‚¹çš„åç§»é‡æ˜¯0</strong></p><p>å¯¹äºè´´å›¾åæ ‡ï¼Œä¹Ÿå¯ä»¥é…±ç´«è§£é‡Šï¼ˆå‘½åä¸º1å·å±æ€§ï¼‰ï¼Œè¿™é‡Œå±æ€§çš„é¡ºåºå•¥çš„éƒ½ä¸é‡è¦ï¼Œåªè¦åœ¨<code>shader</code>ï¼ˆç€è‰²å™¨ï¼‰ä¸­èƒ½è‡ªå·±å¯¹åº”ä¸Šå°±å¯ä»¥</p><h3 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h3><p>ä¸ºä»€ä¹ˆè¦å¦‚æ­¤éº»çƒ¦å‘¢ï¼Œä¸ºä»€ä¹ˆä¸ç»™ä¸€äº›ç±»å’Œç»“æ„ï¼Œè€Œæ˜¯ä»ä¸€ç»´æ•°ç»„ï¼ŒåŸå§‹æ•°æ®å¼€å§‹è§£é‡Šå‘¢</p><p>æ¨æµ‹ï¼š<code>OpenGL</code>æ˜¯åº•å±‚å›¾å½¢åº“ï¼Œé…±ç´«å¯ä»¥æä¾›æœ€é«˜çš„æ€§èƒ½ä»¥åŠè‡ªç”±åº¦ï¼Œä¾›ç¨‹åºå‘˜è‡ªç”±å°è£…ï¼›åŒæ—¶ä¹Ÿå¯¹<code>GPU</code>æ¥è®²æ›´å¥½è¯»å–</p><h2 id="IBO-ï¼ˆIndex-Buffer-Objectï¼šç´¢å¼•æ•°ç»„å¯¹è±¡ï¼‰-or-EBOï¼ˆElement-Buffer-Objectï¼‰"><a href="#IBO-ï¼ˆIndex-Buffer-Objectï¼šç´¢å¼•æ•°ç»„å¯¹è±¡ï¼‰-or-EBOï¼ˆElement-Buffer-Objectï¼‰" class="headerlink" title="IBO ï¼ˆIndex Buffer Objectï¼šç´¢å¼•æ•°ç»„å¯¹è±¡ï¼‰ or EBOï¼ˆElement Buffer Objectï¼‰"></a>IBO ï¼ˆIndex Buffer Objectï¼šç´¢å¼•æ•°ç»„å¯¹è±¡ï¼‰ or EBOï¼ˆElement Buffer Objectï¼‰</h2><p>å…¶å®æœ‰äº†<code>VBO</code>å°±å¯ä»¥å¼€å§‹ç»˜åˆ¶å›¾å½¢äº†ï¼Œä¸ºå•¥è¿˜è¦<code>IBO</code>å‘¢</p><p><code>IBO</code>ä¹Ÿå«<code>EBO</code>ï¼Œä¸¤ç§å«æ³•ï¼Œä½†æ˜¯ç¬¬ä¸€ç§æ›´è§åçŸ¥æ„ï¼Œä¸€çœ‹å°±çŸ¥é“æ˜¯ä¿å­˜ç´¢å¼•çš„</p><p><code>IBO</code>çš„å­˜åœ¨æ˜¯ä¸ºäº†ä¼˜åŒ–å†…å­˜</p><p>æ¯”å¦‚ï¼šæˆ‘ä»¬è¦ç”»ä¸€ä¸ªæ­£æ–¹å½¢ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œä¸€ä¸ªæ­£æ–¹å½¢å¯ä»¥ç”±ä¸¤ä¸ªä¸‰è§’å½¢æ„æˆï¼ˆå¯¹è§’åˆ†ï¼‰</p><p>ä¸¤ä¸ªä¸‰è§’å½¢æœ‰6ä¸ªé¡¶ç‚¹ï¼Œä½†æ˜¯æ­£æ–¹å½¢åªéœ€è¦4ä¸ªé¡¶ç‚¹</p><p><img src="/img/image-20230306204158147.png" alt="æ­£æ–¹å½¢"></p><p>å¦‚æ­¤ä¸€æ¥ï¼Œæœ‰ä¸¤ä¸ªé¡¶ç‚¹çš„æ•°æ®å°±æ˜¯é‡å¤çš„ï¼Œåœ¨<code>VBO</code>é‡ŒåŒ…å«6ä¸ªé¡¶ç‚¹çš„ä¿¡æ¯æ˜¾ç„¶æ˜¯ååˆ†æ»´<strong>stupid</strong></p><p>é‚£ä¸ºä½•ä¸ç›´æ¥ç”¨ç´¢å¼•æ¥ä»£è¡¨é¡¶ç‚¹å‘¢ï¼Œæ¯”å¦‚ç»™å››ä¸ªé¡¶ç‚¹ç¼–å·ï¼ˆ1,2,3,4ï¼‰</p><p>ç„¶åå‘Šè¯‰<code>OpenGL</code>ï¼Œæˆ‘è¦ç»˜åˆ¶ä¸¤ä¸ªä¸‰è§’å½¢ï¼Œä¸€ä¸ªæ˜¯ï¼ˆ1,2,4ï¼‰ï¼Œä¸€ä¸ªæ˜¯ï¼ˆ2,3,4ï¼‰</p><p>é…±ç´«å¯ä¸æ–¹ä¾¿å¤šäº†</p><p>ä¿å­˜ç´¢å¼•çš„å¯¹è±¡å°±å«<code>IBO</code>ï¼Œç´¢å¼•ç¼“å†²å¯¹è±¡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp">GLuint indices[] = &#123;<br>    <span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>, <span class="hljs-comment">//ä¸‰è§’å½¢1</span><br>    <span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>  <span class="hljs-comment">//ä¸‰è§’å½¢2</span><br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="VAOï¼ˆVertex-Array-Objectï¼šé¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼‰"><a href="#VAOï¼ˆVertex-Array-Objectï¼šé¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼‰" class="headerlink" title="VAOï¼ˆVertex Array Objectï¼šé¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼‰"></a>VAOï¼ˆVertex Array Objectï¼šé¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼‰</h2><p>è¯¶è¯¶ï¼Œæœ‰æ•°æ®æœ‰ç´¢å¼•äº†ï¼Œè¿˜ä¼˜åŒ–å†…å­˜äº†ï¼Œä½ è¿˜æƒ³å’‹æ ·aï¼Œaaaaaa</p><p>æ˜¯é…±ç´«ï¼Œå…„å¼Ÿï¼Œæˆ‘çŸ¥é“ä½ å¾ˆæ€¥ï¼Œä½†æ˜¯ä½ å…ˆåˆ«æ€¥</p><p>ä½ çœ‹aï¼Œä¸€ç»„æ•°æ®å’Œä¸€ç»„ç´¢å¼•å¯ä»¥ç»˜åˆ¶ä¸€ä¸ªå›¾å½¢ï¼Œä½†æ˜¯å‡å¦‚æœ‰å¾ˆå¤šå›¾å½¢ï¼Œæ¯æ¬¡åˆ‡æ¢ç€ç»˜åˆ¶ï¼Œç»˜åˆ¶å‰éƒ½è¦ç»‘å®šè¿™ç»‘å®šé‚£çš„æœ‰ç‚¹éº»çƒ¦</p><p>ä¸å¦‚æ¥ä¸€ä¸ªä¸œä¸œæ¥è®°å½•ä¸€ä¸‹æˆ‘ä»¬çš„æ“ä½œï¼ˆæ¯”å¦‚å¯¹é¡¶ç‚¹ä¿¡æ¯çš„è§£é‡Šï¼Œæ¯”å¦‚é¡¶ç‚¹æ•°æ®ï¼‰</p><p>è¿™ä¸ªä¸œä¸œå°±æ˜¯<code>VAO</code>ï¼Œå¯ä»¥ä¿å­˜æˆ‘ä»¬çš„æ“ä½œï¼Œé…±ç´«å°±å¯ä»¥åªç»‘å®š<code>VAO</code>å®ç°ç»˜åˆ¶ï¼ˆé€šè¿‡<code>VAO</code>è®¿é—®å„ç§æ•°æ®ï¼‰</p><p>å…·ä½“ä¿å­˜äº†å•¥å‘¢ï¼Ÿ</p><ul><li><p>vertex attribute å¯¹åº”çš„ VBO çš„idï¼Œ<strong>glBindBuffer</strong> è®¾ç½®ã€‚</p></li><li><p>vertex attribute çš„æ ¼å¼ï¼Œç”± <strong>glVertexAttribPointer</strong> è®¾ç½®</p></li><li><p>vertex attribute çš„å¼€å¯æˆ–å…³é—­ï¼Œ<strong>glEnableVertexAttribArray</strong>å’Œ<strong>glDisableVertexAttribArray</strong></p></li><li><p>**#å½“å‰#**ç»‘å®šçš„ GL_ELEMENT_ARRAY_BUFFERï¼ˆç´¢å¼•ç¼“å†²æ•°ç»„ï¼ŒIBOï¼‰ çš„åå­—ï¼Œç”± glBindBuffer è®¾ç½®</p></li></ul><p>ä¹Ÿå°±æ˜¯ä¿å­˜äº†<code>VBO</code>å’Œ<code>IBO</code>ï¼Œä½†æ˜¯ä»–ä»¬ä¹‹é—´æœ‰ä¸€ä¸ªå¾ˆå¤§çš„åŒºåˆ«</p><ul><li>VBOæ˜¯é€šè¿‡<code>glVertexAttribPointer</code>è¿™ä¸ªå‡½æ•°è¿›è¡Œç»‘å®šçš„</li><li>è€ŒIBOæ˜¯é€šè¿‡<code>glBindBuffer</code>å‡½æ•°è¿›è¡Œç»‘å®šçš„</li></ul><p>è¿™æ˜¯å› ä¸ºä¸€ä¸ª<code>VAO</code>å¯ä»¥ç»‘å®šå¤šä¸ª<code>VBO</code>ï¼ˆå¯ä»¥ç”¨ä¸åŒVBOä¿å­˜ä¸åŒæ•°æ®ï¼ˆåæ ‡ã€é¢œè‰²å¯ä»¥åˆ†å¼€ï¼‰ï¼‰</p><p>ä½†æ˜¯åªèƒ½ç»‘å®šä¸€ä¸ª<code>IBO</code>ï¼ˆç´¢å¼•ï¼‰</p><p><em>&#x2F;&#x2F; ç»‘å®š0å·ç¼“å†²åŒºå°±æ˜¯è§£ç»‘ï¼šVBO: glBindBuffer(GL_ARRAY_BUFFER, 0) or IBO: glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, 0)</em></p><p>æ‰€ä»¥VBOçš„è§£ç»‘å¹¶ä¸ä¼šå½±å“VAOå¯¹å…¶æ•°æ®çš„è®¿é—®ï¼ˆå·²ç»é€šè¿‡<code>glVertexAttribPointer</code>ä¿å­˜äº†æŒ‡é’ˆï¼‰ï¼Œè€ŒIBOçš„è§£ç»‘å°±ä¼šå¯¼è‡´VAOæ— æ³•è®¿é—®ç´¢å¼•ï¼ˆå˜æˆ0å·IBOäº†ï¼‰</p><h3 id="æ·±å…¥VAO"><a href="#æ·±å…¥VAO" class="headerlink" title="æ·±å…¥VAO"></a>æ·±å…¥VAO</h3><p>å®é™…ä¸Šï¼Œåœ¨ç°ä»£<code>OpenGL</code>ä¸­ï¼Œåœ¨<code>VAO</code>å‡ºç°åï¼ˆv3.0ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨VAOæ‰èƒ½ç»˜åˆ¶</p><p>å¦‚æœä½ ä¸æ˜¾ç¤ºåœ°å®šä¹‰ä¸€ä¸ª<code>VAO</code>ï¼Œé‚£ä¹ˆé»˜è®¤ï¼ˆå…¼å®¹æ¨¡å¼ï¼‰ä¼šæä¾›çš„ä¸€ä¸ªé»˜è®¤<code>VAO</code>ä»¥ä¾›ç»‘å®šï¼›&#x2F;&#x2F;æ ¸å¿ƒæ¨¡å¼ä¸æä¾›</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°è¿™ä¹ˆæƒ³ï¼š</p><p><code>OpenGL</code>çš„<code>draw</code>ç»˜åˆ¶å‡½æ•°å°±æ˜¯ä»å½“å‰çš„VAOä¸­è¯»å–VBOå’ŒIBOä¿¡æ¯ï¼Œå¹¶è¿›è¡Œç»˜åˆ¶çš„</p><p><strong>é‚£ä¹ˆï¼Œåªè¦åœ¨ç»˜åˆ¶å‰ï¼ŒVAOä¸­ç»‘å®šäº†IBOï¼Œå°±å¯ä»¥æ­£å¸¸è¿è¡Œ</strong></p><p><strong>è€Œåœ¨å®šä¹‰IBOæ—¶ï¼Œå¹¶ä¸éœ€è¦ç»‘å®šVAO</strong></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é…±ç´«ï¼š</p><p>åˆå§‹åŒ–éƒ¨åˆ†ï¼š<em>ä¼ªä»£ç </em></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp">VAO.<span class="hljs-built_in">bind</span>();<br>VBO.<span class="hljs-built_in">bind</span>();<br>VBO.<span class="hljs-built_in">setData</span>();<br><span class="hljs-comment">//è§£é‡ŠVBOæ•°æ®</span><br>VBO.<span class="hljs-built_in">unbind</span>();<br>VAO.<span class="hljs-built_in">unbind</span>();<br><br>IBO.<span class="hljs-built_in">bind</span>();<br>IBO.<span class="hljs-built_in">setData</span>();<br>IBO.<span class="hljs-built_in">unbind</span>();<br></code></pre></td></tr></table></figure><p>ç»˜åˆ¶éƒ¨åˆ†ï¼š<em>ä¼ªä»£ç </em></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp">VAO.<span class="hljs-built_in">bind</span>();<br>IBO.<span class="hljs-built_in">bind</span>(); <span class="hljs-comment">//ç»˜åˆ¶å‰å†ç»‘å®šåˆ°VAO</span><br><span class="hljs-comment">//draw()ç»˜åˆ¶</span><br>IBO.<span class="hljs-built_in">unbind</span>();<br><br>IBO2.<span class="hljs-built_in">bind</span>(); <span class="hljs-comment">//åˆ‡æ¢IBO</span><br><span class="hljs-comment">//draw()ç»˜åˆ¶</span><br>IBO2.<span class="hljs-built_in">unbind</span>();<br></code></pre></td></tr></table></figure><p>å“¦å¯¹ï¼Œè¿˜æƒ³èµ·ä¸ªé—®é¢˜ï¼Œä¸ºå•¥<code>VAO</code>è¿™åå«©å¥‡æ€ªå•Šï¼Œé¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼Ÿ</p><p>å…¶å®æ˜¯é…±ç´«ï¼Œæˆ‘ä»¬å¯ä»¥å§taçœ‹æˆä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ç»„é¡¶ç‚¹æ•°æ®ï¼Œé€šè¿‡<code>glVertexAttribPointer</code>è®¾ç½®</p><p>æ¯”å¦‚<code>VAO[0]</code>æ˜¯åæ ‡ï¼Œ<code>VAO[1]</code>æ˜¯é¢œè‰²ï¼Œ<code>VAO[2]</code>æ˜¯æ³•å‘é‡é…±ç´«ï¼ˆå½“ç„¶é€šè¿‡[]è®¿é—®æ˜¯ä¸ºäº†å¥½ç†è§£ï¼‰</p><h3 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h3><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://blog.csdn.net/Mhypnos/article/details/123516615">OpenGLç†è§£VBOï¼ŒIBOï¼ŒVAO_vboå’Œibo_Mhypnosçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/sixdaycoder/article/details/78951764">[Modern OpenGL]è°ˆè°ˆVAOã€VBOã€IBO_SixDayCoderçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://www.zhihu.com/question/39082624">VAOå’ŒEBOè§£ç»‘å®šçš„å‘ï¼Ÿ - çŸ¥ä¹</a></p><p><a href="https://blog.csdn.net/xiji333/article/details/114934590">OpenGL VAO VBO EBO(IBO)çš„ç»‘å®šã€è§£ç»‘é—®é¢˜_è§£ç»‘vbo,veo_csu_xijiçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://zhuanlan.zhihu.com/p/392128223">Openglçš„VAOä¸ªäººç†è§£ - çŸ¥ä¹</a></p><p><strong>ç‰¹åˆ«é¸£è°¢</strong>ï¼š<code>New Bing</code> &amp; <code>ChatGPT</code></p>]]></content>
    
    
    <categories>
      
      <category>OpenGL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>OpenGL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Qt-é¼ æ ‡é•¿æŒ‰å¼å¼¹å‡ºèœå•çš„ä¸€ç§å®ç°æ–¹æ¡ˆ</title>
    <link href="/2022/10/26/Qt-%E9%BC%A0%E6%A0%87%E9%95%BF%E6%8C%89%E5%BC%8F%E5%BC%B9%E5%87%BA%E8%8F%9C%E5%8D%95%E7%9A%84%E4%B8%80%E7%A7%8D%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88/"/>
    <url>/2022/10/26/Qt-%E9%BC%A0%E6%A0%87%E9%95%BF%E6%8C%89%E5%BC%8F%E5%BC%B9%E5%87%BA%E8%8F%9C%E5%8D%95%E7%9A%84%E4%B8%80%E7%A7%8D%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>èœå•ï¼Œæ‰€ä¸ºä½•ç‰©ï¼Ÿ</p><p>é¤é¦†é‡Œèœå“çš„ç§ç±»è¡¨å˜›</p><p>æ ¸ç† å¤ªæ²³é‡Œäº†</p><p>ä»Šå¤©çš„blogå°±å†™åˆ°è¿™é‡Œï¼Œå¼€é¥­äº†</p><p>end</p><p>åœ¨è½¯ä»¶ä¸­ï¼Œåœ¨å¤§ä¼—å°è±¡é‡Œï¼Œèœå•åº”è¯¥æ˜¯å³é”®å•å‡»åå¼¹å‡ºæ¥çš„é‚£ç©æ„å„¿ï¼š</p><p><img src="/img/image-20221026191207095.png" alt="Menu"></p><p>æ¨ªå¹³ç«–ç›´ï¼Œæ­»æ¿è€Œä¸å¯Œæœ‰ç”ŸåŠ›</p><p>ä½†æ˜¯èœå•é¡¹å³ä¾§çš„å°ç®­å¤´é¢„ç¤ºç€ è¯¥é¡¹ä¹Ÿæ˜¯ä¸ªèœå•ï¼Œå¯ä»¥å¼€å¯äºŒçº§èœå•</p><p>åŒç†å¯ä»¥å¼€å¯å¤šçº§èœå•ï¼Œaka çº§è”èœå•</p><p><img src="/img/image-20221026191539227.png" alt="çº§è”èœå•"></p><p><code>Qt</code>ä¸­ï¼Œè¿™ç©æ„å„¿å«åš<code>QMenu</code></p><p><code>QMenu</code>ä¸­å¯ä»¥æ”¾å…¥è‹¥å¹²ä¸ªèœå•é¡¹ï¼š</p><ul><li>å¯ä»¥æ˜¯QAction</li><li>ä¹Ÿå¯ä»¥æ˜¯QMenuï¼Œæ„æˆçº§è”æ ‘çŠ¶ç»“æ„</li></ul><p>å¤ªå¥½äº†ï¼Œ<code>Qt</code>æä¾›äº†<code>QMenu</code>ï¼Œå¤ªå¥½ç”¨äº†ï¼Œç®€ç›´æ˜¯æ•‘è‹¦æ•‘éš¾æ´»è©è¨</p><p>blogåˆ°è¿™é‡Œåˆå¯ä»¥ç»“æŸäº† å¼€é¥­äº†</p><h3 id="æ¬²æ±‚ä¸æ»¡"><a href="#æ¬²æ±‚ä¸æ»¡" class="headerlink" title="æ¬²æ±‚ä¸æ»¡"></a>æ¬²æ±‚ä¸æ»¡</h3><p>å¤ªæ²¡è¿½æ±‚äº†ï¼Œå¤ªåŸ‹æ±°äº†ï¼Œå¤ªä¸‘äº†</p><p>ä»–ç”šè‡³ä¸èƒ½è‡ªå®šä¹‰èœå•é¡¹çš„ä½ç½®ï¼Œåªèƒ½å‚ç›´æ’åˆ—</p><p>ä½œä¸ºä¸€ä¸ªæœ‰è¿½æ±‚çš„ç¨‹åºå‘˜ï¼Œå†³ä¸èƒ½å°±æ­¤ç½¢ä¼‘</p><p>è®©æˆ‘ä»¬æ¥åº·åº·<code>Maya</code>çš„èœå•ï¼š</p><p><img src="/img/image-20221026192838016.png" alt="Maya Menu"></p><p>æˆ‘é ï¼Œä»€ä¹ˆå«<code>Maya</code>ï¼Œä»€ä¹ˆå«ä¸šå†…æ ‡æ†ï¼Œå°±ä¸€ä¸ªå­—ï¼šnewbility</p><h3 id="å“­é—¹"><a href="#å“­é—¹" class="headerlink" title="å“­é—¹"></a>å“­é—¹</h3><p>æˆ‘ä¹Ÿè¦æˆ‘ä¹Ÿè¦ï¼Œä¸å˜›ä¸å˜›ï¼Œæˆ‘å°±è¦ï¼Œwww</p><p>æˆ‘ä¸å¬æˆ‘ä¸å¬ï¼Œåˆ«äººæœ‰æˆ‘ä¹Ÿè¦</p><h3 id="ä¹‰çœ¼ç›¯é’ˆ"><a href="#ä¹‰çœ¼ç›¯é’ˆ" class="headerlink" title="ä¹‰çœ¼ç›¯é’ˆ"></a>ä¹‰çœ¼ç›¯é’ˆ</h3><p>è®ºæ–­ï¼š</p><blockquote><p>è¿™è‚¯å®šæ˜¯è‡ªç»˜èœå•ï¼Œè‚¯å®šä¸æ˜¯ç”¨çš„ç³»ç»Ÿèœå•ï¼ˆè™½ç„¶QMenuä¹Ÿæ˜¯Qtè‡ªç»˜çš„ï¼‰</p></blockquote><p>ä½ é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„ï¼Ÿ</p><p>æˆ‘åªèƒ½è¯´ï¼šddddï¼Œæ‡‚çš„éƒ½æ‡‚ï¼Œä¸æ‡‚çš„ä¹Ÿä¸å¿…å¤šè¯´ï¼Œè¿™é‡Œé¢çš„æ°´å¾ˆæ·±ï¼Œä¸è¯´ä¹Ÿæ˜¯ä¸ºä½ å¥½</p><h2 id="æ­£ç‰‡ï¼ˆå åº•"><a href="#æ­£ç‰‡ï¼ˆå åº•" class="headerlink" title="æ­£ç‰‡ï¼ˆå åº•"></a>æ­£ç‰‡ï¼ˆå åº•</h2><p>é‚£ä¹ˆè¦å¦‚ä½•å®ç°è¿™ç§æ•ˆæœå‘¢ï¼Ÿ</p><h3 id="å¤§èªæ˜"><a href="#å¤§èªæ˜" class="headerlink" title="å¤§èªæ˜"></a>å¤§èªæ˜</h3><p>æœ‰äººå¯èƒ½ä¼šè¯´ï¼šä¸€ä¸ªmenuä¸è¡Œï¼Œé‚£å°±å¤šä¸ªmenuåŒæ—¶<code>popup()</code>å°±å¯ä»¥äº†å‘€</p><p>èªæ˜ï¼Œå¤ªèªæ˜äº†</p><p>ä½†æ˜¯ç»è¿‡å®éªŒå‘ç°ï¼Œåªæœ‰ä¸€ä¸ªmenuå¯ä»¥å“åº”é¼ æ ‡åˆ’è¿‡ï¼ˆhoverï¼‰ï¼Œå…¶ä»–çš„å‡æ— ååº”</p><h3 id="è‡ªç»˜"><a href="#è‡ªç»˜" class="headerlink" title="è‡ªç»˜"></a>è‡ªç»˜</h3><p>å½“ç„¶ï¼Œè‡ªç»˜æ§ä»¶ï¼ˆçª—ä½“ï¼‰è‚¯å®šæ˜¯æœ€ä¼˜è§£å†³æ–¹æ¡ˆï¼Œè‡ªå®šä¹‰ç¨‹åº¦æœ€é«˜ï¼Œå¦‚ï¼š</p><p><img src="/img/image-20221026194920895.png" alt="è‡ªç»˜èœå•"></p><p>è¿™æ˜¯ä¸€ä¸ªå›¾ç‰‡æŸ¥çœ‹å™¨çš„å³é”®èœå•ï¼Œé•¿æŒ‰å³é”®å¼¹å‡ºï¼Œå¹¶ä¸”å¯ä»¥å®ç°èŠ±é‡Œèƒ¡å“¨çš„æ•ˆæœ</p><p>ä½†æ˜¯è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬çš„èœå•éƒ½æ˜¯å¯ä»¥å®ç°çº§è”çš„</p><p>å¦‚æœè¦è‡ªç»˜å®ç°çº§è”ï¼Œé‚£ä»£ç é‡å°±å¯æƒ³è€ŒçŸ¥äº†</p><p>æ‰€ä»¥è¿™ä¸ªæ–¹æ¡ˆå¥½æ˜¯å¥½ï¼Œä½†æ˜¯æˆ‘æ˜¯æ‡’ç‹—ï¼Œo(â•¥ï¹â•¥)o</p><h3 id="å¥³å¨²è¡¥å¤©"><a href="#å¥³å¨²è¡¥å¤©" class="headerlink" title="å¥³å¨²è¡¥å¤©"></a>å¥³å¨²è¡¥å¤©</h3><p>å®é™…ä¸Šï¼Œä»”ç»†è§‚å¯Ÿ<code>Maya</code>çš„èœå•ï¼Œåªæœ‰ç¬¬ä¸€çº§èœå•æ˜¯æŒä¹…æ˜¾ç¤ºçš„</p><p>åªè¦è§£å†³äº†ç¬¬ä¸€çº§èœå•çš„æ˜¾ç¤ºå’Œå“åº”ï¼Œåç»­èœå•ç›´æ¥ä½¿ç”¨<code>QMenu</code>å³å¯</p><p>ä¹Ÿå°±æ˜¯åªè¦å®ç°ç¬¬ä¸€çº§è§¦å‘å™¨å³å¯</p><p>é‚£ä¹ˆæœ‰ä»€ä¹ˆèƒ½æŒä¹…æ˜¾ç¤ºåœ¨çª—ä½“ä¸Šå‘¢</p><p>é‚£ä¹ˆæ˜¾ç„¶ï¼Œé™¤äº†<code>QMenu</code>éƒ½å¯ä»¥â€¦</p><p>å¥½çš„ï¼Œå½“ç„¶ï¼Œç»è¿‡å±‚å±‚ç­›é€‰ï¼Œå‘ç°<code>QToolButton</code>æ˜¯æœ€åˆé€‚çš„è½½ä½“</p><p>å› ä¸ºè¿™ä¸ªæ§ä»¶è‡ªå¸¦èœå•æ˜¾ç¤ºï¼ˆsetMenuæ–¹æ³•ï¼‰</p><p>è¡¥å……ä¸€ç‚¹ï¼šshowMenuæ˜¯é˜»å¡æ–¹æ³•ï¼ˆç±»ä¼¼execï¼Œå†…éƒ¨å¾ªç¯ï¼‰ï¼Œåœ¨<code>QTimer</code>ä¸­ç”¨ä¼šé˜»æ–­<code>Timer</code></p><h2 id="æ­£ç‰‡"><a href="#æ­£ç‰‡" class="headerlink" title="æ­£ç‰‡"></a>æ­£ç‰‡</h2><p>æ ¹æ®é«˜å†…èšä½è€¦åˆç²¾ç¥ï¼Œæˆ‘ä»¬å†³å®šå°†èœå•å°è£…ä¸ºä¸€ä¸ªå•ç‹¬çš„çª—ä½“</p><p>åœ¨çª—ä½“ä¸Šæ”¾ç½®<code>QToolButton</code>ä½œä¸ºèœå•çš„è½½ä½“ï¼Œè‡ªç„¶åœ°è§£å†³äº†çº§è”èœå•é—®é¢˜</p><p>ç„¶åå†å°†çª—ä½“è®¾ç½®ä¸ºé€æ˜å’Œé¼ æ ‡ç©¿é€</p><p>Perfect</p><p>å“¦ï¼Œæˆ‘çš„ä¸Šå¸ï¼Œå¤ªç®€å•äº†</p><blockquote><p>ç®€ç›´æ˜¯åŸå­æ ¸è„‘è¢‹</p></blockquote><p>è¿˜è®°å¾—æˆ‘ä»¬çš„æ ‡é¢˜å—ï¼šé•¿æŒ‰é¼ æ ‡å¼¹å‡ºèœå•</p><p>å‚è€ƒï¼šApexé•¿æŒ‰ä¸­é”®å¼¹å‡ºæ ‡è®°èœå•ï¼Œæ¾å¼€å³å¯æ ‡è®°</p><p><img src="/img/image-20221026201007425.png" alt="Apex Menu"></p><p>æ‰€ä»¥è¿™é¢˜çœŸæ­£çš„éš¾ç‚¹åœ¨äºï¼šæŒ‰ä½é¼ æ ‡æŒ‰é”®ï¼Œå¹¶å“åº”èœå•</p><p>ä¸€èˆ¬äººå¯èƒ½ä¸è§‰å¾—è¿™æœ‰ä»€ä¹ˆéš¾çš„</p><p>åƒApexå’ŒMayaè‡ªç»˜çš„è¯ï¼Œä¹Ÿå½“ç„¶ä¸æ˜¯ä»€ä¹ˆéš¾é¢˜</p><p>ä½†å¯¹äºå·é¸¡å–å·§çš„æˆ‘ä»¬æ¥è®²ï¼Œè¿™å°±å·®ç‚¹è¢«<strong>checkmate</strong>äº†</p><p>å·é¸¡ï¼Œæ˜¯è¦æ‰¿æ‹…åæœçš„</p><h3 id="Windowsçª—å£ç„¦ç‚¹ç³»ç»Ÿ"><a href="#Windowsçª—å£ç„¦ç‚¹ç³»ç»Ÿ" class="headerlink" title="Windowsçª—å£ç„¦ç‚¹ç³»ç»Ÿ"></a>Windowsçª—å£ç„¦ç‚¹ç³»ç»Ÿ</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåªæœ‰ç„¦ç‚¹çª—å£æ‰èƒ½æ¥æ”¶é¼ æ ‡å’Œé”®ç›˜è¾“å…¥</p><p>è¿™å…¶ä¸­ï¼Œå½“å±é¼ æ ‡ç„¦ç‚¹æœ€ç‰¹æ®Š</p><blockquote><p>åœ¨ä¸€ä¸ªçª—å£Aå†…ï¼ŒæŒ‰ä½é¼ æ ‡ä»»æ„æŒ‰é”®ï¼Œæ‹–åŠ¨é¼ æ ‡è‡³çª—å£Bï¼ŒPress &amp; Move &amp; Releaseæ¶ˆæ¯éƒ½ä¼šå‘é€ç»™çª—å£A</p><p>å¯¼è‡´ä½œä¸ºèœå•å¼¹å‡ºçš„Bæ— æ³•æ­£å¸¸å“åº”é¼ æ ‡ï¼ˆå³ä¾¿æ˜¯è½¬ç§»ç„¦ç‚¹ä¹Ÿä¸è¡Œï¼‰</p></blockquote><p>ä¹Ÿå°±æ˜¯åœ¨çª—å£Aä¸­æŒ‰ä½é¼ æ ‡ä¸­é”®å¼¹å‡ºèœå•Bçš„è¯ï¼Œèœå•Bä¸­çš„<code>QToolButton</code>æ˜¯æ— æ³•æ­£å¸¸å“åº”é¼ æ ‡çš„ï¼Œä¹Ÿå°±æ— æ³•è‡ªåŠ¨å¼¹å‡ºMenu</p><p>ç¦»å¥‡çš„æ˜¯å¼¹å‡ºçš„<code>QMenu</code>æ˜¯å¯ä»¥å“åº”é¼ æ ‡hoverçš„ï¼ˆæ€€ç–‘æ˜¯è‡ªè¡Œæ‹¦æˆªäº†qAppäº‹ä»¶ï¼‰</p><p>æ‰€ä»¥æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯è®©<code>QToolButton</code>å“åº”é¼ æ ‡å¹¶å¼¹å‡ºMenu</p><p>å”¯ä¸€çš„æ–¹æ³•æ˜¯å‘<code>qApp</code>å®‰è£…äº‹ä»¶è¿‡æ»¤å™¨ï¼Œè¿‡æ»¤æ‰€æœ‰mouseMoveäº‹ä»¶ï¼Œæ§åˆ¶èœå•çš„å¼¹å‡ºå’Œå…³é—­</p><p>å½“ç„¶ç»†èŠ‚å¾ˆå¤šï¼Œä½†æ˜¯æœ‰äº†å¤§æ€è·¯ï¼Œå°ç»†èŠ‚åªè¦è€å¿ƒå³å¯è§£å†³</p><p><img src="/img/image-20221026210503942.png" alt="Follower Menu"></p><p>å…·ä½“å¯ä»¥å‚è€ƒï¼š<a href="https://gitee.com/mrbeanc/follower-v2.0/blob/master/toolmenu.cpp">toolmenu.cpp Â· è”¡å§¬&#x2F;Follower v2.0 - ç äº‘ - å¼€æºä¸­å›½ (gitee.com)</a></p><h3 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h3><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://stackoverflow.com/questions/22948145/how-to-show-the-menu-in-qpushbutton-without-blocking/22972318#22972318">qt - How to show the menu in QPushButton without blocking? - Stack Overflow</a></p><p><a href="https://gitee.com/mrbeanc/follower-v2.0/blob/master/toolmenu.cpp">toolmenu.cpp Â· è”¡å§¬&#x2F;Follower v2.0 - ç äº‘ - å¼€æºä¸­å›½ (gitee.com)</a></p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>Menu</tag>
      
      <tag>MouseLongPress</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Qt-äº‹ä»¶å¾ªç¯ &amp; æ¨¡æ€çª—å£</title>
    <link href="/2022/10/21/Qt-%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF-%E6%A8%A1%E6%80%81%E7%AA%97%E5%8F%A3/"/>
    <url>/2022/10/21/Qt-%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF-%E6%A8%A1%E6%80%81%E7%AA%97%E5%8F%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>è³ªå•ï¼š</p><blockquote><p>ä¸ºä»€ä¹ˆæ¨¡æ€å¯¹è¯æ¡†ä¼šé˜»å¡å…¶ä»–çª—å£çš„äº¤äº’ï¼Ÿ</p></blockquote><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œè°ƒç”¨<code>QDialog::exec</code>ä¼šå¼€å¯ä¸€ä¸ªæ¨¡æ€å¯¹è¯æ¡†ï¼Œé˜»å¡åç»­ä»£ç ï¼Œå¹¶é˜»æ­¢å…¶ä»–çª—å£çš„äº¤äº’</p><p>But Whyï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">QDialog::exec</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">Q_D</span>(QDialog);<br>...<br>    <span class="hljs-built_in">setAttribute</span>(Qt::WA_ShowModal, <span class="hljs-literal">true</span>);<br>...<br>    <span class="hljs-built_in">show</span>();<br>...<br>    QEventLoop eventLoop;<br>    (<span class="hljs-type">void</span>) eventLoop.<span class="hljs-built_in">exec</span>(QEventLoop::DialogExec);<br>...<br>&#125;<br></code></pre></td></tr></table></figure><p>è§‚å¯Ÿæºç å¯çŸ¥ï¼Œ<code>exec</code>æ–¹æ³•å°†çª—å£è®¾ç½®ä¸ºäº†æ¨¡æ€ï¼ˆModalï¼‰ï¼Œå¹¶å¼€å¯äº†å±€éƒ¨äº‹ä»¶å¾ªç¯</p><p>é‚£ä¹ˆï¼Œç©¶ç«Ÿæ˜¯å±€éƒ¨äº‹ä»¶å¾ªç¯é˜»æ­¢äº†ä¸å…¶ä»–çª—å£çš„äº¤äº’ï¼Œè¿˜æ˜¯<code>Modal</code>å±æ€§çš„ä»•æ¥­ï¼ˆã—ã‚ã–ï¼‰å‘¢</p><h2 id="EventLoop"><a href="#EventLoop" class="headerlink" title="EventLoop"></a>EventLoop</h2><p>é¦–å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯</p><p>æˆ‘ä»¬åœ¨<code>Qt</code>æ¡Œé¢ç¨‹åºçš„<code>main</code>å‡½æ•°é‡Œå°±èƒ½çœ‹åˆ°<code>QApplicaion::exec()</code></p><p>å…¶å†…éƒ¨å°±å¼€äº†ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œä¹Ÿç§°ä¸º<code>Qt</code>ç¨‹åºçš„ä¸»å¾ªç¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">QCoreApplication::exec</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>...<br>QEventLoop eventLoop;<br>eventLoop.<span class="hljs-built_in">exec</span>();<br>...<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">QEventLoop::exec</span><span class="hljs-params">(ProcessEventsFlags flags)</span></span><br><span class="hljs-function"></span>&#123;<br>...<br>    <span class="hljs-keyword">while</span> (!d-&gt;exit.<span class="hljs-built_in">loadAcquire</span>())<br>        <span class="hljs-built_in">processEvents</span>(flags | WaitForMoreEvents | EventLoopExec);<br>...<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">QEventLoop::processEvents</span><span class="hljs-params">(ProcessEventsFlags flags)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">Q_D</span>(QEventLoop);<br>    <span class="hljs-keyword">if</span> (!d-&gt;threadData-&gt;<span class="hljs-built_in">hasEventDispatcher</span>())<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> d-&gt;threadData-&gt;eventDispatcher.<span class="hljs-built_in">loadRelaxed</span>()-&gt;<span class="hljs-built_in">processEvents</span>(flags);<br>&#125;<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œäº‹ä»¶å¾ªç¯çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä¸æ–­æ¥æ”¶å†…éƒ¨å¤–éƒ¨çš„å„ç§æ¶ˆæ¯ï¼Œå¹¶æ´¾å‘åˆ°å¯¹åº”çš„å‡½æ•°è¿›è¡Œå¤„ç†</p><p>æ‰€ä»¥<code>exec</code>ä¹‹åçš„ï¼ˆåŒä¸€å‡½æ•°å†…çš„ï¼‰ä»£ç åœ¨å¾ªç¯ç»“æŸå‰æ˜¯ä¸ä¼šå¾—åˆ°æ‰§è¡Œæœºä¼šçš„ï¼ˆé˜»å¡ï¼‰</p><p>äº‹ä»¶å¾ªç¯çš„æœ¬è´¨å°±æ˜¯ä»¥é˜Ÿåˆ—çš„æ–¹å¼å†æ¬¡åˆ†é…çº¿ç¨‹æ—¶é—´ç‰‡</p><h3 id="åµŒå¥—å¾ªç¯"><a href="#åµŒå¥—å¾ªç¯" class="headerlink" title="åµŒå¥—å¾ªç¯"></a>åµŒå¥—å¾ªç¯</h3><p>äº‹ä»¶å¾ªç¯è¿˜æœ‰ä¸€ä¸ªé‡è¦æ€§è´¨ï¼Œtaæ˜¯å¯ä»¥è¢«åµŒå¥—çš„</p><p>ä¹Ÿå°±æ˜¯åœ¨<code>QApplicaion::exec()</code>ä¸»å¾ªç¯å†…è¿˜å¯ä»¥å¼€å¯å±€éƒ¨äº‹ä»¶å¾ªç¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">QEventLoop eventLoop;<br>eventLoop.<span class="hljs-built_in">exec</span>();<br></code></pre></td></tr></table></figure><p>å°±åƒ<code>while</code>å¾ªç¯ä¸€æ ·ï¼Œå±€éƒ¨äº‹ä»¶å¾ªç¯è¿è¡Œæ—¶ï¼Œçˆ¶å¾ªç¯å°±å¤„äºåœæ»çŠ¶æ€</p><p>å±€éƒ¨äº‹ä»¶å¾ªç¯è·³å‡ºåï¼Œçˆ¶å¾ªç¯ç»§ç»­è¿è¡Œ</p><p>ä¸è¿‡ï¼Œé—®é¢˜ä¸å¤§ï¼Œäº‹ä»¶å¾ªç¯æœ¬èº«å°±åªæ˜¯æ´¾å‘äº‹ä»¶ï¼Œä¸è°çˆ¶è°å­æ— å…³ï¼Œå±€éƒ¨å¾ªç¯åŒæ ·èƒ½æ‰¿æ‹…ä¸€æ ·çš„èŒèƒ½</p><p><code>Qt</code>ä¼šæŠŠäº‹ä»¶åˆ†å‘åˆ°ç”Ÿæ•ˆçš„äº‹ä»¶å¾ªç¯ä¸­å»</p><p>æ‰€ä»¥ï¼Œè™½ç„¶<code>eventLoop.exec();</code>åçš„ä»£ç è¢«é˜»å¡ï¼Œä½†æ˜¯<code>UI</code>äº¤äº’ã€<code>Timer</code>ç­‰ç­‰å„ç±»äº‹ä»¶éƒ½æ˜¯æ­£å¸¸æ‰§è¡Œçš„</p><blockquote><p> ä¹Ÿå°±æ˜¯ä¸€ä¸ªå‡½æ•°è¢«é˜»å¡ï¼Œä½†æ˜¯åƒåƒä¸‡ä¸‡ä¸ªå‡½æ•°åœ¨é˜»å¡å‰çš„é‚£è¡Œä»£ç å†…è¿è¡Œ</p></blockquote><blockquote><p>æ—¶é—´åœæ­¢äº†ï¼Ÿä¸ï¼Œä¸–ç•Œä»åœ¨è¿è¡Œï¼Œåªæœ‰ä½ åœæ»ä¸å‰ â€”â€” è”¡å§¬</p></blockquote><p>æ­£å› ä¸ºå¦‚æ­¤ï¼Œå±€éƒ¨äº‹ä»¶å¾ªç¯çš„å¦™ç”¨å°±æ˜¯åœ¨ä¸é˜»å¡<code>UI</code>çš„å‰æä¸‹ï¼Œå®ç°å‡½æ•°çš„åŒæ­¥æ‰§è¡Œ</p><p>ä¾‹å¦‚ï¼šç­‰å¾…æœåŠ¡å™¨å“åº”ï¼Œè®¡ç®—è¶…æ—¶ç­‰ç­‰</p><h3 id="ç»¼ä¸Š"><a href="#ç»¼ä¸Š" class="headerlink" title="ç»¼ä¸Š"></a>ç»¼ä¸Š</h3><p>äº‹ä»¶å¾ªç¯å¹¶ä¸é˜»å¡<code>UI</code>ï¼Œä¸å¯èƒ½å¯¼è‡´å¯¹è¯æ¡†é˜»å¡å…¶ä»–çª—å£çš„äº¤äº’</p><h2 id="è¿·"><a href="#è¿·" class="headerlink" title="è¿·"></a>è¿·</h2><p>é‚£ç©¶ç«Ÿæ˜¯è°ï¼Œå¹²äº†è¿™å¥½äº‹ï¼ˆæ¼ï¼‰</p><p>åªæœ‰æ¨¡æ€å±æ€§äº†å§</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">QDialog dia;<br>dia.<span class="hljs-built_in">setModal</span>(<span class="hljs-literal">true</span>);<br>dia.<span class="hljs-built_in">show</span>();<br></code></pre></td></tr></table></figure><p>ç¡®å®å¦‚æ­¤ï¼Œåªè¦è®¾ç½®æ¨¡æ€å±æ€§ï¼Œå°±èƒ½å®ç°äº¤äº’é˜»å¡</p><p>è€Œä¸”è¿˜æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p><table><thead><tr><th align="center">æ¨¡å¼</th><th align="center">æ•ˆæœ</th></tr></thead><tbody><tr><td align="center">Qt::ApplicationModal</td><td align="center">é˜»å¡åº”ç”¨ç¨‹åºçš„æ‰€æœ‰çª—å£</td></tr><tr><td align="center">Qt::WindowModal</td><td align="center">é˜»å¡çˆ¶çª—å£ã€ç¥–å…ˆçª—å£åŠå®ƒä»¬çš„å­çª—å£</td></tr></tbody></table><h2 id="å§‹ä½œä¿‘è€…"><a href="#å§‹ä½œä¿‘è€…" class="headerlink" title="å§‹ä½œä¿‘è€…"></a>å§‹ä½œä¿‘è€…</h2><p>ä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆ</p><p>éš¾é“è¯´</p><blockquote><p>æˆ‘çœŸå‚»ï¼ŒçœŸçš„</p><p>æˆ‘ä¸€ç›´ä»¥ä¸ºé˜»å¡æ˜¯ä¸å¾—å·²è€Œä¸ºä¹‹ï¼Œå´å¿˜äº†äººå¿ƒé™©æ¶</p></blockquote><p>è¿™ææœ‰å¯èƒ½æ˜¯<code>Qt</code>åœ¨å†…éƒ¨æ‰‹åŠ¨å±è”½äº†å…¶ä»–çª—å£çš„äº¤äº’ï¼Œåªä¸ºäº†å¼ºåˆ¶ç”¨æˆ·ä¸“å¿ƒäºæ¨¡æ€çª—å£</p><blockquote><p>www æˆ‘çœŸå‚» çœŸçš„</p></blockquote><h3 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h3><p>å¯¹äº†ï¼Œè¿˜æœ‰ä¸€ç‚¹</p><p><code>QEventLoop::ProcessEventsFlags</code>çš„æšä¸¾å€¼åœ¨<code>Qt</code>æ–‡æ¡£ä¸­è¢«åˆ»æ„éšè—äº†ä¸€äº›</p><p>æ¯”å¦‚<code>Qt</code>æºç ä¸­çš„<code>QEventLoop::DialogExec</code></p><p>åŸå› æœªçŸ¥</p><h3 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h3><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://blog.csdn.net/weixin_42981623/article/details/107593343">Qtäº‹ä»¶å¾ªç¯è¯¦è§£ï¼ˆä¸€ï¼‰_ä¸€åªå‘å‰çš„ç¨‹åºçŒ¿çš„åšå®¢-CSDNåšå®¢_qtå¾ªç¯</a></p><p><a href="https://www.cnblogs.com/senior-engineer/p/9629612.html">Qt ä¹‹ æ¨¡æ€ã€éæ¨¡æ€ã€åŠæ¨¡æ€çª—å£çš„ä»‹ç»åŠ å®ç°QDialogçš„exec()æ–¹æ³• - maxiongying - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://blog.csdn.net/goforwardtostep/article/details/53667566">Qt ä¹‹ æ¨¡æ€ã€éæ¨¡æ€ã€åŠæ¨¡æ€çª—å£çš„ä»‹ç»åŠ å®ç°QDialogçš„exec()æ–¹æ³•_å‰è¡Œä¸­çš„å°çŒªçš„åšå®¢-CSDNåšå®¢_qdialogæ¨¡æ€æ˜¾ç¤º</a></p><p><a href="https://www.cnblogs.com/findumars/p/4886573.html">QDialog æ¨¡æ€å¯¹è¯æ¡†ä¸äº‹ä»¶å¾ªç¯ï¼ˆexecå…¶å®å°±æ˜¯è°ƒç”¨äº†showå’ŒeventLoop.execï¼‰ - findumars - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://blog.csdn.net/qiufenpeng/article/details/81583768">QTä¸­ä½¿ç”¨QEventLoopæ¥å®ç°äº‹ä»¶å¾ªç¯_ã€Œå·²æ³¨é”€ã€çš„åšå®¢-CSDNåšå®¢_qeventloop</a></p><p><a href="https://zhuanlan.zhihu.com/p/484482786">Qt | æ¨¡æ€å¯¹è¯æ¡†å’Œéæ¨¡æ€å¯¹è¯æ¡† QDialog - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://www.cnblogs.com/CooCoChoco/p/14597001.html">Qt æ¨¡æ€çª—å£ - ç´¢æ™ºæº - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://blog.csdn.net/easebone/article/details/46462435">Qt Objectæ¨¡å‹åŠå…¶çº¿ç¨‹å’Œäº‹ä»¶å¤„ç†_szonebitçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://stackoverflow.com/questions/9523311/undocumented-processeventsflag-enums-in-qt">event handling - Undocumented ProcessEventsFlag enums in QT - Stack Overflow</a></p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>EventLoop</tag>
      
      <tag>Modal</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Qt-windeployqtéƒ¨ç½²å‘å¸ƒæµ…è°ˆ</title>
    <link href="/2022/10/12/Qt-windeployqt%E9%83%A8%E7%BD%B2%E5%8F%91%E5%B8%83%E6%B5%85%E8%B0%88/"/>
    <url>/2022/10/12/Qt-windeployqt%E9%83%A8%E7%BD%B2%E5%8F%91%E5%B8%83%E6%B5%85%E8%B0%88/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>Qt Creator</code>ä¸­è¿è¡Œé¡¹ç›®ï¼Œæˆ–è€…æ˜¯åœ¨<code>release/debug</code>æ–‡ä»¶å¤¹ä¸­åŒå‡»<code>exe</code>è¿è¡Œåº”ç”¨ç¨‹åº</p><p>æœ‰äº›åŒå­¦å¯èƒ½å¯¹åè€…å­˜åœ¨äº›è®¸ç–‘æƒ‘ï¼Œæ—¶å¸¸ä¼šçœ‹åˆ°<code>æ‰¾ä¸åˆ°dll</code>ç­‰é”™è¯¯</p><p>è¿™æ˜¯ç”±äºæœªåœ¨ç¯å¢ƒå˜é‡ä¸­åŠ å…¥<code>msvc/bin</code> | <code>mingw/bin</code>ç­‰ç›®å½•ï¼ˆç¯å¢ƒå˜é‡å¯ä»¥çœ‹åšæ˜¯æœç´¢ç›®å½•ï¼‰</p><p>è€Œ<code>bin</code>ç›®å½•ä¸­å­˜æ”¾çš„æ­£æ˜¯é¡¹ç›®ä¸­ä¾èµ–çš„å„ç§<code>Qt-dll</code></p><blockquote><p> <code>exe</code>çš„è¿è¡Œä¾èµ–å„ç§<code>dll</code>ï¼Œè¿™æ˜¯å¸¸è¯†</p></blockquote><p>ä½†æ˜¯å…·ä½“ä¾èµ–å“ªäº›<code>dll</code>ï¼Œä»¥åŠå“ªå‡ ç±»<code>dll</code>å‘¢</p><p>ä»æ¥æºä¸Šï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š<code>Windows dll</code> &amp; <code>Qt dll</code></p><ul><li><code>Windows dll</code>é€šå¸¸ä½äº<code>C:\Windows\System32</code>æ–‡ä»¶å¤¹ä¸‹ï¼ˆä»¥<code>x64</code>ä¸ºä¾‹ï¼‰ï¼Œä¸€èˆ¬ç³»ç»Ÿè‡ªå¸¦ï¼Œæ— éœ€ç‰¹æ®Šå¤„ç†</li><li><code>Qt dll</code>ä¸€èˆ¬ä½äº<code>msvc/bin</code> | <code>mingw/bin</code>ï¼ˆåŒ…å«ç‰ˆæœ¬å·ï¼‰ï¼Œä¸€èˆ¬ç”¨æˆ·ç³»ç»Ÿæ— <code>Qt</code>ï¼Œå¤§æ¦‚ç‡ç¼ºå¤±ï¼Œéœ€è¦ç¨‹åºè‡ªå¸¦</li></ul><p>æ‰€ä»¥ï¼Œä¸ºäº†å°†åº”ç”¨ç¨‹åºæ‰“åŒ…å‘å¸ƒåˆ°ä¸€èˆ¬<code>PC</code>ä¸Šï¼Œæˆ‘ä»¬éœ€è¦æœé›†ä¾èµ–çš„<code>Qt-dll</code>å¹¶ä¸<code>exe</code>ç½®äºåŒçº§ç›®å½•ä¸‹ï¼Œæ–¹ä¾¿å¯»å€</p><blockquote><p>But How</p></blockquote><h2 id="æ­£ç‰‡ï¼ˆå åº•"><a href="#æ­£ç‰‡ï¼ˆå åº•" class="headerlink" title="æ­£ç‰‡ï¼ˆå åº•"></a>æ­£ç‰‡ï¼ˆå åº•</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡</p><ul><li><code>Dependencies</code>è½¯ä»¶</li><li><code>ä»»åŠ¡ç®¡ç†å™¨ - æ€§èƒ½ - èµ„æºç›‘è§†å™¨ - æ¨¡å—</code></li></ul><p>æŸ¥çœ‹<code>exe</code>çš„<code>dll</code>ä¾èµ–</p><p>ä½†æ˜¯ä¸€ä¸ªä¸ªå¤åˆ¶å®åœ¨æ˜¯ï¼Œæƒ…ã‘ãªã„ï¼Œä¸¢ç¨‹åºå‘˜çš„è„¸ï¼</p><p><code>Qt</code>ä¸ºæˆ‘ä»¬æä¾›äº†å‘½ä»¤è¡Œå·¥å…·<code>windeployqt</code>æ¥è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼ˆè¿™åå­—ï¼šwin + deploy +qt ç§€ï¼‰</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨<code>cmd</code>ä¸­ç›´æ¥ä½¿ç”¨è¯¥å‘½ä»¤</p><p>è€Œæ˜¯åº”è¯¥åœ¨Qtæä¾›çš„å‘½ä»¤è¡Œç¯å¢ƒ <code>Qt 5.15.2 (MSVC 2019 64-bit)</code> | <code>Qt 5.15.2 (MinGW 8.1.0 64-bit)</code>ä¸­è¿›è¡Œï¼ˆé€‰æ‹©å¯¹åº”çš„ç¼–è¯‘å™¨å’Œç‰ˆæœ¬ï¼‰</p><p>è¯¦ç»†åŸå› è¯·å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡blogï¼š<a href="https://mrbeancpp.github.io/2021/09/17/windeployqt%E5%8F%91%E5%B8%83%E9%A1%B9%E7%9B%AE-%E4%B8%BA%E4%BD%95%E6%80%BB%E6%98%AF%E7%BC%BA%E5%B0%91dll/">windeployqtå‘å¸ƒé¡¹ç›® ä¸ºä½•æ€»æ˜¯ç¼ºå°‘dll - MrBeanC-Blog (mrbeancpp.github.io)</a></p><p>æˆ‘ä»¬è¿™æ¬¡çš„é‡ç‚¹å¹¶ä¸åœ¨äºæ­¤</p><h2 id="windeployqt"><a href="#windeployqt" class="headerlink" title="windeployqt"></a>windeployqt</h2><p>&#x2F;&#x2F;è¯¥å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬å°†<code>exe</code>æ‰€éœ€è¦çš„<code>Qt-dll</code>æ‹·è´åˆ°<code>exe</code>åŒçº§ç›®å½•ä¸‹</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">Usage: <span class="hljs-title">windeployqt</span> [<span class="hljs-title">options</span>] [<span class="hljs-title">files</span>]</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">Options</span>:</span><br><span class="hljs-function">  -?, -<span class="hljs-title">h</span>, --<span class="hljs-title">help</span>            <span class="hljs-title">Displays</span> <span class="hljs-title">this</span> <span class="hljs-title">help</span>.</span><br><span class="hljs-function">  -<span class="hljs-title">v</span>, --<span class="hljs-title">version</span>             <span class="hljs-title">Displays</span> <span class="hljs-title">version</span> <span class="hljs-title">information</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">dir</span> &lt;<span class="hljs-title">directory</span>&gt;         <span class="hljs-title">Use</span> <span class="hljs-title">directory</span> <span class="hljs-title">instead</span> <span class="hljs-title">of</span> <span class="hljs-title">binary</span> <span class="hljs-title">directory</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">libdir</span> &lt;<span class="hljs-title">path</span>&gt;           <span class="hljs-title">Copy</span> <span class="hljs-title">libraries</span> <span class="hljs-title">to</span> <span class="hljs-title">path</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">plugindir</span> &lt;<span class="hljs-title">path</span>&gt;        <span class="hljs-title">Copy</span> <span class="hljs-title">plugins</span> <span class="hljs-title">to</span> <span class="hljs-title">path</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">debug</span>                   <span class="hljs-title">Assume</span> <span class="hljs-title">debug</span> <span class="hljs-title">binaries</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">release</span>                 <span class="hljs-title">Assume</span> <span class="hljs-title">release</span> <span class="hljs-title">binaries</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">pdb</span>                     <span class="hljs-title">Deploy</span> .<span class="hljs-title">pdb</span> <span class="hljs-title">files</span> (<span class="hljs-title">MSVC</span>).</span><br><span class="hljs-function">  --<span class="hljs-title">force</span>                   <span class="hljs-title">Force</span> <span class="hljs-title">updating</span> <span class="hljs-title">files</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">dry</span>-<span class="hljs-title">run</span>                 <span class="hljs-title">Simulation</span> <span class="hljs-title">mode</span>. <span class="hljs-title">Behave</span> <span class="hljs-title">normally</span>, <span class="hljs-title">but</span> <span class="hljs-title">do</span> <span class="hljs-title">not</span></span><br><span class="hljs-function">                            <span class="hljs-title">copy</span>/<span class="hljs-title">update</span> <span class="hljs-title">any</span> <span class="hljs-title">files</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">no</span>-<span class="hljs-title">patchqt</span>              <span class="hljs-title">Do</span> <span class="hljs-title">not</span> <span class="hljs-title">patch</span> <span class="hljs-title">the</span> <span class="hljs-title">Qt5Core</span> <span class="hljs-title">library</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">no</span>-<span class="hljs-title">plugins</span>              <span class="hljs-title">Skip</span> <span class="hljs-title">plugin</span> <span class="hljs-title">deployment</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">no</span>-<span class="hljs-title">libraries</span>            <span class="hljs-title">Skip</span> <span class="hljs-title">library</span> <span class="hljs-title">deployment</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">qmldir</span> &lt;<span class="hljs-title">directory</span>&gt;      <span class="hljs-title">Scan</span> <span class="hljs-title">for</span> <span class="hljs-title">QML</span>-<span class="hljs-title">imports</span> <span class="hljs-title">starting</span> <span class="hljs-title">from</span> <span class="hljs-title">directory</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">no</span>-<span class="hljs-title">quick</span>-<span class="hljs-title">import</span>         <span class="hljs-title">Skip</span> <span class="hljs-title">deployment</span> <span class="hljs-title">of</span> <span class="hljs-title">Qt</span> <span class="hljs-title">Quick</span> <span class="hljs-title">imports</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">no</span>-<span class="hljs-title">translations</span>         <span class="hljs-title">Skip</span> <span class="hljs-title">deployment</span> <span class="hljs-title">of</span> <span class="hljs-title">translations</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">no</span>-<span class="hljs-title">system</span>-<span class="hljs-title">d3d</span>-<span class="hljs-title">compiler</span>  <span class="hljs-title">Skip</span> <span class="hljs-title">deployment</span> <span class="hljs-title">of</span> <span class="hljs-title">the</span> <span class="hljs-title">system</span> <span class="hljs-title">D3D</span> <span class="hljs-title">compiler</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">compiler</span>-<span class="hljs-title">runtime</span>        <span class="hljs-title">Deploy</span> <span class="hljs-title">compiler</span> <span class="hljs-title">runtime</span> (<span class="hljs-title">Desktop</span> <span class="hljs-title">only</span>).</span><br><span class="hljs-function">  --<span class="hljs-title">no</span>-<span class="hljs-title">compiler</span>-<span class="hljs-title">runtime</span>     <span class="hljs-title">Do</span> <span class="hljs-title">not</span> <span class="hljs-title">deploy</span> <span class="hljs-title">compiler</span> <span class="hljs-title">runtime</span> (<span class="hljs-title">Desktop</span> <span class="hljs-title">only</span>).</span><br><span class="hljs-function">  --<span class="hljs-title">webkit2</span>                 <span class="hljs-title">Deployment</span> <span class="hljs-title">of</span> <span class="hljs-title">WebKit2</span> (<span class="hljs-title">web</span> <span class="hljs-title">process</span>).</span><br><span class="hljs-function">  --<span class="hljs-title">no</span>-<span class="hljs-title">webkit2</span>              <span class="hljs-title">Skip</span> <span class="hljs-title">deployment</span> <span class="hljs-title">of</span> <span class="hljs-title">WebKit2</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">json</span>                    <span class="hljs-title">Print</span> <span class="hljs-title">to</span> <span class="hljs-title">stdout</span> <span class="hljs-title">in</span> <span class="hljs-title">JSON</span> <span class="hljs-title">format</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">angle</span>                   <span class="hljs-title">Force</span> <span class="hljs-title">deployment</span> <span class="hljs-title">of</span> <span class="hljs-title">ANGLE</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">no</span>-<span class="hljs-title">angle</span>                <span class="hljs-title">Disable</span> <span class="hljs-title">deployment</span> <span class="hljs-title">of</span> <span class="hljs-title">ANGLE</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">no</span>-<span class="hljs-title">opengl</span>-<span class="hljs-title">sw</span>            <span class="hljs-title">Do</span> <span class="hljs-title">not</span> <span class="hljs-title">deploy</span> <span class="hljs-title">the</span> <span class="hljs-title">software</span> <span class="hljs-title">rasterizer</span> <span class="hljs-title">library</span>.</span><br><span class="hljs-function">  --<span class="hljs-title">list</span> &lt;<span class="hljs-title">option</span>&gt;           <span class="hljs-title">Print</span> <span class="hljs-title">only</span> <span class="hljs-title">the</span> <span class="hljs-title">names</span> <span class="hljs-title">of</span> <span class="hljs-title">the</span> <span class="hljs-title">files</span> <span class="hljs-title">copied</span>.</span><br><span class="hljs-function">                            <span class="hljs-title">Available</span> <span class="hljs-title">options</span>:</span><br><span class="hljs-function">                             <span class="hljs-title">source</span>:   <span class="hljs-title">absolute</span> <span class="hljs-title">path</span> <span class="hljs-title">of</span> <span class="hljs-title">the</span> <span class="hljs-title">source</span> <span class="hljs-title">files</span></span><br><span class="hljs-function">                             <span class="hljs-title">target</span>:   <span class="hljs-title">absolute</span> <span class="hljs-title">path</span> <span class="hljs-title">of</span> <span class="hljs-title">the</span> <span class="hljs-title">target</span> <span class="hljs-title">files</span></span><br><span class="hljs-function">                             <span class="hljs-title">relative</span>: <span class="hljs-title">paths</span> <span class="hljs-title">of</span> <span class="hljs-title">the</span> <span class="hljs-title">target</span> <span class="hljs-title">files</span>, <span class="hljs-title">relative</span></span><br><span class="hljs-function">                                       <span class="hljs-title">to</span> <span class="hljs-title">the</span> <span class="hljs-title">target</span> <span class="hljs-title">directory</span></span><br><span class="hljs-function">                             <span class="hljs-title">mapping</span>:  <span class="hljs-title">outputs</span> <span class="hljs-title">the</span> <span class="hljs-title">source</span> <span class="hljs-title">and</span> <span class="hljs-title">the</span> <span class="hljs-title">relative</span></span><br><span class="hljs-function">                                       <span class="hljs-title">target</span>, <span class="hljs-title">suitable</span> <span class="hljs-title">for</span> <span class="hljs-title">use</span> <span class="hljs-title">within</span> <span class="hljs-title">an</span></span><br><span class="hljs-function">                                       <span class="hljs-title">Appx</span> <span class="hljs-title">mapping</span> <span class="hljs-title">file</span></span><br><span class="hljs-function">  --<span class="hljs-title">verbose</span> &lt;<span class="hljs-title">level</span>&gt;         <span class="hljs-title">Verbose</span> <span class="hljs-title">level</span>.</span><br><span class="hljs-function">  </span><br><span class="hljs-function"><span class="hljs-title">Arguments</span>:</span><br><span class="hljs-function">  [<span class="hljs-title">files</span>]                   <span class="hljs-title">Binaries</span> <span class="hljs-title">or</span> <span class="hljs-title">directory</span> <span class="hljs-title">containing</span> <span class="hljs-title">the</span> <span class="hljs-title">binary</span>.</span><br></code></pre></td></tr></table></figure><p>åªè¦åœ¨å‘½ä»¤è¡Œä¸­æ”¹å˜(<code>cdÂ·Change Directory</code>)å·¥ä½œç›®å½•è‡³<code>exe</code>æ‰€åœ¨ç›®å½•</p><p>å¹¶æ‰§è¡Œ<code>windeployqt test.exe</code></p><p>ä¾¿ä¼šè‡ªåŠ¨å°†ä¾èµ–æ–‡ä»¶ï¼ˆåŒ…æ‹¬<code>dll</code>å’Œå›¾æ ‡ç­‰ä¼—æ–‡ä»¶ï¼‰æ‹·è´è‡³<code>exe</code>æ‰€åœ¨ç›®å½•</p><p>æ­¤æ—¶ï¼Œæ‰“åŒ…ä¸ºå‹ç¼©åŒ…å¹¶ä¸€é½å‘å¸ƒå³å¯</p><h3 id="MSVCèƒŒåˆº"><a href="#MSVCèƒŒåˆº" class="headerlink" title="MSVCèƒŒåˆº"></a>MSVCèƒŒåˆº</h3><p>å¦‚æœæ˜¯<code>MSVC</code>ç¼–è¯‘å™¨ï¼Œè¦æ³¨æ„ä¸€ç‚¹</p><p><code>MSVC</code>ä¾èµ–äº<code>VS</code>ï¼Œå¯èƒ½ä¼šç”¨åˆ°<code>VS</code>ä¸‹çš„ä¸€äº›<code>dll</code>å¦‚ï¼š<code>MSVCP140.dll</code>ç­‰<code>C++</code>è¿è¡Œæ—¶ç¯å¢ƒ</p><p>ä¸å±äº<code>Qt</code>ï¼Œæ‰€ä»¥éœ€è¦è‡ªè¡Œæ‹·è´ï¼ˆè™½ç„¶å¤šæ•°ç”µè„‘ä¸ŠåŒ…å«ï¼‰</p><h2 id="More"><a href="#More" class="headerlink" title="More"></a>More</h2><p>å¦‚æœä½ è®¤ä¸ºè¿™ç¯‡åšå®¢åˆ°æ­¤ä¸ºæ­¢ï¼Œé‚£å°±å¤ªå¹´è½»äº†</p><p>é‚£å’Œä¸€èˆ¬çš„CV blogæœ‰ä»€ä¹ˆåŒºåˆ«</p><p>å’³å’³</p><p><code>windeployqt</code>ç›´æ¥æ‰“åŒ…å‘å¸ƒï¼Œè¿è¡Œå¹¶æ— å¤§ç¢ï¼Œä½†é—®é¢˜åœ¨äºé»˜è®¤å¤åˆ¶çš„ä¾èµ–å¤šæ•°å†—ä½™ï¼Œéœ€è¦æ‰‹åŠ¨ç²¾ç®€</p><h3 id="ä½•ãŒã„ã‚‹"><a href="#ä½•ãŒã„ã‚‹" class="headerlink" title="ä½•ãŒã„ã‚‹"></a>ä½•ãŒã„ã‚‹</h3><h4 id="libEGL-libGLESV2-opengl32sw"><a href="#libEGL-libGLESV2-opengl32sw" class="headerlink" title="libEGL libGLESV2 opengl32sw"></a>libEGL libGLESV2 opengl32sw</h4><p><code>libEGL.dll</code>,<code>libGLESV2.dll</code>è¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯ ANGLE çš„æ–‡ä»¶ï¼Œå¯ä»¥å»æ‰</p><p><code>opengl32sw.dll</code>æ˜¯è½¯ä»¶æ¨¡æ‹Ÿ OpenGLï¼Œé™¤éç”¨æˆ·çš„ç³»ç»Ÿè¿ DirectX æ”¯æŒéƒ½ä¸å®Œæ•´ï¼ˆä¾‹å¦‚è™šæ‹Ÿæœºï¼‰ï¼Œä¸ç„¶ä¹Ÿæ²¡ç”¨</p><p>å¯ä»¥ç”¨<code>--no-angle</code> &amp; <code>--no-opengl-sw</code>è¿™ä¿©å‚æ•°å»é™¤</p><h4 id="svg"><a href="#svg" class="headerlink" title="svg"></a>svg</h4><p>å¦‚æœæ²¡æœ‰ä½¿ç”¨<code>svg</code>çš„è¯ï¼Œ<code>iconengines\qsvgicon.dll</code>, <code>imageformats\qsvg.dll</code>, <code>Qt5Svg.dll</code> è¿™ä¸‰ä¸ªæ–‡ä»¶ä¹Ÿå¯ä»¥åˆ æ‰</p><p>è¿™æ˜¯çŸ¢é‡å›¾æ ¼å¼ï¼Œå¤§éƒ¨åˆ†ç¨‹åºåº”è¯¥éƒ½ä¸éœ€è¦</p><h4 id="translations"><a href="#translations" class="headerlink" title="translations"></a>translations</h4><p>å¦‚æœæ²¡æœ‰å›½é™…åŒ–æ”¯æŒçš„è¯ï¼Œ<code>translations</code>æ–‡ä»¶å¤¹å¯ä»¥æ•´ä¸ªåˆ æ‰</p><p>æˆ–è€…ä½¿ç”¨å‚æ•°<code>--no-translations</code></p><h3 id="Final"><a href="#Final" class="headerlink" title="Final"></a>Final</h3><p>ç»¼ä¸Šï¼Œæ¨èä½¿ç”¨ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">windeployqt --no-angle --no-opengl-sw --no-translations app.exe<br></code></pre></td></tr></table></figure><h3 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h3><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://blog.csdn.net/itas109/article/details/80497065">QTä½¿ç”¨windeployqtéƒ¨ç½²å‘å¸ƒåŠå…¶ç²¾ç®€_itas109çš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/u012830675/article/details/102495371">QT MSVCç¼–è¯‘é¡¹ç›®æ‰“åŒ…_æ˜“æ—¥çš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://mrbeancpp.github.io/2021/09/17/windeployqt%E5%8F%91%E5%B8%83%E9%A1%B9%E7%9B%AE-%E4%B8%BA%E4%BD%95%E6%80%BB%E6%98%AF%E7%BC%BA%E5%B0%91dll/">windeployqtå‘å¸ƒé¡¹ç›® ä¸ºä½•æ€»æ˜¯ç¼ºå°‘dll - MrBeanC-Blog (mrbeancpp.github.io)</a></p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>windeployqt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€å¯¹airpodså¼•å‘çš„ç¨‹åºå‘˜è„‘ç»†èƒå¤§æ­»äº¡äº‹ä»¶</title>
    <link href="/2022/10/10/%E4%B8%80%E5%AF%B9airpods%E5%BC%95%E5%8F%91%E7%9A%84%E7%A8%8B%E5%BA%8F%E5%91%98%E8%84%91%E7%BB%86%E8%83%9E%E5%A4%A7%E6%AD%BB%E4%BA%A1%E4%BA%8B%E4%BB%B6/"/>
    <url>/2022/10/10/%E4%B8%80%E5%AF%B9airpods%E5%BC%95%E5%8F%91%E7%9A%84%E7%A8%8B%E5%BA%8F%E5%91%98%E8%84%91%E7%BB%86%E8%83%9E%E5%A4%A7%E6%AD%BB%E4%BA%A1%E4%BA%8B%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå½“ä½ ç‹¬è‡ªå®…äºè‡ªå·±çš„å°æˆ¿é—´æ—¶ï¼Œå¯èƒ½ä¼šæ’­æ”¾ä¸€äº›**çš„å†…å®¹</p><p>æ­¤æ—¶ï¼Œè¦æ˜¯æœ‰ä¸€åªåä¸º<code>Human</code>çš„ç”Ÿç‰©è¿›å…¥ï¼Œ<code>You</code>åˆ™ä¼šç«‹åˆ»ç¤¾ä¼šæ€§æ­»äº¡</p><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦ï¼šå¿«é€Ÿåˆ‡æ¢éŸ³é¢‘è¾“å‡ºè®¾å¤‡ï¼ˆbetween æ‰¬å£°å™¨ &amp; è€³æœºï¼‰</p><blockquote><p>But How to make it programmatically?</p></blockquote><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><ol><li>è·å–æ‰€æœ‰éŸ³é¢‘è¾“å‡ºè®¾å¤‡</li><li>åˆ‡æ¢éŸ³é¢‘è¾“å‡ºè®¾å¤‡</li></ol><p>é’ˆå¯¹<strong>ç¬¬ä¸€ç‚¹</strong>ï¼Œ<code>Qt</code>æä¾›äº†å¿«æ·æ–¹æ¡ˆï¼ˆ<code>QAudioDeviceInfo</code>ï¼‰ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QStringList <span class="hljs-title">Win::validAudioOutputDevices</span><span class="hljs-params">()</span> <span class="hljs-comment">//ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯å½“å‰è®¾å¤‡</span></span><br><span class="hljs-function"></span>&#123;<br>    QStringList devList;<br>    QList&lt;QAudioDeviceInfo&gt; audioDeviceList = QAudioDeviceInfo::<span class="hljs-built_in">availableDevices</span>(QAudio::AudioOutput);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; dev : <span class="hljs-built_in">qAsConst</span>(audioDeviceList)) &#123;<br>        <span class="hljs-type">const</span> QString&amp; name = dev.<span class="hljs-built_in">deviceName</span>();<br>        <span class="hljs-type">int</span> index = name.<span class="hljs-built_in">lastIndexOf</span>(<span class="hljs-string">&quot; (&quot;</span>); <span class="hljs-comment">//&quot;è€³æœº (Realtek(R) Audio)&quot;-&gt;&quot;è€³æœº&quot;</span><br>        devList &lt;&lt; (index == <span class="hljs-number">-1</span> ? name : name.<span class="hljs-built_in">left</span>(index));<br>    &#125;<br>    <span class="hljs-keyword">return</span> devList;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>&quot;è€³æœº (Realtek(R) Audio)&quot;-&gt;&quot;è€³æœº&quot;</code>æ˜¯ä¸ºäº†ä¸‹ä¸€æ­¥ï¼Œåˆ‡æ¢éŸ³é¢‘è¾“å‡ºè®¾å¤‡åšå‡†å¤‡ï¼ˆåŒæ—¶ä¹Ÿä¸ºä¸€åˆ‡åŸ‹ä¸‹äº†éšæ‚£ï¼‰</p><p><strong>ç¬¬äºŒç‚¹</strong>ï¼Œåˆ‡æ¢éŸ³é¢‘è®¾å¤‡ï¼Œè¯´å®è¯ï¼Œ<code>Qt</code>æ²¡æœ‰ä»€ä¹ˆåŠæ³•ï¼ˆä¸åˆç†å•Šå–‚ï¼Œèƒ½è·å–ä¸ºä»€ä¹ˆä¸èƒ½åˆ‡æ¢ï¼‰ï¼Œ<code>Windows API</code>é‡Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¾¿æ·çš„åŠæ³•ï¼Œå¯„</p><p>ä½†æ˜¯ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªç¬¬ä¸‰æ–¹å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥æä¾›åˆ‡æ¢åŠŸèƒ½ï¼š<code>nircmd.exe</code></p><p>ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">nircmd setdefaultsounddevice &quot;è€³æœº&quot; #ä¸åŒ…å«æ‹¬å·å†…çš„é¢å¤–ä¿¡æ¯(Realtek(R) Audio)<br></code></pre></td></tr></table></figure><p><code>Qt</code>å¼€å¯å¤–éƒ¨è¿›ç¨‹å¹¶ä¼ å‚ä¹Ÿä¸æ˜¯ä»€ä¹ˆéš¾äº‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Win::setActiveAudioOutputDevice</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; name)</span></span><br><span class="hljs-function"></span>&#123;<br>    QProcess pro;<br>    pro.<span class="hljs-built_in">setProgram</span>(<span class="hljs-string">&quot;nircmd&quot;</span>);<br>    pro.<span class="hljs-built_in">setArguments</span>(<span class="hljs-built_in">QStringList</span>() &lt;&lt; <span class="hljs-string">&quot;setdefaultsounddevice&quot;</span> &lt;&lt; name);<br>    pro.<span class="hljs-built_in">start</span>();<br>    pro.<span class="hljs-built_in">waitForFinished</span>(<span class="hljs-number">2000</span>);<br>    <span class="hljs-built_in">qDebug</span>() &lt;&lt; <span class="hljs-string">&quot;#Changed Audio Output Device:&quot;</span> &lt;&lt; name;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹‹åï¼Œåˆ‡æ¢çš„é€»è¾‘ä¸ç”¨æˆ‘è¯´å§</p><p>Okayï¼Œå·²ç»ç»“æŸäº†ï¼Œå°±è¿™ä¹ˆç®€å•ï¼Œæ•£äº†æ•£äº†</p><h3 id="å’Œå¹³æå«è€…"><a href="#å’Œå¹³æå«è€…" class="headerlink" title="å’Œå¹³æå«è€…"></a>å’Œå¹³æå«è€…</h3><p>å°±è¿™æ ·ï¼Œæˆ‘å¿«ä¹åœ°ç”¨ç€è¿™ä¸ªç¨‹åºï¼Œå¿«ä¹åœ°åœ¨æ‰¬å£°å™¨ &amp; è€³æœºé—´åå¤æ¨ªè·³ï¼Œå¥½ä¸å¿«æ´»</p><p>ä¸€åˆ‡éƒ½æ˜¯é‚£ä¹ˆç¾å¥½</p><p>ç›´åˆ°æœ‰ä¸€å¤©ï¼Œæˆ‘å‘<code>Darli</code>å€Ÿäº†ä¸€å¯¹<code>airpods</code>ï¼Œåº“å…‹ä¾¿å‘Šè¯‰äº†æˆ‘ï¼Œä»€ä¹ˆå«å¹´è½»</p><h3 id="ä¸œçª—äº‹å‘"><a href="#ä¸œçª—äº‹å‘" class="headerlink" title="ä¸œçª—äº‹å‘"></a>ä¸œçª—äº‹å‘</h3><p>å½“æˆ‘å¿«ä¹åœ°å°†<code>airpods</code>è¿ä¸Š<code>PC(Windows)</code>ï¼Œä¾¿å‘ç°<code>airpods</code>çš„å®Œæ•´è®¾å¤‡åå«åšï¼šè€³æœº (Airpods)</p><p>â€¦</p><p>å¥½çš„ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸‰ä¸ªéŸ³é¢‘è¾“å‡ºè®¾å¤‡ï¼š</p><ul><li>æ‰¬å£°å™¨ (Realtek(R) Audio)</li><li>è€³æœº (Realtek(R) Audio)</li><li>è€³æœº (Airpods)</li></ul><p>è€Œ<code>nircmd</code>åœ¨åˆ‡æ¢è®¾å¤‡æ—¶ï¼Œä¸éœ€è¦æ‹¬å·ä¸­çš„é¢å¤–å†…å®¹ï¼Œåªéœ€è¦è®¾å¤‡åï¼šâ€è€³æœºâ€</p><p>è¿™ä¸å°±è›‹ç³•äº†å˜›ï¼Œè¿™æœ‰ä¿©è€³æœºå‘€ï¼ŒäºŒä¹‰æ€§ï¼</p><p>æ ¹æ®æˆ‘å¤šå¹´ç¨‹åºå‘˜çš„ç›´è§‰æ¥çœ‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä½†æ˜¯æ˜¾ç„¶<code>QAudioDeviceInfo</code>å¹¶æ²¡æœ‰æä¾›ç›¸å…³<code>API</code></p><p>å¥½çš„ï¼Œä¸¤ä¸ª<code>parts</code>ï¼Œè·å–å’Œåˆ‡æ¢ï¼Œéƒ½å¯„äº†</p><h2 id="æ­£ç‰‡ï¼ˆå åº•"><a href="#æ­£ç‰‡ï¼ˆå åº•" class="headerlink" title="æ­£ç‰‡ï¼ˆå åº•"></a>æ­£ç‰‡ï¼ˆå åº•</h2><p>å¥½çš„ï¼Œå¼€å§‹é¢å‘æµè§ˆå™¨ç¼–ç¨‹</p><p>æ‰“å¼€<code>Edge</code>ï¼Œæ‰“å¼€<code>Bing</code>ï¼Œæœç´¢ï¼šWindows C++ åˆ‡æ¢éŸ³é¢‘è¾“å‡ºè®¾å¤‡</p><p>ã‚ã£ãŸ</p><p><a href="https://blog.csdn.net/wangkui1331/article/details/78618310">windowsä»£ç è®¾ç½®é»˜è®¤éŸ³é¢‘è¾“å‡ºè®¾å¤‡_kevinâ€“ä½ ä¸çŸ¥é“çš„äº‹çš„åšå®¢-CSDNåšå®¢</a></p><p>å¯ä»¥çœ‹åˆ°æœ‰äº¿ç‚¹ç‚¹å¤æ‚å‘€ï¼Œè€Œä¸”ç”¨åˆ°äº†<a href="https://baike.baidu.com/item/COM%E7%BB%84%E4%BB%B6/3351509">COMç»„ä»¶</a></p><p>ä¸è¿‡é—®é¢˜ä¸å¤§ï¼Œtalk is cheapï¼Œè¿™ä»£ç éƒ½æœ‰äº†ï¼Œè¿˜èƒ½å‡ºå•¥å¹ºè›¾å­</p><blockquote><p>æ’ç”µ - å¼€æœºï¼</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="hljs-title">SetDefaultEndpoint</span><span class="hljs-params">( <span class="hljs-comment">//comæ¥å£å£°æ˜</span></span></span><br><span class="hljs-params"><span class="hljs-function">        __in PCWSTR wszDeviceId,</span></span><br><span class="hljs-params"><span class="hljs-function">        __in ERole eRole </span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>;<br></code></pre></td></tr></table></figure><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">Warning: &#x27;__in&#x27; has not been declared<br></code></pre></td></tr></table></figure><blockquote><p>çœ‹èµ·æ¥æ²¡å•¥ç”¨ ä¸å¦‚åˆ äº† __in</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++">HRESULT hr = <span class="hljs-built_in">CoCreateInstance</span>(__uuidof(CPolicyConfigVistaClient), <span class="hljs-literal">NULL</span>, CLSCTX_ALL, __uuidof(IPolicyConfigVista), (LPVOID *)&amp;pPolicyConfig);<br></code></pre></td></tr></table></figure><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">Warning: undefined reference to _GUID const&amp; __mingw_uuidof()<br></code></pre></td></tr></table></figure><p>aaaaa o(â•¥ï¹â•¥)o</p><p>æ‰“å¼€<code>Edge</code>ï¼Œæ‰“å¼€<code>Bing</code>ï¼Œæœç´¢ï¼šundefined reference to _GUID const&amp; __mingw_uuidof()</p><p><a href="https://blog.csdn.net/dyj095/article/details/114632051">Qt5+mingw åœ¨windowsç³»ç»Ÿä¸Šè°ƒç”¨COMæ§ä»¶æ—¶ï¼Œç”¨åˆ°__uuidof()æŠ¥undefined reference to _GUID const&amp; __mingw_uuidof()_dyj095çš„åšå®¢-CSDNåšå®¢</a></p><p>å—¯ï¼Œçœ‹èµ·æ¥å¾ˆæœ‰é“ç†ï¼Œè¯•è¯•ï¼šWarning Warning</p><blockquote><p>çœŸæ˜¯å±±ç©·æ°´å¤ç–‘æ— è·¯ï¼ŒæŸ³æš—èŠ±æ˜åˆä¸€å‘å•Š</p></blockquote><p>è›‹ç³•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">hr = pStore-&gt;<span class="hljs-built_in">GetValue</span>(PKEY_Device_FriendlyName, &amp;friendlyName);<br></code></pre></td></tr></table></figure><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">Warning:</span> undefined reference <span class="hljs-keyword">to</span> `PKEY_Device_FriendlyName<span class="hljs-comment">&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="HowTime-Flies"><a href="#HowTime-Flies" class="headerlink" title="HowTime Flies"></a>HowTime Flies</h3><blockquote><p>æ—¶é—´å°±åƒæµ·ç»µé‡Œçš„æ°´ï¼Œåªè¦ä½ æ„¿æ„æŒ¤ï¼Œæ€»ä¼šè¢«ä½ æŒ¤å®Œçš„</p></blockquote><p>ä¸çŸ¥é“è¿‡äº†å¤šä¹…</p><blockquote><p>å²æœˆä¸å ªæ•°ï¼Œæ•…äººä¸å¦‚åˆ</p></blockquote><blockquote><p>åæ¥ï¼Œå—å±±çš„é£å¹æ•£äº†è°·å †ï¼ŒåŒ—æµ·çš„æ°´æ·¹æ²¡äº†å¢“ç¢‘</p></blockquote><p>æˆ‘è¿˜æ˜¯TMDé€šä¸è¿‡ç¼–è¯‘</p><p>æˆ‘ç»ˆäºæ˜ç™½äº†ï¼Œæ‰€è°“<code>MinGW</code>ç¼–è¯‘å™¨å’Œ<code>Windows</code>ç›¸æ€§å·®æ˜¯æ€ä¹ˆä¸€å›äº‹äº†</p><blockquote><p>CDSNç½‘å‹æœ‰äº‘ï¼šå¦‚æœæ˜¯åœ¨QTä¸­è¿›è¡ŒCOMç¼–ç¨‹ï¼Œåˆ™QTçš„ç¼–è¯‘å¥—ä»¶å¿…é¡»ä¸º MSVC</p></blockquote><p>å…³äºMinGWå’ŒMSVCç¼–è¯‘å™¨çš„åŒºåˆ«ï¼Œå¯ä»¥çœ‹æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ï¼š<a href="https://mrbeancpp.github.io/2022/10/09/Qt%E7%BC%96%E8%AF%91%E5%99%A8%E8%BF%81%E7%A7%BB%EF%BC%9A%E4%BB%8EMinGW%E5%88%B0MSVC/">Qtç¼–è¯‘å™¨è¿ç§»ï¼šä»MinGWåˆ°MSVC - MrBeanC-Blog (mrbeancpp.github.io)</a></p><p>æˆ‘ç»ˆäºæ˜ç™½äº†ï¼Œæ˜¯æ—¶å€™è¯¥æ¢ç¼–è¯‘å™¨äº†</p><h3 id="å¤§æ¸…è¿˜æœªäº¡å‘¢"><a href="#å¤§æ¸…è¿˜æœªäº¡å‘¢" class="headerlink" title="å¤§æ¸…è¿˜æœªäº¡å‘¢"></a>å¤§æ¸…è¿˜æœªäº¡å‘¢</h3><p>ç­‰ï¼Œä¸€ä¸‹</p><p>æˆ‘æ˜¯å¦å¯ä»¥ç”¨<code>VS</code>å°†ä»£ç å°è£…ä¸º<code>dll</code>ï¼Œä¾›<code>Qt</code>é“¾æ¥ä½¿ç”¨å‘¢</p><p><a href="https://blog.csdn.net/qq_41688035/article/details/113755872">VS 2017 å¯¼å‡ºdll</a>ï¼ˆæ³¨æ„ä½¿ç”¨.hæ—¶ï¼Œè¦å»æ‰<code>__declspec(dllexport)</code> æˆ– æ”¹ä¸º<code>__declspec(dllimport)</code>ï¼‰</p><p><code>VS</code>æ˜¯å¾®è½¯çš„äº²å„¿å­ï¼Œç”¨çš„ä¹Ÿæ˜¯<code>MSVC</code>ç¼–è¯‘å™¨ï¼Œç¼–è¯‘ä»¥ä¸Šä»£ç é‚£æ˜¯å¦‚é±¼å¾—æ°´</p><p>ä¸‰ä¸‹äº”é™¤äºŒï¼Œ<code>dll</code>ï¼Œ<code>lib</code>ï¼Œ<code>h</code>æ–°é²œå‡ºç‚‰</p><p>å¯¼å…¥<code>Qt</code>ï¼</p><p>å®ï¼Œé“¾æ¥å¤±è´¥</p><p>åŸæ¥ï¼Œ<code>C++</code>çš„<code>dll</code>åœ¨ä¸åŒç¼–è¯‘å™¨ä¸­å‘½åæ–¹å¼ä¸åŒï¼Œä¸èƒ½è·¨ç¼–è¯‘å™¨ä½¿ç”¨ï¼Œåªèƒ½åŠ ä¸Š<code>extern&quot;C&quot;</code>æ ‡å¿—ï¼Œä»¥Cæ–¹å¼å¯¼å‡ºï¼Œä½†æ˜¯é™åˆ¶äº†åªèƒ½ä½¿ç”¨Cè¯­è¨€ </p><p>è¿™â€¦.</p><p>noooooooooooooooooooooooooooooooooooo</p><p>æ”¹å†™ä¸ºCï¼Œè¿˜æ˜¯å¦å¯»å‡ºå…¥ï¼Œè”¡å…ˆç”Ÿé™·å…¥äº†è¿·èŒ«</p><p>èº²å¾—è¿‡åˆä¸€ï¼Œèº²ä¸è¿‡åäº”å•Šï¼Œä»ŠæœClangï¼Œåæœ(chao)å¯æ€ä¹ˆåŠå‘¢</p><p>ä¸èƒ½å¦¥åï¼</p><h4 id="å°å°å°è¡¥å……"><a href="#å°å°å°è¡¥å……" class="headerlink" title="å°å°å°è¡¥å……"></a>å°å°å°è¡¥å……</h4><ul><li>å°è£…ä¸º<code>exe</code>åˆ™ä¸å­˜åœ¨ä»¥ä¸Šé—®é¢˜ï¼Œå‚è€ƒ<code>nircmd.exe</code>ï¼Œä½†æ˜¯å¼€å¯å¤–éƒ¨è¿›ç¨‹æ•ˆç‡è¾ƒä½</li><li>æ³¨å†Œä¸ºCOMç»„ä»¶ï¼Œä¾›Qtè°ƒç”¨ï¼ˆç­‰ä¸€ä¸‹ Qtä¸æ˜¯ç¼–è¯‘ä¸è¿‡å˜›ï¼ˆä½†æ˜¯è²Œä¼¼æœ‰ä»€ä¹ˆActiveXç±»ï¼Œè²Œä¼¼ï¼Œè²Œä¼¼ï¼Œå†è¯´ï¼‰ï¼‰</li></ul><h3 id="å¤§æ˜è¿˜åšæŒºå‘¢"><a href="#å¤§æ˜è¿˜åšæŒºå‘¢" class="headerlink" title="å¤§æ˜è¿˜åšæŒºå‘¢"></a>å¤§æ˜è¿˜åšæŒºå‘¢</h3><p>éš¾é“ï¼ŒçœŸçš„è¦æ¢<code>MSVC</code>ç¼–è¯‘å™¨äº†å—ï¼Œwww</p><p><code>Qt + VS</code>è”åˆå¼€å‘å—ï¼Œå“</p><ul><li>ä¸‹è½½VSï¼ˆ2022ï¼‰çš„<code>Qt VS Tool</code></li><li>åœ¨<code>Qt</code>ä¸­æ·»åŠ <code>MSVC</code>å¥—ä»¶</li></ul><p>åœ¨<code>VS</code>ä¸­æ–°å»º<code>Qt</code>é¡¹ç›®ï¼Œç†Ÿæ‚‰ï¼Œè€Œåˆé™Œç”Ÿ</p><p><code>VS</code>ä¸­çš„<code>Qt</code>é¡¹ç›®æ²¡æœ‰<code>.pro</code>æ–‡ä»¶ï¼Œæ€ä¹ˆçœ‹éƒ½ä¸åƒæ˜¯äº²ç”Ÿçš„</p><p>ä¸€çœ‹æ–‡ä»¶å¤¹ï¼Œå¥½å®¶ä¼™ï¼Œä¸€ä¸ªç©ºé¡¹ç›®è¶³è¶³<code>204MB</code>ï¼Œä¸æ„§æ˜¯<code>VS</code>ï¼ˆé‡Œé¢å…¨æ˜¯æ–‡ä»¶ç´¢å¼•ä¹‹ç±»çš„æ•°æ®åº“ï¼‰</p><p>æˆåŠŸäº†å—ï¼Œä½†ä¸ºä»€ä¹ˆæˆ‘å´ä¸€ç‚¹ä¹Ÿå¼€å¿ƒä¸èµ·æ¥å‘¢</p><p>ä¸ï¼Œè¿™ä¸æ˜¯æˆ‘ç†Ÿæ‚‰çš„<code>Qt</code>ï¼Œåˆå¤§åˆä¸å®Œæ•´ï¼Œnoooooooooooo</p><blockquote><p>æˆ‘è¦ï¼Œæˆ‘è¦ï¼Œæˆ‘å°±è¦æ—ºæ—ºç¢å†°å†°</p></blockquote><h3 id="Chinaï¼"><a href="#Chinaï¼" class="headerlink" title="Chinaï¼"></a>Chinaï¼</h3><p>ä¸ï¼Œæˆ‘ä¸ç”˜å¿ƒï¼Œä¸å°±æ˜¯ä¸ª<code>MSVC</code>ç¼–è¯‘å™¨å—ï¼Œè·Ÿæˆ‘<code>Qt Creator</code>ç¼–è¾‘å™¨æœ‰ä»€ä¹ˆå…³ç³»</p><p>æˆ‘ä¸ç›¸ä¿¡ï¼</p><blockquote><p>æ’ç”µ - å¼€æœºï¼</p></blockquote><p>åˆ‡æ¢<code>MSVC</code>ç¼–è¯‘å¥—ä»¶ï¼</p><p><img src="/img/image-20221010144059972.png" alt="åˆ‡æ¢å¥—ä»¶"></p><p>è¯¶ï¼Œæˆäº†ï¼Ÿæˆäº†ï¼</p><p>WTF</p><h3 id="å°ä¸‘ç«Ÿæ˜¯æˆ‘è‡ªå·±"><a href="#å°ä¸‘ç«Ÿæ˜¯æˆ‘è‡ªå·±" class="headerlink" title="å°ä¸‘ç«Ÿæ˜¯æˆ‘è‡ªå·±"></a>å°ä¸‘ç«Ÿæ˜¯æˆ‘è‡ªå·±</h3><p>å•Šï¼Œç„¯ï¼ŒåŸæ¥æ ¹æœ¬ä¸éœ€è¦<code>VS</code></p><p><code>Qt + MSVC</code> in <code>Windows</code> yyds</p><blockquote><p>ç¼–è¯‘ - è¿è¡Œï¼çˆ½</p></blockquote><h3 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h3><p>å…·ä½“åˆ‡æ¢æ­¥éª¤å‚è€ƒä¸Šä¸€ç¯‡blog</p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://www.zhihu.com/question/40225132">æœ‰å“ªäº›æè¿°æ—¶é—´è¿‡å¾—å¿«çš„å¥½å¥å­ï¼Ÿ - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://blog.csdn.net/pigautumn/article/details/94381624">C++è·å–WindowséŸ³é¢‘è®¾å¤‡åˆ—è¡¨_xhuboboçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://www.cnblogs.com/findumars/p/8001358.html">QT è°ƒç”¨ DLL æ–¹æ³•ï¼ˆä¸‰ç§æ–¹æ³•ï¼‰ - findumars - åšå®¢å›­</a></p><p><a href="https://www.cnblogs.com/sankye/p/5951852.html">QTæ€»ç»“ç¬¬3ç¯‡ï¼šå¦‚ä½•åœ¨QTä¸­æ·»åŠ .libï¼Œ.dllè¿˜æœ‰.hæ–‡ä»¶ - Sankye - åšå®¢å›­</a></p><p><a href="https://blog.csdn.net/Dorthyn/article/details/116224270">Qt åŠ è½½VSç”Ÿæˆçš„C&#x2F;C++ dll_Dorthynçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/qq_40285839/article/details/82657867">QTè°ƒç”¨VSç”Ÿæˆçš„DLLï¼ˆæ— å¤´æ–‡ä»¶ï¼‰_qq_40285839çš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/qq_41688035/article/details/113755872">VS 2017 DLLæ–‡ä»¶çš„å¯¼å‡ºåˆ°è°ƒç”¨æ­¥éª¤_å˜å˜£è„†341çš„åšå®¢-CSDNåšå®¢_vså¯¼å‡ºdll</a></p><p><a href="https://www.itbaoku.cn/post/492615.html">QT5+å¦‚ä½•ä¸ºQMediaPlayerè®¾ç½®é»˜è®¤éŸ³é¢‘è®¾å¤‡ - ITå®åº“ (itbaoku.cn)</a></p><p><a href="https://xiaolong.blog.csdn.net/article/details/113127300">QTåº”ç”¨ç¼–ç¨‹: windowsä¸‹QTè°ƒç”¨COMç»„ä»¶å¹¶é›†æˆåˆ°QTç•Œé¢_DSå°é¾™å“¥çš„åšå®¢-CSDNåšå®¢_qt è°ƒç”¨com</a></p><p><a href="https://blog.csdn.net/dyj095/article/details/114632051">Qt5+mingw åœ¨windowsç³»ç»Ÿä¸Šè°ƒç”¨COMæ§ä»¶æ—¶ï¼Œç”¨åˆ°__uuidof()æŠ¥undefined reference to _GUID const&amp; __mingw_uuidof()_dyj095çš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/bailang_zhizun/article/details/117779762?spm=1001.2014.3001.5502">QT - QTä¸­çš„COMç¼–ç¨‹ï¼ˆexeè¿›ç¨‹å¤–ç»„ä»¶å½¢å¼ï¼‰_bailang_zhizunçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://github.com/Belphemur/AudioEndPointLibrary">Belphemur&#x2F;AudioEndPointLibrary: A library based on DefSound to provides access to Default Sound Devices. (github.com)</a></p><p><a href="https://github.com/frgnca/AudioDeviceCmdlets">frgnca&#x2F;AudioDeviceCmdlets: AudioDeviceCmdlets is a suite of PowerShell Cmdlets to control audio devices on Windows (github.com)</a></p><p><a href="https://www.cnblogs.com/zzr-stdio/p/16289725.html">C++è®¾ç½®é»˜è®¤å£°éŸ³è¾“å‡ºè®¾å¤‡(SetDefaultAudioPlaybackDevice) - è¿™ç§äºº - åšå®¢å›­</a></p><p><a href="https://download.csdn.net/download/hx0318/10581431">C++ä¿®æ”¹é»˜è®¤éŸ³é¢‘è¾“å‡ºè®¾å¤‡_cåˆ‡æ¢éŸ³é¢‘è¾“å‡ºè®¾å¤‡-C++ä»£ç ç±»èµ„æº-CSDNæ–‡åº“</a></p><p><a href="https://blog.csdn.net/wangkui1331/article/details/78618310">windowsä»£ç è®¾ç½®é»˜è®¤éŸ³é¢‘è¾“å‡ºè®¾å¤‡_kevinâ€“ä½ ä¸çŸ¥é“çš„äº‹çš„åšå®¢-CSDNåšå®¢</a></p><p><a href="http://www.nirsoft.net/utils/nircmd.html">NirCmd - Windows command line tool (nirsoft.net)</a></p><p><a href="http://www.nirsoft.net/utils/sound_volume_view.html#command_line">View &#x2F; change sound volume on Windows from command line or GUI (nirsoft.net)</a></p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>Windows</tag>
      
      <tag>MinGW</tag>
      
      <tag>MSVC</tag>
      
      <tag>dll</tag>
      
      <tag>VS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Qtç¼–è¯‘å™¨è¿ç§»ï¼šä»MinGWåˆ°MSVC</title>
    <link href="/2022/10/09/Qt%E7%BC%96%E8%AF%91%E5%99%A8%E8%BF%81%E7%A7%BB%EF%BC%9A%E4%BB%8EMinGW%E5%88%B0MSVC/"/>
    <url>/2022/10/09/Qt%E7%BC%96%E8%AF%91%E5%99%A8%E8%BF%81%E7%A7%BB%EF%BC%9A%E4%BB%8EMinGW%E5%88%B0MSVC/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Qt</code>æ”¯æŒä¸¤ç§ç¼–è¯‘å™¨</p><ul><li>MSVCï¼ˆMicrosoft Visual C++ Compilerï¼‰ï¼šå¾®è½¯çš„VCç¼–è¯‘å™¨ï¼Œå¦‚VSä¸­è‡ªå¸¦</li><li>MinGWï¼ˆMinimalist GNU for Windowsï¼‰ï¼šæ˜¯å°†GNUå¼€å‘å·¥å…·ç§»æ¤åˆ°Win32å¹³å°ä¸‹çš„äº§ç‰©</li></ul><h3 id="ç–¯ç›å‰ï¼šé€‰æ‹©ï¼"><a href="#ç–¯ç›å‰ï¼šé€‰æ‹©ï¼" class="headerlink" title="ç–¯ç›å‰ï¼šé€‰æ‹©ï¼"></a>ç–¯ç›å‰ï¼šé€‰æ‹©ï¼</h3><p>é‚£ä¹ˆï¼Œé—®é¢˜æ¥äº†ï¼Œå°å­©å­æ‰å…¨éƒ½è¦ï¼Œå¤§äººå¿…é¡»å¾—é€‰ä¸€ä¸ªäº†</p><p>ä¸ºä»€ä¹ˆè¦é€‰å‘¢</p><p><strong>ç¬¬ä¸€ä¸ªé—®é¢˜</strong>åœ¨äºï¼Œ<code>MSVC</code>å’Œ<code>MinGW</code>ç¼–è¯‘çš„<code>dll</code>é€šå¸¸ä¸å…¼å®¹ï¼Œä¸èƒ½ç›¸äº’è°ƒç”¨ï¼Œè¿™å†³å®šäº†ä½ èƒ½ç”¨å¤šå°‘ç¬¬ä¸‰æ–¹åº“</p><ul><li>åœ¨<code>Windows</code>ä¸‹ï¼Œ<code>MSVC</code>ç¼–è¯‘çš„åº“æ›´å¤š</li><li>ä½†æ˜¯<code>MinGW</code>çš„åº“èƒ½è·¨å¹³å°ï¼ˆ<code>Linux</code>ï¼‰</li></ul><p>æ‰€ä»¥ä½ ç”¨å“ªä¸ªç¼–è¯‘ä¸å–å†³äºä½ æƒ³ç”¨å“ªä¸ªï¼Œå–å†³äºä½ ä¹ æƒ¯ç”¨æ¥è‡ªå“ªä¸ªå¹³å°çš„ç¬¬ä¸‰æ–¹åº“</p><p><strong>å…¶æ¬¡</strong>ï¼Œ<code>MSVC</code>ï¼Œä¸€å¬å°±æ˜¯å¾®è½¯å®¶çš„ï¼Œ<code>Windows</code>ä¹Ÿæ˜¯å¾®è½¯å®¶çš„ï¼Œäº²ç”Ÿçš„ç¼–è¯‘å™¨ä¸ç”¨æˆ‘å¤šè¯´å§ï¼ˆä¾‹å¦‚ä¸€äº›<code>COM</code>ç»„ä»¶çš„æ“ä½œåœ¨<code>MinGW</code>ä¸­å°±æ­»æ´»ä¸èƒ½é€šè¿‡ï¼‰</p><p>æ€»ç»“ï¼š</p><ul><li><code>Windows</code>å¹³å°é€‰<code>MSVC</code></li><li>è·¨å¹³å°é€‰<code>MinGW</code></li></ul><h3 id="ç–¯ç›å‰ï¼šå†é€‰æ‹©ï¼"><a href="#ç–¯ç›å‰ï¼šå†é€‰æ‹©ï¼" class="headerlink" title="ç–¯ç›å‰ï¼šå†é€‰æ‹©ï¼"></a>ç–¯ç›å‰ï¼šå†é€‰æ‹©ï¼</h3><p>é™¤äº†ä¸¤ç§ç¼–è¯‘å™¨ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸‰ç§å¼€å‘æ–¹å¼</p><p><img src="/img/image-20221009210739958.png" alt="å¯¹æ¯”"></p><p>åœ¨VSä¸­å¯ä»¥æ›´å¥½åœ°è¿›è¡Œè°ƒè¯•ï¼Œä½†æ˜¯æ¯•ç«Ÿä¸æ˜¯åŸç”Ÿæ–¹å¼ï¼Œå¤šå°‘æœ‰ç‚¹é—®é¢˜å°‘å¹´äº†</p><p>ä¸€èˆ¬é€‰æ‹©<code>QtCreator + MSVC</code>æ–¹å¼è¿›è¡Œ<code>Windows</code>å¼€å‘</p><h2 id="æ­£ç‰‡ï¼ˆå åº•"><a href="#æ­£ç‰‡ï¼ˆå åº•" class="headerlink" title="æ­£ç‰‡ï¼ˆå åº•"></a>æ­£ç‰‡ï¼ˆå åº•</h2><p>è¯¶ï¼Œé‚£ä½ è¯´ï¼Œæˆ‘ä½œä¸ºä¸€ä¸ª<code>Windows</code>ç¨‹åºå‘˜ï¼Œæ—¢ç„¶é€‰æ‹©<code>QtCreator + MSVC</code>æ— ç–‘ï¼Œä¸ºä»€ä¹ˆä¼šå†™ä¸‹è¿™ç¯‡è¿ç§»åšå®¢å‘¢ï¼Ÿ</p><p>å’³å’³</p><p>è¯´æ¥æƒ­æ„§ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸º<code>MSVC</code>å¿…é¡»è¦ç”¨<code>VS</code>é…åˆå¼€å‘ï¼Œå°±â€¦â€¦</p><p>å®³ï¼Œè¯´å¤šäº†éƒ½æ˜¯æ³ª</p><h2 id="è¿å¾™ï¼"><a href="#è¿å¾™ï¼" class="headerlink" title="è¿å¾™ï¼"></a>è¿å¾™ï¼</h2><p>é‚£ä¹ˆï¼Œåœ¨<code>Qt Creator</code>ä¸‹ï¼Œå¦‚ä½•ä»<code>MinGW</code>åˆ‡æ¢ä¸º<code>MSVC</code>å‘¢</p><p>å…¶å®è¯´æ¥ä¹Ÿç®€å•ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>Qt</code>çš„<code>MaintenanceTool.exe</code>ä¸­æ·»åŠ <code>MSVC</code>ç»„ä»¶ï¼ˆåŒ…å«MSVCç‰ˆæœ¬çš„dllï¼‰</p><p><img src="/img/image-20221009211741210.png" alt="Qtç»´æŠ¤å·¥å…·"></p><p>å…¶æ¬¡ï¼Œéœ€è¦ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„<code>VS</code>ï¼ˆåœ¨è¯¥ä¾‹ä¸­ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯2022ç‰ˆä¹Ÿok hhhï¼‰</p><p>è¿™æ ·ï¼Œ<code>Qt</code>å°±èƒ½è‡ªåŠ¨æ£€æµ‹åˆ°<code>VS</code>ä¸­çš„<code>MSVC</code>ç¼–è¯‘å™¨å’Œ<code>debugger</code>äº†</p><p>ç„¶åå†é¡¹ç›®ä¸­å°±èƒ½çœ‹åˆ°<code>MSVC</code>å¥—ä»¶äº†ï¼Œç‚¹å‡»å³å¯åˆ‡æ¢</p><p><img src="/img/image-20221009212022400.png" alt="åˆ‡æ¢toolkit"></p><h2 id="å¤§é€¼å…œ"><a href="#å¤§é€¼å…œ" class="headerlink" title="å¤§é€¼å…œ"></a>å¤§é€¼å…œ</h2><p>è¿™å°±å®Œäº†ï¼Ÿæƒ³å¾—ç¾ï¼Œè¿™æ‰å“ªåˆ°å“ªï¼Œä¹Ÿå°±ç®—æ˜¯åˆšåœ¨è€ƒå·ä¸Šå†™å®Œç­çº§å§“åå§</p><p>è¿é¢è€Œæ¥çš„æ˜¯æ»¡å±çš„<code>Warning</code>å’Œ<code>Error</code></p><h3 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h3><p>å…¶ä¸­æœ€æ˜¾çœ¼çš„ä¾¿æ˜¯</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">warning</span> C4819: è¯¥æ–‡ä»¶åŒ…å«ä¸èƒ½åœ¨å½“å‰ä»£ç é¡µ(936)ä¸­è¡¨ç¤ºçš„å­—ç¬¦ã€‚è¯·å°†è¯¥æ–‡ä»¶ä¿å­˜ä¸º Unicode æ ¼å¼ä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ç”±äº<code>MSVC</code>é»˜è®¤åªæ”¯æŒ<code>UTF-8(with BOM)</code>ï¼Œè€Œ<code>MinGW</code>çš„åŸå§‹ç¼–ç å¯èƒ½æ˜¯<code>UFT-8</code>ï¼Œå¯¼è‡´äº†ç¼–ç ä¸å…¼å®¹</p><p>å…¶ä¸­ä¸€ä¸ªåŠæ³•æ˜¯æ›´æ”¹æºæ–‡ä»¶ç¼–ç ï¼Œä½†è´¹æ—¶è´¹åŠ›ï¼Œè€Œä¸”åŸå§‹çš„ä¸­æ–‡å¯èƒ½ç¼–è¯‘åæ˜¯ä¹±ç ï¼ˆæ–‡ä»¶ä¸­çœ‹ä¸å‡ºæ¥ï¼‰</p><p>ç»ˆæè§£å†³æ–¹æ¡ˆåº”è¯¥æ˜¯åœ¨<code>.pro</code>æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs qmake">msvc &#123;<br>    QMAKE_CFLAGS += /utf-8<br>    QMAKE_CXXFLAGS += /utf-8<br>&#125;<br></code></pre></td></tr></table></figure><p>å¼ºåˆ¶<code>MSVC</code>é‡‡ç”¨<code>utf-8</code>ç¼–è¯‘</p><h3 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h3><p>åœ¨ç°æœ‰å·¥ç¨‹ä¸­ç›´æ¥åˆ‡æ¢ä¸º<code>MSVC</code>è¿˜ä¼šå¯¼è‡´ç¼–è¯‘é—®é¢˜</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">error: </span>msvc-version.conf loaded but QMAKE_MSC_VER isn&#x27;t set<br></code></pre></td></tr></table></figure><p>è¿˜ä¼šå¯¼è‡´è¯†åˆ«ä¸åˆ°é¡¹ç›®æ–‡ä»¶</p><p>è§£å†³åŠæ³•ï¼šæ‰‹åŠ¨æ¸…ç©ºå·¥ç¨‹åŸæ¥ç¼–è¯‘åç”Ÿæˆçš„æ–‡ä»¶å¤¹åŠæ–‡ä»¶ï¼Œé‡æ–°ç”Ÿæˆå·¥ç¨‹å³å¯</p><p>ï¼ˆç‰¹åˆ«æ˜¯ï¼š.stash Makefile ä¹‹ç±»çš„æ–‡ä»¶ï¼‰</p><h3 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h3><p>ç”±äº<code>MinGW</code>å’Œ<code>MSVC</code>çš„åŒºåˆ«ï¼ŒæŸäº›åº“å¯èƒ½é“¾æ¥å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨åœ¨<code>.pro</code>æ–‡ä»¶ä¸­åŠ å…¥<code>lib</code></p><p>å¦‚ï¼š<code>LIBS += -luser32</code></p><h3 id="dll"><a href="#dll" class="headerlink" title="dll"></a>dll</h3><p>ä»”ç»†è§‚å¯Ÿ<code>Qt</code>çš„<code>MinGW</code>å’Œ<code>MSVC</code>æ–‡ä»¶å¤¹ï¼Œä¼šå‘ç°ä»–ä»¬çš„<code>dll</code>ä¾èµ–éƒ½æ˜¯ä¸åŒçš„ï¼ˆåŒåä½†å†…å®¹ä¸åŒ æ¨æµ‹æ˜¯ç”¨å¯¹åº”ç¼–è¯‘å™¨ç¼–è¯‘çš„ï¼‰</p><p>å¹¶ä¸”<code>MSVC</code>çš„<code>dll</code>éƒ½æ˜¯æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„ï¼ˆReleaseå’ŒDebugï¼ˆæ–‡ä»¶å+dï¼‰ï¼‰</p><p>æ›´æœ‰ç”šè€…ï¼Œ<code>MSVC</code>çš„<code>plugins/audio</code>æ–‡ä»¶å¤¹å†…å±…ç„¶å¤šäº†ä¸€ä¸ª<code>qtaudio_wasapi.dll</code></p><p>å¯¼è‡´<code>QAudioDeviceInfo::availableDevices(QAudio::AudioOutput)</code>å¡é¡¿ï¼Œä¸”é‡å¤è¾“å‡ºéŸ³é¢‘è®¾å¤‡ï¼ˆè½¬æ¢ç¼–è¯‘å™¨åå‘ç°çš„ç¬¬ä¸€ä¸ªæ¶æ€§bugï¼‰</p><p>è§£å†³æ–¹æ¡ˆæ˜¯åˆ é™¤è¯¥<code>dll</code></p><p>æ€ªï¼ŒçœŸæ»´å¤ªæ€ªäº† å®¶äººä»¬</p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>ä¸è¿‡ï¼Œ<code>Qt Creator</code>åŸç”Ÿæ”¯æŒ<code>MSVC</code>ï¼Œä¸ç”¨è”åˆ<code>VS</code>äº†ï¼Œã‚ˆã‹ã£ãŸ www</p><p>æˆ‘çœŸå‚» çœŸçš„</p><p>Peace</p><h2 id="Careful"><a href="#Careful" class="headerlink" title="Careful"></a>Careful</h2><p>ä¸ºäº†è®©<code>exe</code>åœ¨éIDEç¯å¢ƒä¸‹è¿è¡Œï¼Œæˆ‘ä»¬é€šå¸¸éƒ½è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆ<code>PATH</code>ï¼‰</p><p>ä½†æ˜¯å½“<code>MinGW/bin</code>å’Œ<code>MSVC/bin</code>çš„ç¯å¢ƒå˜é‡å…±å­˜æ—¶</p><p>å…¶ä¸­çš„åŒå<code>dll</code>ä¼šäº§ç”Ÿè¯¯å¯¼å’Œå†²çªï¼Œ<code>exe</code>ä¼šè‡ªåŠ¨é€‰æ‹©<strong>é å‰</strong>çš„ç¯å¢ƒå˜é‡ä¸­çš„<code>dll</code></p><p>å¯¼è‡´ç¼–è¯‘å™¨ä¸åŒæ—¶äº§ç”Ÿé”™è¯¯ï¼ˆ<code>dll</code>ä¸é€šç”¨ï¼‰</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>æ”¹ç”¨åŒä¸€ä¸ªç¼–è¯‘å™¨</li><li>æ‹·è´<code>dll</code>è‡³<code>exe</code>åŒä¸€ç›®å½•ï¼ˆã‚„ã°ã„ï¼‰</li><li>æ‰‹åŠ¨è®¾ç½®<code>exe</code>ç¯å¢ƒå˜é‡</li></ul><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://blog.iamli.cc/archives/129#:~:text=MSVC%20%E4%B8%AD%E7%9A%84utf-8%E7%BC%96%E7%A0%81%E9%97%AE%E9%A2%98%20%2F,Qt%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98%20%E5%BD%93%E6%88%91%E4%BB%AC%E5%9C%A8VS%E9%87%8C%E9%9D%A2%E7%BC%96%E8%AF%91%E4%B8%80%E4%B8%AA%E4%BB%A5UTF8%E4%BF%9D%E5%AD%98%E7%9A%84c%E6%BA%90%E7%A8%8B%E5%BA%8F%E6%97%B6%EF%BC%8C%20MSVC%E4%BC%9A%E5%B0%86%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E7%BC%96%E7%A0%81%E4%BB%8EUTF8%E8%BD%AC%E6%8D%A2%E4%B8%BAANSI%E7%BC%96%E7%A0%81%20%28%E5%BD%93%E5%89%8D%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%A1%B5%E4%BB%A3%E7%A0%81%29">MSVC ä¸­çš„utf-8ç¼–ç é—®é¢˜ &#x2F; Qtä¸­æ–‡ä¹±ç é—®é¢˜ â€“ liçš„blog</a></p><p><a href="https://blog.csdn.net/lenkco/article/details/123932391">QT+MSVCçš„UTF-8é…ç½®ã€MSVCçš„UTF-8é…ç½®_lenkcoçš„åšå®¢-CSDNåšå®¢_msvc utf8</a></p><p><a href="https://blog.csdn.net/qq_43521843/article/details/116864525">Qtè®°å½•ï¼šQtç¼–ç¨‹é‡C2001é”™è¯¯ï¼Œæç¤ºâ€œå¸¸é‡ä¸­æœ‰æ¢è¡Œç¬¦â€_æ˜Ÿè¾°ä¸¶å¤§æµ·çš„åšå®¢-CSDNåšå®¢_qtå¸¸é‡ä¸­æœ‰æ¢è¡Œç¬¦</a></p><p><a href="https://blog.csdn.net/u013185164/article/details/48160561?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1-48160561-blog-80573034.pc_relevant_multi_platform_whitelistv3&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1-48160561-blog-80573034.pc_relevant_multi_platform_whitelistv3&utm_relevant_index=2">Qt MinGWä¸MSVCå¯¹æ¯”_16ernçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://www.zhihu.com/question/331375227">Qt ç”¨ MSVC å’Œ MinGW å“ªä¸ªç¼–è¯‘å™¨ç¼–è¯‘ç¨‹åºæ¯”è¾ƒå¥½ï¼Ÿ - çŸ¥ä¹</a></p><p><a href="https://blog.csdn.net/qq_38025219/article/details/105666735">Qtå°ç™½ä¹‹é€‰æ‹©ä½•ç§å¼€å‘æ–¹å¼ï¼ˆvs+qt or qt+mingw&#x2F;msvcï¼‰_è¡Œæ€åå¿†ï¼Œå¿—å‡Œäº‘çš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/m0_52040845/article/details/118761684">QAudioDeviceInfo::availableDevices è·å–è¯­éŸ³è¾“å…¥è®¾å¤‡é—®é¢˜_#è‹”èŠ±å¦‚ç±³å°#çš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/u011602263/article/details/103882827">Qtç¼–è¯‘é”™è¯¯ï¼š error: msvc-version.conf loaded but QMAKE_MSC_VER isnâ€™t set_é…·ä¾ ä¸€å‰‘ç»gghçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/u013245354/article/details/113772880">QtCreator + MSVCç¼–è¯‘å™¨å¼€å‘_feimimizhiyçš„åšå®¢-CSDNåšå®¢_qtcreatoré…ç½®ç¼–è¯‘å™¨</a></p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>Windows</tag>
      
      <tag>MinGW</tag>
      
      <tag>MSVC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring-AOP æ‚è°ˆå°è®°</title>
    <link href="/2022/09/16/Spring-AOP-%E6%9D%82%E8%B0%88%E5%B0%8F%E8%AE%B0/"/>
    <url>/2022/09/16/Spring-AOP-%E6%9D%82%E8%B0%88%E5%B0%8F%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>IOC(Inversion of Control)</code> &amp;&amp; <code>AOP(Aspect-Oriented Programming)</code>æ˜¯<code>Spring</code>çš„ä¸¤å¤§æ ¸å¿ƒ</p><p>è€Œ<code>AOP</code>åˆæ˜¯åŸºäº<code>IOC</code>çš„</p><p><code>AOP</code>ï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯<code>OOP</code>ï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰çš„æ‹“å±•å’Œå»¶ä¼¸ï¼Œæ˜¯è®¾è®¡æ¨¡å¼ä¸­<strong>ä»£ç†æ¨¡å¼</strong>çš„ä¸€ç§å®ç°</p><p><code>OOP</code>é€šå¸¸åªèƒ½å¯¹è¿ç»­ä»£ç è¿›è¡Œå°è£…ï¼Œè€Œç±»ä¼¼æ—¥å¿—è¿™æ ·åˆ†æ•£æ ¸å¿ƒä»£ç å‰åå„å¤„çš„éæ ¸å¿ƒä»£ç ï¼Œå´éš¾ä»¥å®ç°é›†ä¸­å¤„ç†ï¼Œæ˜¯ä¸€å¤§ç—›ç‚¹</p><p>å®˜æ–¹ä¸€ç‚¹å°±æ˜¯ï¼šå®ƒå°†ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä½¿å¾—ä¸šåŠ¡é€»è¾‘å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼Œä½¿å¼€å‘äººå‘˜åœ¨ç¼–å†™ä¸šåŠ¡é€»è¾‘æ—¶å¯ä»¥ä¸“å¿ƒäºæ ¸å¿ƒä¸šåŠ¡ï¼Œä»è€Œæé«˜äº†å¼€å‘æ•ˆç‡</p><p>äºæ˜¯ä¾¿æœ‰äº†<code>AOP</code></p><p><code>Spring</code>çš„<code>AOP</code>åŸºäº<code>AspectJ</code>ï¼Œå…·ä½“åº•å±‚å®ç°æœ‰ä¸¤ç§ï¼š</p><ul><li><code>JDK</code>åŸç”ŸåŠ¨æ€ä»£ç†ï¼ˆæœ‰æ¥å£çš„æƒ…å†µï¼‰ï¼šéœ€è¦è¢«ä»£ç†çš„ç›®æ ‡ç±»å¿…é¡»å®ç°æ¥å£ï¼Œå› ä¸ºè¿™ä¸ªæŠ€æœ¯è¦æ±‚<strong>ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡å®ç°åŒæ ·çš„æ¥å£</strong>ï¼ˆå…„å¼Ÿä¸¤ä¸ªæ‹œæŠŠå­æ¨¡å¼ï¼‰</li><li><code>cglib</code>ï¼ˆæ— æ¥å£çš„æƒ…å†µï¼‰ï¼šé€šè¿‡<strong>ç»§æ‰¿è¢«ä»£ç†çš„ç›®æ ‡ç±»</strong>ï¼ˆè®¤å¹²çˆ¹æ¨¡å¼ï¼‰å®ç°ä»£ç†ï¼Œæ‰€ä»¥ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ï¼Œä½†æ˜¯ä¸èƒ½å¯¹<code>final</code>æ–¹æ³•è¿›è¡Œä»£ç†ï¼›å…¶åº•å±‚ä½¿ç”¨å­—èŠ‚ç å¤„ç†æ¡†æ¶<code>ASM</code>ï¼Œæ¥è½¬æ¢å­—èŠ‚ç å¹¶ç”Ÿæˆæ–°çš„ç±»ï¼ˆæ•ˆç‡é«˜äºå‰è€…ï¼‰</li></ul><h2 id="æ­£ç‰‡ï¼ˆå åº•"><a href="#æ­£ç‰‡ï¼ˆå åº•" class="headerlink" title="æ­£ç‰‡ï¼ˆå åº•"></a>æ­£ç‰‡ï¼ˆå åº•</h2><p>å¥½çš„ï¼Œä¸Šé¢éƒ½æ˜¯å®˜æ–¹åºŸè¯</p><p>å‰æƒ…æè¦å•Šï¼Œå‰æƒ…æè¦</p><p>ï¼ˆç•¥è¿‡åˆ‡é¢çš„é…ç½®ï¼Œä½ ä»¬éƒ½æ‡‚çš„å¯¹å§ï¼‰</p><p>ç°åœ¨çš„ä¸»è¦é—®é¢˜æ˜¯å¦‚ä½•ä½¿ç”¨<code>AOP</code>ç”Ÿæˆçš„ä»£ç†ç±»å‘¢</p><p>ï¼ˆæˆ‘å‘ç°å¤§éƒ¨åˆ†éƒ½åœ¨è®²æ€ä¹ˆé…ç½® æ²¡è®²æ€ä¹ˆç”¨å•Šå¤§å“¥ï¼‰</p><h3 id="æœ‰æ¥å£çš„æƒ…å†µï¼ˆJDKåŠ¨æ€ä»£ç†ï¼‰"><a href="#æœ‰æ¥å£çš„æƒ…å†µï¼ˆJDKåŠ¨æ€ä»£ç†ï¼‰" class="headerlink" title="æœ‰æ¥å£çš„æƒ…å†µï¼ˆJDKåŠ¨æ€ä»£ç†ï¼‰"></a>æœ‰æ¥å£çš„æƒ…å†µï¼ˆJDKåŠ¨æ€ä»£ç†ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ioc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;spring-context.xml&quot;</span>);<br>    <span class="hljs-type">Calculator</span> <span class="hljs-variable">cal</span> <span class="hljs-operator">=</span> ioc.getBean(Calculator.class); <br>    System.out.println(cal.div(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>));<br>&#125;<br></code></pre></td></tr></table></figure><p>å¥½çš„ï¼Œç°åœ¨å‡è£…ï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªæ¥å£ï¼ˆ<code>Calculator</code>ï¼‰å’Œä¸€ä¸ªå®ç°ç±»ï¼ˆ<code>CalculatorImpl</code>ï¼‰</p><p>å‰é¢è¯´äº†ï¼Œ<code>Spring</code>çš„<code>AOP</code>åŸºäº<code>IOC</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç›®æ ‡ç±»å’Œä»£ç†ç±»éƒ½æ˜¯äº¤ç»™<code>IOC</code>ç®¡ç†çš„</p><p>å¹¶ä¸”ï¼Œæˆ‘ä»¬å°†ä¸èƒ½å†é€šè¿‡<code>IOC</code>å®¹å™¨è·å–åŸå§‹ç›®æ ‡ç±»ï¼ˆè¢«ä»<code>IOC</code>ä¸­åˆ é™¤ï¼Œå¯èƒ½æ˜¯ç»™ä»£ç†ç±»è®©ä½ï¼‰</p><p>å¥½çš„ï¼Œé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬è¦å¦‚ä½•è·å–ä»£ç†ç±»å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¸çŸ¥é“ä»£ç†ç±»çš„ç±»åï¼Œå…¶æ¬¡ä¸çŸ¥é“å…¶<code>bean</code>çš„<code>id</code>ï¼Œhow to get it</p><p><em>ï¼ˆæ’å™ï¼šå…¶å®é€šè¿‡<code>cal.getClass().getName()</code>å¯ä»¥è·å¾—ç±»åï¼Œå‘ç°æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼š<code>com.sun.proxy.$Proxy16</code>ï¼‰</em></p><p>ä½†æ˜¯ï¼Œå‰é¢è¯´äº†ï¼Œä»£ç†ç±»å’Œç›®æ ‡ç±»å…±åŒå®ç°åŒä¸€ä¸ªæ¥å£ï¼Œè€Œä¸”<code>IOC</code>å®¹å™¨å¯ä»¥æ™ºèƒ½åœ°æ ¹æ®æ¥å£è¿”å›å®ç°ç±»ï¼ˆå‰ææ˜¯å®ç°ç±»å”¯ä¸€ï¼‰</p><p>è¿™å¯èƒ½å°±æ˜¯<code>IOC</code>è‡ªåŠ¨åˆ é™¤ç›®æ ‡ç±»<code>bean</code>çš„åŸå› ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®æ¥å£ç›´æ¥è·å–ä»£ç†ç±»äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Calculator</span> <span class="hljs-variable">cal</span> <span class="hljs-operator">=</span> ioc.getBean(Calculator.class); <br></code></pre></td></tr></table></figure><p>ä½†æ˜¯æï¼Œé—®é¢˜æ¥äº†ï¼Œå¦‚æœå®ç°ç±»ä¸å”¯ä¸€æ€ä¹ˆåŠ</p><p>æ¯”å¦‚è¿˜æœ‰ä¸€ä¸ªå®ç°ç±»ï¼š<code>CalculatorImpl2</code>ä¹Ÿå®ç°äº†<code>Calculator</code>æ¥å£</p><p>é‚£ä¹ˆ<code>IOC</code>å®¹å™¨ä¸­å°†æœ‰ä¸¤ä¸ªä»£ç†ç±»ï¼ˆå®ç°äº†åŒä¸€æ¥å£<code>Calculator</code>ï¼‰</p><p>è¿™ç§æƒ…å†µä¸‹<code>ioc.getBean(Calculator.class)</code>å°±ä¸çŸ¥é“è¿”å›å“ªä¸€ä¸ªå®ç°ç±»äº†ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">NoUniqueBeanDefinitionException<br></code></pre></td></tr></table></figure><p>é‚£æˆ‘ä»¬åœ¨è¿™ç§æƒ…å†µä¸‹è¯¥å¦‚ä½•è·å–<code>CalculatorImpl</code>çš„ä»£ç†ç±»å‘¢ï¼ˆå¤§éƒ¨åˆ†èµ„æ–™éƒ½æ²¡è¯´aaaaa æ°”shiæˆ‘å•¦ï¼‰</p><p>è¿™ç§æ—¶å€™å°±éœ€è¦å›æƒ³ä¸€ä¸‹<code>IOC</code>çš„çŸ¥è¯†äº†ï¼Œåœ¨æ¥å£æœ‰å¤šä¸ªå®ç°ç±»çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¦‚ä½•è·å–æŒ‡å®šå®ç°ç±»</p><p>é€šè¿‡é‡è½½å‡½æ•°<code>getBean(String var1, Class&lt;T&gt; var2)</code>æ˜¯å§ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>bean id</code>ï¼Œç¬¬äºŒä¸ªæ˜¯æ¥å£ç±»</p><p>é‚£ä¹ˆæ­¤æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•æ ‡è¯†å®ç°ç±»ï¼ˆæ¯•ç«Ÿç›´æ¥é€šè¿‡<code>å®ç°ç±».class</code>å·²ç»ä¸è¡Œäº†å¯¹å§ï¼Œdeletedï¼‰</p><h4 id="idï¼Ÿ"><a href="#idï¼Ÿ" class="headerlink" title="idï¼Ÿ"></a>idï¼Ÿ</h4><p>é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œ<code>id</code>æ˜¯å•¥ï¼Œå¦‚æœæ˜¯é€šè¿‡<code>xml</code>é…ç½®çš„ï¼Œ<code>id</code>å°±æ˜¯è‡ªå·±å†™çš„</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;calImpl&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.mrbeanc.spring.aop.CalculatorImpl&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯é€šè¿‡<code>@Component</code>æ³¨è§£æ§åˆ¶çš„ï¼Œé‚£ä¹ˆé»˜è®¤<code>id</code>ä¸ºç±»åçš„å°é©¼å³°ï¼Œå³<code>calculatorImpl</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Calculator</span> <span class="hljs-variable">cal</span> <span class="hljs-operator">=</span> ioc.getBean(<span class="hljs-string">&quot;calculatorImpl&quot;</span>, Calculator.class);<br></code></pre></td></tr></table></figure><p>å½“ç„¶<code>@Component</code>ä¹Ÿå¯ä»¥è‡ªå®šä¹‰<code>id</code>ï¼Œlike <code>@Component(&quot;calImpl&quot;)</code></p><h4 id="è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬çŸ¥è¯†éœ€è¦å›é¡¾å’Œä¸²è”"><a href="#è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬çŸ¥è¯†éœ€è¦å›é¡¾å’Œä¸²è”" class="headerlink" title="è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬çŸ¥è¯†éœ€è¦å›é¡¾å’Œä¸²è”"></a>è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬çŸ¥è¯†éœ€è¦å›é¡¾å’Œä¸²è”</h4><h3 id="æ— æ¥å£ï¼ˆcglibç»§æ‰¿å®ç°å­ç±»ï¼‰"><a href="#æ— æ¥å£ï¼ˆcglibç»§æ‰¿å®ç°å­ç±»ï¼‰" class="headerlink" title="æ— æ¥å£ï¼ˆcglibç»§æ‰¿å®ç°å­ç±»ï¼‰"></a>æ— æ¥å£ï¼ˆcglibç»§æ‰¿å®ç°å­ç±»ï¼‰</h3><p>è¿™ç§æƒ…å†µä¸‹ç›´æ¥é€šè¿‡ç›®æ ‡ç±»å³å¯è·å–ä»£ç†ç±»ï¼ˆå­ç±»ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">CalculatorImpl</span> <span class="hljs-variable">cal</span> <span class="hljs-operator">=</span> ioc.getBean(<span class="hljs-string">&quot;calculatorImpl&quot;</span>);<br><span class="hljs-comment">//or</span><br><span class="hljs-type">CalculatorImpl</span> <span class="hljs-variable">cal</span> <span class="hljs-operator">=</span> ioc.getBean(CalculatorImpl.class); <br><span class="hljs-comment">//maybe æˆ‘çŒœçš„hh</span><br></code></pre></td></tr></table></figure><h3 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h3><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://juejin.cn/post/7019868958140399629">Springâ€”â€”AOPå®ç°æ–¹å¼ - æ˜é‡‘</a></p><p><a href="https://blog.csdn.net/glpghz/article/details/107362344">å­—èŠ‚ç å¢å¼ºå’Œspring AOP åŸç†_é•¿ä¸å¤§çš„å¤§ç°ç‹¼çš„åšå®¢-CSDNåšå®¢_å­—èŠ‚ç å¢å¼ºå®ç°aop</a></p><p><a href="https://www.jianshu.com/p/ba6610930b01">ç†è§£Springä¸­çš„getBean() - ç®€ä¹¦</a></p><p><a href="https://blog.csdn.net/Sampson_S/article/details/106908797">ã€Springæ¡†æ¶ã€‘Springçš„AOPä½¿ç”¨_Sampson_Sçš„åšå®¢-CSDNåšå®¢</a></p>]]></content>
    
    
    <categories>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>AOP</tag>
      
      <tag>AspectJ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®º Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;) æ˜¯å¦‚ä½•å¯»å€çš„</title>
    <link href="/2022/09/09/%E8%AE%BA-Resources-getResourceAsStream-mybatis-config-xml-%E6%98%AF%E5%A6%82%E4%BD%95%E5%AF%BB%E5%9D%80%E7%9A%84/"/>
    <url>/2022/09/09/%E8%AE%BA-Resources-getResourceAsStream-mybatis-config-xml-%E6%98%AF%E5%A6%82%E4%BD%95%E5%AF%BB%E5%9D%80%E7%9A%84/</url>
    
    <content type="html"><![CDATA[<h2 id="å•åˆ€ç›´å…¥"><a href="#å•åˆ€ç›´å…¥" class="headerlink" title="å•åˆ€ç›´å…¥"></a>å•åˆ€ç›´å…¥</h2><p>å¤§å®¶åœ¨å­¦<code>MyBatis</code>çš„æ—¶å€™è‚¯å®šç”¨åˆ°äº†<code>Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;)</code>è¿™è¡Œä»£ç <br>ï¼ˆin <code>SqlSessionUtil</code>ï¼‰</p><p>ä½†æ˜¯æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªå‚æ•°åªéœ€è¦å†™æ–‡ä»¶åå°±èƒ½å®šä½å‘¢</p><ul><li>æœ‰äººå¯èƒ½è¯´äº†ï¼šè¿™ç›¸å¯¹è·¯å¾„ï¼Œé‚£è‚¯å®šæ˜¯åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹å˜›</li></ul><p>éä¹Ÿï¼Œéä¹Ÿ</p><p><img src="/img/image-20220909161841514.png" alt="Figure 1"></p><p>è¯¸å›è¯·çœ‹ï¼Œä»–ä¿©ç›¸éš”åä¸‡å…«åƒé‡Œ</p><h2 id="çŒœæƒ³"><a href="#çŒœæƒ³" class="headerlink" title="çŒœæƒ³"></a>çŒœæƒ³</h2><p>é¦–å…ˆï¼Œç¬¬ä¸€ä¸ªæ¯”è¾ƒè½æ’çš„çŒœæƒ³ï¼Œéš¾é“æ˜¯æ ¹æ®<code>resources</code>çš„æ–‡ä»¶å¤¹æ ‡è®°å®šä½æ ¹ç›®å½•çš„å—</p><p>éä¹Ÿï¼Œéä¹Ÿ</p><p>å»æ‰æ ‡è®°ä»èƒ½è¿è¡Œ</p><h2 id="çœŸç›¸ï¼ˆMaybeï¼‰"><a href="#çœŸç›¸ï¼ˆMaybeï¼‰" class="headerlink" title="çœŸç›¸ï¼ˆMaybeï¼‰"></a>çœŸç›¸ï¼ˆMaybeï¼‰</h2><p>è¯¸å›è¯·çœ‹</p><p><img src="/img/image-20220909162406745.png" alt="Figure 2"></p><p>è§‚å¯Ÿç¼–è¯‘åçš„<code>target</code>æ–‡ä»¶å¤¹</p><p><code>java</code>æ–‡ä»¶å¤¹å’Œ<code>resources</code>æ–‡ä»¶å¤¹ <strong>åˆå¹¶</strong>äº†</p><p>ç»Ÿä¸€å½’å¹¶åœ¨<code>classes</code>æ–‡ä»¶å¤¹ä¸‹</p><p>è¯¶ï¼Œå¥½åƒæœ‰é‚£ä¹ˆç‚¹æ¥è¿‘çœŸç›¸äº†ï¼Œä½†åˆæ²¡æœ‰å®Œå…¨æ¥è¿‘â€¦</p><ul><li>æœ‰åç”Ÿå¯èƒ½å‘ç°ç›²ç‚¹äº†ï¼šä½ è¿™<code>SqlSessionUtil</code>ç±»åœ¨<code>utils</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œå’Œ<code>mybatis-config.xml</code>ä¹Ÿä¸åŒçº§å•Šï¼Œæ€ä¹ˆèƒ½ç›¸å¯¹å¼•ç”¨</li></ul><p>å’³å’³ï¼Œè¿™ä¸ªå‘¢ï¼Œä¸»è¦æ˜¯</p><p>ä¸Šä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">InputStream <span class="hljs-title function_">getResourceAsStream</span><span class="hljs-params">(String resource, ClassLoader[] classLoader)</span> &#123;<br>        ClassLoader[] var3 = classLoader;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">var4</span> <span class="hljs-operator">=</span> classLoader.length;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">var5</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; var5 &lt; var4; ++var5) &#123;<br>            <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">cl</span> <span class="hljs-operator">=</span> var3[var5];<br>            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != cl) &#123;<br>                <span class="hljs-type">InputStream</span> <span class="hljs-variable">returnValue</span> <span class="hljs-operator">=</span> cl.getResourceAsStream(resource);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == returnValue) &#123;<br>                    returnValue = cl.getResourceAsStream(<span class="hljs-string">&quot;/&quot;</span> + resource);<br>                &#125;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != returnValue) &#123;<br>                    <span class="hljs-keyword">return</span> returnValue;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯<code>Resources.getResourceAsStream</code>çš„æ·±å±‚å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == returnValue) &#123;<br>returnValue = cl.getResourceAsStream(<span class="hljs-string">&quot;/&quot;</span> + resource);<br>&#125;<br></code></pre></td></tr></table></figure><p>è§‚å¯Ÿè¿™å‡ è¡Œå¯ä»¥å‘ç°ï¼Œåœ¨è·å–æ–‡ä»¶å¤±è´¥åï¼Œä¼šè‡ªåŠ¨åŠ ä¸Šâ€&#x2F;â€œå†è¿›è¡Œå°è¯•ï¼ˆéå¸¸æ»´äººæ€§åŒ–å‘€ï¼‰</p><p>å¤§å®¶éƒ½çŸ¥é“ï¼ŒåŠ ä¸Šâ€&#x2F;â€œä¹‹åï¼Œå°±æ„å‘³ç€ä»æ ¹ç›®å½•è¿›è¡Œå¯»å€ï¼Œä¹Ÿå°±æ‰¾åˆ°äº†<code>mybatis-config.xml</code>ï¼ˆæˆ‘çŒœæ ¹ç›®å½•æ˜¯classesï¼‰</p><p>å’³å’³ï¼Œå°±æ˜¯è¿™æ ·å•¦ï¼ˆmaybeï¼‰</p><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>å…¶å®è¿™ä¸ªçŸ¥è¯†ç‚¹è¿˜å¯ç”¨äº<code>mybatis-config.xml</code>çš„<code>mappers</code>é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;mappers/UserMapper.xml&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸€ä¸ªæ˜ å°„æ–‡ä»¶éƒ½è¦è¿™æ ·å†™å…¥æ ¸å¿ƒé…ç½®</p><p>ä½†æ˜¯ï¼Œè¿™æœªå…å¤ªè¿‡éº»çƒ¦ï¼Œå› ä¸ºæ¯ä¸€ä¸ªæ˜ å°„å°±è¦å†™ä¸€è¡Œ</p><p>æ‰€ä»¥ç»å¸¸å†™ä¸º</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.mrbeanc.mybatis.mapper&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥æŠŠ<code>mapper</code>ä¸‹çš„æ‰€æœ‰æ˜ å°„æ–‡ä»¶è‡ªåŠ¨å†™å…¥å•¦</p><p>ä½†æ˜¯è¿™ä¹ˆå†™æ˜¯æœ‰ä¸¤ä¸ªè¦æ±‚çš„</p><ol><li>mapperæ¥å£å’Œæ˜ å°„æ–‡ä»¶æ‰€åœ¨åŒ…ä¸€è‡´</li><li>mapperæ¥å£å’Œæ˜ å°„æ–‡ä»¶çš„æ–‡ä»¶åä¸€è‡´</li></ol><p>é‚£ä¹ˆæœ‰äººå°±è¦é—®äº†ï¼Œè¯¶ï¼Œä¸ºä»€ä¹ˆåŒ…è¦ä¸€è‡´å•Š</p><p>ä½ è¿™ä¸€ä¸ªåœ¨javaæ–‡ä»¶å¤¹ä¸‹ï¼Œä¸€ä¸ªåœ¨resourcesæ–‡ä»¶å¤¹ä¸‹ï¼Œå°±ç®—å†…éƒ¨åŒ…ä¸€è‡´ï¼Œçˆ¶æ–‡ä»¶å¤¹ä¹Ÿä¸ä¸€è‡´å‘€</p><p><img src="/img/image-20220909163834063.png" alt="Figure 3"></p><p>ä½†æ˜¯ç»“åˆä¸Šé¢çš„çŸ¥è¯†ç‚¹ï¼Œå¯ä»¥å‘ç°ï¼Œç¼–è¯‘åä»–ä¿©å°±ä¼šåˆå¹¶</p><p><img src="/img/image-20220909163915194.png" alt="Figure 4"></p><p>è¿™æ ·ä¸€æ¥ï¼Œä»–ä¿©å°±åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œäº†ï¼Œå¯»å€éå¸¸æ–¹ä¾¿</p><h3 id="Peace"><a href="#Peace" class="headerlink" title="Peace"></a>Peace</h3><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://www.bilibili.com/video/BV1Ya411S7aT?p=17&vd_source=72f34a53a3e27b95117029804465fa3f">017-MyBatisæ ¸å¿ƒé…ç½®æ–‡ä»¶ä¹‹mappers_å“”å“©å“”å“©_bilibili</a></p>]]></content>
    
    
    <categories>
      
      <category>MyBatis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>idea</tag>
      
      <tag>MyBatis</tag>
      
      <tag>Resources</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•è¿ç§»Hexo Blogè‡³ new PC</title>
    <link href="/2022/09/09/%E5%A6%82%E4%BD%95%E8%BF%81%E7%A7%BBHexo-Blog%E8%87%B3-new-PC/"/>
    <url>/2022/09/09/%E5%A6%82%E4%BD%95%E8%BF%81%E7%A7%BBHexo-Blog%E8%87%B3-new-PC/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>è¯è¯´å›æ¥ï¼Œæˆ‘å·²ç»äº”ä¸ªæœˆæ²¡æœ‰æ›´æ–°<code>Blog</code>äº†ï¼ŒçœŸæ˜¯æ‡ã‹ã—ã„ãªã‚</p><p>ã„ã‚ã‚“ãªåŸå› ã ã­</p><p>å˜›ï¼Œè¦è¯´å¿™ï¼Œå…¶å®ä¹Ÿä¸æ˜¯</p><p>ä¸»è¦æ˜¯æ¢äº†æ–°ç¬”è®°æœ¬ç”µè„‘ï¼Œå°±è¦å¯¹<code>Hexo</code>è¿›è¡Œè¿ç§»</p><p>ä½†æ˜¯æï¼Œä¸ç”¨æˆ‘å¤šè¯´ï¼Œå¤§å®¶ä¹Ÿä¸æ˜¯ä»€ä¹ˆèŒæ–°ï¼Œåº”è¯¥çŸ¥é“è¿™ä¸æ˜¯<code>Copy</code>ä¸€ä¸ªæ–‡ä»¶å¤¹é‚£ä¹ˆç®€å•çš„äº‹</p><p>ç”šè‡³æ¯”ä»é›¶å¼€å§‹è¦æ›´åŠ å¤æ‚ä¸€ç‚¹ï¼Œå› ä¸ºéœ€è¦ç»´æŒåŸæœ‰çš„<code>Theme</code>ã€<code>é…ç½®æ–‡ä»¶</code>ã€<code>.mdæ–‡ä»¶</code>å’Œ<code>imgs</code>ï¼Œä»¥åŠä¸<code>gitee</code>è¿é€šçš„éƒ¨åˆ†</p><p>è€Œä¸”å®‰è£…<code>Hexo</code>æœ¬èº«å°±éœ€è¦<code>NodeJs</code>çš„å‰ç½®æ”¯æŒ</p><p>ä¸»è¦æ˜¯æˆ‘å·²ç»å¿˜äº†å½“æ—¶æ˜¯å¦‚ä½•é…ç½®çš„ï¼Œaaaï¼Œæƒ³æƒ³å°±å¤´å¤§</p><p>ä¾¿ä¸€ç›´æ‹–åˆ°äº†ç°åœ¨â€¦.ï¼ˆæƒ­æ„§æƒ­æ„§ï¼‰</p><h2 id="æ­£ç‰‡ï¼ˆå åº•"><a href="#æ­£ç‰‡ï¼ˆå åº•" class="headerlink" title="æ­£ç‰‡ï¼ˆå åº•"></a>æ­£ç‰‡ï¼ˆå åº•</h2><p>ç„¶åå˜›ï¼Œæœ€è¿‘åœ¨çœ‹<code>JavaWeb</code>ï¼Œçš„ç¡®éœ€è¦è®°å½•ä¸€ç‚¹ä¸€äº›ä¸œä¸œï¼Œæ²¡åŠæ³•ï¼Œéœ€æ±‚æ‰æ˜¯ç¬¬ä¸€é©±åŠ¨åŠ›å•Š</p><p>ã€ãƒªãƒ³ã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆï¼ã€</p><p>æ€ä¹ˆè¿ç§»å‘¢ï¼Ÿ</p><p>æ­¥éª¤è¿™ä¹ˆå¤šï¼Œå…ˆä»éª¨æ¶å¼€å§‹</p><ol><li>å®‰è£…<a href="www.nodejs.org"><code>NodeJs</code></a></li><li>å®‰è£…<code>hexo</code>å¹¶æ‰§è¡Œ<code>hexo init</code>ï¼ˆå•Šï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªçº¯æ´æ— ç‘•çš„hexoç›®å½•ï¼‰</li><li>ç„¶åæ€ä¹ˆåŠå‘¢â€¦</li></ol><p>è¿™å°±å¾ˆå°´å°¬äº†</p><p>ä¸€å¼€å§‹ æˆ‘æŠŠæ‰€æœ‰çš„æ–‡ä»¶ç»Ÿç»Ÿå¤åˆ¶åˆ°äº†æ–°ç›®å½•é‡Œï¼Œè™½ç„¶å¯ä»¥è¿è¡Œ ä½†æ˜¯æ˜¾ç„¶<code>hexo g</code>é‡æ–°ç”Ÿæˆä¼šå¤±è´¥</p><p>å’³å’³ï¼Œæ€ä¹ˆå¯èƒ½è¿™ä¹ˆç®€å•å˜›</p><h3 id="restart"><a href="#restart" class="headerlink" title="restart"></a>restart</h3><ul><li><p>å…¶å®æœ€ç®€å•çš„è¿ç§»å°±æ˜¯æ‹·è´<code>source/_posts</code>ä¸‹çš„æ‰€æœ‰<code>.md</code>æ–‡ä»¶ï¼Œè¿™æ˜¯æœ€ç®€å•çš„å†…å®¹è¿ç§»</p></li><li><p>å…¶æ¬¡æ˜¯<code>theme</code>ä¸»é¢˜è¿ç§»ï¼Œä½¿ç”¨<code>npm install --save hexo-theme-fluid</code>å®‰è£…ä¸»é¢˜ï¼ˆæ ¹æ®è‡ªå·±éœ€æ±‚æ›´æ”¹ä¸»é¢˜ï¼‰</p></li><li><p>å¹¶ä¸”æ‹·è´åŸPCä¸Šçš„<code>.yml</code>æ–‡ä»¶ï¼Œå³å¯å®Œæˆä¸»é¢˜è¿ç§»</p></li></ul><p>å“¦ åˆ«å¿˜äº†åŸæœ¬çš„<code>img</code>æ–‡ä»¶å¤¹ï¼ˆ<code>node_modules\ä¸»é¢˜æ–‡ä»¶å¤¹\source\img</code>ï¼‰</p><p>okï¼Œç°åœ¨å·²ç»å®Œæˆ<strong>æœ¬åœ°è¿ç§»</strong>äº†</p><p>æ¥ä¸‹æ¥è¿˜éœ€è¦é…ç½®<code>gitee</code>çš„ä¸Šä¼ ï¼Œç”±äºgiteeçš„é…ç½®æ—©å·²å®Œæˆï¼ˆlast PCï¼‰ï¼Œ<code>.yml</code>é…ç½®æ–‡ä»¶ä¹Ÿå†™å¥½äº†</p><ul><li>å°±å·®ä¸€ä¸ª<code>npm</code>ä¾èµ–ï¼ˆ<code>npm install hexo-deployer-git --save</code>ï¼‰</li></ul><p>å¤§åŠŸå‘Šæˆ</p><h2 id="åè¨€"><a href="#åè¨€" class="headerlink" title="åè¨€"></a>åè¨€</h2><p>è¯¶ è¿™ä¸ªä¸»é¢˜æ€ä¹ˆç¨ç¨å˜äº†ä¸€ç‚¹ç‚¹</p><p>emmm åº”è¯¥æ˜¯æ›´æ–°äº†å§ en åº”è¯¥æ˜¯è¿™æ · å¤§æ¦‚ ãŸã¶ã‚“</p><p>Peace</p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://www.bilibili.com/video/BV1Yb411a7ty?spm_id_from=333.337.search-card.all.click&vd_source=72f34a53a3e27b95117029804465fa3f">æ‰‹æŠŠæ‰‹æ•™ä½ ä»0å¼€å§‹æ­å»ºè‡ªå·±çš„ä¸ªäººåšå®¢ |æ— å‘ç‰ˆè§†é¢‘æ•™ç¨‹| hexo_å“”å“©å“”å“©_bilibili</a></p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>è¿ç§»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºC++æ¨¡æ¿ä¸éæ¨¡æ¿å‡½æ•°é‡è½½</title>
    <link href="/2022/04/26/%E5%85%B3%E4%BA%8EC-%E6%A8%A1%E6%9D%BF%E4%B8%8E%E9%9D%9E%E6%A8%A1%E6%9D%BF%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD/"/>
    <url>/2022/04/26/%E5%85%B3%E4%BA%8EC-%E6%A8%A1%E6%9D%BF%E4%B8%8E%E9%9D%9E%E6%A8%A1%E6%9D%BF%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>å‡å¦‚æˆ‘ä»¬éœ€è¦ä¸º<code>QList&lt;T&gt;</code>çš„æŸä¸ªç±»å‹ç¼–å†™ç‰¹æ®Šçš„<code>operator==</code></p><p>é‚£å°±éœ€è¦è€ƒè™‘æ˜¯ç¼–å†™æ™®é€šå‡½æ•°è¿˜æ˜¯æ¨¡æ¿ç‰¹åŒ–äº†</p><h2 id="æ¨¡æ¿å‡½æ•°ä¸éæ¨¡æ¿å‡½æ•°çš„é‡è½½å†³è®®æ­¥éª¤"><a href="#æ¨¡æ¿å‡½æ•°ä¸éæ¨¡æ¿å‡½æ•°çš„é‡è½½å†³è®®æ­¥éª¤" class="headerlink" title="æ¨¡æ¿å‡½æ•°ä¸éæ¨¡æ¿å‡½æ•°çš„é‡è½½å†³è®®æ­¥éª¤"></a>æ¨¡æ¿å‡½æ•°ä¸éæ¨¡æ¿å‡½æ•°çš„é‡è½½å†³è®®æ­¥éª¤</h2><h3 id="1-ä¸ºè¿™ä¸ªå‡½æ•°åå»ºç«‹å€™é€‰å‡½æ•°é›†åˆ"><a href="#1-ä¸ºè¿™ä¸ªå‡½æ•°åå»ºç«‹å€™é€‰å‡½æ•°é›†åˆ" class="headerlink" title="1.ä¸ºè¿™ä¸ªå‡½æ•°åå»ºç«‹å€™é€‰å‡½æ•°é›†åˆ"></a>1.ä¸ºè¿™ä¸ªå‡½æ•°åå»ºç«‹å€™é€‰å‡½æ•°é›†åˆ</h3><ul><li>ä¸è¢«è°ƒç”¨å‡½æ•°åå­—ç›¸åŒçš„ä»»æ„æ™®é€šå‡½æ•°</li><li>ä»»æ„å‡½æ•°æ¨¡æ¿å®ä¾‹åŒ–ï¼Œåœ¨å…¶ä¸­ï¼Œæ¨¡æ¿å®å‚æ¨æ–­å‘ç°äº†ä¸è°ƒç”¨ä¸­æ‰€ç”¨å‡½æ•°å®å‚ç›¸åŒ¹é…çš„æ¨¡æ¿å®å‚</li></ul><h3 id="2-ç¡®å®šå“ªäº›æ™®é€šå‡½æ•°æ˜¯å¯è¡Œçš„ï¼ˆå¦‚æœæœ‰å¯è¡Œå‡½æ•°çš„è¯ï¼‰ã€‚å€™é€‰é›†åˆä¸­çš„æ¯ä¸ªæ¨¡æ¿å®ä¾‹éƒ½å¯è¡Œçš„ï¼Œå› ä¸ºæ¨¡æ¿å®å‚æ¨æ–­ä¿è¯å‡½æ•°å¯ä»¥è¢«è°ƒç”¨"><a href="#2-ç¡®å®šå“ªäº›æ™®é€šå‡½æ•°æ˜¯å¯è¡Œçš„ï¼ˆå¦‚æœæœ‰å¯è¡Œå‡½æ•°çš„è¯ï¼‰ã€‚å€™é€‰é›†åˆä¸­çš„æ¯ä¸ªæ¨¡æ¿å®ä¾‹éƒ½å¯è¡Œçš„ï¼Œå› ä¸ºæ¨¡æ¿å®å‚æ¨æ–­ä¿è¯å‡½æ•°å¯ä»¥è¢«è°ƒç”¨" class="headerlink" title="2.ç¡®å®šå“ªäº›æ™®é€šå‡½æ•°æ˜¯å¯è¡Œçš„ï¼ˆå¦‚æœæœ‰å¯è¡Œå‡½æ•°çš„è¯ï¼‰ã€‚å€™é€‰é›†åˆä¸­çš„æ¯ä¸ªæ¨¡æ¿å®ä¾‹éƒ½å¯è¡Œçš„ï¼Œå› ä¸ºæ¨¡æ¿å®å‚æ¨æ–­ä¿è¯å‡½æ•°å¯ä»¥è¢«è°ƒç”¨"></a>2.ç¡®å®šå“ªäº›æ™®é€šå‡½æ•°æ˜¯å¯è¡Œçš„ï¼ˆå¦‚æœæœ‰å¯è¡Œå‡½æ•°çš„è¯ï¼‰ã€‚å€™é€‰é›†åˆä¸­çš„æ¯ä¸ªæ¨¡æ¿å®ä¾‹éƒ½å¯è¡Œçš„ï¼Œå› ä¸ºæ¨¡æ¿å®å‚æ¨æ–­ä¿è¯å‡½æ•°å¯ä»¥è¢«è°ƒç”¨</h3><h3 id="3-å¦‚æœéœ€è¦è½¬æ¢æ¥è¿›è¡Œè°ƒç”¨ï¼Œæ ¹æ®è½¬æ¢çš„ç§ç±»æ’åˆ—å¯é å‡½æ•°ï¼Œè®°ä½ï¼Œè°ƒç”¨æ¨¡æ¿å‡½æ•°å®ä¾‹æ‰€å…è®¸çš„è½¬æ¢æ˜¯æœ‰é™çš„"><a href="#3-å¦‚æœéœ€è¦è½¬æ¢æ¥è¿›è¡Œè°ƒç”¨ï¼Œæ ¹æ®è½¬æ¢çš„ç§ç±»æ’åˆ—å¯é å‡½æ•°ï¼Œè®°ä½ï¼Œè°ƒç”¨æ¨¡æ¿å‡½æ•°å®ä¾‹æ‰€å…è®¸çš„è½¬æ¢æ˜¯æœ‰é™çš„" class="headerlink" title="3. å¦‚æœéœ€è¦è½¬æ¢æ¥è¿›è¡Œè°ƒç”¨ï¼Œæ ¹æ®è½¬æ¢çš„ç§ç±»æ’åˆ—å¯é å‡½æ•°ï¼Œè®°ä½ï¼Œè°ƒç”¨æ¨¡æ¿å‡½æ•°å®ä¾‹æ‰€å…è®¸çš„è½¬æ¢æ˜¯æœ‰é™çš„"></a>3. å¦‚æœéœ€è¦è½¬æ¢æ¥è¿›è¡Œè°ƒç”¨ï¼Œæ ¹æ®è½¬æ¢çš„ç§ç±»æ’åˆ—å¯é å‡½æ•°ï¼Œè®°ä½ï¼Œè°ƒç”¨æ¨¡æ¿å‡½æ•°å®ä¾‹æ‰€å…è®¸çš„è½¬æ¢æ˜¯æœ‰é™çš„</h3><ul><li>å¦‚æœåªæœ‰ä¸€ä¸ªå‡½æ•°å¯é€‰ï¼Œå°±è°ƒç”¨è¿™ä¸ªå‡½æ•°</li><li>å¦‚æœè°ƒç”¨æœ‰äºŒä¹‰æ€§ï¼Œä»å¯è¡Œå‡½æ•°é›†åˆä¸­å»æ‰æ‰€æœ‰å‡½æ•°æ¨¡æ¿å®ä¾‹</li></ul><h3 id="4-é‡æ–°æ’åˆ—å»æ‰å‡½æ•°æ¨¡æ¿å®ä¾‹çš„å¯è¡Œå‡½æ•°"><a href="#4-é‡æ–°æ’åˆ—å»æ‰å‡½æ•°æ¨¡æ¿å®ä¾‹çš„å¯è¡Œå‡½æ•°" class="headerlink" title="4.é‡æ–°æ’åˆ—å»æ‰å‡½æ•°æ¨¡æ¿å®ä¾‹çš„å¯è¡Œå‡½æ•°"></a>4.é‡æ–°æ’åˆ—å»æ‰å‡½æ•°æ¨¡æ¿å®ä¾‹çš„å¯è¡Œå‡½æ•°</h3><ul><li>å¦‚æœåªæœ‰ä¸€ä¸ªå‡½æ•°å¯é€‰ï¼Œå°±è°ƒç”¨è¿™ä¸ªå‡½æ•°</li><li>å¦åˆ™ï¼Œè°ƒç”¨æœ‰äºŒä¹‰æ€§</li></ul><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyList</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-type">const</span> MyList&lt;T&gt;&amp; l) <span class="hljs-type">const</span> &#123;<br>        <span class="hljs-keyword">return</span> a == l.a;<br>    &#125;<br>    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>!=(<span class="hljs-type">const</span> MyList&lt;T&gt;&amp; l) <span class="hljs-type">const</span> &#123;<br>        <span class="hljs-keyword">return</span> a != l.a;<br>    &#125;<br>    T a;<br>&#125;;<br><br><span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-type">const</span> MyList&lt;<span class="hljs-type">int</span>&gt;&amp; lhs, <span class="hljs-type">const</span> MyList&lt;<span class="hljs-type">int</span>&gt;&amp; rhs)<br>&#123;<br>    <span class="hljs-keyword">return</span> lhs.a == rhs.a;<br>&#125;<br><br><span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>!=(<span class="hljs-type">const</span> MyList&lt;<span class="hljs-type">int</span>&gt;&amp; lhs, <span class="hljs-type">const</span> MyList&lt;<span class="hljs-type">int</span>&gt;&amp; rhs)<br>&#123;<br>    <span class="hljs-keyword">return</span> !(lhs == rhs);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span>&#123;<br>    MyList&lt;<span class="hljs-type">int</span>&gt; list, list2;<br>    list == list2;<br>    list != list2;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šå›¾ è°ƒç”¨<code>!=</code>è¿ç®—ç¬¦ä¼šæŠ¥é”™</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs aspectj">E:\Qt5.14.2\Projects\HelloWorld\hellodialog.cpp:44: <span class="hljs-keyword">error</span>: ambiguous overload <span class="hljs-keyword">for</span> &#x27;operator==&#x27; (operand types are &#x27;<span class="hljs-keyword">const</span> MyList&lt;<span class="hljs-keyword">int</span>&gt;&#x27; and &#x27;<span class="hljs-keyword">const</span> MyList&lt;<span class="hljs-keyword">int</span>&gt;&#x27;)<br>     <span class="hljs-keyword">return</span> !(lhs == rhs);<br>              ~~~~^~~~~~<br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯ç±»æ¨¡æ¿çš„æˆå‘˜å‡½æ•° å’Œ æ™®é€šå‡½æ•°äº§ç”ŸäºŒä¹‰æ€§ï¼ˆéƒ½æ˜¯å®Œç¾åŒ¹é…ï¼‰</p><p>ä½†æ˜¯ä½ å¯èƒ½è¯´äº†ï¼šå‡½æ•°æ¨¡æ¿ä¼˜å…ˆçº§ä¸åº”è¯¥ä½äºæ™®é€šå‡½æ•°å—ï¼Œåº”è¯¥è°ƒç”¨æ™®é€šå‡½æ•°æ‰å¯¹å‘€</p><p>æˆ‘ä¹Ÿè¿™ä¹ˆè®¤ä¸º</p><p>ä½†æ˜¯æœ‰æ²¡æœ‰å¯èƒ½ï¼Œæˆå‘˜å‡½æ•°<code>operator==</code>ä¸æ˜¯æ¨¡æ¿å‡½æ•°å‘¢ï¼Ÿ</p><p>å› ä¸ºå”¯ä¸€çš„æ¨¡æ¿é€‚ç”¨äºæŒ‡ç¤ºæ¨¡æ¿ç±»çš„ç±»å‹çš„</p><p>ä¸€æ—¦ç±»çš„ç±»å‹ç¡®å®šï¼Œ<code>operator==</code>çš„å‚æ•°ä¹Ÿå°±ç¡®å®šäº†</p><blockquote><p>åœ¨ç±»æ¨¡æ¿ä½œç”¨åŸŸä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ¨¡æ¿åè€Œä¸æä¾›å®å‚ â€”â€” ã€ŠC++ Primerã€‹ P589</p></blockquote><p>å³ï¼Œä»¥ä¸‹ä¸¤ç§çš†å¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-type">const</span> MyList&lt;T&gt;&amp; l) <span class="hljs-type">const</span>;<br><span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-type">const</span> MyList&amp; l) <span class="hljs-type">const</span>;<br></code></pre></td></tr></table></figure><p>è¿™å°±æ˜¯æ™®é€šå‡½æ•°</p><p><code>operator==</code>æ ¹æœ¬ä¸æ˜¯æ¨¡æ¿å‡½æ•°</p><p>å¯¼è‡´æ¨¡æ¿å‡½æ•°åŒ¹é…è§„åˆ™ä¸é€‚ç”¨</p><p>ï¼ˆä»¥ä¸Šæˆ‘çŒœçš„ï¼‰</p><p><strong>ç¬¬äºŒç‚¹</strong>ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">E:\Qt5<span class="hljs-number">.14</span><span class="hljs-number">.2</span>\Projects\HelloWorld\hellodialog.cpp:<span class="hljs-number">64</span>: warning: ISO C++ says <span class="hljs-keyword">that</span> these are ambiguous, even though <span class="hljs-keyword">the</span> worst conversion <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> <span class="hljs-keyword">first</span> <span class="hljs-keyword">is</span> better than <span class="hljs-keyword">the</span> worst conversion <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> <span class="hljs-keyword">second</span>:<br>     <span class="hljs-built_in">list</span> == list2;<br>             ^~~~~<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯<code>warning</code>ï¼Œå¦‚æœæŒ‰ä»¥ä¸Šåˆ†æï¼Œæ­¤æ—¶è™½ç„¶è¦ç»è¿‡<code>const</code>è½¬æ¢ï¼Œè¿™åº”è¯¥ä¹Ÿå¾—æ˜¯äºŒä¹‰æ€§é”™è¯¯ï¼Œä¸ºä»€ä¹ˆæ­¤æ—¶æ™®é€šå‡½æ•°æ›´å¥½ï¼Œä¸è§£</p><h2 id="æ­£ç¡®åšæ³•"><a href="#æ­£ç¡®åšæ³•" class="headerlink" title="æ­£ç¡®åšæ³•"></a>æ­£ç¡®åšæ³•</h2><p>æƒ³è¦ä¸å†²çªï¼Œæœ€å¥½ä¸è¦äº§ç”Ÿæ¨¡æ¿å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„é‡è½½</p><p>æœ€å¥½è¿›è¡Œæ¨¡æ¿ç‰¹åŒ–</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">template</span> &lt;&gt;<br><span class="hljs-type">bool</span> MyList&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-keyword">operator</span>==(<span class="hljs-type">const</span> MyList&lt;<span class="hljs-type">int</span>&gt;&amp; l) <span class="hljs-type">const</span><br>&#123;<br>    <span class="hljs-keyword">return</span> l.a == a;<br>&#125;<br><span class="hljs-keyword">template</span> &lt;&gt;<br><span class="hljs-type">bool</span> MyList&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-keyword">operator</span>!=(<span class="hljs-type">const</span> MyList&lt;<span class="hljs-type">int</span>&gt;&amp; l) <span class="hljs-type">const</span><br>&#123;<br>    <span class="hljs-keyword">return</span> !(l == *<span class="hljs-keyword">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>PS</strong>ï¼šæ³¨æ„æ¨¡æ¿ç‰¹åŒ–è¦å†™åœ¨è°ƒç”¨ä¹‹å‰ï¼Œå¦åˆ™ä¼šå¯¼è‡´äº§ç”Ÿæ–°æ¨¡æ¿å®ä¾‹</p><h2 id="å¯„"><a href="#å¯„" class="headerlink" title="å¯„"></a>å¯„</h2><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://www.cnblogs.com/rickyk/p/3941176.html">C++æ™®é€šå‡½æ•°ä¸æ¨¡æ¿å‡½æ•°ä»¥åŠç‰¹åŒ–å‡½æ•°é‡è½½çš„ä¼˜å…ˆçº§é—®é¢˜ - Ricky.K - åšå®¢å›­</a></p><p><a href="https://www.cnblogs.com/liyuan989/p/4138378.html">èŠèŠC++æ¨¡æ¿å‡½æ•°ä¸éæ¨¡æ¿å‡½æ•°çš„é‡è½½ - origins - åšå®¢å›­</a></p><p><a href="https://blog.csdn.net/wangwenjing90/article/details/8530498">å‡½æ•°æ¨¡æ¿ä¸åŒåçš„éæ¨¡æ¿å‡½æ•°é‡è½½çš„æ—¶å€™ï¼Œä¸¤è€…è°ƒç”¨é¡ºåº_ä¹æœˆä¸«å¤´çš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/brook0344/article/details/53444786">ç±»æ¨¡æ¿å‡½æ•°ç‰¹åŒ–ï¼ˆä¸“ç”¨åŒ–ï¼‰specialization of â€¦â€¦ after instantiation_å¸ƒé²å…‹é›¶ä¸‰å››å››çš„åšå®¢</a></p><p><a href="https://harttle.land/2015/10/03/cpp-template.html">C++æ¨¡æ¿çš„åç‰¹åŒ–ä¸å…¨ç‰¹åŒ– | Harttle Land</a></p>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>Qt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SwitchToThisWindow ç‚¹çŸ³æˆé‡‘ï¼Ÿ</title>
    <link href="/2022/04/11/SwitchToThisWindow-%E7%AA%97%E7%8B%AC%E5%88%86%E5%AD%90%EF%BC%9F/"/>
    <url>/2022/04/11/SwitchToThisWindow-%E7%AA%97%E7%8B%AC%E5%88%86%E5%AD%90%EF%BC%9F/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>åŠ æ›´ä¸€æœŸ</p><p>åˆ«å‰æƒ…æè¦äº†ï¼Œç†„ç¯äº†å¤§å“¥</p><h2 id="æ­£ç‰‡"><a href="#æ­£ç‰‡" class="headerlink" title="æ­£ç‰‡"></a>æ­£ç‰‡</h2><p>å¶ç„¶å‘ç°</p><blockquote><p><code>SwitchToThisWindow</code> ä½œç”¨äº<code>Qt</code>å­æ§ä»¶ï¼ˆå¦‚<code>QLineEdit</code>ï¼‰å¯¼è‡´åŸæœ¬çš„çª—å£æ•´ä½“åˆ†è£‚ä¸ºä¼—å¤šå­çª—ä½“</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-built_in">SwitchToThisWindow</span>(<span class="hljs-built_in">HWND</span>(ui-&gt;lineEdit-&gt;<span class="hljs-built_in">winId</span>()), <span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Spy++</code>æ¢æµ‹<code>Qt</code>çª—å£æ˜¯åªèƒ½æ‰«åˆ°ä¸€æ•´ä¸ªçª—å£çš„</p><p>ä½†æ˜¯å¦‚æ­¤æ“ä½œä¹‹åï¼Œå°±èƒ½æ¢æµ‹åˆ°å­æ§ä»¶ï¼ˆå·²ç»ä¸Šå‡ä¸ºå­çª—ä½“ æ‹¥æœ‰<code>HWND</code>ï¼‰</p><p><img src="/img/image-20220411225430212.png" alt="åˆ†è£‚"></p><p>åæœæ˜¯ï¼Œä¸Šå±‚å­çª—ä½“ä¼šæ‹¦æˆª<code>WM_NCHITTEST</code>ï¼Œå¯¼è‡´ä¸‹å±‚ä¸»çª—ä½“æ— æ³•æ¥æ”¶ï¼Œå¯¼è‡´è‡ªå®šä¹‰æ ‡é¢˜æ æ— æ³•å“åº”é¼ æ ‡ç§»åŠ¨ï¼ˆçª—ä½“æ— æ³•ç§»åŠ¨ï¼‰</p><p>æˆ‘åªèƒ½è¯´å¾ˆç¥å¥‡ï¼Œè¿™ç»å¯¹æ˜¯ä¸€ä¸ªéå¸¸éš¾å‘ç°çš„ç‰¹æ€§ï¼ˆå¹¶æ²¡æœ‰å‘ç°ä»»ä½•è®°è½½ï¼‰</p><h3 id="More"><a href="#More" class="headerlink" title="More"></a>More</h3><p>è¿˜æœ‰æ›´ç¥å¥‡çš„</p><p>å¯¹<code>QListWidget</code>çš„è‡ªå®šä¹‰<code>item</code>ä½¿ç”¨åå‘ç°</p><ul><li>ç¬¬ä¸€è¡Œçš„<code>item</code>æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œç¬¬äºŒè¡Œå¼€å§‹ï¼Œæ¯ä¸ªæ§ä»¶éƒ½åˆ†è£‚ä¸ºçª—å£</li><li>æ–°å¢çš„<code>item</code>åœ¨åˆå§‹åŒ–æ—¶ä¼šè¡¨ç°ä¸ºé¦–è¡Œ<code>item</code>æ ·è²Œï¼Œç„¶åç¬é—´æ¢å¤æ­£å¸¸</li></ul><p>è¿™å°±</p><p><img src="/img/image-20220411230439944.png" alt="å¤§å—éœ‡æ’¼"></p><p>äº¤ç»™åäººäº†</p><p>ç¡äº† peace</p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows Hook æŠ€æœ¯æµ…æ</title>
    <link href="/2022/04/07/Windows-Hook-%E6%8A%80%E6%9C%AF%E6%B5%85%E6%9E%90/"/>
    <url>/2022/04/07/Windows-Hook-%E6%8A%80%E6%9C%AF%E6%B5%85%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå‡ºäºå®‰å…¨æ€§è€ƒè™‘ï¼Œæ“ä½œç³»ç»Ÿçš„è¿›ç¨‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œçª—å£ä¹Ÿä¸ä¾‹å¤–</p><p><code>Windows</code>çš„é€šä¿¡åŸºäºæ¶ˆæ¯æœºåˆ¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†å„ç§ä¿¡æ¯é€šè¿‡æ¶ˆæ¯(<code>Message</code>)çš„å½¢å¼ä¼ é€’ç»™å„ä¸ªçº¿ç¨‹ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä»¥çº¿ç¨‹ä¸ºå•ä½çš„ï¼‰</p><p>è¿™ä¹Ÿæ„å‘³ç€ä¸€ä¸ªè¿›ç¨‹<strong>åªèƒ½</strong>è·å–<code>Windows</code>å‘é€ç»™<strong>è‡ªèº«</strong>çª—ä½“çš„æ¶ˆæ¯ï¼Œå¦‚ï¼š</p><ul><li>é”®ç›˜æŒ‰é”®ä¿¡æ¯</li><li>é¼ æ ‡æ»šè½®ã€åŒå‡»ä¿¡æ¯</li><li>çª—å£æœ€å°åŒ–&#x2F;æœ€å¤§åŒ–</li><li>â€¦</li></ul><p><em>â€œä¸¤è€³ä¸é—»çª—å¤–äº‹ï¼Œä¸€å¿ƒåªè¯»åœ£è´¤ä¹¦â€</em>äº†å±äºæ˜¯</p><p>ä»–æƒ³é—»ä¹Ÿé—»ä¸åˆ°å•Šä¸»è¦æ˜¯ï¼Œæ“ä½œç³»ç»Ÿç»™ä»–æäº†</p><p><code>Windows</code>ï¼šå–‚ï¼Œåˆ«ä¸œå¼ è¥¿æœ›</p><h2 id="å¤–é¢çš„ä¸–ç•Œ"><a href="#å¤–é¢çš„ä¸–ç•Œ" class="headerlink" title="å¤–é¢çš„ä¸–ç•Œ"></a>å¤–é¢çš„ä¸–ç•Œ</h2><p>é‚£è«ï¼Œæˆ‘è¦æ˜¯æ±‚çŸ¥æ¬²ç‰¹åˆ«å¼ºï¼Œå°±æ˜¯æƒ³çŸ¥é“åˆ«çš„è¿›ç¨‹&#x2F;çª—å£å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æ¯”å¦‚ï¼šï¼ˆç›‘å¬å…¶ä»–çª—å£çš„å¯†ç è¾“å…¥ï¼‰</p><p>å“¦ï¼Œä¸æ˜¯ä¸æ˜¯ï¼Œè¯¯ä¼šäº†ï¼Œæˆ‘çš„è€ä¼™è®¡</p><p>æˆ‘æ˜¯è¯´ï¼šå¸®åŠ©ä¸€äº›è¡ŒåŠ¨ä¸ä¾¿çš„ç¨‹åºï¼Œå¤„ç†ä¸€äº›æ¶ˆæ¯~</p><p>å’³å’³</p><p>é‚£å°±éœ€è¦ç”¨åˆ°<code>Windows Hook</code>æŠ€æœ¯äº†</p><h2 id="Windows-Hook"><a href="#Windows-Hook" class="headerlink" title="Windows Hook"></a>Windows Hook</h2><p>ä»€ä¹ˆæ˜¯<code>Hook</code></p><p><code>Hook</code>ï¼Œç›´è¯‘ï¼šé’©å­ï¼ŒæŒ‚é’©</p><p>éå¸¸å½¢è±¡ï¼Œå…¶ä½œç”¨å°±æ˜¯åœ¨<code>Windows</code>å°†æ¶ˆæ¯åˆ†å‘ç»™æŒ‡å®šçª—å£è¿‡ç¨‹ä¸­æ•è·ï¼ˆé’©ä½ï¼‰æ¶ˆæ¯ï¼Œä»è€Œè·å¾—å¯¹æ¶ˆæ¯çš„æ§åˆ¶æƒï¼Œä»¥ä¾¿å¤„ç†æˆ–ä¿®æ”¹ï¼Œç”šè‡³å¯ä»¥æ‹¦æˆªï¼ˆä¸ç»§ç»­ä¼ é€’ï¼‰</p><p>æ¯”å¦‚ï¼šåœ¨æµè§ˆå™¨è¾“å…¥æ–‡å­—ï¼ŒæŒ‰é”®æ¶ˆæ¯å°±ä¼šç”±<code>Windows</code>å‘å¸ƒåˆ°æµè§ˆå™¨çª—å£ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç”¨é”®ç›˜é’©å­æ•è·æ¶ˆæ¯ï¼Œä»è€Œå¾—çŸ¥ç”¨æˆ·çš„è¾“å…¥</p><h2 id="Hookç±»å‹ï¼ˆè¿™ä¸€æ®µå¯ä»¥è·³è¿‡ï¼ŒæŸ¥é˜…ç”¨ï¼‰"><a href="#Hookç±»å‹ï¼ˆè¿™ä¸€æ®µå¯ä»¥è·³è¿‡ï¼ŒæŸ¥é˜…ç”¨ï¼‰" class="headerlink" title="Hookç±»å‹ï¼ˆè¿™ä¸€æ®µå¯ä»¥è·³è¿‡ï¼ŒæŸ¥é˜…ç”¨ï¼‰"></a>Hookç±»å‹ï¼ˆè¿™ä¸€æ®µå¯ä»¥è·³è¿‡ï¼ŒæŸ¥é˜…ç”¨ï¼‰</h2><p>æœ‰å¦‚ä¸‹çš„å‡ ç§å¸¸ç”¨ç±»å‹ï¼š</p><ul><li>é”®ç›˜é’©å­å’Œä½çº§é”®ç›˜é’©å­å¯ä»¥ç›‘è§†å„ç§é”®ç›˜æ¶ˆæ¯</li><li>é¼ æ ‡é’©å­å’Œä½çº§é¼ æ ‡é’©å­å¯ä»¥ç›‘è§†å„ç§é¼ æ ‡æ¶ˆæ¯</li><li>å¤–å£³é’©å­å¯ä»¥ç›‘è§†å„ç§<code>Shell</code>äº‹ä»¶æ¶ˆæ¯ã€‚æ¯”å¦‚å¯åŠ¨å’Œå…³é—­åº”ç”¨ç¨‹åº</li><li>æ—¥å¿—é’©å­å¯ä»¥è®°å½•ä»ç³»ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºçš„å„ç§äº‹ä»¶æ¶ˆæ¯</li><li>çª—å£è¿‡ç¨‹é’©å­ç›‘è§†æ‰€æœ‰ä»ç³»ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—å‘å¾€ç›®æ ‡çª—å£çš„æ¶ˆæ¯</li></ul><p>è¯¦ç»†æ¥è¯´ï¼š</p><h3 id="1-WH-CALLWNDPROC-å’Œ-WH-CALLWNDPROCRET"><a href="#1-WH-CALLWNDPROC-å’Œ-WH-CALLWNDPROCRET" class="headerlink" title="1.WH_CALLWNDPROC å’Œ WH_CALLWNDPROCRET"></a>1.WH_CALLWNDPROC å’Œ WH_CALLWNDPROCRET</h3><p>ç›‘è§†å‘é€åˆ°çª—å£è¿‡ç¨‹çš„æ¶ˆæ¯ã€‚ç³»ç»Ÿåœ¨æ¶ˆæ¯å‘é€åˆ°æ¥æ”¶çª—å£è¿‡ç¨‹ä¹‹å‰è°ƒç”¨<code>WH_CALLWNDPROC Hook</code>å­ç¨‹ï¼Œå¹¶ä¸”åœ¨çª—å£è¿‡ç¨‹å¤„ç†å®Œæ¶ˆæ¯ä¹‹åè°ƒç”¨<code>WH_CALLWNDPROCRET Hook</code>å­ç¨‹</p><h3 id="2-WH-CBT"><a href="#2-WH-CBT" class="headerlink" title="2.WH_CBT"></a>2.WH_CBT</h3><p>åœ¨ä»¥ä¸‹äº‹ä»¶ä¹‹å‰ï¼Œç³»ç»Ÿéƒ½ä¼šè°ƒç”¨<code>WH_CBT Hook</code>å­ç¨‹ï¼Œè¿™äº›äº‹ä»¶åŒ…æ‹¬ï¼š</p><ul><li>æ¿€æ´»ï¼Œå»ºç«‹ï¼Œé”€æ¯ï¼Œæœ€å°åŒ–ï¼Œæœ€å¤§åŒ–ï¼Œç§»åŠ¨ï¼Œæ”¹å˜å°ºå¯¸ç­‰çª—å£äº‹ä»¶</li><li>å®Œæˆç³»ç»ŸæŒ‡ä»¤</li><li>æ¥è‡ªç³»ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ç§»åŠ¨é¼ æ ‡ï¼Œé”®ç›˜äº‹ä»¶</li><li>è®¾ç½®è¾“å…¥ç„¦ç‚¹äº‹ä»¶</li><li>åŒæ­¥ç³»ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—äº‹ä»¶</li></ul><p><code>Hook</code>å­ç¨‹çš„è¿”å›å€¼ç¡®å®šç³»ç»Ÿæ˜¯å¦å…è®¸æˆ–è€…é˜²æ­¢è¿™äº›æ“ä½œä¸­çš„ä¸€ä¸ª</p><h3 id="3-WH-DEBUG"><a href="#3-WH-DEBUG" class="headerlink" title="3.WH_DEBUG"></a>3.WH_DEBUG</h3><p>åœ¨ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿä¸­ä¸å…¶ä»–<code>Hook</code>å…³è”çš„å­ç¨‹ä¹‹å‰ï¼Œç³»ç»Ÿä¼šè°ƒç”¨<code>WH_DEBUG Hook</code>å­ç¨‹ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ª<code>Hook</code>æ¥å†³å®šæ˜¯å¦å…è®¸ç³»ç»Ÿè°ƒç”¨ä¸å…¶ä»–<code>Hook</code>å…³è”çš„å­ç¨‹</p><h3 id="4-WH-FOREGROUNDIDLE"><a href="#4-WH-FOREGROUNDIDLE" class="headerlink" title="4.WH_FOREGROUNDIDLE"></a>4.WH_FOREGROUNDIDLE</h3><p>å½“åº”ç”¨ç¨‹åºçš„å‰å°çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>WH_FOREGROUNDIDLE Hook</code>æ‰§è¡Œä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚å½“åº”ç”¨ç¨‹åºçš„å‰å°çº¿ç¨‹å¤§æ¦‚è¦å˜æˆç©ºé—²çŠ¶æ€æ—¶ï¼Œç³»ç»Ÿå°±ä¼šè°ƒç”¨<code>WH_FOREGROUNDIDLE Hook</code>å­ç¨‹</p><h3 id="5-WH-GETMESSAGE"><a href="#5-WH-GETMESSAGE" class="headerlink" title="5.WH_GETMESSAGE"></a>5.WH_GETMESSAGE</h3><p>åº”ç”¨ç¨‹åºä½¿ç”¨<code>WH_GETMESSAGE Hook</code>æ¥ç›‘è§†ä»<code>GetMessage</code> or <code>PeekMessage</code>å‡½æ•°è¿”å›çš„æ¶ˆæ¯ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>WH_GETMESSAGE Hook</code>å»ç›‘è§†é¼ æ ‡å’Œé”®ç›˜è¾“å…¥ï¼Œä»¥åŠå…¶ä»–å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</p><h3 id="6-WH-JOURNALPLAYBACK"><a href="#6-WH-JOURNALPLAYBACK" class="headerlink" title="6.WH_JOURNALPLAYBACK"></a>6.WH_JOURNALPLAYBACK</h3><p><code>WH_JOURNALPLAYBACK Hook</code>ä½¿åº”ç”¨ç¨‹åºå¯ä»¥æ’å…¥æ¶ˆæ¯åˆ°ç³»ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—ã€‚å¯ä»¥ä½¿ç”¨è¿™ä¸ª<code>Hook</code>å›æ”¾é€šè¿‡ä½¿ç”¨<code>WH_JOURNALRECORD Hook</code>è®°å½•ä¸‹æ¥çš„è¿ç»­çš„é¼ æ ‡å’Œé”®ç›˜äº‹ä»¶ã€‚åªè¦<code>WH_JOURNALPLAYBACK Hook</code>å·²ç»å®‰è£…ï¼Œæ­£å¸¸çš„é¼ æ ‡å’Œé”®ç›˜äº‹ä»¶å°±æ˜¯æ— æ•ˆçš„ã€‚<code>WH_JOURNALPLAYBACK Hook</code>æ˜¯å…¨å±€<code>Hook</code>ï¼Œä¸ä¼šæ³¨å…¥<code>dll</code>ã€‚<code>WH_JOURNALPLAYBACK Hook</code>è¿”å›è¶…æ—¶å€¼ï¼Œè¿™ä¸ªå€¼å‘Šè¯‰ç³»ç»Ÿåœ¨å¤„ç†æ¥è‡ªå›æ”¾<code>Hook</code>å½“å‰æ¶ˆæ¯ä¹‹å‰éœ€è¦ç­‰å¾…å¤šé•¿æ—¶é—´ï¼Œè¿™å°±ä½¿<code>Hook</code>å¯ä»¥æ§åˆ¶å®æ—¶äº‹ä»¶çš„å›æ”¾ã€‚</p><h3 id="7-WH-JOURNALRECORD"><a href="#7-WH-JOURNALRECORD" class="headerlink" title="7.WH_JOURNALRECORD"></a>7.WH_JOURNALRECORD</h3><p><code>WH_JOURNALRECORD Hook</code>ç”¨æ¥ç›‘è§†å’Œè®°å½•è¾“å…¥äº‹ä»¶ã€‚å¯ä»¥ä½¿ç”¨è¿™ä¸ª<code>Hook</code>è®°å½•è¿ç»­çš„é¼ æ ‡å’Œé”®ç›˜äº‹ä»¶ï¼Œç„¶åé€šè¿‡ä½¿ç”¨<code>WH_JOURNALPLAYBACK Hook</code>æ¥å›æ”¾ã€‚<code>WH_JOURNALRECORD Hook</code>æ˜¯å…¨å±€<code>Hook</code>ï¼Œä¸ä¼šæ³¨å…¥<code>dll</code></p><h3 id="8-WH-KEYBOARD"><a href="#8-WH-KEYBOARD" class="headerlink" title="8.WH_KEYBOARD"></a>8.WH_KEYBOARD</h3><p>åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œ<code>WH_KEYBOARD Hook</code>ç”¨æ¥ç›‘è§†<code>WM_KEYDOWN</code> and <code>WM_KEYUP</code>æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆæ¯é€šè¿‡<code>GetMessage</code> or <code>PeekMessage</code> å‡½æ•°è¿”å›ã€‚å¯ä»¥ä½¿ç”¨è¿™ä¸ª<code>Hook</code>æ¥ç›‘è§†è¾“å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„é”®ç›˜æ¶ˆæ¯</p><h3 id="9-WH-KEYBOARD-LL"><a href="#9-WH-KEYBOARD-LL" class="headerlink" title="9.WH_KEYBOARD_LL"></a>9.WH_KEYBOARD_LL</h3><p>ç›‘è§†å³å°†è¾“å…¥åˆ°çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„é”®ç›˜æ¶ˆæ¯</p><h3 id="10-WH-MOUSE"><a href="#10-WH-MOUSE" class="headerlink" title="10.WH_MOUSE"></a>10.WH_MOUSE</h3><p>ç›‘è§†ä»<code>GetMessage</code> æˆ–è€… <code>PeekMessage</code> å‡½æ•°è¿”å›çš„é¼ æ ‡æ¶ˆæ¯ã€‚ä½¿ç”¨è¿™ä¸ª<code>Hook</code>ç›‘è§†è¾“å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„é¼ æ ‡æ¶ˆæ¯</p><h3 id="11-WH-MOUSE-LL"><a href="#11-WH-MOUSE-LL" class="headerlink" title="11.WH_MOUSE_LL"></a>11.WH_MOUSE_LL</h3><p>ç›‘è§†å³å°†è¾“å…¥åˆ°çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„é¼ æ ‡æ¶ˆæ¯</p><h3 id="12-WH-MSGFILTER-å’Œ-WH-SYSMSGFILTER"><a href="#12-WH-MSGFILTER-å’Œ-WH-SYSMSGFILTER" class="headerlink" title="12.WH_MSGFILTER å’Œ WH_SYSMSGFILTER"></a>12.WH_MSGFILTER å’Œ WH_SYSMSGFILTER</h3><p>å¯ä»¥ç›‘è§†èœå•ï¼Œæ»šåŠ¨æ¡ï¼Œæ¶ˆæ¯æ¡†ï¼Œå¯¹è¯æ¡†æ¶ˆæ¯å¹¶ä¸”å‘ç°ç”¨æˆ·ä½¿ç”¨<code>ALT+TAB</code> or <code>ALT+ESC</code> ç»„åˆé”®åˆ‡æ¢çª—å£</p><h3 id="13-WH-SHELL"><a href="#13-WH-SHELL" class="headerlink" title="13.WH_SHELL"></a>13.WH_SHELL</h3><p>å½“å¤–å£³åº”ç”¨ç¨‹åºæ˜¯æ¿€æ´»çš„å¹¶ä¸”å½“é¡¶å±‚çª—å£å»ºç«‹æˆ–è€…é”€æ¯æ—¶ï¼Œç³»ç»Ÿè°ƒç”¨<code>WH_SHELL Hook</code>å­ç¨‹</p><h2 id="ä¸ç®¡äº†ï¼Œå…ˆå¼€å§‹"><a href="#ä¸ç®¡äº†ï¼Œå…ˆå¼€å§‹" class="headerlink" title="ä¸ç®¡äº†ï¼Œå…ˆå¼€å§‹"></a>ä¸ç®¡äº†ï¼Œå…ˆå¼€å§‹</h2><p>ä¸Šé¢ä¸€å¤§å¨çœ‹å¾—å¤´ç—›æ˜¯å§ï¼Œé‚£å°±å…ˆåˆ«çœ‹äº†ï¼Œä¸å¦‚ä¸Šæ‰‹è¯•è¯•</p><p>å…¶å®å¤§å¤šæ•°äººå…¥æ‰‹<code>Hook</code>çš„ç¬¬ä¸€ä¸ªä¾‹å­å°±æ˜¯é¼ æ ‡å’Œé”®ç›˜é’©å­ï¼Œæ¯”å¦‚ï¼šè·å–å…¨å±€é”®ç›˜è¾“å…¥</p><p>é‚£ä¹ˆï¼Œé—®é¢˜æ¥äº†ï¼Œå“ªä¸€ç§ç±»å‹çš„<code>Hook</code>å¯ä»¥å®ç°è¿™ç§éœ€æ±‚å‘¢ï¼Ÿ</p><p>å°å­¦è‹±è¯­ä¹Ÿå¯ä»¥ç­›é€‰å‡ºä¸¤ä¸ªï¼š<code>WH_KEYBOARD</code> &amp;&amp; <code>WH_KEYBOARD_LL</code></p><p>Qï¼šé‚£è¿™ä¿©æ€ä¹ˆé€‰å˜›ï¼Œéƒ½æ˜¯<code>KeyBoard</code>ï¼Œè¯¶ï¼Œé‚£ä¸ª<code>LL</code>åç¼€æ˜¯å•¥å‘€</p><p>Aï¼šLow Levelï¼Œä»£è¡¨ä½çº§é”®ç›˜é’©å­</p><p>Qï¼šæœ‰å•¥åŒºåˆ«å‘¢</p><p>Aï¼š<code>WH_KEYBOARD_LL</code>ä¼šåœ¨æ¶ˆæ¯å³å°†å‘å¸ƒåˆ°çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—æ—¶è°ƒç”¨ï¼Œè€Œ<code>WH_KEYBOARD</code>ä¼šåœ¨æ¶ˆæ¯è¢«çº¿ç¨‹å¤„ç†å‰è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>WH_KEYBOARD_LL</code>è°ƒç”¨æ—¶æœºæ›´æ—©</p><p>è€Œä¸”ä½¿ç”¨èµ·æ¥æ›´ç®€å•ï¼Œä¸ºå•¥å‘¢ï¼Ÿå› ä¸º<code>WH_KEYBOARD_LL</code>è°ƒç”¨æ—¶ï¼Œæ¶ˆæ¯è¿˜æœªå‘å¸ƒåˆ°å…·ä½“çº¿ç¨‹ï¼Œæ‰€ä»¥ä¸ç”¨ç¼–å†™ç‹¬ç«‹<code>dll</code>ç”¨ä»¥æ³¨å…¥ã€‚åå¤„æ˜¯ï¼Œæ­£ç”±äºæ¶ˆæ¯è¿˜æœªå‘å¸ƒåˆ°å…·ä½“çº¿ç¨‹ï¼Œæ‰€ä»¥ä¸çŸ¥é“æ¶ˆæ¯çš„æ¥æ”¶è€…æ˜¯è°ã€‚</p><p>è€Œ<code>WH_KEYBOARD</code>æ˜¯åœ¨çº¿ç¨‹è·å–æ¶ˆæ¯æ—¶è°ƒç”¨ï¼Œæ‰€ä»¥ä¸Šä¸‹æ–‡å·²ç»åˆ‡æ¢è‡³å…·ä½“çº¿ç¨‹ï¼Œæƒ³è¦æ‰§è¡Œ<code>Hook</code>å‡½æ•°å°±å¿…é¡»ç¼–å†™ç‹¬ç«‹<code>dll</code>å¹¶å°†<code>dll</code>æ³¨å…¥æŒ‡å®šçº¿ç¨‹ï¼ˆ<code>Windows</code>æ‰§è¡Œæ³¨å…¥ï¼‰æ‰èƒ½æ‰§è¡Œï¼ˆåŒä¸€ç‰‡åœ°å€ç©ºé—´ï¼‰ï¼Œè¿™æ ·å°±ä¼šå‰Šå‰Šæœ‰ç‚¹éº»çƒ¦ï¼Œä½†å¯ä»¥å®ç°ç›‘æ§æŒ‡å®šçº¿ç¨‹</p><p>é‚£ä¹ˆä»€ä¹ˆ<code>Hook</code>å¯ä»¥ä¸ç”¨<code>dll</code>å‘¢ï¼Œè²Œä¼¼<code>Global Only</code>çš„å¯ä»¥ä¸è¦ï¼š</p><p><img src="/img/image-20220407142524115.png" alt="Hook Scope"></p><h2 id="å†™äº†å†è¯´"><a href="#å†™äº†å†è¯´" class="headerlink" title="å†™äº†å†è¯´"></a>å†™äº†å†è¯´</h2><p>ç®¡ä¸äº†é‚£ä¹ˆå¤šäº†ï¼Œç›´æ¥è½</p><p>ç¼–å†™é’©å­ç¨‹åºçš„æ­¥éª¤åˆ†ä¸ºä¸‰æ­¥ï¼šå®šä¹‰é’©å­å‡½æ•°ã€å®‰è£…é’©å­å’Œå¸è½½é’©å­</p><h3 id="1-å®šä¹‰é’©å­å‡½æ•°"><a href="#1-å®šä¹‰é’©å­å‡½æ•°" class="headerlink" title="1.å®šä¹‰é’©å­å‡½æ•°"></a>1.å®šä¹‰é’©å­å‡½æ•°</h3><p>é’©å­å‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„å›è°ƒå‡½æ•°ï¼Œé’©å­ç›‘è§†çš„ç‰¹å®šäº‹ä»¶å‘ç”Ÿåï¼Œç³»ç»Ÿä¼šè°ƒç”¨é’©å­å‡½æ•°è¿›è¡Œå¤„ç†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">LRESULT CALLBACK <span class="hljs-title">HookProc</span><span class="hljs-params">(<span class="hljs-type">int</span> nCode ,WPARAM wParam,LPARAM lParam)</span></span><br></code></pre></td></tr></table></figure><p>å‚æ•°<code>wParam </code>å’Œ <code>lParam</code>åŒ…å«æ‰€é’©æ¶ˆæ¯çš„ä¿¡æ¯ï¼Œæ¯”å¦‚é¼ æ ‡ä½ç½®ã€çŠ¶æ€ï¼Œé”®ç›˜æŒ‰é”®ç­‰ï¼Œ<code>nCode</code>åŒ…å«æœ‰å…³æ¶ˆæ¯æœ¬èº«çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ˜¯å¦ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç§»å‡º</p><p>åœ¨é’©å­å‡½æ•°ä¸­å®ç°äº†å…·ä½“åŠŸèƒ½åï¼Œè¿˜éœ€è¦è¿”å›å€¼</p><p>æ¨èç”¨<code>CallNextHookEx</code>å‡½æ•°æŠŠæ¶ˆæ¯ä¼ é€’ç»™åä¸€ä¸ªå¯¹è±¡ï¼ˆä¸‹ä¸€ä¸ªé’©å­å‡½æ•°æˆ–ç‰¹å®šçº¿ç¨‹ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">LRESULT <span class="hljs-title">CallNextHookEx</span><span class="hljs-params">( HHOOK hhk, <span class="hljs-type">int</span> nCode, WPARAM wParam, LPARAM lParam )</span></span><br></code></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥<code>return true</code>ä¸ç»§ç»­ä¼ é€’ï¼Œå³æ‹¦æˆªæ¶ˆæ¯</p><p>ï¼ˆè¿™æ ·éå¸¸éœ¸é“ï¼Œå¯ä»¥ç”¨æ¥å±è”½é”®ç›˜ï¼‰</p><p>æ³¨ï¼šåœ¨é’©å­å‡½æ•°ä¸­ï¼Œä¸è¦åšè€—æ—¶æ“ä½œï¼Œå¦åˆ™ä¼šé˜»å¡ç³»ç»Ÿï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™</p><h3 id="2-å®‰è£…é’©å­"><a href="#2-å®‰è£…é’©å­" class="headerlink" title="2.å®‰è£…é’©å­"></a>2.å®‰è£…é’©å­</h3><p>è°ƒç”¨å‡½æ•°<code>SetWindowsHookEx</code>å®‰è£…é’©å­ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">HHOOK <span class="hljs-title">SetWindowsHookEx</span><span class="hljs-params">( <span class="hljs-type">int</span> idHook,HOOKPROC lpfn, INSTANCE hMod,DWORD dwThreadId )</span></span><br></code></pre></td></tr></table></figure><ul><li><code>idHook</code>è¡¨ç¤ºé’©å­ç±»å‹ï¼Œå¦‚ï¼š<code>WH_KEYBOARD</code></li><li><code>lpfn</code>æ˜¯é’©å­å‡½æ•°çš„åœ°å€</li><li><code>hMod</code>æ˜¯é’©å­å‡½æ•°æ‰€åœ¨çš„å®ä¾‹çš„å¥æŸ„</li><li><code>dwThreadId</code>æŒ‡å®šé’©å­æ‰€ç›‘è§†çš„çº¿ç¨‹çš„IDï¼Œè‹¥ä¸º<code>NULL</code>ï¼Œåˆ™ç›‘è§†æ‰€æœ‰çº¿ç¨‹ï¼ˆå…¨å±€é’©å­ï¼‰</li><li>è¿”å›å€¼ä¸ºé’©å­å¥æŸ„ï¼ˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼‰</li></ul><p>æ³¨ï¼šæœ€è¿‘å®‰è£…çš„é’©å­æ”¾åœ¨<code>Hook</code>é“¾çš„å¼€å§‹ï¼Œè€Œæœ€æ—©å®‰è£…çš„é’©å­æ”¾åœ¨æœ€åï¼Œä¹Ÿå°±æ˜¯ååŠ å…¥çš„å…ˆè·å¾—æ§åˆ¶æƒ</p><p>æ³¨ï¼šå¦‚æœé’©å­è¿‡ç¨‹è¶…æ—¶ï¼Œç³»ç»Ÿå°†æ¶ˆæ¯ä¼ é€’ç»™ä¸‹ä¸€ä¸ªé’©å­ã€‚ä½†æ˜¯ï¼Œåœ¨ <code>Windows 7</code> åŠæ›´é«˜ç‰ˆæœ¬ä¸Šï¼Œè¯¥æŒ‚é’©ä¼šåœ¨ä¸è¢«è°ƒç”¨çš„æƒ…å†µä¸‹è¢«é™é»˜åˆ é™¤ã€‚åº”ç”¨ç¨‹åºæ— æ³•çŸ¥é“æŒ‚é’©æ˜¯å¦è¢«ç§»é™¤</p><p><strong>Windows 10 ç‰ˆæœ¬ 1709 åŠæ›´é«˜ç‰ˆæœ¬</strong>ç³»ç»Ÿå…è®¸çš„æœ€å¤§è¶…æ—¶å€¼ä¸º 1000 æ¯«ç§’ï¼ˆ1 ç§’ï¼‰ã€‚<strong>å¦‚æœLowLevelHooksTimeout</strong>å€¼è®¾ç½®ä¸ºå¤§äº 1000 çš„å€¼ï¼Œç³»ç»Ÿå°†é»˜è®¤ä½¿ç”¨ 1000 æ¯«ç§’è¶…æ—¶ã€‚</p><h3 id="3-å¸è½½é’©å­"><a href="#3-å¸è½½é’©å­" class="headerlink" title="3.å¸è½½é’©å­"></a>3.å¸è½½é’©å­</h3><p>é’©å­ç‰¹åˆ«æ˜¯ç³»ç»Ÿé’©å­ä¼šæ¶ˆè€—æ¶ˆæ¯å¤„ç†æ—¶é—´ï¼Œé™ä½ç³»ç»Ÿæ€§èƒ½ã€‚åªæœ‰åœ¨å¿…è¦çš„æ—¶å€™æ‰å®‰è£…é’©å­ï¼Œåœ¨ä½¿ç”¨å®Œæ¯•åè¦åŠæ—¶å¸è½½:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">BOOL <span class="hljs-title">UnhookWindowsHookEx</span><span class="hljs-params">(HHOOK hhk)</span></span><br></code></pre></td></tr></table></figure><p>ä¸è¿‡ï¼Œå®é™…ä¸Šå‘¢ï¼Œç”±äº<code>Windows</code>ç³»ç»Ÿçš„é²æ£’æ€§ï¼Œåœ¨ç¨‹åºé€€å‡ºæ—¶ï¼Œç³»ç»Ÿä¼šéšå¼é‡Šæ”¾æ‰€æœ‰å¥æŸ„ï¼Œæ‰€ä»¥å…¶å®ä¸ç”¨å¤ªæ‹…å¿ƒ</p><p>å®éªŒè¡¨æ˜ï¼Œå¦‚æœé’©å­å‡½æ•°å†™åœ¨<code>dll</code>ä¸­ï¼Œç¨‹åºç›´æ¥é€€å‡ºï¼Œç³»ç»Ÿä¼šé‡Šæ”¾<code>Hook</code>å¥æŸ„ï¼Œå¹¶å¸è½½åœ¨å…¶ä»–çº¿ç¨‹æ³¨å…¥çš„<code>dll</code>ï¼ˆå¯èƒ½æœ‰å»¶è¿Ÿï¼‰</p><p>æ³¨ï¼šè°ƒç”¨<code>SetWindowsHookEx</code>çš„è¿›ç¨‹è·å¾—å¥æŸ„ï¼ˆè½½å…¥<code>dll</code>åè°ƒç”¨ä¹Ÿæ˜¯ï¼ˆåŒä¸€è¿›ç¨‹ç©ºé—´ï¼‰ï¼‰</p><h2 id="å®æ“ï¼šä½çº§é”®ç›˜é’©å­ï¼ˆæ— dllï¼‰"><a href="#å®æ“ï¼šä½çº§é”®ç›˜é’©å­ï¼ˆæ— dllï¼‰" class="headerlink" title="å®æ“ï¼šä½çº§é”®ç›˜é’©å­ï¼ˆæ— dllï¼‰"></a>å®æ“ï¼šä½çº§é”®ç›˜é’©å­ï¼ˆæ— dllï¼‰</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setKeyboardHook</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    h_key = <span class="hljs-built_in">SetWindowsHookEx</span>(WH_KEYBOARD_LL, keyboardProc, <span class="hljs-built_in">GetModuleHandle</span>(<span class="hljs-literal">NULL</span>), <span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unHook</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (h_key != <span class="hljs-literal">nullptr</span>) &#123;<br>        <span class="hljs-built_in">UnhookWindowsHookEx</span>(h_key);<br>        h_key = <span class="hljs-literal">nullptr</span>;<br>    &#125;<br>&#125;<br><span class="hljs-function">LRESULT <span class="hljs-title">keyboardProc</span><span class="hljs-params">(<span class="hljs-type">int</span> nCode, WPARAM wParam, LPARAM lParam)</span></span><br><span class="hljs-function"></span>&#123;<span class="hljs-comment">//å…³äºwParam å’Œ lParamçš„å®šä¹‰ ä¸åŒHookç±»å‹éƒ½ä¸åŒï¼Œéœ€æŸ¥é˜…å¾®è½¯å®˜æ–¹æ–‡æ¡£</span><br>    <span class="hljs-built_in">qDebug</span>() &lt;&lt; <span class="hljs-string">&quot;keyBoard Hook:&quot;</span> &lt;&lt; ((KBDLLHOOKSTRUCT*)lParam)-&gt;vkCode;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯éå¸¸ç®€å•ï¼Œè¿™æ ·å°±å®ç°äº†å±è”½é”®ç›˜çš„åŠŸèƒ½</p><p>ä½†æ˜¯ï¼Œè¿™ä¹Ÿå¤ª<code>low</code>äº†å§ï¼Œè¿˜ä¸èƒ½ç›‘æ§æŒ‡å®šçº¿ç¨‹ï¼Œæ¢ç¢Ÿï¼</p><h2 id="å®æ“2ï¼šé¼ æ ‡é’©å­ï¼ˆdllï¼‰"><a href="#å®æ“2ï¼šé¼ æ ‡é’©å­ï¼ˆdllï¼‰" class="headerlink" title="å®æ“2ï¼šé¼ æ ‡é’©å­ï¼ˆdllï¼‰"></a>å®æ“2ï¼šé¼ æ ‡é’©å­ï¼ˆdllï¼‰</h2><p>ä¸€èˆ¬ä¸ç‰¹å®šçº¿ç¨‹&#x2F;çª—å£ç›¸å…³çš„é’©å­éƒ½éœ€è¦ç¼–å†™ç‹¬ç«‹<code>dll</code></p><p>é‚£ä¹ˆæ€ä¹ˆå†™å‘¢ï¼Ÿ</p><p>ä¸€èˆ¬ç”¨<code>Visual Studio</code>æ¥ç¼–å†™ï¼ˆæ–°å»º<code>dll</code>å·¥ç¨‹å°±æœ‰æ¨¡æ¿ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// dllmain.cpp : å®šä¹‰ DLL åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;pch.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;Windows.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> data_seg(<span class="hljs-string">&quot;.SHARE&quot;</span>)<span class="hljs-comment">//å…±äº«æ•°æ®æ®µ</span></span><br>HWND hWndServer = <span class="hljs-literal">NULL</span>;<br>HWND hWndTarget = <span class="hljs-literal">NULL</span>;<br>HHOOK hMouse = <span class="hljs-literal">NULL</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> data_seg()</span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(linker, <span class="hljs-string">&quot;/section:.SHARE,rws&quot;</span>)</span><br><br>HINSTANCE hInstance;<br>UINT UWM_MOUSEHOOK;<br><span class="hljs-function">BOOL APIENTRY <span class="hljs-title">DllMain</span><span class="hljs-params">(HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">switch</span> (ul_reason_for_call) &#123;<br>        <span class="hljs-keyword">case</span> DLL_PROCESS_ATTACH:<span class="hljs-comment">//é¦–æ¬¡è½½å…¥ç›®æ ‡è¿›ç¨‹</span><br>            hInstance = hModule;<br>            UWM_MOUSEHOOK = <span class="hljs-built_in">RegisterWindowMessage</span>(<span class="hljs-string">L&quot;Chrome_WH_MOUSE&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> DLL_THREAD_ATTACH:<br>        <span class="hljs-keyword">case</span> DLL_THREAD_DETACH:<br>        <span class="hljs-keyword">case</span> DLL_PROCESS_DETACH:<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> TRUE;<br>&#125;<br><br><span class="hljs-function">LRESULT CALLBACK <span class="hljs-title">MouseProc</span><span class="hljs-params">(<span class="hljs-type">int</span> nCode, WPARAM wParam, LPARAM lParam)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (nCode == HC_ACTION &amp;&amp; hWndServer) &#123;<br>        MOUSEHOOKSTRUCT* data = (MOUSEHOOKSTRUCT*)lParam;<br>        ::<span class="hljs-built_in">PostMessageA</span>(hWndServer, UWM_MOUSEHOOK, wParam, (LPARAM)data-&gt;hwnd);<span class="hljs-comment">//PostMessageä¸èƒ½å‘é€æŒ‡é’ˆ</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">CallNextHookEx</span>(hMouse, nCode, wParam, lParam);<br>&#125;<br><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> _declspec(dllexport)<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">setMouseHook</span><span class="hljs-params">(HWND hWnd, HWND target, DWORD* errorCode)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (hWndServer) &#123;<br>        *errorCode = <span class="hljs-number">11451444</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    hMouse = <span class="hljs-built_in">SetWindowsHookEx</span>(WH_MOUSE, (HOOKPROC)MouseProc, hInstance, <span class="hljs-built_in">GetWindowThreadProcessId</span>(hWndTarget = target, <span class="hljs-literal">NULL</span>));<br>    <span class="hljs-keyword">if</span> (hMouse) &#123;<br>        hWndServer = hWnd;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    *errorCode = <span class="hljs-built_in">GetLastError</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> _declspec(dllexport)<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">clearHook</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>hWndServer = <span class="hljs-literal">NULL</span>;<br>hMouse = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">UnhookWindowsHookEx</span>(hMouse);<span class="hljs-comment">//è‹¥hookå·²è¢«è‡ªåŠ¨å¸è½½ ä¹Ÿä¼šè¿”å›false</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> data_seg(<span class="hljs-string">&quot;.SHARE&quot;</span>)<span class="hljs-comment">//å…±äº«æ•°æ®æ®µ åå­—å¯ä»¥éšä¾¿å» ä½†è¦å’Œæœ€åä¸€å¥å¯¹åº”</span></span><br>HWND hWndServer = <span class="hljs-literal">NULL</span>;<br>HWND hWndTarget = <span class="hljs-literal">NULL</span>;<br>HHOOK hMouse = <span class="hljs-literal">NULL</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> data_seg()</span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(linker, <span class="hljs-string">&quot;/section:.SHARE,rws&quot;</span>)</span><br></code></pre></td></tr></table></figure><p>è¿™æ®µç”¨äºå®šä¹‰å…±äº«æ•°æ®æ®µ</p><p>ä¸ºä»€ä¹ˆè¦å…±äº«å‘¢ï¼Ÿå› ä¸º<code>dll</code>æ³¨å…¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ï¼Œæ•°æ®æ˜¯ä¸å…±äº«çš„ï¼Œé‚£å¯åäº†ï¼Œ<code>Hook</code>å¥æŸ„å’ŒæœåŠ¡ç«¯çª—å£å¥æŸ„éƒ½è¯»ä¸åˆ°äº†</p><p>ä¸ºäº†å…±äº«å°±éœ€è¦ç”¨åˆ°ç¼–è¯‘å™¨æŒ‡ä»¤<code>#pragma data_seg</code></p><p>åŒæ—¶ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> _declspec(dllexport)<br></code></pre></td></tr></table></figure><p>è¿™å¥è¯ç”¨äºå£°æ˜<code>dll</code>ä¸­è¦å¯¼å‡ºçš„å‡½æ•°ï¼ˆä»¥Cé£æ ¼ ä¸ºäº†å…¼å®¹æ€§ï¼‰ï¼Œå¦åˆ™å¤–éƒ¨ä¸èƒ½è®¿é—®</p><p>å¤„ç†å‡½æ•°åœ¨æ³¨å…¥åˆ°å…¶ä»–çº¿ç¨‹çš„<code>dll</code>ä¸­ï¼Œé‚£ä¹ˆå¤©é«˜çš‡å¸è¿œï¼Œæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½è·å–åˆ°æ¶ˆæ¯å‘¢ï¼Ÿ</p><p>è¿™å°±è¦è®©æ³¨å…¥çš„<code>dll</code>å……å½“å†…é¬¼äº†ï¼Œå°†æ¶ˆæ¯é€šè¿‡<code>PostMessage</code>ä¼ é€’å‡ºæ¥</p><p>ä¸ºå•¥æ˜¯<code>PostMessage</code>è€Œä¸æ˜¯<code>SendMessage</code>å‘¢ï¼Ÿ</p><p>å› ä¸ºå‰é¢è¯´äº†ï¼Œé’©å­å‡½æ•°è¦å°½é‡é«˜æ•ˆï¼Œä¸èƒ½é˜»å¡ï¼Œè€Œ<code>SendMessage</code>æ˜¯é˜»å¡å‡½æ•°ï¼Œæ˜¾ç„¶ä¸è¡Œ</p><p>é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œç”±äº<code>PostMessage</code>å¼‚æ­¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¸èƒ½ä¼ é€’æŒ‡é’ˆï¼ˆæ‰€æŒ‡å‘çš„å¯¹è±¡æ—©å°±é”€æ¯äº†ï¼‰</p><p>è€Œ<code>lParam</code>é€šå¸¸æ˜¯ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆ</p><p>é‚£å’‹åŠå‘¢ï¼Ÿ</p><p>è¦ä¹ˆç”¨<code>VirtualAlloc</code>åœ¨ç›®æ ‡è¿›ç¨‹å¼€ç©ºé—´ï¼Œç„¶åå¤åˆ¶è¿‡å»ï¼Œè¦ä¹ˆï¼Œæœ€å¤šåªèƒ½ä¼ é€’<code>sizeof(LPARAM)</code>ï¼Œ64bits 8å­—èŠ‚çš„æ•°æ®</p><p>é‚£å‘æ¶ˆæ¯æ€»å¾—æœ‰æš—å·å§</p><p>å¯ä»¥ä½¿ç”¨<code>RegisterWindowMessage</code>å®šä¹‰ç”¨æˆ·æ¶ˆæ¯ï¼Œæ¥æ”¶ç«¯å°±å¯ä»¥è¯†åˆ«äº†</p><h3 id="ä½¿ç”¨ä¾‹"><a href="#ä½¿ç”¨ä¾‹" class="headerlink" title="ä½¿ç”¨ä¾‹"></a>ä½¿ç”¨ä¾‹</h3><p>Okayï¼Œ<code>dll</code>å†™å®Œäº†ï¼Œæ€»å¾—æœ‰äººç”¨å§ï¼Œæˆ‘ä»¬ä»¥<code>Qt</code>ä¸ºä¾‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">bool</span> <span class="hljs-params">(*HookFunc)</span><span class="hljs-params">(HWND, HWND, DWORD*)</span></span>;<span class="hljs-comment">//å£°æ˜å‡½æ•°ç»“æ„</span><br><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">bool</span> <span class="hljs-params">(*UnHookFunc)</span><span class="hljs-params">()</span></span>;<br><span class="hljs-function">QLibrary <span class="hljs-title">lib</span><span class="hljs-params">(<span class="hljs-string">&quot;mouseHook.dll&quot;</span>)</span></span>;<br>HookFunc setMouseHook = (HookFunc)lib.<span class="hljs-built_in">resolve</span>(<span class="hljs-string">&quot;setMouseHook&quot;</span>);<span class="hljs-comment">//æ ¹æ®å‡½æ•°åå®šä½</span><br>UnHookFunc clearHook = (UnHookFunc)lib.<span class="hljs-built_in">resolve</span>(<span class="hljs-string">&quot;clearHook&quot;</span>);<br>HWND hWndChrome = <span class="hljs-built_in">FindWindowA</span>(<span class="hljs-string">&quot;Chrome_WidgetWin_1&quot;</span>, <span class="hljs-literal">NULL</span>);<br>DWORD errorCode;<br><span class="hljs-built_in">clearHook</span>();<span class="hljs-comment">//æ‰‹åŠ¨æ¸…é™¤hWndServeré˜²æ­¢Chrome dllæœªå¸è½½å¯¼è‡´å…±äº«å˜é‡æœªåˆ é™¤</span><br><span class="hljs-built_in">setMouseHook</span>((HWND)<span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">winId</span>(), hWndChrome, &amp;errorCode);<br></code></pre></td></tr></table></figure><p>å¯ä»¥ç”¨<code>QLibrary</code>è½½å…¥<code>dll</code>ï¼ˆ<code>Windows API</code>ä¸º<code>LoadLibrary</code>ï¼‰</p><p>å¹¶æ ¹æ®å‡½æ•°åå®šä½å‡½æ•°åœ°å€ï¼ˆæœ‰äº†åœ°å€å°±å¯ä»¥è°ƒç”¨äº†ï¼‰</p><p>ç„¶ååœ¨æ¶ˆæ¯å¾ªç¯ä¸­æ¥æ”¶å†…é¬¼<code>dll</code>å‘æ¥çš„ä¿¡æ¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">Widget::nativeEvent</span><span class="hljs-params">(<span class="hljs-type">const</span> QByteArray&amp; eventType, <span class="hljs-type">void</span>* message, <span class="hljs-type">long</span>* result)</span> </span><br><span class="hljs-function"></span>&#123;<br>    MSG* msg = (MSG*)message;<br>    <span class="hljs-type">static</span> <span class="hljs-type">const</span> UINT UWM_MOUSEHOOK = <span class="hljs-built_in">RegisterWindowMessageW</span>(<span class="hljs-string">L&quot;Chrome_WH_MOUSE&quot;</span>);<br>    <span class="hljs-keyword">if</span> (msg-&gt;message == UWM_MOUSEHOOK &amp;&amp; msg-&gt;wParam == WM_LBUTTONDBLCLK) &#123;<br>        HWND hwnd = (HWND)msg-&gt;lParam;<br>        <span class="hljs-built_in">qDebug</span>() &lt;&lt; <span class="hljs-string">&quot;WM_LBUTTONDBLCLK&quot;</span> &lt;&lt; hwnd;<br>        <span class="hljs-keyword">if</span> (Win::<span class="hljs-built_in">getWindowClass</span>(hwnd) == ChromeClass) &#123;<br>            Win::<span class="hljs-built_in">simulateKeyEvent</span>(<span class="hljs-built_in">QList</span>&lt;BYTE&gt;(&#123; VK_CONTROL, <span class="hljs-string">&#x27;W&#x27;</span> &#125;));<span class="hljs-comment">//æ¨¡æ‹ŸåŒå‡»å…³é—­æ ‡ç­¾é¡µ</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">//æ­¤å¤„è¿”å›falseï¼Œç•™ç»™å…¶ä»–äº‹ä»¶å¤„ç†å™¨å¤„ç†</span><br>&#125;<br></code></pre></td></tr></table></figure><p>Okayï¼Œå¤§åŠŸå‘Šæˆï¼Œè¿™æ ·å°±å®ç°äº†ç›‘å¬<code>Chrome</code>æ ‡é¢˜æ çš„å·¦é”®åŒå‡»å¹¶æ¨¡æ‹Ÿ<code>Ctrl+W</code>å…³é—­æ ‡ç­¾é¡µçš„æ•ˆæœ</p><h2 id="é—®é¢˜å’Œæ³¨æ„äº‹é¡¹"><a href="#é—®é¢˜å’Œæ³¨æ„äº‹é¡¹" class="headerlink" title="é—®é¢˜å’Œæ³¨æ„äº‹é¡¹"></a>é—®é¢˜å’Œæ³¨æ„äº‹é¡¹</h2><p>1.<a href="https://blog.csdn.net/immigrator/article/details/7560965">å…³äº<code>dll</code>è¢«å¤šä¸ªè¿›ç¨‹è°ƒç”¨</a></p><p><code>Win32</code>ç³»ç»Ÿä¼šç¡®ä¿å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªè¯¥<code>DLL</code>çš„æ‹·è´ï¼Œè¿™æ˜¯é€šè¿‡å†…å­˜æ˜ å°„æ–‡ä»¶æ¥å®ç°çš„ã€‚ä¸åŒçš„è¿›ç¨‹åˆ†åˆ«å°†è¿™ä»½<code>DLL</code>çš„ä»£ç æ®µåœ°å€æ˜ å°„åˆ°è‡ªå·±çš„è¿›ç¨‹ç©ºé—´ä¸­ï¼ŒåŒæ—¶ä¸åŒçš„è¿›ç¨‹åœ¨è‡ªå·±çš„è¿›ç¨‹ç©ºé—´åˆ†åˆ«æœ‰å„è‡ªçš„ä¸€ä»½è¯¥<code>DLL</code>çš„æ•°æ®æ®µï¼ˆå…¨å±€å˜é‡ï¼‰æ‹·è´</p><p>2.<a href="https://blog.csdn.net/immigrator/article/details/7560965">æ—¢ç„¶ä»£ç æ®µå…±äº«ï¼Œå¦‚æœè¿›ç¨‹Aä¸­ä¿®æ”¹<code>DLL</code>çš„ä»£ç å†…å®¹ï¼Œä½¿ç”¨åŒä¸€<code>DLL</code>çš„å…¶å®ƒè¿›ç¨‹Bæ˜¯å¦å—å½±å“ï¼Ÿ</a></p><p>NOï¼</p><p>è¿™å°±æ¶‰åŠåˆ°ä¸€ä¸ªå†…å­˜çš„<code>COPY ON WRITE</code>æœºåˆ¶é—®é¢˜</p><p>å¦‚æœè¿›ç¨‹Aä¿®æ”¹äº†<code>dll</code>ä»£ç æˆ–æ•°æ®ï¼Œåˆ™æœ‰å†…å®¹è¢«ä¿®æ”¹åï¼Œä¼šæ„é€ å‰¯æœ¬ï¼Œé‡æ–°æ˜ å°„</p><p>æ‰€ä»¥åŸºæœ¬ä¸Šå†…å­˜ä¸­åªæœ‰ä¸€ä»½<code>dll</code>å¯ä»¥èŠ‚çœç©ºé—´</p><p>3.ä¸è°ƒç”¨<code>UnhookWindowsHookEx</code>é‡Šæ”¾é’©å­ä¼šå¦‚ä½•ï¼Ÿ</p><p>å…¶å®ä¸ä¼šå¦‚ä½•ï¼Œç”±äº<code>Windows</code>ç³»ç»Ÿçš„é²æ£’æ€§ï¼Œåœ¨ç¨‹åºé€€å‡ºæ—¶ï¼Œç³»ç»Ÿä¼šéšå¼é‡Šæ”¾æ‰€æœ‰å¥æŸ„ï¼Œæ‰€ä»¥å…¶å®ä¸ç”¨å¤ªæ‹…å¿ƒ</p><p>å®éªŒè¡¨æ˜ï¼Œå¦‚æœé’©å­å‡½æ•°å†™åœ¨<code>dll</code>ä¸­ï¼Œç¨‹åºç›´æ¥é€€å‡ºï¼Œç³»ç»Ÿä¼šé‡Šæ”¾<code>Hook</code>å¥æŸ„ï¼Œå¹¶å¸è½½åœ¨å…¶ä»–çº¿ç¨‹æ³¨å…¥çš„<code>dll</code>ï¼ˆå¯èƒ½æœ‰<strong>å»¶è¿Ÿ</strong>ï¼‰</p><h4 id="æ‰€æœ‰dllé‡Šæ”¾åï¼Œå…±äº«æ•°æ®æ®µè¢«æ¸…ç©ºï¼ˆæˆ‘çŒœçš„ï¼‰"><a href="#æ‰€æœ‰dllé‡Šæ”¾åï¼Œå…±äº«æ•°æ®æ®µè¢«æ¸…ç©ºï¼ˆæˆ‘çŒœçš„ï¼‰" class="headerlink" title="æ‰€æœ‰dllé‡Šæ”¾åï¼Œå…±äº«æ•°æ®æ®µè¢«æ¸…ç©ºï¼ˆæˆ‘çŒœçš„ï¼‰"></a>æ‰€æœ‰<code>dll</code>é‡Šæ”¾åï¼Œå…±äº«æ•°æ®æ®µè¢«æ¸…ç©ºï¼ˆæˆ‘çŒœçš„ï¼‰</h4><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://blog.csdn.net/Castlehe/article/details/108275984">Visual Studioå…³äºhooké¡¹ç›®çš„ç®€å•ä½¿ç”¨_å¨å¨ä¸æ‰“é‡çš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://www.cnblogs.com/fanling999/p/4592740.html">HOOK API ï¼ˆä¸€ï¼‰â€”â€”HOOKåŸºç¡€+ä¸€ä¸ªé¼ æ ‡é’©å­å®ä¾‹ - â€¦..? - åšå®¢å›­</a></p><p><a href="http://www.flounder.com/hooks.htm">Hooks and DLLs</a></p><p><a href="https://blog.csdn.net/immigrator/article/details/7560965">æœ‰å…³DLLçš„å‡ ä¸ªé—®é¢˜_SONG_CAçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://docs.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-setwindowshookexa?redirectedfrom=MSDN">SetWindowsHookExA function (winuser.h) - Win32 apps | Microsoft Docs</a></p>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>Windows</tag>
      
      <tag>Hook</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¨¡æ‹ŸæŒ‰é”® - keybd_event Send/PostMessageçš„ä¸€äº›æ€è€ƒ</title>
    <link href="/2022/03/23/%E6%A8%A1%E6%8B%9F%E6%8C%89%E9%94%AE-keybd-event-Send-PostMessage%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"/>
    <url>/2022/03/23/%E6%A8%A1%E6%8B%9F%E6%8C%89%E9%94%AE-keybd-event-Send-PostMessage%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>åœ¨è½¯ä»¶å¼€å‘ï¼Œç‰¹åˆ«æ˜¯è¾…åŠ©è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦ç”¨åˆ°é”®ç›˜æŒ‰é”®æ¨¡æ‹Ÿæ¥å®ç°è‡ªåŠ¨åŒ–</p><p>æ¯”å¦‚ï¼Œä½¿ç”¨è™šæ‹Ÿé”®ç <code>VK_VOLUME_UP</code> &amp; <code>VK_VOLUME_DOWN</code>æ¥å®ç°éŸ³é‡è°ƒèŠ‚</p><p>æˆ–è€…ï¼Œä½¿ç”¨<code>VK_SNAPSHOT</code>å®ç°æˆªå±</p><p>è¿™æ˜¯ä¸€ç§å¯ä»¥é¿å¼€ç³»ç»Ÿ<code>API</code>å¤æ‚æ“ä½œçš„ï¼Œéå¸¸è®¨å·§çš„æ·å¾„</p><h2 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h2><h3 id="keybd-event"><a href="#keybd-event" class="headerlink" title="keybd_event"></a>keybd_event</h3><p>ä¸ºäº†å®ç°æŒ‰é”®æ¨¡æ‹Ÿï¼Œæˆ‘ä»¬å¸¸ç”¨<code>Windows API</code> - <code>keybd_event</code>:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">keybd_event</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">  [in] BYTE      bVk, <span class="hljs-comment">//ä¸€ä¸ªè™šæ‹Ÿé”®ç ã€‚ä»£ç å¿…é¡»æ˜¯ 1 åˆ° 254 èŒƒå›´å†…çš„å€¼</span></span></span><br><span class="hljs-params"><span class="hljs-function">  [in] BYTE      bScan, <span class="hljs-comment">//å¯†é’¥çš„ç¡¬ä»¶æ‰«æç </span></span></span><br><span class="hljs-params"><span class="hljs-function">  [in] DWORD     dwFlags, <span class="hljs-comment">//æ§åˆ¶åŠŸèƒ½æ“ä½œçš„å„ä¸ªæ–¹é¢: KEYEVENTF_EXTENDEDKEY | KEYEVENTF_KEYUP</span></span></span><br><span class="hljs-params"><span class="hljs-function">  [in] ULONG_PTR dwExtraInfo <span class="hljs-comment">//ä¸å‡»é”®å…³è”çš„é™„åŠ å€¼</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨<code>bVK</code> &amp; <code>dwFlags</code>å‚æ•°å³å¯ï¼ˆå¤æ‚æƒ…å†µï¼Œå¦‚æ¸¸æˆçª—å£ï¼Œéœ€è¦åŠ ä¸Šæ‰«æç ï¼‰</p><p>ä¸€ä¸ªå‡»é”®çš„è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼šæŒ‰ä¸‹ &amp; æŠ¬èµ·</p><p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬è¦æ¨¡æ‹Ÿé”®ç›˜ä¸Š<code>A</code>é”®çš„å‡»é”®ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-built_in">keybd_event</span>(<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">//ç¬¬ä¸‰ä¸ªå‚æ•°0ä»£è¡¨KeyDown</span><br><span class="hljs-built_in">keybd_event</span>(<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-number">0</span>, KEYEVENTF_KEYUP, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>æˆ–è€…æ˜¯ï¼Œå›è½¦é”®<code>ï¼ˆENTERï¼‰</code>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-built_in">keybd_event</span>(VK_RETURN, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br><span class="hljs-built_in">keybd_event</span>(VK_RETURN, <span class="hljs-number">0</span>, KEYEVENTF_KEYUP, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>çŸ¥é“äº†è¿™ç‚¹ï¼Œé‚£ä¹ˆæ¨¡æ‹Ÿç»„åˆé”®ä¹Ÿä¸åœ¨è¯ä¸‹äº†ï¼Œå¦‚<code>Ctrl+Tab</code>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-built_in">keybd_event</span>(VK_CONTROL, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<span class="hljs-comment">//æŒ‰ä¸‹Ctrl</span><br><span class="hljs-built_in">keybd_event</span>(VK_TAB, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<span class="hljs-comment">//æŒ‰ä¸‹Tab</span><br><span class="hljs-built_in">keybd_event</span>(VK_TAB, <span class="hljs-number">0</span>, KEYEVENTF_KEYUP, <span class="hljs-number">0</span>);<span class="hljs-comment">//æŠ¬èµ·Tab</span><br><span class="hljs-built_in">keybd_event</span>(VK_CONTROL, <span class="hljs-number">0</span>, KEYEVENTF_KEYUP, <span class="hljs-number">0</span>);<span class="hljs-comment">//æŠ¬èµ·Ctrl</span><br></code></pre></td></tr></table></figure><p>å…¶ä»–æŒ‰é”®çš„å®å®šä¹‰å¯ä»¥å‚è€ƒï¼š<a href="https://docs.microsoft.com/en-us/windows/win32/inputdev/virtual-key-codes">è™šæ‹Ÿé”®ä»£ç ï¼ˆVirtual-Key Codesï¼‰</a></p><p><em>æ³¨ï¼šå¾®è½¯å®˜æ–¹å»ºè®® - æ­¤åŠŸèƒ½å·²è¢«å–ä»£ã€‚è¯·æ”¹ç”¨<a href="https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-sendinput">SendInput</a>ï¼ˆå…¶å®å·®ä¸å¤šï¼‰</em></p><h3 id="SendMessage-x2F-PostMessage"><a href="#SendMessage-x2F-PostMessage" class="headerlink" title="SendMessage&#x2F;PostMessage"></a>SendMessage&#x2F;PostMessage</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Windows</code>ç³»ç»Ÿæ˜¯åŸºäºæ¶ˆæ¯çš„ï¼Œè€Œè¿™ä¸¤ä¸ªå‡½æ•°éƒ½æ˜¯å‘çª—å£å‘é€æ¶ˆæ¯</p><p>ä»–ä»¬çš„åŒºåˆ«åœ¨äºï¼š</p><ul><li><code>SendMessage</code>æ˜¯åŒæ­¥å‡½æ•°ï¼Œæˆ–è€…è¯´é˜»å¡å‡½æ•°ï¼Œè°ƒç”¨æŒ‡å®šçª—å£çš„çª—å£è¿‡ç¨‹ï¼Œç›´åˆ°çª—å£è¿‡ç¨‹<strong>å¤„ç†å®Œ</strong>æ¶ˆæ¯æ‰è¿”å›</li><li><code>PostMessage</code>æ˜¯å¼‚æ­¥å‡½æ•°ï¼Œåœ¨ä¸åˆ›å»ºæŒ‡å®šçª—å£çš„çº¿ç¨‹å…³è”çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶åœ¨<strong>ä¸ç­‰å¾…</strong>çº¿ç¨‹å¤„ç†æ¶ˆæ¯çš„æƒ…å†µä¸‹è¿”å›ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>SendMessage</code>è¿”å›çš„æ—¶å€™ï¼Œæ¶ˆæ¯è‚¯å®šè¢«å¯¹æ–¹å¤„ç†å®Œäº†</p><p>è€Œ<code>PostMessage</code>ä¸ç®¡å¤„ç†æ²¡å¤„ç†ï¼Œä»€ä¹ˆæ—¶å€™å¤„ç†ï¼Œç›´æ¥æ‰”è¿‡å»å°±è¿”å›äº†</p><p>å¥½å¤„æ˜¯ï¼Œå¯¹æ–¹ä¸å›åº”çš„æ—¶å€™ï¼Œè‡ªå·±ä¸ä¼šå¡æ­»ï¼ˆæŒ‚èµ·ï¼‰</p><p>ä¸ºä»€ä¹ˆè¦æè¿™ä¸¤ä¸ªå‡½æ•°å‘¢ï¼Œå› ä¸º<code>Windows</code>åŸºäºæ¶ˆæ¯ï¼Œæ‰€ä»¥æŒ‰é”®ä¹Ÿæ˜¯<code>æ¶ˆæ¯(WM_KEYDOWN | WM_KEYUP)</code></p><p>é‚£ä¹ˆåªè¦å‘æŒ‡å®šçª—å£å‘é€æ¶ˆæ¯å°±å¯ä»¥æ¨¡æ‹ŸæŒ‰é”®äº†ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">//æ¨¡æ‹ŸAé”®</span><br><span class="hljs-built_in">SendMessage</span>(hwnd, WM_KEYDOWN, <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-built_in">SendMessage</span>(hwnd, WM_KEYUP, <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>æ¯”<code>keybd_event</code>å¤šä¸€ä¸ªå‚æ•°ï¼Œè¿™é‡Œçš„<code>hwnd</code>æŒ‡çš„æ˜¯çª—å£å¥æŸ„ï¼Œç±»ä¼¼äºçª—å£çš„<code>ID</code></p><p>è€Œ<code>PostMessage</code>å¦‚æœè¿™ä¹ˆå†™çš„è¯ï¼Œå°±ä¼šå‘ç°ä¸å¯¹åŠ²äº†ï¼ŒæŒ‰é”®è²Œä¼¼è¢«é‡å¤äº†ä¸¤é</p><p>æŸ¥è¯¢èµ„æ–™ &amp; å®˜æ–¹æ–‡æ¡£å¯çŸ¥ï¼Œæˆ‘ä»¬å¿½ç•¥äº†æœ€åä¸€ä¸ªå‚æ•°ï¼š<code>lParam</code></p><blockquote><p>é‡å¤è®¡æ•°ã€æ‰«æç ã€æ‰©å±•é”®æ ‡å¿—ã€ä¸Šä¸‹æ–‡ä»£ç ã€å‰ä¸€ä¸ªé”®çŠ¶æ€æ ‡å¿—å’Œè½¬æ¢çŠ¶æ€æ ‡å¿—ï¼Œå¦‚ä¸‹æ‰€ç¤º</p></blockquote><p><img src="/img/image-20220323145807093.png" alt="lParam"></p><blockquote><p>å‡»é”®æ¶ˆæ¯çš„<strong>lParam</strong>å‚æ•°åŒ…å«æœ‰å…³ç”Ÿæˆæ¶ˆæ¯çš„å‡»é”®çš„é™„åŠ ä¿¡æ¯ã€‚è¯¥ä¿¡æ¯åŒ…æ‹¬é‡å¤è®¡æ•°ã€æ‰«æç ã€æ‰©å±•é”®æ ‡å¿—ã€ä¸Šä¸‹æ–‡ä»£ç ã€å‰ä¸€ä¸ªé”®çŠ¶æ€æ ‡å¿—å’Œè½¬æ¢çŠ¶æ€æ ‡å¿—ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†è¿™äº›æ ‡å¿—å’Œå€¼åœ¨<strong>lParam</strong>å‚æ•°ä¸­çš„ä½ç½®ã€‚</p></blockquote><p><img src="https://docs.microsoft.com/en-us/windows/win32/inputdev/images/csinp-02.png" alt="å‡»é”®æ¶ˆæ¯çš„ lparam å‚æ•°ä¸­çš„æ ‡å¿—å’Œå€¼çš„ä½ç½®"></p><p>ä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ª<code>32</code>ä½çš„å‚æ•°ä¸­ï¼Œè¡¨ç¤ºäº†å¤§é‡æ ‡å¿—ä¿¡æ¯ï¼Œè¿™éœ€è¦ç”¨åˆ°ä½è¿ç®—</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs C++">DWORD dwVKFkeyData;<br>WORD dwScanCode = <span class="hljs-built_in">MapVirtualKey</span>(<span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-number">0</span>);<span class="hljs-comment">//è®¡ç®—æ‰«æç </span><br>dwVKFkeyData = <span class="hljs-number">1</span>; <span class="hljs-comment">//00000...00001(b)</span><br>dwVKFkeyData |= dwScanCode &lt;&lt; <span class="hljs-number">16</span>;<br><span class="hljs-built_in">PostMessage</span>(hwnd, WM_KEYDOWN, <span class="hljs-string">&#x27;B&#x27;</span>, dwVKFkeyData);<br>dwVKFkeyData |= <span class="hljs-number">3</span> &lt;&lt; <span class="hljs-number">30</span>; <span class="hljs-comment">//11(b) &lt;&lt; 30</span><br><span class="hljs-built_in">PostMessage</span>(hwnd, WM_KEYUP, <span class="hljs-string">&#x27;B&#x27;</span>, dwVKFkeyData);<br></code></pre></td></tr></table></figure><p>è¿™æ ·æ‰èƒ½å®Œæˆä¸€æ¬¡<code>PostMessage</code>å‡»é”®æ¶ˆæ¯çš„æ­£ç¡®å‘é€</p><p>æ˜¾ç„¶æ˜¯<code>SendMessage</code>æ›´æ–¹ä¾¿ï¼Œä½†è¦è€ƒè™‘åˆ°é˜»å¡å‡½æ•°çš„æˆæœ¬</p><h2 id="é—®é¢˜ä¸æ€è€ƒ"><a href="#é—®é¢˜ä¸æ€è€ƒ" class="headerlink" title="é—®é¢˜ä¸æ€è€ƒ"></a>é—®é¢˜ä¸æ€è€ƒ</h2><p>ä»¥ä¸Šéƒ½æ˜¯ä¸€äº›åŸºç¡€æ“ä½œï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä¹Ÿéƒ½æ˜¯å¤§å®¶å…¬è®¤çš„</p><p>ä½†æ˜¯å‘¢ï¼Œéœ€æ±‚ä¸€æ—¦å¤æ‚åŒ–ï¼ŒåŸºæœ¬çš„ä¿¡æ¯å°±ä¸å¤Ÿç”¨äº†ï¼Œé—®é¢˜å°±èœ‚æ‹¥è€Œè‡³äº†</p><h3 id="å·®å¼‚"><a href="#å·®å¼‚" class="headerlink" title="å·®å¼‚"></a>å·®å¼‚</h3><p>é¦–å…ˆæˆ‘ä»¬è¯´ä¸€ä¸‹ï¼Œ<code>keybd_event</code> ä¸ <code>Send/PostMessage</code>çš„åŒºåˆ«å§</p><ul><li><p><code>keybd_event</code>æ˜¯å…¨å±€æŒ‰é”®æ¨¡æ‹Ÿï¼Œä¹Ÿå°±æ˜¯åƒçœŸå®åœ°æŒ‰é”®ä¸€æ ·ï¼Œå°†æ¶ˆæ¯å‘é€ç»™<strong>å‰å°æ´»åŠ¨</strong>çª—å£ï¼Œä¹Ÿå°±æ˜¯<strong>ç„¦ç‚¹</strong>çª—å£ï¼Œè¿™æ˜¯ä¸€å¤§é™åˆ¶</p></li><li><p><code>Send/PostMessage</code>å¯ä»¥è‡ªè¡ŒæŒ‡å®šå‘é€çš„çª—å£å¯¹è±¡ï¼Œå¯ä»¥å‘<strong>æ— ç„¦ç‚¹</strong>çš„çª—å£å‘é€æŒ‰é”®ä¿¡æ¯ï¼Œæ›´çµæ´»</p></li></ul><p>å¦‚æœä¸–ä¸ŠçœŸæœ‰è¿™æ ·å®Œç¾çš„å‡½æ•°å°±å¥½äº†ï¼Œé‚£å¦ä¸€æ–¹å°±ä¼šè¢«æŠ¹æ€</p><p>è¿™ä¸¤è€…åŒæ—¶å­˜åœ¨æ˜¯æœ‰åŸå› çš„ï¼š</p><ul><li><code>Send/PostMessage</code>æ— æ³•æ¨¡æ‹Ÿç»„åˆé”®ï¼ˆ<code>ALT</code>é™¤å¤–ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ï¼Œå› ä¸ºæ¶ˆæ¯åªæ˜¯çŠ¶æ€çš„<strong>åˆ‡æ¢</strong>ï¼Œä¸èƒ½<strong>ç»´æŒ</strong>æŒ‰ä¸‹ï¼Œè€Œç¨‹åºé€šå¸¸æ˜¯ç›´æ¥æ£€æµ‹<code>Ctrl Shift</code>ç­‰ä¿®é¥°é”®çš„çŠ¶æ€æ¥å†³å®šç»„åˆé”®çš„</li><li>æ¨¡æ‹ŸæŒ‰é”®æ—¶ï¼Œ<code>SendMessage</code>æœ‰æ—¶ä¼šå¤±æ•ˆï¼ˆå¦‚QQçª—å£ï¼‰ï¼Œæ‰€ä»¥å»ºè®®ç”¨<code>PostMessage</code>ï¼ˆ<em>åŸå› ä¸æ˜</em>ï¼‰</li></ul><h3 id="ç»„åˆé”®å¤„ç†"><a href="#ç»„åˆé”®å¤„ç†" class="headerlink" title="ç»„åˆé”®å¤„ç†"></a>ç»„åˆé”®å¤„ç†</h3><p>é‚£æ€ä¹ˆåŠï¼Œè¦å‘é€ç»„åˆé”®æ€ä¹ˆåŠ</p><p>å¦‚æœæ˜¯æ´»åŠ¨çª—å£ï¼Œé‚£ç›´æ¥<code>keybd_event</code>æ¨¡æ‹Ÿï¼Œæ²¡å•¥å¥½è¯´çš„</p><p>å¦‚æœæ˜¯éæ´»åŠ¨çª—å£æ€ä¹ˆåŠ</p><ul><li>æœ€ç²—æš´ï¼Œç›´æ¥å°†å…¶å˜ä¸ºå‰å°æ´»åŠ¨çª—å£ï¼Œç„¶åå†æ¨¡æ‹Ÿï¼ˆè®¾ç½®å‰å°çª—å£å‚è§ï¼š<a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-attachthreadinput">AttachThreadInput</a> &amp; <a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-setforegroundwindow">SetForegroundWindow</a>ï¼‰</li><li>â†‘ä½†è¿™æ˜¯ä¸ªæ‚–è®ºï¼Œè¿™æ ·å°±ä¸æ˜¯éæ´»åŠ¨çª—å£äº†</li><li>æˆ–è€…ç”¨<code>keybd_event</code>æ¨¡æ‹Ÿä¿®é¥°é”®ï¼ˆå¦‚<code>Ctrl</code>ï¼‰ + <code>Send/PostMessage</code>æ¨¡æ‹Ÿå…¶ä»–æŒ‰é”®ï¼ˆå¦‚<code>A</code>ï¼‰ï¼Œä½†é—®é¢˜åœ¨äºæ— æ³•å¾ˆå¥½åœ°é…åˆæ¶ˆæ¯é¡ºåºï¼Œå› ä¸º<code>keybd_event</code>ä¸ä¼šç­‰å¾…æ¶ˆæ¯å¤„ç†</li><li>è§£å†³åŠæ³•ï¼šåœ¨<code>keybd_event</code>ä¹‹åå»¶æ—¶ä¸€æ®µæ—¶é—´ï¼Œå†è¿›è¡Œ<code>SendMessage</code>ï¼Œå¯å®ç°å¯¹éæ´»åŠ¨çª—å£çš„ç»„åˆé”®æ§åˆ¶</li></ul><h3 id="å¾€ä¸‹-å†å¾€ä¸‹ï¼ˆé©±åŠ¨çº§æ¨¡æ‹Ÿï¼‰"><a href="#å¾€ä¸‹-å†å¾€ä¸‹ï¼ˆé©±åŠ¨çº§æ¨¡æ‹Ÿï¼‰" class="headerlink" title="å¾€ä¸‹ å†å¾€ä¸‹ï¼ˆé©±åŠ¨çº§æ¨¡æ‹Ÿï¼‰"></a>å¾€ä¸‹ å†å¾€ä¸‹ï¼ˆé©±åŠ¨çº§æ¨¡æ‹Ÿï¼‰</h3><p>ä¸€èˆ¬çš„çª—å£è¿™æ ·å°±è¡Œäº†ï¼Œä½†æ˜¯æ¸¸æˆçª—å£å¯èƒ½ä¼šç›´æ¥ä½¿ç”¨åº•å±‚ç¡¬ä»¶è¾“å…¥ï¼ˆä½å»¶æ—¶ï¼‰ï¼Œè€Œä¸ç»è¿‡<code>Windows</code></p><p>è¿™æ—¶å€™å°±ä¸èƒ½åœ¨ä½¿ç”¨<code>Windows</code>æ¶ˆæ¯æœºåˆ¶äº†ï¼Œå¿…é¡»ç›´æ¥å¯¹åº•å±‚ç«¯å£è¿›è¡Œæ“ä½œ</p><p>è¿™æ—¶å€™å°±éœ€è¦å¤–åŠ›å¸®åŠ©äº†</p><blockquote><p>WinIOç¨‹åºåº“å…è®¸åœ¨32ä½çš„Windowsåº”ç”¨ç¨‹åºä¸­ç›´æ¥å¯¹I&#x2F;Oç«¯å£å’Œç‰©ç†å†…å­˜è¿›è¡Œå­˜å–æ“ä½œã€‚é€šè¿‡ä½¿ç”¨ä¸€ç§å†…æ ¸æ¨¡å¼çš„è®¾å¤‡é©±åŠ¨å™¨å’Œå…¶å®ƒå‡ ç§åº•å±‚ç¼–ç¨‹æŠ€å·§ï¼Œå®ƒç»•è¿‡äº†Windowsç³»ç»Ÿçš„ä¿æŠ¤æœºåˆ¶</p></blockquote><p>æ‹“å±•èµ„æ–™ï¼š</p><p><a href="https://github.com/starofrainnight/winio">winioä¸‹è½½winioçš„æºç _GitHub_å¸®é…·</a></p><p><a href="https://www.cnblogs.com/WoodHower/p/14850251.html">winIOä»‹ç» - é‡è›®æœ¨å¤´ - åšå®¢å›­</a></p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="http://www.noobyard.com/article/p-fxffgjkm-gg.html">é”®ç›˜é¼ æ ‡æ¨¡æ‹Ÿå…¨çŸ¥é“ - èœé¸Ÿå­¦é™¢</a></p><p><a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-keybd_event">keybd_event function (winuser.h) - Win32 apps | Microsoft Docs</a></p><p><a href="https://docs.microsoft.com/en-us/windows/win32/inputdev/about-keyboard-input#keystroke-message-flags">About Keyboard Input - Win32 apps | Microsoft Docs</a></p><p><a href="https://docs.microsoft.com/en-us/windows/win32/inputdev/wm-keydown">WM_KEYDOWN message (Winuser.h) - Win32 apps | Microsoft Docs</a></p><p><a href="https://blog.csdn.net/lzl_li/article/details/117386885">é€šè¿‡PostMessage&#x2F;SendMessageå®ç°æ¨¡æ‹Ÿé”®ç›˜é¼ æ ‡æŒ‰é”®ï¼Œå‘é€ä¸æˆåŠŸæˆ–å‡ºç°é‡å¤æŒ‰é”®çš„å¯å‚è€ƒæœ¬æ–‡_lzl_liçš„åšå®¢-CSDNåšå®¢_c# sendmessageæ¨¡æ‹Ÿé”®ç›˜</a></p><p><a href="https://www.codeleading.com/article/40993377446/">å‘æŸä¸ªçª—å£å‘é€æŒ‰é”®æ¶ˆæ¯(åŒ…æ‹¬åå°éšè—çš„çª—å£) - ä»£ç å…ˆé”‹ç½‘</a></p>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°ä¸€æ¬¡æ•°ç»„è¶Šç•Œå¼•å‘çš„å†…å­˜ç¯¡æ”¹å¯¼è‡´çš„é‡æŒ‡é’ˆå¼•ç”¨ç¾éš¾</title>
    <link href="/2022/03/21/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%95%B0%E7%BB%84%E8%B6%8A%E7%95%8C%E5%BC%95%E5%8F%91%E7%9A%84%E5%86%85%E5%AD%98%E7%AF%A1%E6%94%B9%E5%AF%BC%E8%87%B4%E7%9A%84%E9%87%8E%E6%8C%87%E9%92%88%E5%BC%95%E7%94%A8%E7%81%BE%E9%9A%BE/"/>
    <url>/2022/03/21/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%95%B0%E7%BB%84%E8%B6%8A%E7%95%8C%E5%BC%95%E5%8F%91%E7%9A%84%E5%86%85%E5%AD%98%E7%AF%A1%E6%94%B9%E5%AF%BC%E8%87%B4%E7%9A%84%E9%87%8E%E6%8C%87%E9%92%88%E5%BC%95%E7%94%A8%E7%81%BE%E9%9A%BE/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>é‚£æ˜¯ä¸€ä¸ªé£å’Œæ—¥ä¸½çš„æ™šä¸Šï¼Œæˆ‘å›åˆ°å¯å®¤ï¼Œæ‰“å¼€ç”µè„‘ï¼Œå‘ç°æˆ‘çš„ç¨‹åºçª—å£ï¼ˆå§‘ä¸”å«å®ƒ<code>QF.exe</code>ï¼‰æ¶ˆå¤±äº†</p><ul><li>è¿™æ˜¯ä¸€ä¸ªè·ŸéšQQçª—å£çš„è¾…åŠ©å°ç¨‹åº</li></ul><p>â€œå¯èƒ½æ˜¯ä¹‹å‰å¿˜è®°å¼€äº†å§â€ï¼Œæˆ‘å¹¶æ²¡æœ‰å¤ªåœ¨æ„</p><p>éšåä¾¿å†æ¬¡æ‰“å¼€äº†<code>QF.exe</code></p><p>åˆ·åˆ·Bç«™ï¼Œç©ç©æ¸¸æˆï¼Œå¥½ä¸å¿«æ´»</p><p>å¯å½“æˆ‘å†æ¬¡æ‰“å¼€QQï¼Œç‚¹å‡»<code>QF</code>çš„çª—å£æ—¶ï¼Œçœ‹ç€æ—‹è½¬çš„é¼ æ ‡æŒ‡é’ˆï¼Œæˆ‘å¥½åƒçŸ¥é“æ¥ä¸‹æ¥è¦å‘ç”Ÿä»€ä¹ˆäº†</p><ul><li><code>QF</code>å†æ¬¡æ¶ˆå¤±äº†</li></ul><blockquote><p>ta è½»è½»åœ°èµ°äº†ï¼Œæ­£å¦‚ ta è½»è½»åœ°æ¥ï¼ŒæŒ¥ä¸€æŒ¥é¼ æ ‡ï¼Œä¸å¸¦èµ°ä¸€å—å†…å­˜</p><p>åªç•™æˆ‘ä¸€äººï¼Œåœ¨é£ä¸­å‡Œä¹±</p></blockquote><p>â€œta ä¸æ˜¯è¿™æ ·çš„äººï¼Œta ä»ä¸ä¼šä¸è¾è€Œåˆ«â€</p><p>æˆ‘è¿™æ‰æ„è¯†åˆ°äº‹æƒ…çš„ä¸¥é‡æ€§ï¼Œå…¶å®ä¹‹å‰ä¹Ÿå‘ç”Ÿè¿‡ç±»ä¼¼çš„äº‹æƒ…ï¼Œä½†æˆ‘å´ä¸€ç›´ä¸ä»¥ä¸ºæ„ï¼Œè®© ta æ‰¿å—äº†å¤ªå¤š</p><p>æ‚”ä¸å½“åˆï¼Œå¦‚æœç»™æˆ‘å†æ¥ä¸€æ¬¡çš„æœºä¼šï¼Œæˆ‘ä¸€å®šä¼šå¯¹ ta è¯´ä¸‰ä¸ªå­—ï¼š<strong>æˆ‘ç„¯ï¼</strong></p><p>åŠ ç­å§</p><h2 id="ä½ èƒ½å†è¡¨æ¼”ä¸€æ¬¡å—"><a href="#ä½ èƒ½å†è¡¨æ¼”ä¸€æ¬¡å—" class="headerlink" title="ä½ èƒ½å†è¡¨æ¼”ä¸€æ¬¡å—"></a>ä½ èƒ½å†è¡¨æ¼”ä¸€æ¬¡å—</h2><blockquote><p>ä¿®æ­£ç¨‹åºé”™è¯¯çš„ç¬¬ä¸€æ­¥æ˜¯è¦é‡ç°è¿™ä¸ªé”™è¯¯ã€‚â€”â€” Tom Duff</p></blockquote><p>å¦‚æœæ”¶é›†ä¸åˆ°è¶³å¤Ÿå¤šçš„<code>bug</code>æ ·ä¾‹ï¼Œå°±æ²¡æœ‰åŠæ³•å¯¹<code>bug</code>è¿›è¡Œåˆ†æ</p><p>æ‰€ä»¥<code>debug</code>çš„ç¬¬ä¸€æ­¥å°±æ˜¯å¤ç°<code>bug</code></p><p>å½“æ—¶æ— è®ºæˆ‘å¦‚ä½•æµ‹è¯•ç¨‹åºï¼Œta è¡¨ç°å¾—éƒ½æå…¶æ­£å¸¸ï¼Œåè€Œæ˜¯åœ¨æˆ‘æŠ›ä¹‹è„‘åå‡ å°æ—¶ï¼Œæ‰ä¼šå‡ºç°é—ªé€€ï¼Œå¹¶ä¸”æ—¶æœºæå…¶<strong>éšæœº</strong></p><ul><li>å³ï¼šæ— æ³•ç¡®å®š<code>bug</code>è§¦å‘æœºåˆ¶</li></ul><p>è°ƒæŸ¥é™·å…¥äº†åƒµå±€</p><h2 id="æœç‹—ï¼Œæˆ‘å«ä½ ä¸€å£°ä½ æ•¢åº”å—"><a href="#æœç‹—ï¼Œæˆ‘å«ä½ ä¸€å£°ä½ æ•¢åº”å—" class="headerlink" title="æœç‹—ï¼Œæˆ‘å«ä½ ä¸€å£°ä½ æ•¢åº”å—"></a>æœç‹—ï¼Œæˆ‘å«ä½ ä¸€å£°ä½ æ•¢åº”å—</h2><p>å”¯ä¸€å€¼å¾—åœ¨æ„çš„æ˜¯ï¼Œå¼‚å¸¸é€€å‡ºå‰ï¼Œåœ¨<code>QtCreator</code>çš„è¾“å‡ºçª—å£ä¸­å‡ºç°äº†è¿™ä¹ˆä¸€è¡Œï¼š<code>D:\SogouInput\Components</code></p><p><img src="/img/image-20220321175514697.png" alt="D:\SogouInput\Components"></p><p>å¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œè¿™ä¸æ˜¯æœ¬ç¨‹åºçš„ä»»ä½•è¾“å‡º</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦ä¹ˆæ˜¯<code>QtCreator</code>çš„æç¤ºï¼Œè¦ä¹ˆæ˜¯æœç‹—è¾“å…¥æ³•æçš„é¬¼</p><p>ç»è¿‡æœç´¢ï¼Œå‘ç°æˆ‘å¹¶ä¸æ˜¯å”¯ä¸€ä¸€ä¸ªå—åˆ°æœç‹—é’ççš„ç å†œ</p><p>æœ‰ä¸å°‘äººéƒ½é‡åˆ°è¿‡è¿™æ ·çš„æç¤ºï¼Œä½†å¤§ä¼™éƒ½ä¸€è‡´è¡¨ç¤ºï¼Œè¿™é”…è¿˜çœŸä¸èƒ½è®©æœç‹—èƒŒ</p><p><img src="/img/image-20220321175153078.png" alt="Google"></p><p><img src="/img/image-20220321175236363.png" alt="è·Ÿæœç‹—æ²¡å…³ç³»"></p><p>è€Œä¸”ï¼Œæˆ‘çš„è®°å¿†ä¸­è²Œä¼¼ä¹Ÿé‡åˆ°è¿‡è¿™æ ·çš„æç¤ºï¼Œç¡®å®æ˜¯é‡æŒ‡é’ˆçš„é—®é¢˜</p><h2 id="æ˜¯ä½ ï¼Œåˆä¸æ˜¯ä½ "><a href="#æ˜¯ä½ ï¼Œåˆä¸æ˜¯ä½ " class="headerlink" title="æ˜¯ä½ ï¼Œåˆä¸æ˜¯ä½ "></a>æ˜¯ä½ ï¼Œåˆä¸æ˜¯ä½ </h2><p>æ—¢ç„¶çŸ¥é“äº†æ˜¯é‡æŒ‡é’ˆçš„é—®é¢˜ï¼Œé‚£å°±æ‰¾å‘—</p><p>ä½†å¥‡æ€ªçš„æ˜¯ï¼Œåœ¨ååå¤å¤é˜…è¯»äº†æ‰€æœ‰ä»£ç åï¼Œæˆ‘ç¡®è®¤äº†ä¸€ä¸ªäº‹å®ï¼š</p><ul><li>æˆ‘çš„ä»£ç é‡Œæ²¡æœ‰ä»»ä½•å¯èƒ½çš„é‡æŒ‡é’ˆï¼Œå…¨å‘˜åˆå§‹åŒ–</li></ul><p>è°ƒæŸ¥å†æ¬¡é™·å…¥åƒµå±€</p><h2 id="Windows-ä½ æ€ä¹ˆçœ‹"><a href="#Windows-ä½ æ€ä¹ˆçœ‹" class="headerlink" title="Windows, ä½ æ€ä¹ˆçœ‹"></a>Windows, ä½ æ€ä¹ˆçœ‹</h2><p>é€šè¿‡<code>Windows</code>çš„äº‹ä»¶æŸ¥çœ‹å™¨ï¼Œæˆ‘ä»¬å‘ç°ï¼Œç¨‹åºçš„å¼‚å¸¸é€€å‡ºè§¦å‘äº†ä¸€æ¬¡<code>Application Error</code>è®°å½•</p><p><img src="/img/image-20220321181024001.png" alt="äº‹ä»¶æŸ¥çœ‹å™¨"></p><p>å¯ä»¥å‘ç°ï¼Œå‡ºé”™çš„æ¨¡å—ä¸ºï¼šQt5Gui.dll</p><p>è‡³å°‘å¯ä»¥ç¡®è®¤æ˜¯ä¸<code>GUI</code>ç›¸å…³å‡½æ•°å‡ºé”™ï¼Œä¸”é€šè¿‡é”™è¯¯åç§»é‡å¯ä»¥ç¡®è®¤å‡½æ•°åç§°ï¼ˆè™½ç„¶å½“æ—¶å¹¶ä¸çŸ¥é“Howï¼‰</p><p>ä½†ä¸<code>GUI</code>æ“ä½œç›¸å…³çš„ç±»å¤ªå¤šï¼Œä¾æ—§éš¾ä»¥å®šä½</p><h2 id="å¯¹ä¸èµ·ï¼Œæœç‹—"><a href="#å¯¹ä¸èµ·ï¼Œæœç‹—" class="headerlink" title="å¯¹ä¸èµ·ï¼Œæœç‹—"></a>å¯¹ä¸èµ·ï¼Œæœç‹—</h2><p>æœ‰è°è¿˜è®°å¾—æœç‹—ç»™æˆ‘ç•™ä¸‹çš„çº¿ç´¢ï¼š<code>D:\SogouInput\Components</code></p><p>æˆ‘å°è¯•ç€è¿›å…¥è¿™ä¸ªç›®å½•ï¼Œå‘ç°äº†<code>crash</code>æ–‡ä»¶å¤¹ï¼Œé‡Œé¢å«æœ‰ï¼š</p><ul><li>crash.dmp</li><li>errorlog.txt</li></ul><p><code>errorlog.txt</code>é‡Œè®°å½•äº†<code>QF</code>çš„å´©æºƒæ—¶é—´ï¼Œæ¨¡å—ä»¥åŠå½“æ—¶çš„æ‰€æœ‰è¿›ç¨‹</p><p>è€Œ<code>crash.dmp</code>æ˜¯<code>Windows</code>çš„å†…å­˜è½¬å‚¨æ–‡ä»¶ï¼Œéœ€è¦ç”¨<code>windbg</code>æ‰“å¼€</p><p>é‡Œé¢è®°å½•äº†<code>QF</code>å´©æºƒç¬é—´çš„å†…å­˜ä¿¡æ¯ï¼Œä»¥åŠå‡½æ•°è°ƒç”¨é“¾</p><p>è¿™æ˜¯ç¨‹åºç”Ÿå‘½æœ€åçš„é»‘åŒ£å­ï¼ˆwwwï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dmp">ExceptionAddress: 000000000119fa8a (Qt5Gui!ZNK4QPeneqERKS_+0x000000000000001a)<br>ExceptionCode: c0000005 (Access violation)<br>ExceptionFlags: 00000000<br>NumberParameters: 2<br>   Parameter[0]: 0000000000000000<br>   Parameter[1]: ffffffffffffffff<br>Attempt to read from address ffffffffffffffff<br><br>STACK_TEXT:  <br> Qt5Gui!ZNK4QPeneqERKS_+0x1a<br> Qt5Gui!ZN8QPainter6setPenERK4QPen+0x23<br> QQ_Follower+0x4d51<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯<code>dll</code>çš„å¯¼å‡ºå‡½æ•°ï¼Œè™½ç„¶å‡½æ•°åç»è¿‡å¤„ç†ï¼Œä¸è¿‡è¿˜æ˜¯èƒ½å¤§è‡´çœ‹å‡ºå…¶æœ¬æ¥é¢ç›®</p><h2 id="æ˜¯è°ï¼Ÿ"><a href="#æ˜¯è°ï¼Ÿ" class="headerlink" title="æ˜¯è°ï¼Ÿ"></a>æ˜¯è°ï¼Ÿ</h2><p>å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼Œå…ƒå‡¶æ˜¯<code>ZNK4QPeneqERKS_</code>è¿™ä¸ªå‡½æ•°è¿›è¡Œäº†éæ³•å†…å­˜è®¿é—®ï¼Œå¯¼è‡´çš„å´©æºƒ</p><p>è€Œä¸Šä¸€çº§è°ƒç”¨å‡½æ•°æ˜¯<code>ZN8QPainter6setPenERK4QPen</code></p><p>æ ¹æ®ä»£ç çŒœæµ‹ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°åˆ†åˆ«æ˜¯<code>QPen::operator==()</code> å’Œ <code>QPainter::setPen()</code></p><p>è€Œä¸”æœ¬ç¨‹åºå”¯ä¸€ä½¿ç”¨<code>QPainter::setPen()</code>çš„åœ°æ–¹åªæœ‰<code>paintEvent()</code></p><p>å¹¶ä¸”è²Œä¼¼ä¹‹å‰éƒ½æ˜¯åœ¨çª—ä½“é‡æ–°æ¸²æŸ“æ—¶ï¼Œå‡ºç°çš„é—ªé€€</p><p>è¿™ä¹ˆä¸€æ¥ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šæ˜¯<code>paintEvent()</code>ä¸­<code>QPainter::setPen()</code>çš„é—®é¢˜äº†</p><h2 id="ä¸ºä»€ä¹ˆæ˜¯ä½ ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ˜¯ä½ ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯ä½ ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ˜¯ä½ ï¼Ÿ</h2><p>ä¹ä¸€çœ‹ï¼Œå·²ç»æ‰¾åˆ°äº†é—®é¢˜æ‰€åœ¨ï¼Œä½†ä½ ä»”ç»†æƒ³æƒ³ï¼Œè¿™æ˜¯ååˆ†ä¸åˆç†çš„</p><p>åœ¨<code>paintEvent()</code>ä¸­åˆ©ç”¨<code>QPainter::setPen()</code>è®¾ç½®ç”»ç¬”ï¼Œæ”¹å˜é¢œè‰² &amp; çº¿æ¡ç²—ç»†ç­‰ï¼Œæ˜¯å¸¸è§„æ“ä½œï¼Œä¸åº”è¯¥å‡ºé—®é¢˜</p><p>åœ¨ä»”ç»†é˜…è¯»äº†<code>Qt</code>æºç åï¼Œæˆ‘å‘ç°ï¼Œ<code>QPainter::setPen()</code>ä¸­ç¡®å®ç”¨åˆ°äº†<code>QPen::operator==()</code> ç”¨ä»¥æ¯”è¾ƒæ–°æ—§ç”»ç¬”</p><p>ä½†æ˜¯è¿™ä¸ªå‡½æ•°æƒ³è¦å‡ºç°æŒ‡é’ˆå¼•ç”¨é”™è¯¯ï¼Œå°±åªèƒ½æ˜¯<code>QPainter::setPen(const QPen&amp; pen)</code>ä¼ å…¥çš„å‚æ•°<code>pen</code>çš„é—®é¢˜äº†</p><p>è¿™ä¸ª<code>pen</code>ï¼Œå—¯ï¼Œå—¯ï¼Ÿå—¯ï¼å—¯ï¼Ÿ</p><p>è¿™æ¬¡ç¡®å®æœ‰äº›ä¸åŒï¼Œä¸ºäº†å‡å°‘æ¯æ¬¡æ„é€  &amp; ææ„çš„å¼€é”€ï¼Œæˆ‘ä½¿ç”¨äº†<code>static</code>å°†<code>pen</code>ä¿®é¥°ä¸ºé™æ€å˜é‡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Widget::paintEvent</span><span class="hljs-params">(QPaintEvent* event)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">QPainter <span class="hljs-title">painter</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">static</span> QPen <span class="hljs-title">pen</span><span class="hljs-params">(Qt::darkGray, <span class="hljs-number">2</span>)</span></span>;<br>    painter.<span class="hljs-built_in">setPen</span>(pen);<br>    painter.<span class="hljs-built_in">drawRect</span>(<span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">rect</span>());<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸è¿‡ï¼Œé‚£åˆå¦‚ä½•å‘¢</p><p>ä¸€ä¸ª<code>static QPen</code>æ€»ä¸å¯èƒ½æ˜¯é‡æŒ‡é’ˆå§ï¼Œå†µä¸”æ˜¯é€šè¿‡<code>const &amp;</code>å¼•ç”¨ä¼ é€’</p><p>è™½è¯´<code>QPen</code>ç±»å†…å«æŒ‡é’ˆæˆå‘˜ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•å‡½æ•°ä¿®æ”¹è¿™ä¸ª<code>static</code>å¯¹è±¡å‘€</p><h2 id="ä¸ï¼Œä¸æ˜¯ä½ "><a href="#ä¸ï¼Œä¸æ˜¯ä½ " class="headerlink" title="ä¸ï¼Œä¸æ˜¯ä½ "></a>ä¸ï¼Œä¸æ˜¯ä½ </h2><p>ä¸åº”è¯¥ä¸åº”è¯¥ï¼Œæ€ä¹ˆè¯´éƒ½ä¸å¯èƒ½æ˜¯<code>static</code>çš„é—®é¢˜</p><p>è¿™éå¸¸è¿åæˆ‘å¤šå¹´æ¥çš„<code>C++</code>å¸¸è¯†</p><p>æ­¤æ¡ˆå¦æœ‰éšæƒ…</p><h2 id="è¯•è¯•ä¹Ÿæ— å¦¨"><a href="#è¯•è¯•ä¹Ÿæ— å¦¨" class="headerlink" title="è¯•è¯•ä¹Ÿæ— å¦¨"></a>è¯•è¯•ä¹Ÿæ— å¦¨</h2><p>åœ¨æ•°æ¬¡å¸Œæœ›ä¸å¤±æœ›ä¸­å¾˜å¾Šåï¼Œæˆ‘ç”šè‡³æƒ³è¿‡æ˜¯<code>Sougou</code>çš„<code>32/64 bits</code>ç‰ˆæœ¬é—®é¢˜</p><p>åœ¨æ€ç´¢æ— æœåï¼Œè™½ç„¶å¾ˆå†²å‡»æˆ‘çš„å¸¸è¯†ï¼Œä½†è¿˜æ˜¯å†³å®šæ­»é©¬å½“æ´»é©¬åŒ»ï¼Œè¯•è¯•å»æ‰<code>static</code></p><h2 id="æ‰‘æœ”è¿·ç¦»"><a href="#æ‰‘æœ”è¿·ç¦»" class="headerlink" title="æ‰‘æœ”è¿·ç¦»"></a>æ‰‘æœ”è¿·ç¦»</h2><p>åœ¨å»é™¤<code>static</code>åï¼Œç¦»å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†</p><p>è™½ç„¶ç¨‹åºè¿˜æ˜¯å´©æºƒäº†ï¼Œä½†æ˜¯<code>dmp</code>çš„åˆ†æç»“æœå´äº§ç”Ÿäº†å˜åŒ–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dmp">ExceptionAddress: 000000006895a94e (Qt5Core!ZN9QtPrivate20QStringList_containsEPK11QStringListRK7QStringN2Qt15CaseSensitivityE+0x000000000000000e)<br>ExceptionCode: c0000005 (Access violation)<br>ExceptionFlags: 00000000<br>NumberParameters: 2<br>   Parameter[0]: 0000000000000000<br>   Parameter[1]: ffffffffffffffff<br>Attempt to read from address ffffffffffffffff<br></code></pre></td></tr></table></figure><p>è¿™æ¬¡å‘ç”Ÿå¼‚å¸¸çš„å‡½æ•°ä¸å†æ˜¯<code>QPen::operator==()</code> è€Œæ˜¯<code>ZN9QtPrivate20QStringList_containsEPK11QStringListRK7QStringN2Qt15CaseSensitivityE</code></p><p>ä¹Ÿå°±æ˜¯ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++">QPrivate::<span class="hljs-built_in">QStringList_contains</span>(<span class="hljs-type">const</span> QStringList *that, <span class="hljs-type">const</span> QString &amp;str, Qt::CaseSensitivity cs)<br></code></pre></td></tr></table></figure><h2 id="æƒŠäººçš„ç›¸ä¼¼"><a href="#æƒŠäººçš„ç›¸ä¼¼" class="headerlink" title="æƒŠäººçš„ç›¸ä¼¼"></a>æƒŠäººçš„ç›¸ä¼¼</h2><p>é‚£ä¹ˆï¼Œæˆ‘åœ¨ä»€ä¹ˆåœ°æ–¹ä½¿ç”¨äº†è¿™ä¸ªå‡½æ•°å‘¢</p><p>æˆ‘è®°å¾—éå¸¸æ¸…æ¥š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-type">static</span> <span class="hljs-type">const</span> QStringList BlackList = &#123; <span class="hljs-string">&quot;XXX&quot;</span>, <span class="hljs-string">&quot;YYY&quot;</span>, <span class="hljs-string">&quot;ZZZ&quot;</span> &#125;;<br><span class="hljs-keyword">if</span>(BlackList.<span class="hljs-built_in">contains</span>(title))&#123;...&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘åªåœ¨è¿™ä¸ª<code>QStringList</code>å¯¹è±¡ä¸Šè°ƒç”¨äº†<code>contains</code>å‡½æ•°ï¼ˆè¯¥å‡½æ•°åœ¨å†…éƒ¨ä¼šç»§ç»­è°ƒç”¨ä¸Šè¿°å‡½æ•°ï¼‰</p><p>å‘ç°äº†å—ï¼Œåˆæ˜¯ä¸€ä¸ª<code>static</code>å¯¹è±¡ï¼Œåˆæ˜¯é‡æŒ‡é’ˆéæ³•å†…å­˜è®¿é—®</p><p>è¿™ç§ä¸è°‹è€Œåˆçš„ç›¸ä¼¼ï¼ŒçœŸæ˜¯è®©æˆ‘ä¸å¯’è€Œæ —</p><p>éš¾ä»¥è¨€è¯´ï¼Œä½†æœ‰ç§çœŸç›¸å‘¼ä¹‹æ¬²å‡ºçš„æ„Ÿè§‰</p><h2 id="å‰æ–¹æ˜¯ä»€ä¹ˆ"><a href="#å‰æ–¹æ˜¯ä»€ä¹ˆ" class="headerlink" title="å‰æ–¹æ˜¯ä»€ä¹ˆ"></a>å‰æ–¹æ˜¯ä»€ä¹ˆ</h2><p>ä¸ºäº†è§£å†³è¿™ä¸ªç–‘é—®</p><p>æˆ‘å†³å®šè¦äº²çœ¼çœ‹ä¸€çœ‹å†…å­˜</p><p>ç”¨<code>QtCreator</code>çš„<code>debug</code>æ¨¡å¼è°ƒè¯•ï¼Œå¹¶è®¾ç½®æ–­ç‚¹ï¼ŒæŸ¥çœ‹<code>BlackList</code>çš„å†…å­˜</p><p>ä¹ä¸€çœ‹ï¼Œå¹³å¹³æ— å¥‡ï¼Œä½†å½“æˆ‘æŠ¬å¤´æ—¶ï¼Œæˆ‘å´çœ‹åˆ°äº†ä»¤äººéœ‡æ’¼çš„ä¸€å¹•</p><h2 id="é¬¼å‹åºŠ"><a href="#é¬¼å‹åºŠ" class="headerlink" title="é¬¼å‹åºŠ"></a>é¬¼å‹åºŠ</h2><p><img src="/img/image-20220321192456055.png" alt="å†…å­˜"></p><p>åœ¨<code>BlackList</code>çš„å†…å­˜ä¸Šæ–¹ï¼Œèµ«ç„¶ç«‹ç€ä¸¤ä¸ªæ•°ç»„ <code>text</code> &amp; <code>path</code>ï¼Œåˆ†åˆ«å­˜å‚¨çª—å£æ ‡é¢˜å’Œè¿›ç¨‹è·¯å¾„</p><p>å¦‚æœè¿™ä¿©æ•°ç»„ä¸‹æº¢çš„è¯ï¼Œé‚£å°†ç›´æ¥è¦†ç›–<code>BlackList</code>çš„å†…å­˜ï¼Œåæœä¸å ªè®¾æƒ³ï¼Œå…¶ä¸­çš„æŒ‡é’ˆå¿…ç„¶é‡åŒ–</p><p>é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè¿™ä¿©æ•°ç»„ä¸ºä½•ä¼šå¹¶åˆ—<code>BlackList</code>å‡ºç°åœ¨è¿™é‡Œ</p><p>é‚£æ˜¯å› ä¸º <code>text</code> <code>path</code> <code>BlackList</code>å‡ä¸º<code>static</code>å˜é‡ï¼Œç»Ÿä¸€ç½®äºé™æ€å­˜å‚¨åŒº</p><h2 id="çœŸç›¸ï¼Ÿ"><a href="#çœŸç›¸ï¼Ÿ" class="headerlink" title="çœŸç›¸ï¼Ÿ"></a>çœŸç›¸ï¼Ÿ</h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´è¿˜åŸäº‹ä»¶çš„çœŸç›¸</p><p>å¯èƒ½æ˜¯æŸæ•°ç»„ä¸‹æº¢ï¼Œå¯¼è‡´<code>BlackList</code>ä¸­çš„æŒ‡é’ˆè¢«è¦†ç›–ï¼Œå¯¼è‡´äº§ç”Ÿé‡æŒ‡é’ˆï¼Œè§£å¼•ç”¨åéæ³•å†…å­˜è®¿é—®å¯¼è‡´å´©æºƒ</p><p>ä¸è¿‡ï¼Œç©¶ç«Ÿæ˜¯ä»€ä¹ˆå¯¼è‡´æ•°ç»„æº¢å‡ºï¼Ÿ</p><h2 id="æŸ³æš—èŠ±æ˜"><a href="#æŸ³æš—èŠ±æ˜" class="headerlink" title="æŸ³æš—èŠ±æ˜"></a>æŸ³æš—èŠ±æ˜</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">QString <span class="hljs-title">Win::getWindowText</span><span class="hljs-params">(HWND hwnd)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">static</span> WCHAR text[<span class="hljs-number">128</span>];<span class="hljs-comment">//#</span><br>    <span class="hljs-built_in">GetWindowTextW</span>(hwnd, text, <span class="hljs-built_in">sizeof</span>(text));<span class="hljs-comment">//#</span><br>    <span class="hljs-keyword">return</span> QString::<span class="hljs-built_in">fromWCharArray</span>(text);<br>&#125;<br><span class="hljs-function">QString <span class="hljs-title">Win::getProcessName</span><span class="hljs-params">(HWND hwnd)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (hwnd == <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">QString</span>();<br>    DWORD PID = <span class="hljs-built_in">getProcessID</span>(hwnd);<br><br>    <span class="hljs-type">static</span> WCHAR path[<span class="hljs-number">128</span>];<span class="hljs-comment">//#</span><br>    HANDLE Process = <span class="hljs-built_in">OpenProcess</span>(PROCESS_QUERY_INFORMATION | PROCESS_VM_READ, FALSE, PID);<br>    <span class="hljs-built_in">GetProcessImageFileNameW</span>(Process, path, <span class="hljs-built_in">sizeof</span>(path));<span class="hljs-comment">//#</span><br>    <span class="hljs-built_in">CloseHandle</span>(Process);<br><br>    QString pathS = QString::<span class="hljs-built_in">fromWCharArray</span>(path);<br>    <span class="hljs-keyword">return</span> pathS.<span class="hljs-built_in">mid</span>(pathS.<span class="hljs-built_in">lastIndexOf</span>(<span class="hljs-string">&#x27;\\&#x27;</span>) + <span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>é—®é¢˜åªå¯èƒ½å‡ºç°åœ¨<code>GetWindowTextW</code> &amp; <code>GetProcessImageFileNameW</code>çš„å‚æ•°ä¸Šï¼ˆWindows APIåˆ†ä¸ºWå’ŒAç‰ˆæœ¬ï¼ŒWä»£è¡¨å®½å­—ç¬¦ï¼‰</p><p>ä½†æ˜¯ä¸ºä»€ä¹ˆæ˜æ˜ç”¨äº†<code>sizeof</code>è¿˜ä¼šæº¢å‡ºå‘¢ï¼Ÿ</p><p>é—®é¢˜å°±å‡ºåœ¨è¿™</p><p>é˜…è¯»å®˜æ–¹æ–‡æ¡£å¯çŸ¥ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">GetWindowTextW</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">  [in]  HWND   hWnd,</span></span><br><span class="hljs-params"><span class="hljs-function">  [out] LPWSTR lpString,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in]  <span class="hljs-type">int</span>    nMaxCount <span class="hljs-comment">//å¤åˆ¶åˆ°ç¼“å†²åŒºçš„æœ€å¤§å­—ç¬¦æ•°ï¼ŒåŒ…æ‹¬ç©ºå­—ç¬¦ã€‚å¦‚æœæ–‡æœ¬è¶…å‡ºæ­¤é™åˆ¶ï¼Œåˆ™å°†å…¶æˆªæ–­ã€‚</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></table></figure><p>æœ€åä¸€ä¸ªå‚æ•°æ˜¯ æœ€å¤§<strong>å­—ç¬¦æ•°</strong>ï¼Œè€Œé<strong>å­—èŠ‚æ•°</strong></p><p>ä¸€å­—ä¹‹å·®ï¼Œå¯¼è‡´äº†ç¨‹åºçš„å´©æºƒ</p><p>åœ¨<code>ASCII</code>ç¼–ç ä¸‹ï¼Œä¸€å­—ç¬¦ä¸ºä¸€å­—èŠ‚ï¼Œå¯ä»¥ç”¨<code>sizeof</code>ç›´æ¥è·å–</p><p>è€Œä¸ºäº†è¡¨ç¤ºä¸­æ–‡ï¼Œå°±éœ€è¦ç”¨åˆ°å®½å­—ç¬¦<code>WCHAR</code>ï¼ˆwchar_tï¼‰</p><p>ä¸€ä¸ªå®½å­—ç¬¦å¹¶ä¸æ˜¯ä¸€å­—èŠ‚ æ‰€ä»¥ä½¿ç”¨<code>sizeof</code>ä¼šå¯¼è‡´ç»“æœå¤§äºå­—ç¬¦æ•°ï¼Œå¯¼è‡´<code>text</code>æº¢å‡º</p><p>æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨<a href="https://www.cnblogs.com/envoy/p/8352467.html"><code>_countof</code></a>å®æ¥è·å–å®é™…æ•°ç»„å…ƒç´ ä¸ªæ•°</p><p><code>path</code>åŒä¸Š</p><h2 id="ç»“æŸäº†å—ï¼Ÿ"><a href="#ç»“æŸäº†å—ï¼Ÿ" class="headerlink" title="ç»“æŸäº†å—ï¼Ÿ"></a>ç»“æŸäº†å—ï¼Ÿ</h2><p>å¹¶æ²¡æœ‰</p><p>ä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œ<code>text</code>åœ¨<code>path</code>ä¸Šæ–¹ï¼Œè¦æº¢å‡ºä¹Ÿæ˜¯å…ˆè¦†ç›–<code>path</code>ï¼Œå¹¶ä¸ä¼šå¯¹<code>BlackList</code>é€ æˆå½±å“</p><p>çœŸç›¸å°±åœ¨çœ¼å‰ï¼Œå´è¦å³°å›è·¯è½¬äº†å˜›ï¼Ÿ</p><p>ä»”ç»†å›å¿†å¯ä»¥å‘ç°ï¼Œç¨‹åºè²Œä¼¼åªåœ¨<code>release</code>æ¨¡å¼ä¸‹å´©æºƒè¿‡ï¼Œåœ¨<code>debug</code>æ¨¡å¼ä¸‹è™½ç„¶ä¹Ÿä¼šæœ‰<code>SougouInput</code>çš„ä¿¡æ¯ï¼š</p><ul><li>Shared library architecture i386 is not compatible with target architecture i386:x86-64.</li></ul><p>ä½†æ˜¾ç„¶ä¸ä¹‹å‰ä¸åŒï¼Œä¸”ä¸ä¼šé€ æˆå´©æºƒ</p><h2 id="å†·ä¸ä¸"><a href="#å†·ä¸ä¸" class="headerlink" title="å†·ä¸ä¸"></a>å†·ä¸ä¸</h2><p>éš¾é“æ˜¯<code>release</code> &amp; <code>debug</code>æ¨¡å¼ä¸‹å†…å­˜åˆ†å¸ƒä¸åŒï¼Ÿ</p><p>ç¡®æ˜¯å¦‚æ­¤</p><p>åœ¨<code>release</code>æ¨¡å¼ä¸‹è¾“å‡ºä¸‰è€…åœ°å€ï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns">path:         <span class="hljs-number">0x40d140</span><br>text:         <span class="hljs-number">0x40d240</span><br>&amp;BlackList:   <span class="hljs-number">0x40d358</span><br></code></pre></td></tr></table></figure><p>å‘ç°<code>text</code>æ›´é è¿‘<code>BlackList</code>ï¼Œæº¢å‡ºåç›´æ¥å¯¼è‡´å…¶è¦†ç›–</p><h2 id="è¿˜æ²¡å®Œ"><a href="#è¿˜æ²¡å®Œ" class="headerlink" title="è¿˜æ²¡å®Œ"></a>è¿˜æ²¡å®Œ</h2><p>çŸ¥é“äº†å†…éƒ¨æœºç†ï¼Œä½†ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå¯¼è‡´äº†<code>text</code>æº¢å‡º</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œçª—å£æ ‡é¢˜æ˜¯ä¸å¤ªå¯èƒ½è¶…è¿‡128å­—ç¬¦çš„</p><p>è¿™ä¹Ÿæ˜¯æ­¤<code>bug</code>éš¾ä»¥å¤ç°çš„åŸå› ä¹‹ä¸€</p><p>åœ¨å¶ç„¶æƒ…å†µä¸‹ï¼Œæˆ‘è®°å½•åˆ°äº†ä½¿ç¨‹åºå´©æºƒçš„çª—å£æ ‡é¢˜ï¼Œé•¿è¾¾173å­—ç¬¦</p><ul><li>æ˜¯<code>Chrome</code>æµè§ˆå™¨åœ¨åŠ è½½ç½‘é¡µçš„ç¬é—´ï¼Œçª—å£æ ‡é¢˜çŸ­æš‚å˜ä¸ºç½‘å€ï¼ˆå¯èƒ½è¿˜æœªè·å–åˆ°ç½‘é¡µæ ‡é¢˜ï¼‰</li></ul><p>è¿™ä¹Ÿè§£é‡Šäº†å¿…é¡»åœ¨ç©ä¹ä¹‹åæ‰ä¼šå´©æºƒçš„åŸå› </p><p>è€Œä¸”åœ¨<code>text</code>è¶Šç•Œåï¼Œç¨‹åºå¹¶ä¸ä¼šé©¬ä¸Šå´©æºƒï¼Œå¿…é¡»è¦åœ¨QQçª—å£é‡æ–°è·å–ç„¦ç‚¹å¹¶ç›‘æµ‹<code>BlackList</code>æ—¶ï¼Œæ‰ä¼šè§¦å‘é‡æŒ‡é’ˆ</p><p>æ›´å¢åŠ äº†<code>debug</code>éš¾åº¦</p><h2 id="ç»“æ¡ˆ"><a href="#ç»“æ¡ˆ" class="headerlink" title="ç»“æ¡ˆ"></a>ç»“æ¡ˆ</h2><p>è¯¥äº‹ä»¶ï¼Œååˆ†å¤æ‚ï¼Œè®©æˆ‘ä»¬æ¥æ‹ä¸€æ‹<code>bug</code>å‘ç”Ÿçš„æµç¨‹ï¼š</p><ul><li>æ˜¯<code>Chrome</code>æµè§ˆå™¨åœ¨åŠ è½½ç½‘é¡µçš„ç¬é—´ï¼Œçª—å£æ ‡é¢˜çŸ­æš‚å˜ä¸ºç½‘å€ï¼Œå¯¼è‡´<code>text</code>æº¢å‡º</li><li><code>text</code>æº¢å‡ºè¦†ç›–<code>static</code>çš„<code>QPen</code>ï¼ˆbeforeï¼‰ æˆ–è€… è¦†ç›–<code>static</code>çš„<code>QStringList</code>ï¼ˆAfterï¼‰ï¼Œå¯¼è‡´ä¸¤è€…å†…éƒ¨çš„æŒ‡é’ˆé‡åŒ–</li><li>å‰è€…åœ¨<code>paintEvent()</code>æ—¶å´©æºƒï¼Œåè€…åœ¨QQè·å–ç„¦ç‚¹ï¼Œæ¯”è¾ƒ<code>BlackList</code>æ—¶å´©æºƒï¼ˆéæ³•å†…å­˜è®¿é—®ï¼‰</li></ul><p>æ³¨æ„ç‚¹ï¼š</p><ul><li><code>release</code> &amp; <code>debug</code>æ¨¡å¼ä¸‹å†…å­˜åˆ†å¸ƒå¯èƒ½ä¸åŒ</li></ul><p>è§£å†³åŠæ³•ï¼š</p><ul><li>ä½¿ç”¨<a href="https://www.cnblogs.com/envoy/p/8352467.html"><code>_countof</code></a>å®æ¥è·å–å®é™…æ•°ç»„å…ƒç´ ä¸ªæ•°ï¼Œè€Œé<code>sizeof</code></li></ul><p>å¯ç¤ºï¼š</p><ul><li>ä½¿ç”¨<code>dmp</code>å†…å­˜è½¬å‚¨æ–‡ä»¶æ¥è®°å½•ç¨‹åºå´©æºƒç¬é—´çš„å†…å­˜ï¼Œå¹¶ç”¨<code>windbg</code>åˆ†æè°ƒç”¨é“¾</li><li>ä½¿ç”¨è°ƒè¯•æ¨¡å¼ï¼Œè§‚å¯Ÿå†…å­˜ï¼Œæ³¨æ„æ•°ç»„è¶Šç•Œ &amp; é‡æŒ‡é’ˆ</li><li>ä½¿ç”¨<a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump"><code>ProcDump</code></a>å·¥å…·åˆ›å»º<code>dmp</code>æ–‡ä»¶</li><li>å…¶å®<code>Windows</code>ç³»ç»Ÿä¹Ÿä¼šè‡ªåŠ¨ç”Ÿæˆ<code>dmp</code>æ–‡ä»¶ï¼Œè·¯å¾„ï¼š<code>C:\Users\ç”¨æˆ·å\AppData\Local\CrashDumps</code>ï¼ˆåœ¨ç³»ç»Ÿå±æ€§-é«˜çº§-å¯åŠ¨å’Œæ•…éšœæ¢å¤ä¸­è®¾ç½®ï¼‰</li></ul><p>æ³¨ï¼š</p><ul><li>æœç‹—è¾“å…¥æ³•å¯ä»¥è·å–ç¨‹åºå´©æºƒä¿¡æ¯ å¯èƒ½æ˜¯å› ä¸ºè¾“å…¥æ³•éœ€è¦<code>dll</code>æ³¨å…¥</li></ul><p>ç„¯ï¼š</p><ul><li>æˆ‘ä¸¤å¹´å‰å¥½åƒçŠ¯è¿‡è¿™æ ·çš„é”™è¯¯ï¼š</li><li><a href="https://blog.csdn.net/qq_33374268/article/details/107687784?spm=1001.2014.3001.5501">è®°ä¸€æ¬¡ C++ string å‡æ€§â€œå†…å­˜æ³„éœ²â€œ (_Big_allocation_sentinel)_MrBeanCçš„åšå®¢-CSDNåšå®¢_c++ stringå†…å­˜æ³„æ¼</a></li></ul><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump">ProcDump - Windows Sysinternals | Microsoft Docs</a></p><p><a href="https://blog.csdn.net/weixin_38416696/article/details/107576060">Qt åˆ©ç”¨ dmp æ–‡ä»¶è¿›è¡Œè°ƒè¯•_Copy-&gt;Pasteçš„åšå®¢-CSDNåšå®¢_dmp qt</a></p><p><a href="https://www.cnblogs.com/envoy/p/8352467.html">è¯»æ‡‚_countofï¼Œå¯ä»¥æ‡‚å¾—ä»€ä¹ˆ - envoy - åšå®¢å›­</a></p><p><a href="https://www.jianshu.com/p/d30c4fdd43cb">é‡æŒ‡é’ˆ Crash - ç®€ä¹¦</a></p><p><a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getwindowtextw">GetWindowTextW function (winuser.h) - Win32 apps | Microsoft Docs</a></p><p><a href="https://docs.microsoft.com/zh-cn/windows-hardware/drivers/debugger/getting-started-with-windbg">WinDbg å…¥é—¨ï¼ˆç”¨æˆ·æ¨¡å¼ï¼‰ - Windows drivers | Microsoft Docs</a></p><p><a href="https://blog.csdn.net/Evennaire/article/details/82229695">QtæŠ¥é”™ï¼šC:\Program Files (x86)\SogouInput\Components_PlasticMatrixçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://code.woboq.org/qt5/qtbase/src/gui/painting/qpainter.cpp.html#_ZN8QPainterD1Ev">qpainter.cpp source code [qtbase&#x2F;src&#x2F;gui&#x2F;painting&#x2F;qpainter.cpp] - Woboq Code Browser</a></p>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>Qt</tag>
      
      <tag>Windows</tag>
      
      <tag>Debug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºWindowsæ–‡ä»¶å…³è”</title>
    <link href="/2022/02/14/%E5%85%B3%E4%BA%8EWindows%E6%96%87%E4%BB%B6%E5%85%B3%E8%81%94/"/>
    <url>/2022/02/14/%E5%85%B3%E4%BA%8EWindows%E6%96%87%E4%BB%B6%E5%85%B3%E8%81%94/</url>
    
    <content type="html"><![CDATA[<p><a href="https://my.oschina.net/tojosaki/blog/1517530">Windows æ–‡ä»¶å…³è”æœºåˆ¶å‰–æ - ä¸œæ¡å’²çš„ä¸ªäººé¡µé¢ - OSCHINA - ä¸­æ–‡å¼€æºæŠ€æœ¯äº¤æµç¤¾åŒº</a></p><p><a href="https://docs.microsoft.com/zh-cn/windows/win32/shell/default-programs?redirectedfrom=MSDN#reg_examples">é»˜è®¤ç¨‹åº - Win32 apps | Microsoft Docs</a></p><p><a href="https://social.msdn.microsoft.com/Forums/vstudio/en-US/630ed1d9-73f1-4cc0-bc84-04f29cffc13b/what-registry-keys-are-responsible-for-file-extension-association?forum=netfxbcl">What registry keys are responsible for file extension association?</a></p><p><a href="https://blogs.windows.com/windows-insider/2015/05/20/announcing-windows-10-insider-preview-build-10122-for-pcs/">Announcing Windows 10 Insider Preview Build 10122 for PCs | Windows Insider Blog</a></p><p><a href="https://cainiaojiaocheng.com/questions/3536634/getting-file-associations-using-windows-api">ä½¿ç”¨Windows APIè·å–æ–‡ä»¶å…³è”|èœé¸Ÿæ•™ç¨‹</a></p><p><a href="https://blog.csdn.net/weixin_40269730/article/details/99676425">åˆ©ç”¨AssocQueryStringå‡½æ•°è·å–æ‰©å±•åçš„å…³è”ç¨‹åºè·¯å¾„_åŒå­¦xxçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/qq_41399894/article/details/109544067?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1.pc_relevant_default&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1.pc_relevant_default&utm_relevant_index=2">Qtä¹‹æ–‡ä»¶å…³è”_æœ—æœ—ä¸Šå£å°±è¡Œå•¦çš„åšå®¢-CSDNåšå®¢_qt æ–‡ä»¶å…³è”</a></p><p><a href="https://www.it1352.com/1278749.html">å¦‚ä½•ä»¥ç¼–ç¨‹æ–¹å¼åœ¨Windows 10ä¸­è®¾ç½®æ–‡ä»¶å…³è”ã€‚ - ITå±‹-ç¨‹åºå‘˜è½¯ä»¶å¼€å‘æŠ€æœ¯åˆ†äº«ç¤¾åŒº (it1352.com)</a></p><p><a href="http://www.cnit.net.cn/?id=616">ä¸ºå•¥ç”¨æ”¹æ³¨å†Œè¡¨æ–¹å¼æ— æ³•ä¿®æ”¹Win10_1803é»˜è®¤æµè§ˆå™¨_å…¶ä»–åˆ†äº«_æŠ€æœ¯å°å“¥ â€˜S blog (cnit.net.cn)</a></p><p><a href="https://zhuanlan.zhihu.com/p/79489549">Win10_64 é»˜è®¤åº”ç”¨çš„UserChoice Hashç®—æ³•å­¦ä¹  - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://download.csdn.net/download/wjc1231313/10335453?utm_source=bbsseo">win8ä»¥ä¸Šåç¼€å…³è”userchoiceè®¡ç®—hashå€¼_UserChoice-C++ä»£ç ç±»èµ„æº-CSDNæ–‡åº“</a></p><p><a href="https://www.zhihu.com/question/53466947?ivk_sa=1024320u">(29 å°ç§ä¿¡ &#x2F; 80 æ¡æ¶ˆæ¯) Win10æ€»æç¤ºâ€œå·²é‡ç½®åº”ç”¨é»˜è®¤è®¾ç½®â€æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://docs.microsoft.com/zh-cn/archive/blogs/windowsinternals/windows-10-how-to-configure-file-associations-for-it-pros">Windows 10 â€“ å¦‚ä½•ä¸ºITä¸“ä¸šäººå‘˜é…ç½®æ–‡ä»¶ï¼Ÿ |å¾®è½¯æ–‡æ¡£ (microsoft.com)</a></p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>å‡‰äº†ï¼Œ<code>Win10</code>ä¸å¤ªå»ºè®®ç¼–ç¨‹è®¾ç½®æ–‡ä»¶å…³è”ï¼Œæ›´å€¾å‘äºç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©</p>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>C++é‡æ„æ¡ˆä¾‹1ï¼šrepeat in switch</title>
    <link href="/2022/02/05/C++%E9%87%8D%E6%9E%84%E6%A1%88%E4%BE%8B1%EF%BC%9Arepeat-in-switch/"/>
    <url>/2022/02/05/C++%E9%87%8D%E6%9E%84%E6%A1%88%E4%BE%8B1%EF%BC%9Arepeat-in-switch/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>è¿™æ˜¯<strong>å›¾ç‰‡æŸ¥çœ‹å™¨</strong>(ImageViewer2.0)ä¸­çš„ä¸€æ®µä»£ç ï¼Œç”¨äºæ£€æµ‹æŒ‰é”®å¹¶åˆ‡æ¢å›¾ç‰‡ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Widget::keyPressEvent</span><span class="hljs-params">(QKeyEvent* event)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> N = fileList.<span class="hljs-built_in">size</span>();<span class="hljs-comment">//fileListå­˜æ”¾å›¾ç‰‡æ–‡ä»¶å</span><br>    <span class="hljs-keyword">switch</span> (event-&gt;<span class="hljs-built_in">key</span>()) &#123;<br>    <span class="hljs-keyword">case</span> Qt::Key_Left: &#123;<br>        index = <span class="hljs-built_in">qMax</span>(index - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>        QString filePath = curDirPath + <span class="hljs-string">&#x27;/&#x27;</span> + fileList[index];<br>        <span class="hljs-built_in">setPixmap</span>(filePath);<br>    &#125; <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> Qt::Key_Right: &#123;<br>        index = <span class="hljs-built_in">qMin</span>(index + <span class="hljs-number">1</span>, N - <span class="hljs-number">1</span>);<br>        QString filePath = curDirPath + <span class="hljs-string">&#x27;/&#x27;</span> + fileList[index];<br>        <span class="hljs-built_in">setPixmap</span>(filePath);<br>    &#125; <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œè¿™æ®µä»£ç æ£€æµ‹å°é”®ç›˜çš„<code>Left/Right</code>æŒ‰é”®ï¼Œå¹¶æ›´æ”¹<code>index</code>ä»¥åˆ‡æ¢å›¾ç‰‡</p><h2 id="å•é¡Œç‚¹"><a href="#å•é¡Œç‚¹" class="headerlink" title="å•é¡Œç‚¹"></a>å•é¡Œç‚¹</h2><p>ç”±äº<code>Left/Right</code>ä»…æœ‰<code>index</code>è‡ªå¢&#x2F;è‡ªå‡çš„åŒºåˆ«</p><p>å¯¼è‡´<strong>7ã€8</strong> &amp;&amp; <strong>12ã€13</strong>è¡Œä»£ç é‡å¤</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">QString filePath = curDirPath + <span class="hljs-string">&#x27;/&#x27;</span> + fileList[index];<span class="hljs-comment">//æ‹¼æ¥æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-built_in">setPixmap</span>(filePath);<span class="hljs-comment">//è®¾ç½®å›¾ç‰‡</span><br></code></pre></td></tr></table></figure><p>ä»£ç é‡å¤ï¼</p><p>æˆ‘ç„¯</p><p>é‡å¤äº†ä¸¤è¡Œä»£ç ï¼</p><p>ä½ èƒ½å¿å—ï¼Ÿï¼</p><p>æˆ‘ä¸èƒ½å¿</p><p>å£«å¯æ€ä¸å¯è¾±ï¼</p><h2 id="æ’å™"><a href="#æ’å™" class="headerlink" title="æ’å™"></a>æ’å™</h2><p>åœ¨å¼€å§‹è§£å†³è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œå…ˆæ¥è§£å¼€å¤§å®¶å¯¹äºä»£ç çš„ä¸€ç‚¹ç–‘é—®</p><h3 id="1-indexå¢å‡"><a href="#1-indexå¢å‡" class="headerlink" title="1.indexå¢å‡"></a>1.indexå¢å‡</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">index = <span class="hljs-built_in">qMax</span>(index - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>è¿™è¡Œä»£ç æ˜¯ä¸ºäº†é˜²æ­¢<code>index</code>åœ¨å‡å°çš„è¿‡ç¨‹ä¸­å˜æˆè´Ÿæ•°</p><p>çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜å¯¹å§</p><p>ç¡®å®æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯nie</p><p>æŒ‰ç…§æˆ‘é£æ ¼ï¼Œæ€ä¹ˆçš„ä¹Ÿå¾—å†™æˆï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">index = <span class="hljs-built_in">qMax</span>(--index, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>è¿™ç§å‰ç½®è‡ªå‡è¿ç®—ç¬¦å½¢å¼å§</p><p>è™½è¯´å¸…äº†ä¸€ç‚¹ï¼Œç®€æ´äº†ä¸€ç‚¹ï¼Œè¿™å®é™…ä¸Šè¿™æ˜¯<code>undefined</code>è¡Œä¸ºï¼šåœ¨ä¸€ä¸ªåºåˆ—ç‚¹å‰å¯¹<code>index</code>äº§ç”Ÿäº†ä¸¤æ¬¡<a href="https://blog.csdn.net/swordtraveller/article/details/110306917">å‰¯ä½œç”¨</a></p><ul><li><p><code>--index</code>è‡ªå‡æ“ä½œå¯¹<code>index</code>çš„æ”¹å˜ä¿è¯åœ¨<code>;</code>åˆ†å·ç»“æŸå‰å®Œæˆ</p></li><li><p>ç­‰å·å·¦è¾¹çš„<code>index</code>ä¹Ÿä¼šåœ¨<code>;</code>åˆ†å·ç»“æŸå‰è¢«æ”¹å˜</p></li></ul><p>æ— æ³•åˆ¤æ–­è¿™ä¸¤ç§å‰¯ä½œç”¨å‘ç”Ÿé¡ºåºï¼Œæ˜¯<code>undefined</code>è¡Œä¸º</p><p>æ‰€ä»¥ä¸å»ºè®®è¿™ä¹ˆå†™</p><h3 id="2-caseå†…èŠ±æ‹¬å·"><a href="#2-caseå†…èŠ±æ‹¬å·" class="headerlink" title="2.caseå†…èŠ±æ‹¬å·{}"></a>2.caseå†…èŠ±æ‹¬å·{}</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">case</span> Qt::Key_Left: &#123;<br>    index = <span class="hljs-built_in">qMax</span>(index - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>    QString filePath = curDirPath + <span class="hljs-string">&#x27;/&#x27;</span> + fileList[index];<br>    <span class="hljs-built_in">setPixmap</span>(filePath);<br>&#125; <span class="hljs-keyword">break</span>;<br></code></pre></td></tr></table></figure><p>ä¸ºä½•<code>case</code>å†…è¦åŠ ä¸ŠèŠ±æ‹¬å·(<code>line 1 &amp; 5</code>)å‘¢</p><p>é‚£æˆ‘ä»¬ä¸å¦¨å§èŠ±æ‹¬å·å»æ‰è¯•è¯•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp">E:\Qt5<span class="hljs-number">.14</span><span class="hljs-number">.2</span>\Projects\ImageViewer_2\widget.cpp:<span class="hljs-number">302</span>: error: jump to <span class="hljs-keyword">case</span> label [-fpermissive]<br>     <span class="hljs-keyword">default</span>:<br>     ^~~~~~~<br>E:\Qt5<span class="hljs-number">.14</span><span class="hljs-number">.2</span>\Projects\ImageViewer_2\widget.cpp:<span class="hljs-number">299</span>: note:   crosses initialization of <span class="hljs-string">&#x27;QString filePath&#x27;</span><br>         QString filePath = curDirPath + <span class="hljs-string">&#x27;/&#x27;</span> + fileList[index];<br>                 ^~~~~~~~<br></code></pre></td></tr></table></figure><p>å“¦å¼ æŠ¥é”™äº†</p><p>è¿™æ˜¯å› ä¸ºå˜é‡<code>filePath</code>çš„ä½œç”¨åŸŸæ˜¯åˆå§‹åŒ–ç‚¹åˆ°<code>switch</code>çš„ç»“å°¾å¤„</p><p>ç”±äºæˆ‘ä»¬æ— æ³•ç¡®å®šå…¶ä»–<code>case</code>ä¸­æ˜¯å¦ä¼šä½¿ç”¨åˆ°è¿™ä¸ªå˜é‡ï¼Œä¹Ÿæ— æ³•åˆ¤æ–­ä½¿ç”¨ä¹‹å‰å˜é‡æ˜¯å¦è¢«åˆå§‹åŒ–ï¼ˆé€‰æ‹©æ”¯å…·æœ‰ä¸ç¡®å®šæ€§ï¼‰</p><p>å¯¼è‡´ç¼–è¯‘å™¨æ™•ä¹</p><p>æ‰€ä»¥åªè¦ç”¨èŠ±æ‹¬å·<code>&#123;&#125;</code>é™å®š<code>filePath</code>çš„ä½œç”¨åŸŸåœ¨å•ä¸€<code>case</code>ä¸­å³å¯ï¼ˆä¸ä¼šæœ‰äººä¸çŸ¥é“<code>&#123;&#125;</code>é™åˆ¶ä½œç”¨åŸŸå§ï¼Œä¸ä¼šå§ä¸ä¼šå§ï¼‰</p><p>Okey-dokeyï¼Œè§£å†³äº†è¿™äº›ç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹é‡æ„ä»£ç äº†</p><h2 id="é‡æ„"><a href="#é‡æ„" class="headerlink" title="é‡æ„"></a>é‡æ„</h2><h3 id="å…¶ä¸€ï¼šcase-fall-through"><a href="#å…¶ä¸€ï¼šcase-fall-through" class="headerlink" title="å…¶ä¸€ï¼šcase fall through"></a>å…¶ä¸€ï¼šcase fall through</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>case</code>æ ‡ç­¾å†…çš„ä»£ç æ‰§è¡Œå®Œåå¹¶ä¸ä¼šä¸»åŠ¨é€€å‡º<code>switch</code>ï¼Œè€Œæ˜¯è‡ªç”±è½ä½“è‡³ä¸‹ä¸€ä¸ª<code>case</code></p><p>ï¼ˆè¿™ä¹Ÿå°±æ˜¯è¦åŠ ä¸Š<code>break</code>çš„åŸå› ï¼‰</p><p>ã ã‹ã‚‰ã€åªè¦åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå°±èƒ½è®©<code>case Qt::Key_Left</code>æ»‘è½åˆ°<code>case Qt::Key_Right</code></p><p>ä»è€Œå®ç°å¤ç”¨ä»£ç çš„ç›®çš„å•¦ï¼ˆå°å¤©æ‰ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Widget::keyPressEvent</span><span class="hljs-params">(QKeyEvent* event)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> N = fileList.<span class="hljs-built_in">size</span>();<br>    <span class="hljs-keyword">switch</span> (event-&gt;<span class="hljs-built_in">key</span>()) &#123;<br>    <span class="hljs-keyword">case</span> Qt::Key_Left:<br>        index -= <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">case</span> Qt::Key_Right: &#123;<br>        index = <span class="hljs-built_in">qBound</span>(<span class="hljs-number">0</span>, index + <span class="hljs-number">1</span>, N - <span class="hljs-number">1</span>);<span class="hljs-comment">//std::clamp</span><br>        QString filePath = curDirPath + <span class="hljs-string">&#x27;/&#x27;</span> + fileList[index];<br>        <span class="hljs-built_in">setPixmap</span>(filePath);<br>    &#125; <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶è¿™é‡Œä¼šç»™å‡º<code>Warningï¼šthis statement may fall through</code></p><p>hhh ç”¨çš„å°±æ˜¯è¿™ä¸ªç‰¹æ€§</p><p>ç„¶ååˆ©ç”¨<code>qBound</code>æ¥é™åˆ¶<code>index</code>èŒƒå›´ï¼ˆ<code>std::clamp</code>ä¹Ÿè¡Œï¼‰</p><h3 id="å…¶äºŒï¼šä¼˜é›…ã®lambda"><a href="#å…¶äºŒï¼šä¼˜é›…ã®lambda" class="headerlink" title="å…¶äºŒï¼šä¼˜é›…ã®lambda"></a>å…¶äºŒï¼šä¼˜é›…ã®lambda</h3><p>è™½è¯´<code>case</code>è‡ªç”±è½ä½“å¾ˆå¸…ï¼Œä¸è¿‡å¯è¯»æ€§åŸºæœ¬æ˜¯è´Ÿæ•°ï¼Œä¼°è®¡ä¸€ä¸ªæœˆåè‡ªå·±ä¹Ÿä¸€è„¸æ‡µé€¼äº†ï¼ˆè‡ªé£Ÿæ¶æœï¼‰</p><p>æ—¢ç„¶ä»£ç é‡å¤ï¼Œé‚£å°±å°è£…å‡½æ•°å°±å¥½äº†å˜›ï¼Œå¤šç®€å•çš„é“ç†</p><p>è€Œ<code>lambda</code>å¯ä»¥ç®€åŒ–å°å‡½æ•°çš„ä¹¦å†™ï¼Œä¸”å¯ä»¥å†™åœ¨å¦ä¸€ä¸ªå‡½æ•°å†…</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Widget::keyPressEvent</span><span class="hljs-params">(QKeyEvent* event)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">static</span> <span class="hljs-keyword">auto</span> alterPixmap = [=](<span class="hljs-type">int</span> i) &#123;<br>        QString filePath = curDirPath + <span class="hljs-string">&#x27;/&#x27;</span> + fileList[i];<br>        <span class="hljs-built_in">setPixmap</span>(filePath);<br>    &#125;;<br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> N = fileList.<span class="hljs-built_in">size</span>();<br>    <span class="hljs-keyword">switch</span> (event-&gt;<span class="hljs-built_in">key</span>()) &#123;<br>    <span class="hljs-keyword">case</span> Qt::Key_Left:<br>        index = <span class="hljs-built_in">qMax</span>(index - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-built_in">alterPixmap</span>(index);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> Qt::Key_Right:<br>        index = <span class="hljs-built_in">qMin</span>(index + <span class="hljs-number">1</span>, N - <span class="hljs-number">1</span>);<br>        <span class="hljs-built_in">alterPixmap</span>(index);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¨³å¥</p><p>ä¸è¿‡ï¼Œè¿™ä»£ç æ€ä¹ˆå˜é•¿äº†ï¼Œemmm ç­‰ä¸‹</p><p>æ—¢ç„¶å°è£…ï¼Œæˆ‘ä¸ºä»€ä¹ˆä¸æŠŠ<code>index</code>èŒƒå›´åˆ¤æ–­ä¹Ÿæ‰”è¿›å»ï¼Œç„¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Widget::keyPressEvent</span><span class="hljs-params">(QKeyEvent* event)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">static</span> <span class="hljs-keyword">auto</span> alterPixmap = [=](<span class="hljs-type">int</span> i) &#123;<br>        <span class="hljs-type">const</span> <span class="hljs-type">int</span> N = fileList.<span class="hljs-built_in">size</span>();<br>        index = <span class="hljs-built_in">qBound</span>(<span class="hljs-number">0</span>, i, N - <span class="hljs-number">1</span>);<span class="hljs-comment">//this-&gt;index</span><br>        QString filePath = curDirPath + <span class="hljs-string">&#x27;/&#x27;</span> + fileList[index];<br>        <span class="hljs-built_in">setPixmap</span>(filePath);<br>    &#125;;<br>    <span class="hljs-keyword">switch</span> (event-&gt;<span class="hljs-built_in">key</span>()) &#123;<br>    <span class="hljs-keyword">case</span> Qt::Key_Left:<br>        <span class="hljs-built_in">alterPixmap</span>(index - <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> Qt::Key_Right:<br>        <span class="hljs-built_in">alterPixmap</span>(index + <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å•Šå“ˆå“ˆå“ˆå“ˆï¼Œæˆ‘æ»´ä»»åŠ¡ å®Œæˆè¾£</p><p>åªèƒ½ç”¨å¸…æ°”æ¥å½¢å®¹</p><p>ä¸è¿‡è¿™é‡Œæœ‰ä¸ªå°çŸ¥è¯†ç‚¹éœ€è¦æ³¨æ„</p><h4 id="lambda-amp-this"><a href="#lambda-amp-this" class="headerlink" title="lambda &amp; this"></a><a href="https://www.cnblogs.com/jimodetiantang/p/9016826.html">lambda &amp; this</a></h4><p><code>lambda</code>çš„æ•è·åˆ—è¡¨è¦å¦‚ä½•å¤„ç†ç±»å†…çš„æ•°æ®æˆå‘˜ &amp; æˆå‘˜å‡½æ•°å‘¢ï¼Ÿ</p><p>å…¶å®é™…ä¸Šï¼Œæ‰€æœ‰çš„ç±»å†…å˜é‡ &amp; å‡½æ•°éƒ½æ˜¯é€šè¿‡<code>this</code>æŒ‡é’ˆæ¥è°ƒç”¨çš„</p><p>åªè¦ç”¨<code>[=]</code>æ‹·è´<code>this</code>æŒ‡é’ˆå³å¯</p><p>å¦‚ï¼š<code>index</code>ï¼Œå³<code>this-&gt;index</code>ï¼Œä¹Ÿå°±å¯ä»¥éšæ„ä¿®æ”¹è°ƒç”¨äº†</p><h3 id="å…¶ä¸‰ï¼šæ­£ç»å‡½æ•°"><a href="#å…¶ä¸‰ï¼šæ­£ç»å‡½æ•°" class="headerlink" title="å…¶ä¸‰ï¼šæ­£ç»å‡½æ•°"></a>å…¶ä¸‰ï¼šæ­£ç»å‡½æ•°</h3><p>è™½ç„¶<code>lambda</code>å¾ˆä¼˜é›…ï¼Œä½†æ˜¯åœ¨å‡½æ•°å†…å®šä¹‰ï¼Œæ— æ³•è¢«å¤–ç•Œè°ƒç”¨</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿˜æ˜¯è€è€å®å®å†™æˆå‡½æ•°å§ï¼ˆé¡ºä¾¿æ”¹ä¸ªåï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Widget::switchPixmap</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> N = fileList.<span class="hljs-built_in">size</span>();<br>    index = <span class="hljs-built_in">qBound</span>(<span class="hljs-number">0</span>, i, N - <span class="hljs-number">1</span>);<br>    QString filePath = curDirPath + <span class="hljs-string">&#x27;/&#x27;</span> + fileList[index];<br>    <span class="hljs-built_in">setPixmap</span>(filePath);<br>    <span class="hljs-keyword">return</span> index;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Widget::keyPressEvent</span><span class="hljs-params">(QKeyEvent* event)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">switch</span> (event-&gt;<span class="hljs-built_in">key</span>()) &#123;<br>    <span class="hljs-keyword">case</span> Qt::Key_Left:<br>        switchPixmap(index - <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> Qt::Key_Right:<br>        switchPixmap(index + <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Perfect</p><p>peace</p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://www.cnblogs.com/jimodetiantang/p/9016826.html">C++ä¹‹Lambdaè¡¨è¾¾å¼ - å­£æœ«çš„å¤©å ‚ - åšå®¢å›­</a></p><p><a href="https://blog.csdn.net/swordtraveller/article/details/110306917">ã€C++ã€‘åºåˆ—ç‚¹ä¸å‰¯ä½œç”¨_swordtravellerçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://zh.wikipedia.org/wiki/%E9%A1%BA%E5%BA%8F%E7%82%B9">é¡ºåºç‚¹ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦</a></p><p><a href="https://www.jianshu.com/p/254abfa7caed">ã€C++ å¼‚å¸¸ã€‘error: jump to case label [-fpermissive] - ç®€ä¹¦</a></p>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>é‡æ„</tag>
      
      <tag>switch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµ…æstd::function &amp; std::bind</title>
    <link href="/2022/02/01/%E6%B5%85%E6%9E%90std-function-std-bind/"/>
    <url>/2022/02/01/%E6%B5%85%E6%9E%90std-function-std-bind/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>å‡½æ•°(Function)</code>å°è£…äº†ä¸€ç³»åˆ—å¯å¤ç”¨çš„æ“ä½œé›†åˆï¼Œæ˜¯å„ç±»ç¼–ç¨‹è¯­è¨€ä¸­éå¸¸é‡è¦çš„æ¦‚å¿µ</p><p>åœ¨<code>C++</code>ä¸­ï¼Œé™¤äº†æ™®é€šå‡½æ•°ï¼Œè¿˜å¢åŠ äº†<code>ä»¿å‡½æ•°(Functor)</code>ï¼Œåˆç§°ä¸º<code>å‡½æ•°å¯¹è±¡</code>ï¼Œå®é™…ä¸Šæ˜¯é‡è½½äº†<code>å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦operator()</code>çš„ç±»</p><p>è€Œ<code>C++11</code>ä¸­æ–°å¢çš„<code>lambda</code>è¡¨è¾¾å¼å…¶å®å°±æ˜¯<code>åŒ¿åFunctor</code></p><h3 id="è¿™äº›ç»Ÿç§°ä¸ºå¯è°ƒç”¨å¯¹è±¡-callable-entity"><a href="#è¿™äº›ç»Ÿç§°ä¸ºå¯è°ƒç”¨å¯¹è±¡-callable-entity" class="headerlink" title="è¿™äº›ç»Ÿç§°ä¸ºå¯è°ƒç”¨å¯¹è±¡(callable entity):"></a>è¿™äº›ç»Ÿç§°ä¸º<code>å¯è°ƒç”¨å¯¹è±¡(callable entity)</code>:</h3><ul><li><p>æ™®é€šå‡½æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span></span>&#123;<span class="hljs-keyword">return</span> a + b;&#125; <br></code></pre></td></tr></table></figure></li><li><p><code>lambda</code>è¡¨è¾¾å¼ï¼š </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">auto</span> mod = [](<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)&#123; <span class="hljs-keyword">return</span> a % b;&#125;<br></code></pre></td></tr></table></figure></li><li><p>å‡½æ•°å¯¹è±¡ç±»ï¼š</p> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">divide</span>&#123;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(<span class="hljs-type">int</span> denominator, <span class="hljs-type">int</span> divisor)</span></span>&#123;<br>        <span class="hljs-keyword">return</span> denominator/divisor;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure></li></ul><h2 id="å•é¡Œç‚¹"><a href="#å•é¡Œç‚¹" class="headerlink" title="å•é¡Œç‚¹"></a>å•é¡Œç‚¹</h2><p>ä»¥ä¸Šä¸‰ç§å¯è°ƒç”¨å¯¹è±¡è™½ç„¶è°ƒç”¨å½¢å¼éƒ½æ˜¯ <code>int(int,int)</code></p><p>ä½†æ˜¯å®šä¹‰å½¢å¼äº”èŠ±å…«é—¨ï¼Œå¯¼è‡´å¾ˆéš¾ç”¨<strong>ç»Ÿä¸€çš„æ–¹å¼</strong>ä¼ é€’æˆ–ä¿å­˜</p><p>å¦‚æœå†é‡åˆ°ç±»æˆå‘˜å‡½æ•°ï¼Œå¦‚ä½•å£°æ˜å’Œè°ƒç”¨ï¼Œæ›´æ˜¯ä»¤äººå¤´å¤§</p><h2 id="å¤§ä¸€ç»Ÿï¼šå¹³æƒè¡¡ï¼Œæ­£åº¦é‡ï¼Œè°ƒè½»é‡"><a href="#å¤§ä¸€ç»Ÿï¼šå¹³æƒè¡¡ï¼Œæ­£åº¦é‡ï¼Œè°ƒè½»é‡" class="headerlink" title="å¤§ä¸€ç»Ÿï¼šå¹³æƒè¡¡ï¼Œæ­£åº¦é‡ï¼Œè°ƒè½»é‡"></a>å¤§ä¸€ç»Ÿï¼šå¹³æƒè¡¡ï¼Œæ­£åº¦é‡ï¼Œè°ƒè½»é‡</h2><p>å¤©ä¸‹åˆ†ä¹…å¿…åˆï¼Œåˆä¹…å¿…åˆ†</p><p>æ˜¯æ—¶å€™æ¥ç»Ÿä¸€åº¦é‡è¡¡äº†</p><h2 id="std-function"><a href="#std-function" class="headerlink" title="std::function"></a>std::function</h2><p><code>std::function</code>æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡åŒ…è£…å™¨ï¼Œæ˜¯ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œå¯ä»¥å®¹çº³æ‰€æœ‰å¯è°ƒç”¨å¯¹è±¡ï¼Œç”¨ç»Ÿä¸€çš„æ–¹å¼å¤„ç†å‡½æ•°å’Œä»¿å‡½æ•°ï¼Œå¹¶å…è®¸ä¿å­˜å’Œå»¶è¿Ÿå®ƒä»¬çš„æ‰§è¡Œ</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::function&lt;<span class="hljs-type">int</span>(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)&gt; a = add;<span class="hljs-comment">//æ™®é€šå‡½æ•°</span><br>std::function&lt;<span class="hljs-type">int</span>(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)&gt; b = mod;<span class="hljs-comment">//lambda</span><br>std::function&lt;<span class="hljs-type">int</span>(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)&gt; c = <span class="hljs-built_in">divide</span>();<span class="hljs-comment">//divide()åˆ›å»ºåŒ¿åå¯¹è±¡</span><br><span class="hljs-built_in">a</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);<br><span class="hljs-built_in">b</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);<br><span class="hljs-built_in">c</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure><p>è¿™æ ·ä¾¿å¯ä»¥èˆ’é€‚åœ°å®šä¹‰ã€å­˜å‚¨ä¸è°ƒç”¨ä¸€åˆ‡<code>å¯è°ƒç”¨å¯¹è±¡</code>äº†</p><blockquote><p>å¦‚æœè¿™è¿˜ä¸é…·ï¼Œä»€ä¹ˆæ˜¯é…·ï¼Ÿâ€”â€” ã€ŠEffective C++ä¸­æ–‡ç‰ˆï¼ˆç¬¬ä¸‰ç‰ˆï¼‰ã€‹p175</p></blockquote><h2 id="ç­‰ä¸€ä¸‹"><a href="#ç­‰ä¸€ä¸‹" class="headerlink" title="ç­‰ä¸€ä¸‹"></a>ç­‰ä¸€ä¸‹</h2><p>ã¡ã‚‡ã£ã¨å¾…ã£ã¦ï¼Œæˆ‘åˆšåˆšæ˜¯ä¸æ˜¯è¯´äº†â€œä¸€åˆ‡â€</p><p>æˆ‘æ˜¯ä¸æ˜¯å¿˜äº†ä»€ä¹ˆ</p><p>ä»€ä¹ˆå‘¢</p><h2 id="æˆå‘˜å‡½æ•°"><a href="#æˆå‘˜å‡½æ•°" class="headerlink" title="æˆå‘˜å‡½æ•°"></a>æˆå‘˜å‡½æ•°</h2><p>æˆå‘˜å‡½æ•°çš„ä¼ é€’ä¸è°ƒç”¨ä¸€ç›´æ˜¯ä¸€ä¸ªä»¤äººå¤´ç–¼çš„é—®é¢˜</p><p>ä½†åªè¦æŠ“ä½å…¶ä¸æ™®é€šå‡½æ•°çš„åŒºåˆ«ä¾¿å¯ä»¥ä¸€å‡»æ¯™å‘½</p><h2 id="æˆå‘˜å‡½æ•°-vs-æ™®é€šå‡½æ•°"><a href="#æˆå‘˜å‡½æ•°-vs-æ™®é€šå‡½æ•°" class="headerlink" title="æˆå‘˜å‡½æ•° vs æ™®é€šå‡½æ•°"></a>æˆå‘˜å‡½æ•° vs æ™®é€šå‡½æ•°</h2><p>æˆå‘˜å‡½æ•°å±äºç±»ï¼Œä¸”å¯ä»¥ä½¿ç”¨æˆå‘˜å˜é‡ï¼ˆéstaticå‡½æ•°ï¼‰</p><p>è€Œæˆå‘˜å˜é‡ä¾èµ–äºå…·ä½“å®ä¾‹</p><p>åœ¨ä¸æ˜ç¡®å…·ä½“å®ä¾‹çš„æƒ…å†µä¸‹ï¼Œæˆå‘˜å‡½æ•°æ²¡æœ‰åŠæ³•æ­£ç¡®æ‰§è¡Œ</p><p>æ­£æ˜¯å› ä¸ºå¦‚æ­¤ï¼Œæˆå‘˜å‡½æ•°å…¶å®æ˜¯æœ‰ä¸€ä¸ªéšå«å‚æ•°çš„ï¼ˆæŒ‡å‘å…·ä½“å®ä¾‹æŒ‡é’ˆï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Object</span>&#123;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b)</span></span>&#123;<span class="hljs-keyword">return</span> a+b;&#125;<br>&#125;<br><span class="hljs-comment">//Object::sumçš„å½¢å¼å…¶å®æ˜¯</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sum</span><span class="hljs-params">(Object* ptr,<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b)</span></span>;<span class="hljs-comment">//éšå¼å‚æ•°Object* ptr</span><br><span class="hljs-comment">//è°ƒç”¨ï¼š</span><br>(ptr-&gt;*sum)(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<span class="hljs-comment">//-&gt;*ä¸ºæˆå‘˜æŒ‡é’ˆè®¿é—®è¿ç®—ç¬¦</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥åœ¨è°ƒç”¨æˆå‘˜å‡½æ•°æ—¶ï¼Œå¿…é¡»æƒ³åŠæ³•æä¾›å…·ä½“å®ä¾‹çš„æŒ‡é’ˆ</p><h2 id="How"><a href="#How" class="headerlink" title="How"></a>How</h2><p>æ™®é€šè°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ <code>.*</code> æˆ–è€… <code>-&gt;*</code> è¿ç®—ç¬¦</p><p>ä½†æ˜¯åœ¨<code>std::function</code>å¯¹è±¡ä¸­ï¼Œæ›´ä¸ºç®€ä¾¿</p><p>ç›´æ¥å…·è±¡ä¸ºç¬¬ä¸€ä¸ªå‚æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Object</span>&#123;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b)</span></span>&#123;<span class="hljs-keyword">return</span> a+b;&#125;<br>&#125;<br>Object a;<br>std::function&lt;<span class="hljs-type">int</span>(Object*,<span class="hljs-type">int</span>,<span class="hljs-type">int</span>)&gt; func = &amp;Object::sum;<br><span class="hljs-built_in">func</span>(&amp;a,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<span class="hljs-comment">//ç›´æ¥ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°å³å¯</span><br></code></pre></td></tr></table></figure><p>å¦‚æœä½ ä¸æƒ³åœ¨è°ƒç”¨æ—¶ç»‘å®šå®ä¾‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>std::bind</code>å‡½æ•°åœ¨å®šä¹‰æ—¶ç»‘å®š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Object a;<br>std::function&lt;<span class="hljs-type">int</span>(<span class="hljs-type">int</span>,<span class="hljs-type">int</span>)&gt; func = std::<span class="hljs-built_in">bind</span>(&amp;Object::sum, &amp;a);<br><span class="hljs-built_in">func</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±æŠŠå¯¹è±¡<code>a</code>çš„åœ°å€ç»‘å®šåˆ°äº†å‡½æ•°å¯¹è±¡<code>func</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸Šï¼ˆä»ä¸‰ä¸ªå‚æ•°å˜æˆäº†ä¸¤ä¸ªå‚æ•°ï¼‰</p><h4 id="é¡ºä¾¿ä¸€æï¼Œstd-bindå…¶å®æ˜¯å°†å¯¹è±¡è¿›è¡Œäº†æ‹·è´"><a href="#é¡ºä¾¿ä¸€æï¼Œstd-bindå…¶å®æ˜¯å°†å¯¹è±¡è¿›è¡Œäº†æ‹·è´" class="headerlink" title="é¡ºä¾¿ä¸€æï¼Œstd::bindå…¶å®æ˜¯å°†å¯¹è±¡è¿›è¡Œäº†æ‹·è´"></a>é¡ºä¾¿ä¸€æï¼Œ<code>std::bind</code>å…¶å®æ˜¯å°†å¯¹è±¡è¿›è¡Œäº†<strong>æ‹·è´</strong></h4><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå¯¹è±¡<code>a</code>é”€æ¯ï¼Œ<code>func</code>ç…§æ ·å¯ä»¥æ­£å¸¸è°ƒç”¨</p><p>å¦‚æœæƒ³å°†æ‹·è´æ”¹ä¸ºå¼•ç”¨ï¼Œå¯ä»¥é‡‡ç”¨<code>ref(a)</code>å½¢å¼</p><h2 id="lambda"><a href="#lambda" class="headerlink" title="lambda"></a>lambda</h2><p>å…¶å®ï¼Œè°ƒç”¨<code>std::bind</code>è¿›è¡Œç»‘å®šè¿˜æ˜¯æœ‰äº›éº»çƒ¦çš„</p><blockquote><p>æ¯•ç«Ÿï¼Œåªæœ‰â€æ‡’â€ï¼Œæ‰èƒ½æ¨åŠ¨è‡ªåŠ¨åŒ–</p></blockquote><p><code>lambda</code>å…¶å®æœ¬èº«å°±æ˜¯ä¸ºäº†ç®€åŒ–å‡½æ•°å®šä¹‰è€Œå­˜åœ¨çš„</p><p>è€Œä¸”å…¶æœ¬è´¨æ˜¯é‡è½½äº†<code>operator()</code>çš„åŒ¿åå‡½æ•°å¯¹è±¡ç±»</p><p>æ‰€ä»¥åœ¨ä¼ é€’ç»™<code>std::function</code>æ—¶ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ— éœ€é¢å¤–ä¼ é€’å®ä¾‹ä¿¡æ¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::function&lt;<span class="hljs-type">int</span>(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)&gt; add = [](<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b) &#123; <span class="hljs-keyword">return</span> a + b; &#125;;<br><span class="hljs-built_in">add</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦å…¶ä½™å˜é‡æˆ–è€…æ‰€åœ¨ç±»çš„æˆå‘˜å˜é‡ï¼Œå¯ä»¥é€šè¿‡<code>lambda</code>çš„æ•è·åˆ—è¡¨ä¼ é€’</p><p>peace</p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://blog.csdn.net/zh379835552/article/details/19542181">C++11ä¸­çš„Lambdaè¡¨è¾¾å¼æ„æˆä¹‹â€”â€”æ•è·å€¼åˆ—è¡¨</a></p><p><a href="https://www.cnblogs.com/xusd-null/p/3698969.html">bindåŸç†å›¾é‡Š - xusd-null - åšå®¢å›­</a></p><p><a href="https://blog.csdn.net/analogous_love/article/details/77750629">å…³äºstd::bindç»‘å®šæ ˆå˜é‡å¯¹è±¡çš„æ€è€ƒ</a></p><p><a href="https://www.jianshu.com/p/f191e88dcc80">C++11 ä¸­çš„std::functionå’Œstd::bind - ç®€ä¹¦</a></p><p><a href="https://www.zhihu.com/question/25146152">å¦‚ä½•ä½¿ç”¨std::functionæŒ‡å‘ç±»çš„æˆå‘˜å‡½æ•°ï¼Ÿ - çŸ¥ä¹</a></p>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>std::function</tag>
      
      <tag>std::bind</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Qt-æ— è¾¹æ¡†çª—å£ è®¾ç½®ä»»åŠ¡æ ç¼©ç•¥å›¾</title>
    <link href="/2021/12/23/Qt-%E6%97%A0%E8%BE%B9%E6%A1%86%E7%AA%97%E5%8F%A3-%E8%AE%BE%E7%BD%AE%E4%BB%BB%E5%8A%A1%E6%A0%8F%E7%BC%A9%E7%95%A5%E5%9B%BE/"/>
    <url>/2021/12/23/Qt-%E6%97%A0%E8%BE%B9%E6%A1%86%E7%AA%97%E5%8F%A3-%E8%AE%BE%E7%BD%AE%E4%BB%BB%E5%8A%A1%E6%A0%8F%E7%BC%A9%E7%95%A5%E5%9B%BE/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p><strong>ä»»åŠ¡æ ç¼©ç•¥å›¾</strong>å¯ä»¥åœ¨ä¸æ¿€æ´»çª—å£çš„çŠ¶æ€ä¸‹æä¾›çª—å£çš„ç¼©ç•¥ä¿¡æ¯</p><p>å¯¹äºéŸ³ä¹æ’­æ”¾å™¨ç­‰è½¯ä»¶ï¼Œå°¤å…¶é‡è¦ï¼Œä¸ä»…å¯ä»¥å¢åŠ è§‚æ„Ÿï¼Œè¿˜èƒ½æ·»åŠ æ§åˆ¶æŒ‰é’®</p><p>æ˜¯ä¸“ä¸šç¨‹åºå‘˜çš„ä¸äºŒä¹‹é€‰</p><h2 id="ä¸”"><a href="#ä¸”" class="headerlink" title="ä¸”"></a>ä¸”</h2><p>éƒ½1202å¹´äº†ï¼Œä¸ä¼šè¿˜æœ‰äººä¸ç”¨<code>æ— è¾¹æ¡†çª—å£(Framless)</code>å§</p><h2 id="ã§ã‚‚"><a href="#ã§ã‚‚" class="headerlink" title="ã§ã‚‚"></a>ã§ã‚‚</h2><p><code>Qt</code>è‡ªå¸¦çš„<code>QWinThumbnailToolBar</code>ç±»æ˜¯å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œä»»åŠ¡æ ç¼©ç•¥å›¾çš„æ§åˆ¶</p><p>ä½†æ˜¯ï¼Œå¯¹äºæ— è¾¹æ¡†çª—å£ï¼Œè²Œä¼¼å‡ºç°äº†ä¸€äº›é—®é¢˜ï¼š</p><ul><li>ç¼©ç•¥å›¾å‘¨å›´å‡ºç°äº†[ç±»ä¼¼æ ‡é¢˜æ çš„è¾¹æ¡†] å¯¼è‡´å›¾ç‰‡é”™ä½ ååˆ†å½±å“ç¾è§‚</li></ul><p><img src="/img/image-20211223155027008.png" alt="é”™ä½è¾¹æ¡†"></p><p>åœ¨ä»”ç»†é˜…è¯»äº†<code>Qt</code>æ–‡æ¡£åï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆæ”¶è·ï¼Œè¯¥ç±»ååˆ†ç®€æ´ï¼Œå¹¶æ— å¤šäºå‡½æ•°å¯ä¾›æ“ä½œ</p><p>ç„¯</p><h2 id="æ­¢ã¾ã‚‹ã‚“ã˜ã‚ƒã­ã‚ˆ"><a href="#æ­¢ã¾ã‚‹ã‚“ã˜ã‚ƒã­ã‚ˆ" class="headerlink" title="æ­¢ã¾ã‚‹ã‚“ã˜ã‚ƒã­ã‚ˆ"></a>æ­¢ã¾ã‚‹ã‚“ã˜ã‚ƒã­ã‚ˆ</h2><blockquote><p>ä¸è¦åœä¸‹æ¥å•Š å›¢é•¿ï¼</p></blockquote><p>æ¯•ç«Ÿ<code>Qt</code>è¿˜æ˜¯å°è£…çš„<code>Windows API</code></p><p>æ‰€ä»¥è¿˜å¾—ä»<a href="https://docs.microsoft.com/zh-cn/windows/win32/shell/taskbar-extensions?redirectedfrom=MSDN"><code>Windows API</code></a>æ–‡æ¡£å…¥æ‰‹</p><p>åœ¨æœå¯»äº†å…³äº<code>TaskBar</code>çš„å†…å®¹åï¼Œæˆ‘æ‰¾åˆ°äº†è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼š<a href="https://docs.microsoft.com/zh-cn/windows/win32/api/dwmapi/nf-dwmapi-dwmseticonicthumbnail"><code>DwmSetIconicThumbnail</code></a></p><p>è¿™ä¸ªå‡½æ•°ä¸Qt-<code>QWinThumbnailToolBar::setIconicThumbnailPixmap</code>ä¸èƒ½è¯´å¾ˆåƒï¼Œç®€ç›´å°±æ˜¯åŒçˆ¶å¼‚æ¯</p><h2 id="DwmSetIconicThumbnail"><a href="#DwmSetIconicThumbnail" class="headerlink" title="DwmSetIconicThumbnail"></a>DwmSetIconicThumbnail</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">HRESULT <span class="hljs-title">DwmSetIconicThumbnail</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">  [in] HWND    hwnd,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in] HBITMAP hbmp,</span></span><br><span class="hljs-params"><span class="hljs-function">  [in] DWORD   dwSITFlags</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></table></figure><p>é‡ç‚¹åœ¨äºæœ€åä¸€ä¸ªå‚æ•° <code>dwSITFlags</code>ï¼š</p><ul><li>0 (0x00000000) - æä¾›çš„ç¼©ç•¥å›¾å‘¨å›´ä¸æ˜¾ç¤ºä»»ä½•<strong>æ¡†æ¶</strong></li><li>DWM_SIT_DISPLAYFRAME (0x00000001) - åœ¨æä¾›çš„ç¼©ç•¥å›¾å‘¨å›´æ˜¾ç¤ºä¸€ä¸ª<strong>æ¡†æ¶</strong></li></ul><p>ä¸»è¦å°±åœ¨äºè¿™ä¸ªå‚æ•°ä¸­çš„<strong>æ¡†æ¶</strong>äºŒå­—ï¼Œè”æƒ³æˆ‘ä»¬ä¹‹å‰å‡ºç°çš„é”™ä½æƒ…å†µï¼Œé‚£å¯ä¸å°±æ˜¯å¤šäº†ä¸€ä¸ª<strong>æ¡†æ¶</strong>å˜›</p><p>é‚£ä¹ˆåªè¦å°†å‚æ•°è®¾ç½®ä¸º<strong>0</strong>ï¼Œä¸å°±å¯ä»¥è§£å†³äº†å˜›</p><h2 id="æ ¹æº"><a href="#æ ¹æº" class="headerlink" title="æ ¹æº"></a>æ ¹æº</h2><p>å¯æ˜¯ï¼Œ<code>Qt</code> ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ï¼Œéš¾é“æ˜¯ï¼</p><p>è¯´ç½¢ï¼Œæˆ‘ä¾¿å»æŸ¥é˜…äº†<a href="https://code.woboq.org/qt5/qtwinextras/src/winextras/qwinthumbnailtoolbar.cpp.html#_ZN27QWinThumbnailToolBarPrivate21updateIconicThumbnailEPKi"><code>Qt</code>æºç </a>ï¼š</p><p>ã‚„ã¯ã‚Šå•Š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">QWinThumbnailToolBarPrivate::updateIconicThumbnail</span><span class="hljs-params">(<span class="hljs-type">const</span> MSG *message)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (!iconicThumbnail)<br>        <span class="hljs-keyword">return</span>;<br>    <span class="hljs-function"><span class="hljs-type">const</span> QSize <span class="hljs-title">maxSize</span><span class="hljs-params">(HIWORD(message-&gt;lParam), LOWORD(message-&gt;lParam))</span></span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-type">const</span> HBITMAP bitmap = iconicThumbnail.<span class="hljs-built_in">bitmap</span>(maxSize)) &#123;<br>        <span class="hljs-type">const</span> HRESULT hr = <span class="hljs-built_in">DwmSetIconicThumbnail</span>(message-&gt;hwnd, bitmap, dWM_SIT_DISPLAYFRAME);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">FAILED</span>(hr))<br>            <span class="hljs-built_in">qWarning</span>() &lt;&lt; QWinThumbnailToolBarPrivate::<span class="hljs-built_in">msgComFailed</span>(<span class="hljs-string">&quot;DwmSetIconicThumbnail&quot;</span>, hr);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„è§‚å¯Ÿç¬¬7è¡Œï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-type">const</span> HRESULT hr = <span class="hljs-built_in">DwmSetIconicThumbnail</span>(message-&gt;hwnd, bitmap, dWM_SIT_DISPLAYFRAME);<br></code></pre></td></tr></table></figure><p>æœ€åä¸€ä¸ªå‚æ•° å†™æ­»äº† <code>dWM_SIT_DISPLAYFRAME</code></p><p>å¯¼è‡´å¼ºåˆ¶äº§ç”Ÿè¾¹æ¡†ï¼Œä¸<code>æ— è¾¹æ¡†çª—å£</code> äº§ç”Ÿå†²çª</p><p>è€Œä¸”è¿˜ä¸æä¾›æ¥å£ä¿®æ”¹å‚æ•°</p><p><code>Qt</code>ç¨‹åºå‘˜ä¹Ÿå¤ªä¸èµ°å¿ƒäº†å§</p><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>é‚£å’‹åŠ</p><p>å…¶å®å“ˆï¼Œä¸<code>Windows API</code>æ‰“äº¤é“æ˜¯å¾ˆçƒ¦äººçš„ä¸€ä»¶äº‹</p><p>æ‰€ä»¥ï¼Œèƒ½å°‘å†™å°±å°‘å†™ï¼Œå°½é‡ç”¨<code>Qt</code>å°è£…çš„ç±»</p><p>ã ã‹ã‚‰ã€æˆ‘ä»¬å°†é‡‡ç”¨<code>Qt API</code>ä¸<code>Windows API</code>ç»“åˆçš„æ–¹å¼ å®Œæˆç¼©ç•¥å›¾</p><p>æ¯•ç«Ÿ å°±åªæœ‰<code>setIconicThumbnailPixmap</code>è¿™ä¸€ä¸ªå‡½æ•°å†™å¾—ä¸å¥½å˜›</p><p>æˆ‘ä»¬åªè¦ç”¨<code>DwmSetIconicThumbnail</code>ä»£æ›¿å®ƒå³å¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C++">HBITMAP hbm = QtWin::<span class="hljs-built_in">toHBITMAP</span>(pixmap.<span class="hljs-built_in">scaled</span>(maxSize, Qt::KeepAspectRatio, Qt::SmoothTransformation));<br><span class="hljs-keyword">if</span> (hbm) &#123;<br>    HRESULT hr = <span class="hljs-built_in">DwmSetIconicThumbnail</span>((HWND)<span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">winId</span>(), hbm, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">DeleteObject</span>(hbm);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å›°éš¾æ€»æ¯”åŠæ³•å¤š"><a href="#å›°éš¾æ€»æ¯”åŠæ³•å¤š" class="headerlink" title="å›°éš¾æ€»æ¯”åŠæ³•å¤š"></a>å›°éš¾æ€»æ¯”åŠæ³•å¤š</h2><p>å³å¯ï¼Ÿä»€ä¹ˆ<code>TM</code>çš„å«<code>TM</code>çš„å³å¯</p><p>æƒ³åœ¨<code>Qt</code>ä¸­ä½¿ç”¨è¿™æ ·ä¸€ä¸ªå†·é—¨çš„<code>Windows API</code>å¯ä¸å®¹æ˜“</p><h3 id="å¤´æ–‡ä»¶ï¼šdwmapi-h"><a href="#å¤´æ–‡ä»¶ï¼šdwmapi-h" class="headerlink" title="+å¤´æ–‡ä»¶ï¼šdwmapi.h"></a>+å¤´æ–‡ä»¶ï¼š<code>dwmapi.h</code></h3><blockquote><p>Errorï¼šundefined function ç¼ºå°‘å®šä¹‰</p></blockquote><p>Whatï¼Œä¸æ˜¯åŠ äº†å¤´æ–‡ä»¶å—ï¼Œä¸€çœ‹ï¼Œç”±äº <code>_WIN32_WINNT</code> æ•°å€¼è¿‡ä½ï¼ˆç‰ˆæœ¬ä¸è¶³ï¼‰,å¯¼è‡´å®šä¹‰å±è”½</p><h3 id="å¤´æ–‡ä»¶ä¸­è¦†ç›–å®å®šä¹‰ï¼š"><a href="#å¤´æ–‡ä»¶ä¸­è¦†ç›–å®å®šä¹‰ï¼š" class="headerlink" title="å¤´æ–‡ä»¶ä¸­è¦†ç›–å®å®šä¹‰ï¼š"></a>å¤´æ–‡ä»¶ä¸­è¦†ç›–å®å®šä¹‰ï¼š</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">define</span> WINVER 0x0A00</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _WIN32_WINNT 0x0A00 <span class="hljs-comment">//Win10</span></span><br></code></pre></td></tr></table></figure><blockquote><p>Errorï¼šundefined reference ç¼ºå°‘å¼•ç”¨ï¼ˆéœ€è¦é“¾æ¥åº“ï¼‰</p></blockquote><h3 id="proï¼šLIBS-lDwmapi-lGdi32"><a href="#proï¼šLIBS-lDwmapi-lGdi32" class="headerlink" title="+.proï¼šLIBS += -lDwmapi -lGdi32"></a>+.proï¼š<code>LIBS += -lDwmapi -lGdi32</code></h3><p>è¿™å°±å®Œäº†ï¼ŸNonono</p><p>ç¼©ç•¥å›¾å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼Œ<code>Windows</code>ä¸ä¼šè‡ªåŠ¨å¸®ä½ ç¼©æ”¾</p><p>é‚£ä¹ˆå¦‚ä½•çŸ¥é“å¤§å°é™åˆ¶</p><p>ç­”ï¼šåœ¨<code>Windows</code>ä¼ é€’çš„native Messageä¸­æœ‰</p><p>ä½†æ˜¯å¾ˆå¯æƒœ æˆ‘ä»¬ç”¨äº†<code>QWinThumbnailToolBar</code>ï¼Œå¯¼è‡´äº‹ä»¶è¢«æ‹¦æˆªï¼Œæˆ‘ä»¬æ— æ³•è·å–</p><p><strong>ç„¯</strong></p><p>ä»€ä¹ˆå«å¯„äººç¯±ä¸‹</p><p><strong>å¯„</strong></p><p>è¿™æ—¶å€™å°±åªèƒ½æƒ³ç‚¹å·é¸¡æ‘¸ç‹—çš„åŠæ³•äº†</p><p><code>DwmSetIconicThumbnail</code>å‡½æ•°çš„è¿”å›å€¼å¯ä»¥æ ‡è¯†è°ƒç”¨æ˜¯å¦æˆåŠŸ</p><p>å›¾ç‰‡è¿‡å¤§åˆ™ä¸æˆåŠŸ</p><p><code>Size</code>ä»å¤§åˆ°å°å¼€å§‹éå†ï¼Œç›´åˆ°è¿”å›<code>S_OK</code></p><h2 id="æˆ‘æ»´ä»»åŠ¡ï¼Œå®Œæˆå•¦ï¼å•Šå“ˆå“ˆå“ˆå“ˆ"><a href="#æˆ‘æ»´ä»»åŠ¡ï¼Œå®Œæˆå•¦ï¼å•Šå“ˆå“ˆå“ˆå“ˆ" class="headerlink" title="æˆ‘æ»´ä»»åŠ¡ï¼Œå®Œæˆå•¦ï¼å•Šå“ˆå“ˆå“ˆå“ˆ"></a>æˆ‘æ»´ä»»åŠ¡ï¼Œå®Œæˆå•¦ï¼å•Šå“ˆå“ˆå“ˆå“ˆ</h2><p><img src="/img/image-20211223163614109.png" alt="æˆå“"></p><h2 id="TNND-è·Ÿæˆ‘ç©é˜´çš„æ˜¯å§"><a href="#TNND-è·Ÿæˆ‘ç©é˜´çš„æ˜¯å§" class="headerlink" title="TNND è·Ÿæˆ‘ç©é˜´çš„æ˜¯å§"></a>TNND è·Ÿæˆ‘ç©é˜´çš„æ˜¯å§</h2><p>éå†Sizeä¼šå¯¼è‡´è€—æ—¶è¿‡é•¿ï¼Œå¯¼è‡´ç¼©ç•¥å›¾åˆ·æ–°ä¸åŠæ—¶ï¼Œæ˜¾ç¤ºä¸ºç©ºç™½ï¼ˆéœ€è¦é¼ æ ‡ç§»åŠ¨åˆ·æ–°ï¼‰</p><p><strong>ç„¯</strong></p><p>æ ¹æºè¿˜æ˜¯åœ¨äºè·å–ä¸åˆ°<code>maxSize</code>ï¼ˆ<code>Qt</code>ç±»è·å–<code>NativeEvent</code>å<code>return true</code> æ‹¦æˆªæ¶ˆæ¯ ä¸å†ä¼ é€’ï¼‰</p><p>æ‰€ä»¥è¿˜æ˜¯å¾—æƒ³åŠæ³•ä»¥é«˜ä¼˜å…ˆçº§ è·å–<code>NativeEvent</code></p><h2 id="ç›´æ¥æ¥å§"><a href="#ç›´æ¥æ¥å§" class="headerlink" title="ç›´æ¥æ¥å§"></a>ç›´æ¥æ¥å§</h2><p>å‚è€ƒ<code>Qt</code>æºç </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++">QCoreApplication::<span class="hljs-built_in">instance</span>()-&gt;<span class="hljs-built_in">installNativeEventFilter</span>(<span class="hljs-keyword">this</span>);<br></code></pre></td></tr></table></figure><p>è¦æƒ³ä»¥é«˜ä¼˜å…ˆçº§è·å–<code>NativeEvent</code>å¿…é¡»<code>installNativeEventFilter</code>å¹¶ä¸”é‡è½½<code>nativeEventFilter</code>å‡½æ•°</p><p>ä½†è¦æƒ³é‡è½½è¿™ä¸ªå‡½æ•°ï¼Œå°±å¿…é¡»å®ç°<code>QAbstractNativeEventFilter</code>æ¥å£</p><p>åœ¨<code>C++</code>ä¸­ï¼Œé‡‡ç”¨å¤šç»§æ‰¿å®ç°ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span> : <span class="hljs-keyword">public</span> QWidget, <span class="hljs-keyword">public</span> QAbstractNativeEventFilter<br></code></pre></td></tr></table></figure><p>å…³äº<code>installNativeEventFilter</code></p><blockquote><p>If multiple event filters are installed, the filter that was installed last is activated first.</p><p>ä¹Ÿå°±æ˜¯å¦‚æœå¤šä¸ªfilterè¢«å®‰è£…ï¼Œåˆ™åå®‰è£…çš„å…ˆæ¿€æ´»</p></blockquote><p>æˆ‘ä»¬è¦ä¸<code>QWinThumbnailBar</code>ç«äº‰æ‰€ä»¥å¿…é¡»åœ¨å…¶ä¹‹åå®‰è£…ï¼Œä¹Ÿå°±æ˜¯åœ¨å®ƒæ„é€ ä¹‹å</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C++">QWinThumbnailToolBar* thumbbar = <span class="hljs-keyword">new</span> <span class="hljs-built_in">QWinThumbnailToolBar</span>(<span class="hljs-keyword">this</span>);<br>qApp-&gt;<span class="hljs-built_in">installNativeEventFilter</span>(<span class="hljs-keyword">this</span>); <span class="hljs-comment">//åå®‰è£…filterçš„å…ˆè·å–nativeEvent æ‰€ä»¥åœ¨â†‘æ„é€ ä¹‹å</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œåœ¨<code>nativeEventFilter</code>ä¸­å°±å¯ä»¥æ¥æ”¶åˆ°è¯·æ±‚ç¼©ç•¥å›¾å’Œå®æ—¶é¢„è§ˆå›¾çš„æ¶ˆæ¯äº†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">Widget::nativeEventFilter</span><span class="hljs-params">(<span class="hljs-type">const</span> QByteArray&amp; eventType, <span class="hljs-type">void</span>* message, <span class="hljs-type">long</span>* result)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">const</span> MSG* msg = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">const</span> MSG*&gt;(message);<br>    <span class="hljs-keyword">switch</span> (msg-&gt;message) &#123;<br>    <span class="hljs-keyword">case</span> WM_DWMSENDICONICTHUMBNAIL: &#123;<br>        <span class="hljs-function"><span class="hljs-type">const</span> QSize <span class="hljs-title">maxSize</span><span class="hljs-params">(HIWORD(msg-&gt;lParam), LOWORD(msg-&gt;lParam))</span></span>;<span class="hljs-comment">//è·å–æœ€å¤§Size</span><br>        <span class="hljs-built_in">setThumbnailPixmap</span>(pixmap, maxSize);<br>   &#125;<br>    <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> WM_DWMSENDICONICLIVEPREVIEWBITMAP:<br>        <span class="hljs-built_in">setLivePreviewPixmap</span>(<span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">grab</span>());<span class="hljs-comment">//å®æ—¶é¢„è§ˆå›¾ æ²¡æœ‰å¤§å°é™åˆ¶ ç›´æ¥æˆªå›¾</span><br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŸæœ¬çš„ä¿¡å·è¿æ¥å°±å¯ä»¥åˆ äº†ï¼Œä½†æ˜¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++">thumbbar-&gt;<span class="hljs-built_in">setIconicPixmapNotificationsEnabled</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">//è¿›è¡Œä¸€äº›å±æ€§è®¾ç½®ï¼Œå¦åˆ™ä¸èƒ½è®¾ç½®ç¼©ç•¥å›¾</span><br></code></pre></td></tr></table></figure><p>è¿™å¥è¯è¿˜æ˜¯å¾—ç•™ç€çš„â†‘</p><h2 id="æˆ‘æ»´ä»»åŠ¡-åˆå®Œæˆå•¦-å•Šå“ˆå“ˆå“ˆå“ˆ"><a href="#æˆ‘æ»´ä»»åŠ¡-åˆå®Œæˆå•¦-å•Šå“ˆå“ˆå“ˆå“ˆ" class="headerlink" title="æˆ‘æ»´ä»»åŠ¡ åˆå®Œæˆå•¦ å•Šå“ˆå“ˆå“ˆå“ˆ"></a>æˆ‘æ»´ä»»åŠ¡ åˆå®Œæˆå•¦ å•Šå“ˆå“ˆå“ˆå“ˆ</h2><hr><h2 id="ã¡ã‚‡ã£ã¨å¾…ã£ã¦-2022-1-30"><a href="#ã¡ã‚‡ã£ã¨å¾…ã£ã¦-2022-1-30" class="headerlink" title="ã¡ã‚‡ã£ã¨å¾…ã£ã¦(2022.1.30)"></a>ã¡ã‚‡ã£ã¨å¾…ã£ã¦(2022.1.30)</h2><p>æ—¢ç„¶æ˜¯å¯¹ç±»çš„ä¿®æ­£ å°±åº”è¯¥å°è£…ä¸ºç±»</p><p>é‡ç‚¹å°±æ˜¯ï¼š</p><ul><li>ç»§æ‰¿<code>QAbstractNativeEventFilter</code></li><li>å®‰è£…è¿‡æ»¤å™¨ <code>QCoreApplication::instance()-&gt;installNativeEventFilter(this);</code></li><li>é‡è½½<code>nativeEventFilter</code>å¹¶æ•è·<code>WM_DWMSENDICONICTHUMBNAIL</code>æ¶ˆæ¯</li><li>é‡å†™<code>setIconicThumbnailPixmap</code>ï¼Œé‡‡ç”¨<code>Windows API(DwmSetIconicThumbnail)</code></li></ul><p>æ³¨ï¼šåˆ å»å¯¹<code>WM_DWMSENDICONICLIVEPREVIEWBITMAP</code>çš„æ•è·ï¼Œæ²¡å¿…è¦ï¼Œç›´æ¥ç”¨åŸç”Ÿçš„å³å¯</p><h2 id="é™„ï¼šQtæºç "><a href="#é™„ï¼šQtæºç " class="headerlink" title="é™„ï¼šQtæºç "></a>é™„ï¼šQtæºç </h2><p><a href="https://code.woboq.org/qt5/qtwinextras/src/winextras/qwinthumbnailtoolbar.cpp.html">https://code.woboq.org/qt5/qtwinextras/src/winextras/qwinthumbnailtoolbar.cpp.html</a></p><h2 id="é™„ï¼šQtWinThumbnailToolBaråŸç†æµ…æ-Qtæºç "><a href="#é™„ï¼šQtWinThumbnailToolBaråŸç†æµ…æ-Qtæºç " class="headerlink" title="é™„ï¼šQtWinThumbnailToolBaråŸç†æµ…æ(Qtæºç )"></a>é™„ï¼šQtWinThumbnailToolBaråŸç†æµ…æ(Qtæºç )</h2><p><code>Native</code>äº‹ä»¶äº¤ç»™å•ç‹¬çš„<code>QWinThumbnailToolBarPrivate</code>ç±»(ç»§æ‰¿è‡ª<code>QAbstractNativeEventFilter</code>)å¤„ç†ï¼Œæœ¬ä½“æŒæœ‰å…¶æŒ‡é’ˆ</p><p>æ¥æ”¶åˆ°<code>Native</code>äº‹ä»¶åï¼Œå¼€å§‹æ›´æ–°ç¼©ç•¥å›¾ï¼ˆå¦‚æœç”¨<code>setIconicThumbnailPixmap</code>è®¾ç½®è¿‡çš„è¯ï¼‰</p><p>å¹¶<code>emit iconicThumbnailPixmapRequested</code>ä¾›ç”¨æˆ·æ›´æ–°ç¼©ç•¥å›¾</p><p>å¦‚æœè¦è°ƒç”¨<code>Windows API</code>æ‰‹åŠ¨è®¾ç½®ç¼©ç•¥å›¾ å°±ä¸èƒ½è°ƒç”¨<code>setIconicThumbnailPixmap</code>å¦åˆ™ä¼šè¢«è¦†ç›–</p><p><code>setIconicLivePreviewPixmap</code>ä¸è¿›è¡Œå®é™…æ›´æ–°</p><p>å®é™…æ›´æ–°åœ¨<code>Native Event</code>æ—¶<code>updateIconicLivePreview()</code></p><p>æ‰€ä»¥æˆ‘ä»¬åœ¨æ¥æ”¶äº‹ä»¶æ—¶å¿…é¡»å¾€ä¸‹ä¼ é€’ï¼Œä¸èƒ½<code>return true</code>ï¼Œå¦åˆ™æ²¡æœ‰ä»£ç å»å®ç°<code>LivePreview</code>äº†</p><p># å…¶å®æ ¹æœ¬æ²¡æœ‰å¿…è¦é‡å†™ä¸æ‹¦æˆª<code>LivePreview</code>äº‹ä»¶ï¼Œç”¨åŸç”Ÿçš„å°±è¡Œ</p><p># é‡å†™<code>Thumbail</code>å°±è¡Œ</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://docs.microsoft.com/zh-cn/windows/win32/shell/taskbar-extensions?redirectedfrom=MSDN">ä»»åŠ¡æ æ‰©å±• - Win32 apps | Microsoft Docs</a></p><p><a href="https://docs.microsoft.com/zh-cn/windows/win32/api/dwmapi/nf-dwmapi-dwmseticonicthumbnail">DwmSetIconicThumbnail å‡½æ•° (dwmapi.h) - Win32 åº”ç”¨ | å¾®è½¯æ–‡æ¡£</a></p><p><a href="https://docs.microsoft.com/en-us/cpp/porting/modifying-winver-and-win32-winnt?view=msvc-170">Update WINVER and _WIN32_WINNT | Microsoft Docs</a></p><p><a href="https://www.cnblogs.com/163yun/p/9711867.html">ä¸€ä¸ªä½“éªŒå¥½çš„Windows ä»»åŠ¡æ ç¼©ç•¥å›¾å¼€å‘å¿ƒå¾— - ç½‘æ˜“æ•°å¸† - åšå®¢å›­</a></p><p><a href="https://cpp.hotexamples.com/examples/-/-/DwmSetIconicThumbnail/cpp-dwmseticonicthumbnail-function-examples.html">C++ (Cpp) DwmSetIconicThumbnail Examples - HotExamples</a></p><p><a href="https://code.woboq.org/qt5/qtwinextras/src/winextras/qwinthumbnailtoolbar.cpp.html#_ZN27QWinThumbnailToolBarPrivate21updateIconicThumbnailEPKi">qwinthumbnailtoolbar.cpp source code [qtwinextras&#x2F;src&#x2F;winextras&#x2F;qwinthumbnailtoolbar.cpp] - Woboq Code Browser</a></p><p><a href="https://www.coder.work/article/1239944">c++ - Qt::nativeEvent è°ƒç”¨ - ITå·¥å…·ç½‘</a></p><p><a href="https://blog.csdn.net/nicai_xiaoqinxi/article/details/95251380">ä½¿ç”¨Qtæ¥å£è·å–Windowsç³»ç»Ÿçš„äº‹ä»¶_Qtå›-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/weixin_34179968/article/details/86336424?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.essearch_pc_relevant&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.essearch_pc_relevant">qtæ•è·å…¨å±€windowsæ¶ˆæ¯_weixin_34179968çš„åšå®¢-CSDNåšå®¢</a></p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WinPcap in Qt - _snprintfç­‰å‡½æ•°å†²çªå®šä¹‰é—®é¢˜</title>
    <link href="/2021/11/30/WinPcap-in-Qt-_snprintf%E7%AD%89%E5%87%BD%E6%95%B0%E5%86%B2%E7%AA%81%E5%AE%9A%E4%B9%89%E9%97%AE%E9%A2%98/"/>
    <url>/2021/11/30/WinPcap-in-Qt-_snprintf%E7%AD%89%E5%87%BD%E6%95%B0%E5%86%B2%E7%AA%81%E5%AE%9A%E4%B9%89%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨<code>Windows</code>ä¸­è®¿é—®åº•å±‚ç½‘ç»œéœ€è¦ç”¨åˆ°<code>WinPcap</code>è¿™ä¸ªå·¥å…·</p><p>æ¯”å¦‚ï¼Œ<code>Wireshark</code>ï¼ˆç½‘ç»œå°åŒ…åˆ†æè½¯ä»¶ï¼‰å°±ç”¨åˆ°äº†<code>WinPcap</code></p><p>é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨<code>Qt</code>å¹³å°ä¸­ä½¿ç”¨<code>WinPcap</code>å‘¢ï¼Ÿ</p><h3 id="å®‰è£…-WinPcap-for-Qt"><a href="#å®‰è£…-WinPcap-for-Qt" class="headerlink" title="å®‰è£… WinPcap for Qt"></a>å®‰è£… WinPcap for Qt</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>C++</code>æƒ³è¦ä½¿ç”¨åº“ï¼Œå°±å¿…é¡»æä¾›<code>.h .lib .dll</code>ç­‰æ–‡ä»¶ï¼Œé‚£ä¹ˆåªè¦ä¸‹è½½å¯¹åº”æ–‡ä»¶å³å¯</p><p><a href="http://www.winpcap.org/">WinPcapå®˜ç½‘</a></p><blockquote><p>1.<a href="http://www.winpcap.org/install/default.htm">é¦–å…ˆä¸‹è½½å®‰è£…winpcap.exe</a></p><p>ç›®çš„æ˜¯å®‰è£…ç›¸å…³é©±åŠ¨å’Œdllï¼Œå®‰è£…å®Œæˆä¹‹ååŸºäºwinpcapçš„åº”ç”¨ç¨‹åºæ‰èƒ½å¤Ÿæ­£å¸¸è¿è¡Œ</p></blockquote><blockquote><p>2.<a href="http://www.winpcap.org/devel.htm">ä¸‹è½½winpcapçš„å¼€å‘åŒ…ï¼Œå¤´é—®æ–‡ä»¶å’Œåº“æ–‡ä»¶</a> </p><p>è§£å‹å³å¯å¾—åˆ° Include &amp; Lib æ–‡ä»¶å¤¹</p></blockquote><p>From <a href="https://www.cnblogs.com/sunniflyer/p/3983909.html">windowsä¸‹å®‰è£…é…ç½®winpcap - sunnycs - åšå®¢å›­</a></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>Qt</code>ä¸­å¼•ç”¨è¿™äº›æ–‡ä»¶(å‡è®¾è§£å‹ç›®å½•ï¼š<code>E:\WpdPack</code>)</p><p>åœ¨<code>.pro</code>æ–‡ä»¶ä¸­æ·»åŠ ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs makefile">INCLUDEPATH += E:/WpdPack/Include<br>LIBS += E:/WpdPack/Lib/x64/wpcap.lib \<br>        E:/WpdPack/Lib/x64/Packet.lib <span class="hljs-comment">#å‡è®¾æ˜¯x64ç¨‹åº è‹¥ä¸ºx86ç¨‹åº è§‚å¯ŸLibç›®å½•ä¸‹çš„æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><p>ç”¨ä»¥å¼•å…¥å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶è·¯å¾„</p><p>ç„¶ååœ¨<code>mainwindow.h</code>æ–‡ä»¶ä¸­å¼•å…¥å¤´æ–‡ä»¶<code>&quot;pcap.h&quot;</code>ä»¥æµ‹è¯•æ˜¯å¦æˆåŠŸå®‰è£…</p><h2 id="æ­£æ–‡ï¼šError"><a href="#æ­£æ–‡ï¼šError" class="headerlink" title="æ­£æ–‡ï¼šError"></a>æ­£æ–‡ï¼šError</h2><p>æœä¸å…¶ç„¶ï¼Œç³ç…æ»¡ç›®çš„30ä¸ªæŠ¥é”™ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs C++">E:\Qt5<span class="hljs-number">.14</span><span class="hljs-number">.2</span>\Tools\mingw730_64\x86_64-w64-mingw32\include\stdio.h:<span class="hljs-number">735</span>: <br>error: conflicting declaration of <span class="hljs-string">&#x27;int _snprintf(char*, size_t, const char*, ...)&#x27;</span> with <span class="hljs-string">&#x27;C&#x27;</span> linkage<br>   _CRTIMP <span class="hljs-type">int</span> __cdecl _snprintf(<span class="hljs-type">char</span> * __restrict__ _Dest,<span class="hljs-type">size_t</span> _Count,<span class="hljs-type">const</span> <span class="hljs-type">char</span> * __restrict__ _Format,...) __MINGW_ATTRIB_DEPRECATED_SEC_WARN;<br>                       ^~~~~~~~~<br></code></pre></td></tr></table></figure><p>ä¸è¿‡ä»”ç»†è§‚å¯Ÿ</p><p>é”™è¯¯å¤šä¸ºï¼š<strong>conflicting declaration</strong> ï¼ˆå®šä¹‰å†²çªï¼‰&amp; <strong>has not been declared</strong> ï¼ˆæœªå£°æ˜ï¼‰</p><p>ä¸”ç¿»æ¥è¦†å»å°±é‚£å‡ ä¸ªå‡½æ•°ï¼š<strong>_snprintf()</strong>   <strong>_vsnprintf()</strong></p><p>è€Œä¸”è€Œä¸”ï¼Œè²Œä¼¼éƒ½è·Ÿ <strong>stdio.h</strong> æœ‰å…³</p><h2 id="åˆ—æ–‡è™å…‹"><a href="#åˆ—æ–‡è™å…‹" class="headerlink" title="åˆ—æ–‡è™å…‹"></a>åˆ—æ–‡è™å…‹</h2><p>ç­‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¼•å…¥çš„æ˜¯ <code>pcap.h</code> å¤´æ–‡ä»¶ï¼Œä¸ºä»€ä¹ˆä¼šå¼•å‘æ ‡å‡†åº“é”™è¯¯</p><blockquote><p>ã¾ã•ã‹ã€çœŸå®Ÿã¯ã„ã¤ã‚‚ä¸€ã¤</p></blockquote><p>è®©æˆ‘ä»¬è¿›å…¥ <code>pcap.h</code> ã® <code>pcap/pcap.h</code> ã® <code>pcap-stdinc.h</code></p><p>å‘ç°äº†ä»¤äººéœ‡æƒŠçš„ä¸€å¹•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">if</span> _MSC_VER &lt; 1500</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> snprintf _snprintf</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> vsnprintf _vsnprintf</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> strdup _strdup</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå¤´æ–‡ä»¶ å±…ç„¶å¯¹ <code>snprintf</code> &amp; <code>vsnprintf</code> å‡½æ•°è¿›è¡Œäº†<code>#define</code> æ›¿æ¢</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>#define</code> çš„ä½œç”¨åŸŸæ˜¯<strong>è¯¥è¯­å¥åˆ°æ–‡ä»¶å°¾</strong></p><p>å¥½å·§ä¸å·§ï¼Œè¯¥è¯­å¥åæ­£å¥½æœ‰ <code>#include&lt;stdio.h&gt;</code></p><p>è€Œ <code>stdio.h</code> ä¸­åˆåŒæ—¶å®šä¹‰äº† <code>snprintf</code> <code>_snprintf</code> &amp; <code>vsnprintf</code> <code>_vsnprintf</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">vsnprintf</span> <span class="hljs-params">(<span class="hljs-type">char</span> * __restrict__ __stream, <span class="hljs-type">size_t</span> __n, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * __restrict__ __format, va_list __local_argv)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">return</span> __ms_vsnprintf (__stream, __n, __format, __local_argv);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">snprintf</span> <span class="hljs-params">(<span class="hljs-type">char</span> * __restrict__ __stream, <span class="hljs-type">size_t</span> __n, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * __restrict__ __format, ...)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">register</span> <span class="hljs-type">int</span> __retval;<br>  __builtin_va_list __local_argv; __builtin_va_start( __local_argv, __format );<br>  __retval = __ms_vsnprintf (__stream, __n, __format, __local_argv);<br>  __builtin_va_end( __local_argv );<br>  <span class="hljs-keyword">return</span> __retval;<br>&#125;<br><br>__attribute__((__format__ (ms_printf, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>))) __MINGW_ATTRIB_NONNULL(<span class="hljs-number">3</span>)<br>  _CRTIMP <span class="hljs-type">int</span> __cdecl _snprintf(<span class="hljs-type">char</span> * __restrict__ _Dest,<span class="hljs-type">size_t</span> _Count,<span class="hljs-type">const</span> <span class="hljs-type">char</span> * __restrict__ _Format,...) __MINGW_ATTRIB_DEPRECATED_SEC_WARN;<br>  __attribute__((__format__ (ms_printf, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>))) __MINGW_ATTRIB_NONNULL(<span class="hljs-number">3</span>)<br>  _CRTIMP <span class="hljs-type">int</span> __cdecl _vsnprintf(<span class="hljs-type">char</span> * __restrict__ _Dest,<span class="hljs-type">size_t</span> _Count,<span class="hljs-type">const</span> <span class="hljs-type">char</span> * __restrict__ _Format,va_list _Args) __MINGW_ATTRIB_DEPRECATED_SEC_WARN;<br></code></pre></td></tr></table></figure><p>å¯¼è‡´ <code>snprintf</code> <code>vsnprintf</code> è¢«æ›¿æ¢ä¸º _ ä¸‹åˆ’çº¿ç‰ˆæœ¬ å¯¼è‡´é‡å®šä¹‰</p><p>åŒæ—¶å¯¼è‡´&lt;<code>QMainWindow</code>&gt;ä¸­å¼•ç”¨äº† <code>stdio.h</code> çš„æ ‡å‡†åº“æ–‡ä»¶ éƒ½å‡ºç°äº†<code>snprintf</code> <code>vsnprintf</code> æœªå®šä¹‰é—®é¢˜</p><h2 id="å¯¹ç­–"><a href="#å¯¹ç­–" class="headerlink" title="å¯¹ç­–"></a>å¯¹ç­–</h2><p>æ—¢ç„¶ <code>#define</code> çš„ä½œç”¨åŸŸæ˜¯å‚ç›´å‘ä¸‹çš„ï¼Œé‚£ä¹ˆåªè¦æŠŠ <code>stdio.h</code> ä»å…¶ä¸‹æ–¹æ’é™¤å³å¯</p><p>ä¸ºäº†æœ€å¤§é™åº¦é¿å…ä¿®æ”¹å¤´æ–‡ä»¶</p><p>æˆ‘ä»¬éœ€è¦ç”¨åˆ°å¦ä¸€ä¸ªæ€§è´¨ï¼š</p><p>å¤´æ–‡ä»¶ä¸€åŠä¸ºäº†é˜²æ­¢é‡å¤åŒ…å«ï¼Œä¸€èˆ¬ä¼šå†™ä¸Šï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> STH_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> STH_H</span><br>...<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å¤´æ–‡ä»¶ä¸ä¼šäºŒæ¬¡å¼•ç”¨</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦åœ¨ é‚£ä¸ªç½ªæ¶çš„ <code>#define</code> <strong>ä¹‹å‰</strong> å†™ä¸‹ <code>#include&lt;stdio.h&gt;</code>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;pcap.h&quot;</span> </span><br></code></pre></td></tr></table></figure><p>è¿™æ · <code>pcap.h</code> ä¸­çš„ <code>#include &lt;stdio.h&gt;</code> å°±ä¸ä¼šç”Ÿæ•ˆ ä¹Ÿä¸ä¼šäº§ç”Ÿæ›¿æ¢äº†</p><p>è€Œå…¶ä»–ä½ç½®çš„<code>snprintf</code> <code>vsnprintf</code> æ›¿æ¢å¹¶æ— å¤§ç¢ï¼ˆæˆ‘çŒœçš„ï¼‰ï¼Œå› ä¸ºéƒ½æœ‰å®šä¹‰</p><p>æˆ–è€…</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QMainWindow&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;pcap.h&quot;</span> <span class="hljs-comment">//æˆ–è€…è®©&lt;QMainWindow&gt;(é‡Œé¢å¯èƒ½åŒ…å«stdio)ç½®äºpacp.hå‰é¢ï¼Œé˜»æ­¢å¯¹stdio.hä¸­æŸäº›å‡½æ•°çš„é‡å®šä¹‰</span></span><br></code></pre></td></tr></table></figure><p>peace</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://blog.csdn.net/houqd2012/article/details/8028538">ä½¿ç”¨Winpcapç¤ºä¾‹ç¨‹åºçš„æ—¶å€™ï¼Œä¼šå‡ºç°å¾ˆå¤šé”™è¯¯ï¼ˆè½¬ï¼‰_å¤©é“é…¬å‹¤-CSDNåšå®¢</a></p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
      <category>WinPcap</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>Windows</tag>
      
      <tag>WinPcap</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>C++11æ–°ç‰¹æ€§-RåŸç”Ÿå­—ç¬¦ä¸²</title>
    <link href="/2021/11/29/C++11%E6%96%B0%E7%89%B9%E6%80%A7-R%E5%8E%9F%E7%94%9F%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    <url>/2021/11/29/C++11%E6%96%B0%E7%89%B9%E6%80%A7-R%E5%8E%9F%E7%94%9F%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>C++</code>å­—ç¬¦ä¸²ä¸­æœ‰äº›å­—ç¬¦å…·æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œéœ€è¦è½¬ä¹‰ï¼ˆå¦‚<code>&#39;\\&#39; &#39;\&quot;&#39;</code>)</p><p>ç‰¹åˆ«æ˜¯åœ¨è¡¨ç¤º<code>Windows</code>è·¯å¾„æ—¶ï¼Œæå…¶éº»çƒ¦ï¼ˆ<code>&#39;\\&#39;</code>å«é‡è¶…æ ‡ï¼‰</p><p>é‚£ä¹ˆæœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥å‘Šè¯‰ç¼–è¯‘å™¨å–æ¶ˆè½¬ä¹‰å‘¢ï¼Ÿ</p><h2 id="æœ€æ‡‚æˆ‘"><a href="#æœ€æ‡‚æˆ‘" class="headerlink" title="æœ€æ‡‚æˆ‘"></a>æœ€æ‡‚æˆ‘</h2><p>æ²¡é”™ï¼ŒåŸç”Ÿå­—ç¬¦ä¸²<code>(Raw string literal)</code>ç°å·²åŠ å…¥<code>C++11</code>è±ªååˆé¤</p><p>åªéœ€è¦ä½¿ç”¨<code>R</code>å‰ç¼€ï¼Œå³å¯å–æ¶ˆè½¬ä¹‰</p><h2 id="ä¸“ä¸šé‡Šä¹‰"><a href="#ä¸“ä¸šé‡Šä¹‰" class="headerlink" title="ä¸“ä¸šé‡Šä¹‰"></a>ä¸“ä¸šé‡Šä¹‰</h2><blockquote><p>prefix(optional) <strong>Râ€</strong><em>d-char-sequence</em>(optional)<strong>(</strong><em><strong>r-char-sequence</strong></em>(optional)<strong>)</strong> <em>d-char-sequence</em>(optional)<strong>â€œ</strong>      <em>since C++11</em></p></blockquote><blockquote><p>Raw string literal. Used to avoid escaping of any character. Anything between the delimiters becomes part of the string. <em>prefix</em>, if present, has the same meaning as described above. The terminating <em>d-char-sequence</em> is the same sequence of characters as the initial <em>d-char-sequence</em>.</p></blockquote><p>From <a href="https://en.cppreference.com/w/cpp/language/string_literal">String literal - cppreference.com</a></p><h2 id="æœ¬åœ°ç¿»è¯‘"><a href="#æœ¬åœ°ç¿»è¯‘" class="headerlink" title="æœ¬åœ°ç¿»è¯‘"></a>æœ¬åœ°ç¿»è¯‘</h2><p>ä»€ä¹ˆæ„æ€å‘¢</p><p>å°±æ˜¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">R&quot;(åŸå§‹å­—ç¬¦ä¸²)&quot;</span> == <span class="hljs-string">&quot;è½¬ä¹‰çš„å­—ç¬¦ä¸²&quot;</span><br></code></pre></td></tr></table></figure><p>ä¸¾ä¸ªä¾‹å­</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs C++">string str1 = <span class="hljs-string">&quot;E:\\test.jpg&quot;</span>;<br>string str2 = <span class="hljs-string">R&quot;sth(E:\test.jpg)sth&quot;</span>;<span class="hljs-comment">//sthåœ¨æ‹¬å·å‰å ç”¨æ¥æè¿°å­—ç¬¦ä¸²ï¼ˆå¯é€‰ï¼‰</span><br><span class="hljs-comment">//è¾“å‡º: E:\test.jpg</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯<code>()</code>å†…çš„å­—ç¬¦ä¸²åŸæ ·è¾“å‡ºï¼ˆåŒ…æ‹¬æ¢è¡Œã€ç©ºç™½å­—ç¬¦ï¼‰ï¼Œä¸è¿›è¡Œè½¬ä¹‰ï¼Œæ‰€è§å³æ‰€å¾—</p><p>å¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘çš„<code>Windows</code>è·¯å¾„</p><h2 id="ã¡ã‚‡ã£ã¨"><a href="#ã¡ã‚‡ã£ã¨" class="headerlink" title="ã¡ã‚‡ã£ã¨"></a>ã¡ã‚‡ã£ã¨</h2><p>ç­‰ä¸‹ å¿˜è®°åæ§½äº†</p><p><code>C++11</code> è¿™éƒ½2021å¹´äº† 10å¹´äº† ç®—ä¸ªåµæ–°ç‰¹æ€§</p><p>è¿™å«æ—§ç‰¹æ€§ ç„¯</p><p>peace</p>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>å­—ç¬¦ä¸²ï¼Œæ–°ç‰¹æ€§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Qté…ç½®åº”ç”¨ç¨‹åºå›¾æ ‡</title>
    <link href="/2021/11/20/Qt%E9%85%8D%E7%BD%AE%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%9B%BE%E6%A0%87/"/>
    <url>/2021/11/20/Qt%E9%85%8D%E7%BD%AE%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%9B%BE%E6%A0%87/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>åº”ç”¨ç¨‹åºå›¾æ ‡æ˜¯è½¯ä»¶çš„æ ‡è¯†ç¬¦ï¼Œå°±åƒå“ç‰Œç¬¦å·ä¸€æ ·é‡è¦</p><p>ç¨‹åºå¯ä»¥æ‘†ï¼Œå›¾æ ‡ä¸èƒ½çƒ‚</p><p>é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨<code>Qt</code>ä¸­ç»™ç¨‹åºä¸Šå›¾æ ‡å‘¢ï¼Ÿ</p><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p>ä¿—è¯è¯´å¾—å¥½ï¼š</p><blockquote><p>ä¸ä¼šç¾å·¥çš„ç¨‹åºå‘˜ä¸æ˜¯å¥½é¡¹ç›®ç»ç†</p></blockquote><p>å›¾æ ‡è®¾è®¡æ˜æ˜æ˜¯ç¾å·¥çš„æ´»ï¼Œå‡­ä»€ä¹ˆè¦æˆ‘ç¨‹åºå‘˜å¹²ï¼</p><p>é†’é†’ï¼Œä½ æ²¡æœ‰ç¾å·¥ï¼Œä½ ä¸€ä¸ªäººå³æ˜¯ä¸€æ”¯å†›é˜Ÿ</p><h2 id="çœŸÂ·æ­£æ–‡"><a href="#çœŸÂ·æ­£æ–‡" class="headerlink" title="çœŸÂ·æ­£æ–‡"></a>çœŸÂ·æ­£æ–‡</h2><p>é‚£ä¹ˆæ€ä¹ˆä»æ— åˆ°æœ‰ä¸Šå›¾æ ‡å‘¢ï¼ˆtwiceï¼‰</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¾—ç°æœ‰å›¾æ ‡</p><h3 id="1-å›¾æ ‡ã‚’æ‰‹ã«å…¥ã‚Œã‚‹"><a href="#1-å›¾æ ‡ã‚’æ‰‹ã«å…¥ã‚Œã‚‹" class="headerlink" title="1.å›¾æ ‡ã‚’æ‰‹ã«å…¥ã‚Œã‚‹"></a>1.å›¾æ ‡ã‚’æ‰‹ã«å…¥ã‚Œã‚‹</h3><p>åˆ«æƒ³äº†ï¼Œä½ å°±ä¸¤æ¡è·¯</p><ul><li>è‡ªå·±ç”»</li><li>è‡ªå·±æ‰¾</li><li>æ‘†çƒ‚</li></ul><p>è¦ä¹ˆè‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿï¼Œè¦ä¹ˆä¸Šèµ„æºç½‘ç¢°ç¢°è¿æ°”<br><a href="https://icon.52112.com/">https://icon.52112.com/</a></p><p><a href="https://www.iconfont.cn/home/index?spm=a313x.7781069.1998910419.2">iconfont-é˜¿é‡Œå·´å·´çŸ¢é‡å›¾æ ‡åº“</a></p><h3 id="2-è½¬æ¢æ ¼å¼"><a href="#2-è½¬æ¢æ ¼å¼" class="headerlink" title="2.è½¬æ¢æ ¼å¼"></a>2.è½¬æ¢æ ¼å¼</h3><p><code>PS</code>ä¸èƒ½ç¼–è¾‘<code>ICO</code>æ ¼å¼è¿˜æ˜¯æŒºçƒ¦çš„</p><p>å…¶å®<code>ICO</code>æ ¼å¼å¹¶ä¸æ˜¯ç®€ç®€å•å•çš„ä¸€å¼ å›¾ç‰‡</p><p>ä¸ºäº†é€‚åº”ä¸åŒçš„åœºæ™¯ï¼ˆè¯¦ç»†ä¿¡æ¯ã€å°å›¾æ ‡ã€å¤§å›¾æ ‡ã€ç¼©ç•¥å›¾ï¼‰ï¼Œé€šå¸¸ä¸€ä¸ª<code>ICO</code>æ–‡ä»¶é‡ŒåŒ…å«äº†å¤šç§ä¸åŒåˆ†è¾¨ç‡çš„å›¾ç‰‡</p><p>ä¸ºäº†å°†æ™®é€šå›¾ç‰‡å¿«æ·åœ°è½¬æ¢æˆå¤šå°ºå¯¸<code>ICO</code>æ ¼å¼ï¼Œæˆ‘ä»¬éœ€è¦<code>Internet</code></p><p><a href="https://icoconvert.com/"><del>ICO Convert - Create Icons From PNG &amp; JPG Images Online</del></a></p><p><a href="https://www.aconvert.com/cn/icon/png-to-ico/">PNGè½¬ICO - åœ¨çº¿è½¬æ¢å›¾æ ‡æ–‡ä»¶ (aconvert.com)</a></p><h3 id="3-è®¾ç½®å›¾æ ‡-in-Qt"><a href="#3-è®¾ç½®å›¾æ ‡-in-Qt" class="headerlink" title="3.è®¾ç½®å›¾æ ‡ in Qt"></a>3.è®¾ç½®å›¾æ ‡ in Qt</h3><p>ç»ˆäºåˆ°äº†é‡ç‚¹äº†å•Šï¼Œä¸è¿‡ç£¨åˆ€ä¸è¯¯ç æŸ´åŠŸå˜›</p><p>æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><h4 id="å…¶ä¸€"><a href="#å…¶ä¸€" class="headerlink" title="å…¶ä¸€"></a>å…¶ä¸€</h4><p>åœ¨<code>.pro</code>æ–‡ä»¶ä¸­æ·»åŠ å›¾æ ‡æ–‡ä»¶ï¼Œç„¶åé‡æ–°ç¼–è¯‘å³å¯</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs makefile">RC_ICONS = logo.ico <span class="hljs-comment">#ç›¸å¯¹è·¯å¾„</span><br></code></pre></td></tr></table></figure><h4 id="å…¶äºŒ"><a href="#å…¶äºŒ" class="headerlink" title="å…¶äºŒ"></a>å…¶äºŒ</h4><p>1.åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­æ–°å»º<code>logo.rc</code>æ–‡ä»¶ï¼Œå¹¶å†™å…¥</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">IDI_ICON1 ICON <span class="hljs-keyword">DISCARDABLE </span><span class="hljs-string">&quot;logo.ico&quot;</span><br></code></pre></td></tr></table></figure><p>2.åœ¨<code>.pro</code>æ–‡ä»¶é‡Œæ·»åŠ </p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs makefile">RC_FILE = logo.rc<br></code></pre></td></tr></table></figure><p>é‡æ–°ç¼–è¯‘å³å¯</p><p>ä½ å­¦åºŸäº†å—ï¼Ÿ</p><p>peace</p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¼˜ç§€åšå®¢è½¬è½½</title>
    <link href="/2021/10/20/%E4%BC%98%E7%A7%80%E5%8D%9A%E5%AE%A2%E8%BD%AC%E8%BD%BD/"/>
    <url>/2021/10/20/%E4%BC%98%E7%A7%80%E5%8D%9A%E5%AE%A2%E8%BD%AC%E8%BD%BD/</url>
    
    <content type="html"><![CDATA[<h2 id="Qt"><a href="#Qt" class="headerlink" title="Qt"></a>Qt</h2><p><a href="https://zhuanlan.zhihu.com/p/370927844">é«˜æ•ˆQtå¼€å‘-å¿«é€ŸåŠ è½½æœ¬åœ°å›¾ç‰‡å¹¶ç¼©æ”¾æ˜¾ç¤ºçš„æŠ€å·§ - çŸ¥ä¹</a></p><p><a href="https://zhuanlan.zhihu.com/p/348164011">é«˜æ•ˆQtå¼€å‘-ç•Œé¢å¼‚æ­¥åˆ·æ–°æŠ€å·§ - çŸ¥ä¹</a></p><p><a href="https://forum.qt.io/topic/3477/render-qgraphicseffect-into-pixmap">Render QGraphicsEffect into pixmap? | Qt Forum</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Qtè‡ªå®šä¹‰æ ‡é¢˜æ -ç§»åŠ¨çª—å£</title>
    <link href="/2021/10/09/Qt%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E9%A2%98%E6%A0%8F-%E7%A7%BB%E5%8A%A8%E7%AA%97%E5%8F%A3/"/>
    <url>/2021/10/09/Qt%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E9%A2%98%E6%A0%8F-%E7%A7%BB%E5%8A%A8%E7%AA%97%E5%8F%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸€ä¸ªæœ€ç®€å•çš„çª—å£ä¹Ÿæ˜¯æœ‰æ ‡é¢˜æ çš„</p><p><code>Windows</code>é»˜è®¤æä¾›çš„æ ‡é¢˜æ ä¸Šæœ‰ï¼š</p><p>â€‹<code>å›¾æ ‡-çª—å£æ ‡é¢˜-Min-Max-CloseæŒ‰é’®</code></p><p>ä½†æ˜¯ï¼Œè¿™æœªå…å¤ªè¿‡å±€é™</p><p>é«˜è‡ªç”±åº¦çš„è‡ªå®šä¹‰æ˜¯æå®¢<code>(Geek)</code>ç²¾ç¥ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†</p><p>å¦‚æœä½ æƒ³åœ¨æ ‡é¢˜æ ä¸Šå¢åŠ &#x2F;å‡å°‘æ§ä»¶ï¼Œæˆ–æ”¹å˜å¸ƒå±€ã€é¢œè‰²ã€Size</p><p>å°±å¿…é¡»æŠ›å¼ƒ<code>Windows</code>æä¾›çš„å—Ÿæ¥ä¹‹é£Ÿ</p><blockquote><p>è¹´å°”è€Œä¸ä¹‹ï¼Œä¹äººä¸å±‘ä¹Ÿ</p></blockquote><h2 id="ã˜ã‚ƒã‚ã€ã©ã†ã™ã‚‹"><a href="#ã˜ã‚ƒã‚ã€ã©ã†ã™ã‚‹" class="headerlink" title="ã˜ã‚ƒã‚ã€ã©ã†ã™ã‚‹"></a>ã˜ã‚ƒã‚ã€ã©ã†ã™ã‚‹</h2><p>ä½¿ç”¨æ— è¾¹æ¡†çª—å£å³å¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-built_in">setWindowFlags</span>(Qt::FramelessWindowHint);<span class="hljs-comment">//Qt</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥å»é™¤é»˜è®¤çš„æ ‡é¢˜æ ï¼Œå–è€Œä»£ä¹‹çš„ä¾¿æ˜¯å…‰ç§ƒç§ƒçš„å®¢æˆ·åŒº</p><p>ä½ é—®æˆ‘æ¥ä¸‹æ¥æ€ä¹ˆåŠï¼Ÿ</p><p>é‚£è‡ªç„¶æ˜¯è‡ªå·±å†™ä¸€ä¸ªæ ‡é¢˜æ ï¼Œå½“ç„¶è¿™ä¸æ˜¯é‡ç‚¹</p><p>åªæ˜¯ä½ å¾ˆå¿«å°±ä¼šå‘ç°ï¼š<strong>æ ¹æœ¬æ²¡æ³•ç§»åŠ¨çª—å£</strong></p><p>ãã‚Œã¯æ±ºã¾ã£ã¦ã‚“ã ã‚ã†ï¼ˆé‚£å¯ä¸åºŸè¯ï¼‰</p><p><code>è¡£æ¥ä¼¸æ‰‹é¥­æ¥å¼ å£ï¼Œåƒä¹…äº†äº”æ–—ç±³éƒ½ä¸çŸ¥é“æ€ä¹ˆä¸‹åœ°äº†</code></p><h2 id="æ­£é¢˜"><a href="#æ­£é¢˜" class="headerlink" title="æ­£é¢˜"></a>æ­£é¢˜</h2><p>å‰æ‘‡å·¨é•¿ï¼Œç°åœ¨è¿›å…¥æ­£é¢˜ï¼Œé‡ç‚¹è®²è®²å¦‚ä½•ç§»åŠ¨çª—å£</p><p>æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>ç›‘æµ‹é¼ æ ‡åŠ¨ä½œ</li><li>å“åº”<code>Windows</code>æ¶ˆæ¯ï¼Œä¼ªé€ æ ‡é¢˜æ </li></ul><h3 id="æ‰‹åŠ¨æ¨¡æ‹Ÿ"><a href="#æ‰‹åŠ¨æ¨¡æ‹Ÿ" class="headerlink" title="æ‰‹åŠ¨æ¨¡æ‹Ÿ"></a>æ‰‹åŠ¨æ¨¡æ‹Ÿ</h3><p>ç¬¬ä¸€ç§æœ€ç›´è§‚ï¼Œå¹³æ—¶ç§»åŠ¨çª—å£çš„æ–¹å¼ä¸å°±æ˜¯ï¼š</p><p>â€‹<strong>åœ¨é¼ æ ‡åœ¨æ ‡é¢˜æ æŒ‰ä¸‹å·¦é”®å¹¶ç§»åŠ¨ å°±å¯ä»¥å¸¦ç€çª—å£ä¸€èµ·é£å˜›</strong></p><p>é‚£åªè¦æ‰‹åŠ¨æ£€æµ‹é¼ æ ‡çŠ¶æ€ å¹¶ç§»åŠ¨çª—å£å³å¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Widget::mousePressEvent</span><span class="hljs-params">(QMouseEvent* event)</span><span class="hljs-comment">//é¼ æ ‡æŒ‰ä¸‹</span></span><br><span class="hljs-function"></span>&#123;<br>    curPos = event-&gt;<span class="hljs-built_in">screenPos</span>().<span class="hljs-built_in">toPoint</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Widget::mouseMoveEvent</span><span class="hljs-params">(QMouseEvent* event)</span><span class="hljs-comment">//é¼ æ ‡æŒ‰ç€å¹¶ç§»åŠ¨</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (!(event-&gt;<span class="hljs-built_in">buttons</span>() &amp; Qt::LeftButton)) <span class="hljs-keyword">return</span>;<span class="hljs-comment">//å·¦é”®æŒ‰ä¸‹</span><br>    QPoint mousePos = event-&gt;<span class="hljs-built_in">screenPos</span>().<span class="hljs-built_in">toPoint</span>();<br>    QPoint newPos = <span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">pos</span>() + mousePos - curPos;<br>    curPos = mousePos;<br>    <span class="hljs-built_in">move</span>(newPos);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¯æ¬¡é¼ æ ‡ç§»åŠ¨éƒ½ä¼šè§¦å‘<code>Move</code>æ¶ˆæ¯ï¼Œåªè¦è®¡ç®—ä¸ä¸Šæ¬¡ç§»åŠ¨çš„å·®å€¼å¹¶åŒæ­¥ç§»åŠ¨çª—å£ï¼Œå³å¯</p><p>è¿™é‡Œè¦æ³¨æ„å‡ ä¸ªç»†èŠ‚ï¼š</p><ul><li><p>æœ€å¥½ç”¨å‡½æ•°è‡ªå¸¦çš„å‚æ•°<code>event</code>ï¼Œå› ä¸º<code>QCursor::pos()</code>æ›´æ–°ç›¸å¯¹æ»å</p></li><li><p>æœ€å¥½ç”¨é¼ æ ‡çš„å…¨å±€åæ ‡<code>event-&gt;screenPos()</code>ï¼Œè€Œä¸æ˜¯ç›¸å¯¹çª—å£åæ ‡<code>event-&gt;pos()</code>ï¼Œå› ä¸ºåè€…åœ¨é¼ æ ‡å¿«é€Ÿç§»åŠ¨çš„æƒ…å†µä¸‹å¯èƒ½è¶Šç•Œå¯¼è‡´<code>Bomb</code>çˆ†ç‚¸ï¼Œçª—å£é¬¼ç•œ</p></li></ul><h3 id="ä¼ªé€ æ¶ˆæ¯"><a href="#ä¼ªé€ æ¶ˆæ¯" class="headerlink" title="ä¼ªé€ æ¶ˆæ¯"></a>ä¼ªé€ æ¶ˆæ¯</h3><p>ç¬¬äºŒç§ï¼Œæ¬ºéª—<code>Windows</code>ï¼Œå‡è£…è‡ªå®šä¹‰æ ‡é¢˜æ å°±æ˜¯åŸæ¥çš„æ ‡é¢˜æ </p><p>å“åº”<code>Windows</code>æ¶ˆæ¯å³å¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">Widget::nativeEvent</span><span class="hljs-params">(<span class="hljs-type">const</span> QByteArray&amp; eventType, <span class="hljs-type">void</span>* message, <span class="hljs-type">long</span>* result)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">Q_UNUSED</span>(eventType);<br>    MSG* msg = (MSG*)message;<br>    <span class="hljs-keyword">switch</span> (msg-&gt;message) &#123;<br>    <span class="hljs-keyword">case</span> WM_NCHITTEST:<span class="hljs-comment">//é¼ æ ‡ç§»åŠ¨æ¶ˆæ¯</span><br>        <span class="hljs-type">int</span> xPos = <span class="hljs-built_in">GET_X_LPARAM</span>(msg-&gt;lParam) - <span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">frameGeometry</span>().<span class="hljs-built_in">x</span>();<span class="hljs-comment">//è§£æé¼ æ ‡ç›¸å¯¹åæ ‡</span><br>        <span class="hljs-type">int</span> yPos = <span class="hljs-built_in">GET_Y_LPARAM</span>(msg-&gt;lParam) - <span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">frameGeometry</span>().<span class="hljs-built_in">y</span>();<br>        <span class="hljs-keyword">if</span> (ui-&gt;label_title-&gt;<span class="hljs-built_in">geometry</span>().<span class="hljs-built_in">contains</span>(xPos, yPos)) <span class="hljs-comment">//æ ‡é¢˜æ (ä¼ª)</span><br>            *result = HTCAPTION;<span class="hljs-comment">//POINTé‡ç‚¹è¯­å¥ï¼Œé€šè¿‡resultæŒ‡é’ˆè¿”å›--------------------------------&lt;-</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-comment">//å…¶ä»–éƒ¨åˆ†ä¸åšå¤„ç†ï¼Œè¿”å›falseï¼Œç•™ç»™å…¶ä»–äº‹ä»¶å¤„ç†å™¨å¤„ç†</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">//æ­¤å¤„è¿”å›falseï¼Œç•™ç»™å…¶ä»–äº‹ä»¶å¤„ç†å™¨å¤„ç†</span><br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡<code>result</code>æŒ‡é’ˆï¼Œå°†ç»“æœè¿”å›ç»™<code>Windows</code>ï¼Œå‡è£…æ˜¯<code>æ ‡é¢˜æ (CAPTION)</code></p><p>Peace</p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>C++åœ¨ç»§æ‰¿æ¨¡æ¿æ—¶æ— æ³•è®¿é—®çˆ¶ç±»æˆå‘˜é—®é¢˜</title>
    <link href="/2021/09/23/C++%E5%9C%A8%E7%BB%A7%E6%89%BF%E6%A8%A1%E6%9D%BF%E6%97%B6%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E7%88%B6%E7%B1%BB%E6%88%90%E5%91%98%E9%97%AE%E9%A2%98/"/>
    <url>/2021/09/23/C++%E5%9C%A8%E7%BB%A7%E6%89%BF%E6%A8%A1%E6%9D%BF%E6%97%B6%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E7%88%B6%E7%B1%BB%E6%88%90%E5%91%98%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="å•åˆ€ç›´å…¥"><a href="#å•åˆ€ç›´å…¥" class="headerlink" title="å•åˆ€ç›´å…¥"></a>å•åˆ€ç›´å…¥</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">B</span> &#123; <br>    <span class="hljs-type">int</span> x; <br>&#125;;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">X</span> : B&lt;T&gt; &#123;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span> </span>&#123; x = <span class="hljs-number">0</span>; &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™</p><p><code>foo()</code>å†…çš„<code>x</code>æ ‡è¯†ç¬¦æ— æ³•è¢«æ‰¾åˆ°</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p><code>C++</code>çš„æ¨¡æ¿ä¸­çš„åç§°ä¼šè¿›è¡Œä¸¤æ¬¡æŸ¥æ‰¾ï¼Œç§°ä¸ºä¸¤é˜¶æ®µæŸ¥æ‰¾ï¼ˆtwo-phase lookupï¼‰ã€‚</p><p>å¯¹äºä¸€ä¸ª<code>éä¾èµ–å‹åç§°</code>ï¼ˆä¸ä»¥ä»»ä½•æ–¹å¼ä¾èµ–äºæ¨¡æ¿å‚æ•°çš„åç§°ï¼‰ï¼Œåœ¨æ¨¡æ¿å£°æ˜è¿›è¡Œè§£æçš„æ—¶å€™å°±ä¼šè¿›è¡ŒæŸ¥æ‰¾</p><p>ä½†<code>C++</code>æ ‡å‡†ä¸­è§„å®šï¼ˆ14.6.2 3ï¼‰ï¼Œä¸€ä¸ªéå—é™çš„åç§°æŸ¥æ‰¾çš„æ—¶å€™å°†ä¸ä¼šè€ƒè™‘ä¾èµ–å‹çš„åŸºç±»</p><p>è€Œ<code>x</code>æ˜¯ä¸€ä¸ª<code>éä¾èµ–å‹åç§°</code>ï¼Œåœ¨ç¬¬ä¸€é˜¶æ®µç°åœºæŸ¥æ‰¾ï¼ˆæ­¤æ—¶æ¨¡æ¿çˆ¶ç±»æœªå®ä¾‹åŒ–ï¼‰ï¼Œä¸ä¼šæœç´¢çˆ¶ç±»scope</p><p>å¯¼è‡´æ‰¾ä¸åˆ°<code>x</code>æ ‡è¯†ç¬¦</p><h2 id="è¿›ä¸¤æ­¥åˆ†æ"><a href="#è¿›ä¸¤æ­¥åˆ†æ" class="headerlink" title="è¿›ä¸¤æ­¥åˆ†æ"></a>è¿›ä¸¤æ­¥åˆ†æ</h2><p>ä½†æ˜¯åœ¨ç¬¬äºŒé˜¶æ®µï¼Œç­‰æ¨¡æ¿å®ä¾‹åŒ–äº†ï¼Œå°±èƒ½å¤ŸæŸ¥æ‰¾çˆ¶ç±»scopeï¼Œæ­¤æ—¶å°±èƒ½æ‰¾åˆ°<code>x</code></p><p>é‚£åªè¦æƒ³åŠæ³•å°†å…¶å»¶è¿Ÿåˆ°ç¬¬äºŒé˜¶æ®µå³å¯</p><p>ä¹Ÿå°±æ˜¯å°†å…¶å˜æˆ<code>ä¾èµ–å‹åç§°</code></p><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>æœ‰ä¸¤ç§åŠæ³•ï¼š</p><p><code>this-&gt;x</code>(å› ä¸º<code>this</code>ä»£è¡¨å®ä¾‹æŒ‡é’ˆ)</p><p><code>Base&lt;T&gt;::x</code>(æ˜ç¡®æŒ‡å‡ºæœç´¢çˆ¶ç±»æ¨¡æ¿)</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a href="https://blog.csdn.net/sb985/article/details/79670881?utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~default-1.no_search_link&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~default-1.no_search_link">c++æ¨¡æ¿ç±»åœ¨ç»§æ‰¿ä¸­å­ç±»æ— æ³•è®¿é—®çˆ¶ç±»çš„æˆå‘˜_å°æºçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://www.zhihu.com/question/28139230">å¦‚ä½•ç†è§£ æ¨¡æ¿ç±»ç»§æ‰¿æ¨¡æ¿ç±»ï¼Œ å­ç±»çœ‹ä¸åˆ°çˆ¶ç±»æˆå‘˜ï¼Ÿ - çŸ¥ä¹</a></p>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>ç»§æ‰¿</tag>
      
      <tag>æ¨¡æ¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windeployqtå‘å¸ƒé¡¹ç›® ä¸ºä½•æ€»æ˜¯ç¼ºå°‘dll</title>
    <link href="/2021/09/17/windeployqt%E5%8F%91%E5%B8%83%E9%A1%B9%E7%9B%AE-%E4%B8%BA%E4%BD%95%E6%80%BB%E6%98%AF%E7%BC%BA%E5%B0%91dll/"/>
    <url>/2021/09/17/windeployqt%E5%8F%91%E5%B8%83%E9%A1%B9%E7%9B%AE-%E4%B8%BA%E4%BD%95%E6%80%BB%E6%98%AF%E7%BC%BA%E5%B0%91dll/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Qt</code>ç›´æ¥ç¼–è¯‘äº§ç”Ÿçš„<code>exe</code>æ–‡ä»¶å¾ˆéš¾åœ¨å…¶ä»–ç”µè„‘ä¸­è¿è¡Œ</p><p>å…¶æ ¹æºåœ¨äº<code>Qt</code>é‡‡ç”¨åŠ¨æ€é“¾æ¥ï¼Œæ‰€ä¾èµ–çš„å‡½æ•°ä¸ç±»ç­‰ï¼Œå°è£…åœ¨<code>dll(åŠ¨æ€é“¾æ¥åº“Â·Dynamic Link Library)</code>ä¸­</p><p>æ‰€ä»¥ï¼Œå•å•å¤åˆ¶<code>exe</code>æ–‡ä»¶ï¼Œä¼šå¯¼è‡´ç¼ºå¤±<code>dllä¾èµ–åº“</code>ï¼Œè‡´ä½¿æ— æ³•æ­£ç¡®è¿è¡Œ</p><p>çŸ¥é“äº†é—®é¢˜æ‰€åœ¨ï¼Œè§£å†³æ–¹æ³•ä¹Ÿæ˜¯ä¸€ç›®äº†ç„¶ï¼Œåªè¦å°†<code>exe</code>åŒ<code>dllä¾èµ–åº“</code>ä¸€é½æ‰“åŒ…å³å¯</p><p>ç”±äºæ‰‹åŠ¨å¯»æ‰¾ä¾èµ–åº“æå…¶ä¸ä¾¿ï¼Œ<code>Qt</code>è´´å¿ƒåœ°æä¾›äº†éƒ¨ç½²å·¥å…·<code>windeployqt</code></p><h2 id="Usageãƒ»å½"><a href="#Usageãƒ»å½" class="headerlink" title="Usageãƒ»å½"></a>Usageãƒ»å½</h2><p>[ç”±äº<code>windeployqt</code>ç°å·²åŠ å…¥<code>Windows</code>è±ªåç¯å¢ƒå˜é‡]</p><p>æ‰€ä»¥åªè¦åœ¨<code>CMD</code>ä¸­æ”¹å˜(<code>cdÂ·Change Directory</code>)å·¥ä½œç›®å½•è‡³<code>exe</code>æ‰€åœ¨ç›®å½•</p><p>å¹¶æ‰§è¡Œ<code>windeployqt test.exe</code></p><p>ä¾¿ä¼šè‡ªåŠ¨å°†ä¾èµ–æ–‡ä»¶ï¼ˆåŒ…æ‹¬<code>dll</code>å’Œå›¾æ ‡ç­‰ä¼—æ–‡ä»¶ï¼‰æ‹·è´è‡³<code>exe</code>æ‰€åœ¨ç›®å½•</p><p>æ­¤æ—¶ï¼Œæ‰“åŒ…ä¸ºå‹ç¼©åŒ…å¹¶ä¸€é½å‘å¸ƒå³å¯</p><h2 id="Pause"><a href="#Pause" class="headerlink" title="Pause"></a>Pause</h2><p>çœŸæœ‰è¿™ä¹ˆç®€å•ï¼Ÿ</p><p>æ˜¯çš„ï¼Œæˆ‘å°±æ˜¯è¿™ä¹ˆå¹²çš„ï¼Œç„¶åè¯¾ä¸ŠPresentationã®æ™‚ç–¯ç‹‚<code>â€œç¼ºå¤±dllâ€</code></p><p>ç›´æ¥ç¤¾æ­»</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>è¿™ç©¶ç«Ÿæ˜¯äººæ€§çš„æ‰­æ›²è¿˜æ˜¯é“å¾·çš„æ²¦ä¸§</p><p>è¿™æ˜¾ç„¶æ˜¯ <code>å¤åˆ¶äº†ä½†æ²¡æœ‰å®Œå…¨å¤åˆ¶</code></p><p>ç¤¾æ­»çš„æˆ‘å›åˆ°åº§ä½ä¸Šå¼€å§‹æ‰¾åº¦å¨˜</p><p>åº¦å¨˜çš„åšæ³•å’Œæˆ‘ç¨ç¨ã€å‰Šå‰Šæœ‰é‚£ä¹ˆä¸€ç‚¹ç‚¹ ä¸åŒ</p><p>ä¸æ˜¯<code>Windows</code>è‡ªå¸¦<code>CMD</code>è€Œæ˜¯<code>Qt</code>æä¾›çš„å‘½ä»¤è¡Œç¯å¢ƒï¼š<code>Qt 5.14.2 (MinGW 7.3.0 64-bit)</code></p><p><img src="/img/Qt%E5%91%BD%E4%BB%A4%E8%A1%8C.jpg" alt="Qt 5.14.2 (MinGW 7.3.0 64-bit)"></p><h2 id="è¿›ä¸¤æ­¥åˆ†æ"><a href="#è¿›ä¸¤æ­¥åˆ†æ" class="headerlink" title="è¿›ä¸¤æ­¥åˆ†æ"></a>è¿›ä¸¤æ­¥åˆ†æ</h2><p>é‚£è«ï¼Œè¿™ä¿©ç©¶ç«Ÿæœ‰ä½•åŒºåˆ«ï¼Œé€ æˆæœ€ç»ˆæ‹·è´çš„<code>dll</code>æ•°é‡ä¸ç›¸åŒå‘¢</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ <code>Qt 5.14.2 (MinGW 7.3.0 64-bit)</code> ç©¶ç«Ÿæ˜¯ä½•æ–¹ç¥åœ£</p><p>å®é™…ä¸Šè¿™ç©æ„å„¿æ˜¯ä¸ª<code>linkï¼ˆå¿«æ·æ–¹å¼ï¼‰</code></p><p><img src="/img/Qt%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B1%9E%E6%80%A7.png" alt="Qtå‘½ä»¤è¡Œå±æ€§"></p><p>æ³¨æ„<code>ç›®æ ‡(T)</code>å¤„ä»£ç </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs CMD"><span class="hljs-function">C:\<span class="hljs-title">Windows</span>\<span class="hljs-title">System32</span>\<span class="hljs-title">cmd.exe</span> /<span class="hljs-title">A</span> /<span class="hljs-title">Q</span> /<span class="hljs-title">K</span> <span class="hljs-title">E</span>:\<span class="hljs-title">Qt5</span>.14.2\5.14.2\<span class="hljs-title">mingw73_64</span>\<span class="hljs-title">bin</span>\<span class="hljs-title">qtenv2.bat</span></span><br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šæ˜¯è°ƒç”¨<code>CMD</code>æ‰§è¡Œäº†<code>qtenv2.bat</code>ï¼ˆæ‰¹å¤„ç†æ–‡ä»¶ï¼‰</p><p>é‚£ä¹ˆï¼ŒçŒ«è…»ä¹Ÿè®¸å°±è—åœ¨è¿™ä¸ª<code>bat</code>æ–‡ä»¶ä¸­</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä¸­çš„å†…å®¹ï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs BAT">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-built_in">echo</span> Setting up environment <span class="hljs-keyword">for</span> Qt usage...<br><span class="hljs-built_in">set</span> <span class="hljs-built_in">PATH</span>=E:\Qt5.<span class="hljs-number">14</span>.<span class="hljs-number">2</span>\<span class="hljs-number">5</span>.<span class="hljs-number">14</span>.<span class="hljs-number">2</span>\mingw73_64\bin;E:/Qt5.<span class="hljs-number">14</span>.<span class="hljs-number">2</span>/Tools/mingw730_64\bin;<span class="hljs-variable">%PATH%</span><br><span class="hljs-built_in">cd</span> /D E:\Qt5.<span class="hljs-number">14</span>.<span class="hljs-number">2</span>\<span class="hljs-number">5</span>.<span class="hljs-number">14</span>.<span class="hljs-number">2</span>\mingw73_64<br></code></pre></td></tr></table></figure><p>å…¶å®çœŸæ­£èƒ½å¤Ÿé€ æˆå½±å“çš„æ˜¯ç¬¬3è¡Œçš„<code>set PATH</code>ä¸­çš„ç¬¬äºŒä¸ª<code>path(E:/Qt5.14.2/Tools/mingw730_64\bin)</code></p><p>å› ä¸ºç¬¬ä¸€ä¸ª<code>path</code>å…¶å®å·²ç»é»˜è®¤åŠ å…¥äº†ç¯å¢ƒå˜é‡ æ— ä¼¤å¤§é›…</p><p>è€Œ<code>path(E:/Qt5.14.2/Tools/mingw730_64\bin)</code>ä¸­å¹¶ä¸åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œå¯¼è‡´ä¸€èˆ¬çš„<code>CMD</code>æ–¹å¼æ— æ³•è¯»å–å…¶ä¸­çš„<code>dll</code>ï¼Œå¯¼è‡´<code>dllç¼ºå¤±</code></p><h2 id="Last-And-Absolutely-Last"><a href="#Last-And-Absolutely-Last" class="headerlink" title="Last And Absolutely Last"></a>Last And Absolutely Last</h2><p>çœŸç›¸äº†ï¼Œå°±ç¼ºè¿™ä¹ˆä¸€ä¸ªç›®å½•ï¼Œå°‘äº†ä¸€å †<code>dll</code></p><p>ä¸‹æ¬¡è®°å¾—ç”¨<code>Qt</code>å‘½ä»¤è¡Œç¯å¢ƒ</p><p>å“¦ å¯¹äº† å¦‚æœä½¿ç”¨<code>Enigma Virtual Box</code>å°åŒ…</p><p>è®°å¾—ä¸è¦æ‹–å…¥<strong>æ–‡ä»¶å¤¹</strong>ï¼è€Œæ˜¯æ‹–å…¥æ–‡ä»¶(without exe)</p><p>å¦åˆ™ã€cannot load library Qt5Core.dllã€‘ï¼ï¼</p><p>Peace</p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>Windows</tag>
      
      <tag>windeployqt</tag>
      
      <tag>CMD</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Qtæ‰“å¼€æŒ‡å®šç›®å½•å¹¶é€‰ä¸­æ–‡ä»¶</title>
    <link href="/2021/08/26/Qt%E6%89%93%E5%BC%80%E6%8C%87%E5%AE%9A%E7%9B%AE%E5%BD%95%E5%B9%B6%E9%80%89%E4%B8%AD%E6%96%87%E4%BB%B6/"/>
    <url>/2021/08/26/Qt%E6%89%93%E5%BC%80%E6%8C%87%E5%AE%9A%E7%9B%AE%E5%BD%95%E5%B9%B6%E9%80%89%E4%B8%AD%E6%96%87%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>æœ‰æ—¶ï¼Œä¸ºäº†æ–¹ä¾¿ç”¨æˆ·æŸ¥çœ‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æä¾›<code>åœ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€æ–‡ä»¶</code>çš„åŠŸèƒ½</p><p>æ¯”å¦‚ï¼šQt(<code>åœ¨Explorerä¸­æ˜¾ç¤º</code>)ã€Chrome(<code>åœ¨æ–‡ä»¶å¤¹ä¸­æ˜¾ç¤º</code>)</p><p><img src="/img/Qt-%E5%9C%A8Explorer%E4%B8%AD%E6%98%BE%E7%A4%BA.jpg" alt="Qt-åœ¨Explorerä¸­æ˜¾ç¤º"></p><p><img src="/img/Chrome-%E5%9C%A8%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E6%98%BE%E7%A4%BA.jpg" alt="Chrome-åœ¨æ–‡ä»¶å¤¹ä¸­æ˜¾ç¤º"></p><h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><p>è¯¥åŠŸèƒ½ç”¨äºæ‰“å¼€ä¸€ä¸ªæŒ‡å®šæ–‡ä»¶å¤¹ï¼Œå¹¶é€‰ä¸­æŒ‡å®š<code>æ–‡ä»¶</code></p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>æ‰“å¼€<code>æ–‡ä»¶å¤¹</code>æœ¬è´¨ä¸Šå’Œæ‰“å¼€<code>æ–‡ä»¶</code>æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œè¯´ç™½äº†å°±æ˜¯ä¸€ä¸ª<code>URL</code>(Uniform Resource Locator)</p><p>æ‰“å¼€<code>URL</code>ï¼Œæˆ‘ä»¬èƒ½æƒ³åˆ°å¾ˆå¤šç§æ–¹æ³•ï¼š</p><ul><li><code>Windows API</code>ä¸­çš„<code>ShellExecute()</code>å‡½æ•°</li><li><code>CMD</code> çš„ startå‘½ä»¤</li><li>Qtè‡ªå¸¦çš„<code>QDesktopServices::openUrl(const QUrl &amp;url)</code>é™æ€å‡½æ•°</li><li>and so onâ€¦</li></ul><p>æ‰“å¼€<code>URL</code>å¹¶ä¸æ˜¯ä»€ä¹ˆéš¾äº‹</p><p>ä½†æˆ‘ä»¬åœ¨æ‰“å¼€<code>æ–‡ä»¶å¤¹</code>åè¿˜å¿…é¡»é€‰ä¸­<code>æ–‡ä»¶</code></p><p>è¿™ä¸€ç‚¹ï¼Œä¸€èˆ¬çš„å‡½æ•°éƒ½åšä¸åˆ°</p><h2 id="ã‚‚ã£ã¨åˆ†æ"><a href="#ã‚‚ã£ã¨åˆ†æ" class="headerlink" title="ã‚‚ã£ã¨åˆ†æ"></a>ã‚‚ã£ã¨åˆ†æ</h2><p>ç©¶å…¶åŸå› </p><p>æˆ‘ä»¬è¦æ˜ç™½ï¼Œ<code>èµ„æºç®¡ç†å™¨</code>æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<code>åº”ç”¨ç¨‹åº</code></p><p>å³<code>explorer.exe</code></p><p>æˆ‘ä»¬è¦å¯¹<code>åº”ç”¨ç¨‹åº</code>ä¸‹æ‰‹ï¼Œæœ€å¥½çš„åŠæ³•è¿˜æ˜¯é€šè¿‡å…¶è‡ªèº«çš„å‚æ•°</p><h3 id="å‘½ä»¤è¡Œå‚æ•°"><a href="#å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="å‘½ä»¤è¡Œå‚æ•°"></a>å‘½ä»¤è¡Œå‚æ•°</h3><p>æ‰€è°“å‘½ä»¤è¡Œå‚æ•°ï¼Œå°±æ˜¯åœ¨å¯åŠ¨æ—¶ä¼ é€’ç»™ç¨‹åºçš„å‚æ•°ï¼Œç”¨ä»¥æ‰§è¡Œä¸åŒæ“ä½œ</p><p>æ¯”å¦‚ï¼šä¼ é€’ç»™å›¾ç‰‡æŸ¥çœ‹å™¨<code>å›¾ç‰‡çš„ç»å¯¹è·¯å¾„</code></p><p>åœ¨<code>C/C++</code>ä¸­</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span></span><br></code></pre></td></tr></table></figure><p><code>argv</code>æŒ‡é’ˆæ•°ç»„ä¾¿æ˜¯å‘½ä»¤è¡Œå‚æ•°</p><p>é€šè¿‡è¿™äº›å‚æ•°ï¼Œç¨‹åºè‡ªèº«ä¾¿å¯ä»¥è¿›è¡Œåˆ¤æ–­ï¼Œè·å–æ›´å¤šå¤–ç•Œä¿¡æ¯</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>CMD</code>æˆ–è€…æ‹–æ‹½æ–‡ä»¶ä¼ é€’å‘½ä»¤è¡Œå‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs command">test.exe argument<br></code></pre></td></tr></table></figure><p><em>åº”ç”¨ç¨‹åºè·¯å¾„ + ç©ºæ ¼ + å‚æ•°å³å¯</em>ï¼ˆå‚æ•°é—´ç”¨ç©ºæ ¼åˆ†å¼€ï¼‰</p><h3 id="explorerå‚æ•°"><a href="#explorerå‚æ•°" class="headerlink" title="explorerå‚æ•°"></a>explorerå‚æ•°</h3><p>æ˜ç™½äº†è¿™äº›ï¼Œæˆ‘ä»¬åªéœ€è¦ç»™<code>explorer</code>ä¼ é€’å¯¹åº”å‚æ•°å³å¯é€‰ä¸­æ–‡ä»¶</p><p>æ ¼å¼å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs command">explorer.exe /select, URL<br></code></pre></td></tr></table></figure><h2 id="ç†è®ºå­˜åœ¨-å®è·µå¼€å§‹"><a href="#ç†è®ºå­˜åœ¨-å®è·µå¼€å§‹" class="headerlink" title="ç†è®ºå­˜åœ¨ å®è·µå¼€å§‹"></a>ç†è®ºå­˜åœ¨ å®è·µå¼€å§‹</h2><p>è¦èƒ½éé˜»å¡å¼€å¯å¤–éƒ¨ç¨‹åºï¼Œå¹¶ä¼ é€’å‚æ•°</p><p>æˆ‘ä»¬å¤§ä½“æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li><code>ShellExecute()</code></li><li><code>QProcess</code></li></ul><h3 id="ShellExecute-Windows-API"><a href="#ShellExecute-Windows-API" class="headerlink" title="ShellExecute() - Windows API"></a>ShellExecute() - Windows API</h3><p><code>ShellExecute</code>å‡½æ•°åŸå‹åŠå‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-built_in">ShellExecute</span>(<br>hWnd: HWND; <span class="hljs-comment">//&#123;æŒ‡å®šçˆ¶çª—å£[å¥æŸ„]&#125;</span><br>Operation: PChar; <span class="hljs-comment">//&#123;æŒ‡å®šåŠ¨ä½œ, è­¬å¦‚: openã€runasã€printã€editã€exploreã€find&#125;</span><br>FileName: PChar; <span class="hljs-comment">//&#123;æŒ‡å®šè¦æ‰“å¼€çš„æ–‡ä»¶æˆ–ç¨‹åº&#125;</span><br>Parameters: PChar; <span class="hljs-comment">//&#123;ç»™è¦æ‰“å¼€çš„ç¨‹åºæŒ‡å®šå‚æ•°&#125; &lt;-å‘½ä»¤è¡Œå‚æ•°</span><br>Directory: PChar; <span class="hljs-comment">//&#123;ç¼ºçœç›®å½•&#125;</span><br>ShowCmd: Integer <span class="hljs-comment">//&#123;æ‰“å¼€é€‰é¡¹&#125;</span><br>);<br></code></pre></td></tr></table></figure><p>çœ‹èµ·æ¥å¤æ‚ï¼Œä½†ä¸»è¦å°±æ˜¯<code>FileName</code>å’Œ<code>Parameters</code>ï¼Œä¸¾ä¸ªä¾‹å­ä¾¿ä¸€ç›®äº†ç„¶</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-built_in">ShellExecute</span>(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;open&quot;</span>, <span class="hljs-string">&quot;explorer&quot;</span>, <span class="hljs-string">&quot;/select, E:\test.png&quot;</span>, <span class="hljs-literal">NULL</span>, SW_SHOW);<span class="hljs-comment">//æ‰“å¼€E:\test.pngå¹¶é€‰ä¸­</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦æ³¨æ„ä¸€ç‚¹</p><p>å¤§å¤š<code>Windows API</code>éƒ½åˆ†ä¸ºäº†ä¸¤ä¸ªç‰ˆæœ¬ï¼šWç‰ˆå’ŒAç‰ˆ</p><p>ä¹Ÿå°±æ˜¯<code>ShellExecuteW</code>å’Œ<code>ShellExecuteA</code></p><p>åŒºåˆ«æ˜¯Wä»£è¡¨å®½å­—ç¬¦ï¼Œé‡‡ç”¨Unicodeç¼–ç ï¼ŒAä»£è¡¨ASCIIç¼–ç </p><p>ç”±äº<code>æ–‡ä»¶è·¯å¾„</code>å¯èƒ½å‡ºç°ä¸­æ–‡ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨<code>ShellExecuteW</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-built_in">ShellExecuteW</span>(<span class="hljs-literal">NULL</span>, <span class="hljs-string">L&quot;open&quot;</span>, <span class="hljs-string">L&quot;explorer&quot;</span>, <span class="hljs-built_in">QString</span>(<span class="hljs-string">&quot;/select, \&quot;%1\&quot;&quot;</span>).<span class="hljs-built_in">arg</span>(ImagePath).<span class="hljs-built_in">toStdWString</span>().<span class="hljs-built_in">c_str</span>(), <span class="hljs-literal">NULL</span>, SW_SHOW);<br></code></pre></td></tr></table></figure><p><code>L&quot;open&quot;</code>å‰çš„<code>L</code>ä»£è¡¨å°†<code>&quot;open&quot;</code>è½¬åŒ–ä¸ºå®½å­—ç¬¦ï¼Œå¦åˆ™ä¸ç¬¦åˆå‚æ•°ç±»å‹<code>LPCWSTR</code>(<code>typedef const wchar_t* LPCWSTR;</code>)</p><p>è€ŒQStringä¹Ÿè¦ç›¸åº”åœ°è½¬åŒ–ä¸ºå®½å­—ç¬¦ç‰ˆæœ¬</p><p><strong>Perfect</strong></p><h3 id="QProcess-Qtç±»"><a href="#QProcess-Qtç±»" class="headerlink" title="QProcess - Qtç±»"></a>QProcess - Qtç±»</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹Qtç‰¹æœ‰çš„ç±»-QProcess</p><p>è¯¥ç±»å¯ç”¨äºå®Œæˆå¯åŠ¨å¤–éƒ¨ç¨‹åºï¼Œå¹¶ä¸ä¹‹äº¤äº’é€šä¿¡</p><p>ä½†æ­¤æ¬¡æˆ‘ä»¬ä¸éœ€è¦é€šä¿¡ï¼Œåªè¦ä¼ å…¥å‚æ•°å¹¶éé˜»å¡å¯åŠ¨å³å¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C++">QProcess process;<br>process.<span class="hljs-built_in">startDetached</span>(<span class="hljs-built_in">QString</span>(<span class="hljs-string">&quot;explorer /select,\&quot;%1\&quot;&quot;</span>).<span class="hljs-built_in">arg</span>(ImagePath));<span class="hljs-comment">//å¯åŠ¨ååˆ†ç¦»ï¼Œå³éé˜»å¡</span><br></code></pre></td></tr></table></figure><p>ç”±äºæ˜¯Qtå†…éƒ¨çš„ç±»ï¼Œæ‰€ä»¥ä¸éœ€è¦ç‰¹æ®Šå¤„ç†å®½å­—ç¬¦ï¼Œå› ä¸ºQtä¸€å¾‹é‡‡ç”¨Unicodeç¼–ç </p><p><em>Windows APIï¼Œä½ çœ‹çœ‹äººå®¶</em></p><p>Over</p><p>ä¸¤ç§æ–¹æ³•ï¼Œæ·ç¡¬å¸å†³å®šå§</p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‰³é˜³å°æ•…äº‹ å…¶ä¸€ï¼šé¬¼èŠ‚ä¹°çº¸</title>
    <link href="/2021/08/22/%E8%89%B3%E9%98%B3%E5%B0%8F%E6%95%85%E4%BA%8B-%E5%85%B6%E4%B8%80%EF%BC%9A%E9%AC%BC%E8%8A%82%E4%B9%B0%E7%BA%B8/"/>
    <url>/2021/08/22/%E8%89%B3%E9%98%B3%E5%B0%8F%E6%95%85%E4%BA%8B-%E5%85%B6%E4%B8%80%EF%BC%9A%E9%AC%BC%E8%8A%82%E4%B9%B0%E7%BA%B8/</url>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ˜¯é£å’Œæ—¥ä¸½ã€è‰³é˜³é«˜ç…§çš„<code>é¬¼èŠ‚</code> </p><p>æå°å§è¦å»ä¹°<code>çº¸</code></p><blockquote><p>å“ˆ~ é€›äº†ä¸€ä¸‹åˆ ç´¯æ­»äº†</p></blockquote><ul><li>å«ç”Ÿçº¸</li><li>é¤å·¾çº¸</li><li>å·çº¸</li></ul><blockquote><p>ã‚ã‚ã‚ã‚ã‚ã€€ã©ã¡ã‚‰ã¯ã„ã„ã‚“ã ã‚ˆï½ã€€å¤§å¤‰ã </p></blockquote><p>å‡ºäºç¨‹åºå‘˜çš„ç›´è§‰ï¼Œä¸ºäº†é˜²æ­¢å‡ºç°æ„å¤–</p><p>æå°å§å†³å®šå¤‡ä¸€ä¸ªç­ç«å™¨</p><blockquote><p>è€æ¿ï¼Œç­ç«å™¨ï¼Œä¸€ã¤ã€€ãŠé¡˜ã„</p></blockquote><blockquote><p><strong>è€æ¿ï¼š</strong>ã‹ã—ã“ã¾ã‚Šã¾ã—ãŸã€€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ</p></blockquote><p>è‰³é˜³æå‡ºæˆå·çš„çº¸ï¼Œå‘ç°æ²¡å¸¦æ‰“ç«æœº</p><p>åˆä»åé¢æŠ½çƒŸçš„å¤§å”é‚£ï¼Œå€Ÿäº†ç«</p><blockquote><p>å…¹ Fire è½°è½°è½°<br>å‘²å‘²å‘²å‘²å‘²å‘²</p></blockquote><p>çƒŸé›¾è§¦å‘äº†è­¦æŠ¥å™¨</p><p>å…¨æ‘å”¯ä¸€å»è¿‡è¿ªå…çš„èŠ±æ´’ï¼Œåƒäº†ç”Ÿç“œè›‹å­èˆ¬åœ°å°½æƒ…å–·æ´’</p><p>é‚£ä¸€å¤œï¼Œäººä»¬ä¼¼ä¹ä¸å†è¢«ç–«æƒ…çš„é˜´éœ¾ç¬¼ç½©</p><p>è‰³é˜³ä¹‹ä¸‹ï¼Œäººç¾¤å¼€å§‹èºåŠ¨ï¼Œå¾€æ—¥å†·æ¸…çš„å•†åœºæ•£å‘å‡ºæ ¼å¤–è€€çœ¼çš„å…‰èŠ’</p><p>ä¸€åˆ‡ï¼Œåˆæ¢å¤äº†æ›¾ç»çš„ç”Ÿæœºä¸æ´»åŠ›</p><p>åªæ˜¯è€æ¿ä»–</p><p>å´<code>æ ˆæº¢å‡º</code>äº†</p><p>è¿›åŒ–ä¸ºäº†<code>Ghost</code></p><p>è€æ¿å¹³æ—¥å¾…äººå’Œå–„ï¼Œæˆäº†<code>Ghost</code>ï¼Œè„¾æ°”ä¹Ÿä¸å</p><p>åªæ˜¯</p><p>ä»–å˜´é‡Œä¸€ç›´å¿µå¨ç€</p><blockquote><p>çº¸ çº¸ æˆ‘çš„çº¸</p></blockquote><p>ä¸ºäº†çºªå¿µè€æ¿</p><p>ä¸ºäº†æ‰¾å›äººä»¬å¿ƒä¸­é‚£ä¸ªå–„è‰¯å¯çˆ±çš„è€æ¿</p><p>å¤§å®¶å†³å®šï¼Œå°†æ¯å¹´çš„è¿™ä¸€å¤©å®šä¸º<code>Ghost Festival</code>ï¼Œå³<code>é¬¼èŠ‚</code></p><p>æ¯å¹´çš„ä»Šå¤©ï¼Œå¤§å®¶éƒ½ä¼šæ¥åˆ°è¿™ï¼Œé€šè¿‡ç«ç„°ï¼Œå°†<code>çº¸</code>ä¸<code>çº¸ä¸Šçš„æ€å¿µ</code>çµä½“åŒ–ï¼Œä¼ è¾¾ç»™è€æ¿</p><p>è¿™ä¾¿æ˜¯ <code>é¬¼èŠ‚</code>çš„ç”±æ¥</p><hr><p>æ•…äº‹è®²å®Œäº†</p><p>ç°åœ¨æˆ‘ä»¬æ¥è®²è®²<a href="https://www.bilibili.com/video/BV1DK411n7e1"><code>æ ˆæº¢å‡º</code></a></p><p>â€¦</p>]]></content>
    
    
    <categories>
      
      <category>å°æ•…äº‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>story</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºé€šè¿‡ShellExecute()å¯åŠ¨CMDçš„ç¯å¢ƒå˜é‡é—®é¢˜</title>
    <link href="/2021/08/21/%E5%85%B3%E4%BA%8E%E9%80%9A%E8%BF%87ShellExecute-%E5%90%AF%E5%8A%A8CMD%E7%9A%84%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%97%AE%E9%A2%98/"/>
    <url>/2021/08/21/%E5%85%B3%E4%BA%8E%E9%80%9A%E8%BF%87ShellExecute-%E5%90%AF%E5%8A%A8CMD%E7%9A%84%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p><code>CMD</code>(å‘½ä»¤æç¤ºç¬¦)æ˜¯Windowsä¸Šçš„å‘½ä»¤è§£é‡Šç¨‹åº</p><p>æˆ‘ä»¬å¯ä»¥å¿«é€Ÿåœ°åœ¨ç³»ç»Ÿèœå•ä¸­å¯åŠ¨<code>CMD</code>ï¼Œå¹¶æ‰§è¡Œä¸€ç³»åˆ—å¿«æ·æ“ä½œ</p><p>ä½†ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œæˆ‘ä»¬å¯èƒ½ç»å¸¸éœ€è¦åœ¨ç¨‹åºä¸­è°ƒç”¨<code>CMD</code>æ¥æ‰§è¡ŒæŒ‡ä»¤ä»¥è¾…åŠ©æ‰§è¡Œä»»åŠ¡</p><p>è¿™å°±æ¶‰åŠåˆ°<strong>å¤–éƒ¨ç¨‹åºè°ƒç”¨</strong></p><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>C/C++</code>ä¸­ä½¿ç”¨<code>system()</code>å‡½æ•°æ¥æ‰§è¡Œ<code>CMD</code>æŒ‡ä»¤</p><p>ã§ã‚‚ã­ï¼Œ<code>system()</code>æ˜¯é˜»å¡å‡½æ•°ï¼Œé¡¾åæ€ä¹‰ï¼Œåœ¨<code>CMD</code>æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ä¹‹å‰ï¼Œç¨‹åºæµéƒ½ä¼šé˜»å¡åœ¨<code>system()</code></p><p>æœ‰æ—¶å€™ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚ï¼ˆæ¯”å¦‚åœ¨æ‰§è¡Œè€—æ—¶æŒ‡ä»¤æ—¶ï¼‰</p><h2 id="æ­£ç‰‡"><a href="#æ­£ç‰‡" class="headerlink" title="æ­£ç‰‡"></a>æ­£ç‰‡</h2><p>æ­¤æ—¶ï¼Œå°±éœ€è¦éé˜»å¡å‡½æ•°æ¥å¼€å¯<code>CMD</code>è¿›ç¨‹</p><p>æ¯”å¦‚ï¼š<a href="https://baike.baidu.com/item/Shellexecute/5788449"><code>ShellExecute()</code></a> <em><a href="https://blog.csdn.net/helinsen/article/details/50464581">æ³¨æ„äº‹é¡¹</a></em></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-built_in">ShellExecute</span>(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;open&quot;</span>, <span class="hljs-string">&quot;cmd&quot;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, SW_SHOW);<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œæˆ‘æƒŠå¥‡åœ°å‘ç°ï¼Œç”¨<code>ShellExecute()</code>å¼€å¯çš„<code>CMD</code>ä¸æ‰‹åŠ¨å¼€å¯çš„<code>CMD</code>æœ‰äº›è®¸ä¸åŒ</p><p>æ¯”å¦‚ï¼šæœ‰äº›<code>ç¯å¢ƒå˜é‡</code>åœ¨åè€…æ­£å¸¸ä½¿ç”¨ï¼Œå´åœ¨å‰è€…æ— æ³•è¢«è¯†åˆ«</p><p>æç¤ºï¼š<em>XXXä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºæˆ–æ‰¹å¤„ç†æ–‡ä»¶</em></p><h2 id="ç™¾æ€"><a href="#ç™¾æ€" class="headerlink" title="ç™¾æ€"></a>ç™¾æ€</h2><p>ãªã‚“ã ã‚ã†ã­</p><p>ã©ã†ã—ã¦ã‚“ã ã‚ˆ</p><p>ãªãœã ã ã ã ã ã ã ã ã ã ã </p><p>(ã€‚Â´ï½¥Ï‰ï½¥)?</p><p>ä¸ºå•¥å‘€ï¼Œæ˜æ˜å¯åŠ¨çš„æ˜¯åŒä¸€ä¸ªexeæ–‡ä»¶</p><p>éš¾é“æ˜¯å·¥ä½œç›®å½•ä¸åŒï¼Ÿä¸å¯¹ï¼Œæˆ‘å·²ç»è®¾ç½®äº†å¯¹åº”çš„å·¥ä½œç›®å½•ï¼Œè€Œä¸”<code>ç¯å¢ƒå˜é‡</code>æ— å…³å·¥ä½œç›®å½•</p><p>éš¾é“æ˜¯â€¦</p><h2 id="å¾—"><a href="#å¾—" class="headerlink" title="å¾—"></a>å¾—</h2><p>æˆ‘è¿˜å‘ç°ä¸€ä¸ªç»†èŠ‚ï¼šä¸æ˜¯æ‰€æœ‰çš„<code>ç¯å¢ƒå˜é‡</code>éƒ½ä¸èƒ½ä½¿ç”¨ï¼Œè€Œæ˜¯æŸäº›â€¦</p><p>æ¬¸ï¼ŒæŸäº›ï¼</p><p>æˆ‘é‚è¿›å…¥<code>ç¯å¢ƒå˜é‡</code>è®¾ç½®å…¥å£æŸ¥çœ‹</p><p><img src="/img/image-20210821181712344.png" alt="ç¯å¢ƒå˜é‡"></p><p>åŸæ¥<code>ç¯å¢ƒå˜é‡</code>åˆ†ä¸ºä¸¤ç§ï¼š<code>ç”¨æˆ·å˜é‡</code>ä¸<code>ç³»ç»Ÿå˜é‡</code></p><p><code>ç”¨æˆ·å˜é‡</code>åªèƒ½è¢«ç‰¹å®šç”¨æˆ·è¯†åˆ«ï¼Œè€Œ<code>ç³»ç»Ÿå˜é‡</code>å¯ä»¥ä¸ºæ‰€æœ‰ç”¨æˆ·ä½¿ç”¨</p><p>è€Œä¸”ï¼Œé‚£äº›ä¸èƒ½è¢«<code>ShellExecute()</code>å¯åŠ¨çš„<code>CMD</code>è¯†åˆ«çš„ç¯å¢ƒå˜é‡å°±åœ¨<code>ç”¨æˆ·å˜é‡</code>çš„PATHä¸­</p><h2 id="å…¶è§£"><a href="#å…¶è§£" class="headerlink" title="å…¶è§£"></a>å…¶è§£</h2><p>ç ´æ¡ˆäº†</p><p>è™½ç„¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä½†</p><h4 id="ShellExecute-å¯åŠ¨çš„CMDè²Œä¼¼ä¸èƒ½è¯†åˆ«ç”¨æˆ·å˜é‡"><a href="#ShellExecute-å¯åŠ¨çš„CMDè²Œä¼¼ä¸èƒ½è¯†åˆ«ç”¨æˆ·å˜é‡" class="headerlink" title="ShellExecute()å¯åŠ¨çš„CMDè²Œä¼¼ä¸èƒ½è¯†åˆ«ç”¨æˆ·å˜é‡"></a><code>ShellExecute()</code>å¯åŠ¨çš„<code>CMD</code>è²Œä¼¼ä¸èƒ½è¯†åˆ«<code>ç”¨æˆ·å˜é‡</code></h4><p>é‚ï¼Œå°†ä¹‹è®¾ä¸º<code>ç³»ç»Ÿå˜é‡</code>ï¼Œé‡å¯ï¼Œsolveï¼</p><h4 id="è®°å¾—ä¸€å®šè¦é‡å¯å“ˆ-lt-è§£å†³99-é—®é¢˜"><a href="#è®°å¾—ä¸€å®šè¦é‡å¯å“ˆ-lt-è§£å†³99-é—®é¢˜" class="headerlink" title="!!!è®°å¾—ä¸€å®šè¦é‡å¯å“ˆ &lt;-è§£å†³99%é—®é¢˜"></a>!!!è®°å¾—ä¸€å®šè¦é‡å¯å“ˆ &lt;-è§£å†³99%é—®é¢˜</h4>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
      <tag>CMD</tag>
      
      <tag>ç¯å¢ƒå˜é‡</tag>
      
      <tag>ShellExecute</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
